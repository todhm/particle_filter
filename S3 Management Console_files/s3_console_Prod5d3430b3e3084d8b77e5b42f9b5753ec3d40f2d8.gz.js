"use strict";(function(){var h="integ";var b={LOCAL:"LOCAL",PROD:"PROD",GAMMA:"GAMMA"};var i={PUBLIC:{NAME:"PUBLIC",SUFFIX:"aws.amazon.com",PROD:"console.aws.amazon.com",GAMMA:"awsc-integ.aws.amazon.com"},CN:{NAME:"CN",SUFFIX:"amazonaws.cn",PROD:"console.amazonaws.cn",GAMMA:"aws-console-platform-proxy-integ-bjs.integ.amazonaws.cn"},GOV:{NAME:"GOV",SUFFIX:"amazonaws-us-gov.com",PROD:"console.amazonaws-us-gov.com",GAMMA:"aws-console-proxy-staging.integ.amazonaws-us-gov.com"},ISO:{NAME:"ISO",SUFFIX:"c2shome.ic.gov",PROD:"console.c2shome.ic.gov",GAMMA:"awsc-integ.dca.amazon.com"}};var l="s3";var d=[l,"batchOpsServlet","sns","sqs","lambda","kms","cloudwatch","glacier"];var g={PUBLIC:"us-east-1",CN:"cn-north-1",GOV:"us-gov-west-1",ISO:"us-iso-east-1"};var m=["us-east-1","us-east-2","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-south-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","ap-northeast-2","sa-east-1"];var f={PUBLIC:{PROD:["us-east-1","us-east-2","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-south-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","ap-northeast-2","sa-east-1","ca-central-1","eu-west-2"],GAMMA:["us-east-1","eu-west-1"]},CN:{PROD:["cn-north-1"],GAMMA:["cn-north-1"]},GOV:{PROD:["us-gov-west-1"],GAMMA:["us-gov-west-1"]},ISO:{PROD:["us-iso-east-1"],GAMMA:["us-iso-east-1"]}};_.remove(f.PUBLIC.PROD,function(n){return n!==g.PUBLIC&&!e(n)});if(f.PUBLIC.PROD.length===1){f.PUBLIC.PROD=m}var k={PUBLIC:["us-east-1","us-east-2","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-south-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","ap-northeast-2","ca-central-1","eu-west-2","sa-east-1"],CN:["cn-north-1"],GOV:["us-gov-west-1"],ISO:["us-iso-east-1"]};var j=b.LOCAL;var a=b.LOCAL;_.forEach(i,function(n){if(_.contains(window.location.host,n.SUFFIX)||_.contains(window.location.host,n.GAMMA)){a=n.NAME;j=_.contains(window.location.host,h)?b.GAMMA:b.PROD}});var c={};if(a===i.PUBLIC.NAME){d.forEach(function(n){c[n]={};k[a].forEach(function(o){var p=_.includes(f[a][j],o)?o:g[a];if(n!==l){c[n][o]="https://"+p+"."+i[a][j]+"/s3/"+n+"-proxy"}else{c[n][o]="https://"+p+"."+i[a][j]+"/s3/proxy"}})});angular.module("awsconsole.common").constant("S3Endpoint",c[l]);angular.module("awsconsole.common").constant("S3CWSEndpoint",c.batchOpsServlet);angular.module("awsconsole.common").constant("SNSEndpoint",c.sns);angular.module("awsconsole.common").constant("SQSEndpoint",c.sqs);angular.module("awsconsole.common").constant("LambdaEndpoint",c.lambda);angular.module("awsconsole.common").constant("KMSEndpoint",c.kms);angular.module("awsconsole.common").constant("CloudWatchEndpoint",c.cloudwatch);angular.module("awsconsole.common").constant("GlacierEndpoint",c.glacier)}else{angular.module("awsconsole.common").constant("S3Endpoint","/s3/proxy");angular.module("awsconsole.common").constant("S3CWSEndpoint","/s3/batchOpsServlet-proxy");angular.module("awsconsole.common").constant("SNSEndpoint","/s3/sns-proxy");angular.module("awsconsole.common").constant("KMSEndpoint","/s3/kms-proxy");angular.module("awsconsole.common").constant("LambdaEndpoint","/s3/lambda-proxy");angular.module("awsconsole.common").constant("SQSEndpoint","/s3/sqs-proxy");angular.module("awsconsole.common").constant("CloudWatchEndpoint","/s3/cloudwatch-proxy");angular.module("awsconsole.common").constant("GlacierEndpoint","/s3/glacier-proxy")}angular.module("awsconsole.common").constant("IAMEndpoint","/s3/iam-proxy");angular.module("awsconsole.common").constant("IAMAdminEndpoint","/s3/iamadmin-proxy");angular.module("awsconsole.common").constant("OptOutEndpoint","/s3/optOutServlet-proxy");function e(q){var o={};var n=$("#meta-features-json");if(!n||!n.attr("data-featuresjson")){return false}var p=JSON.parse(n.attr("data-featuresjson"));if(angular.isArray(p)){p.forEach(function(r){o[r.externalId]=r.enabled})}return o["s3-prod-stack-"+q]===true}})();"use strict";(function(){var a=angular.module("s3",["AWS-DBUX-FAC","AWS-UI-Components","awsCommonComponents","awsconsole.common","ngCookies","ngRoute","ui.ace","pascalprecht.translate","storageconsole.common"]);a.config(["$routeProvider","$locationProvider","S3Constants",function(d,b,c){b.html5Mode({enabled:true});d.when("/"+c.PATH_SEGMENTS.OBJECT_DETAILS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME+"/:"+c.PATH_SEGMENTS.KEY_PREFIX+"*",{templateUrl:"/s3/partials/object-details/objectdetails.html",controller:"ObjectDetailsController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME+"/:"+c.PATH_SEGMENTS.KEY_PREFIX+"*",{templateUrl:"/s3/partials/bucketdetails.html",controller:"ObjectController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME+"/",{templateUrl:"/s3/partials/bucketdetails.html",controller:"ObjectController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/ot/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME+"/:"+c.PATH_SEGMENTS.KEY_PREFIX+"*/"+c.PATH_SEGMENTS.OBJECT_DETAILS,{templateUrl:"/s3/partials/object-details/objectdetails.html",controller:"ObjectDetailsController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/lc/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME,{templateUrl:"/s3/partials/bucketdetails.html",controller:"ObjectController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/oi/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME,{templateUrl:"/s3/partials/bucketdetails.html",controller:"ObjectController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.when("/si/"+c.PATH_SEGMENTS.BUCKETS+"/:"+c.PATH_SEGMENTS.BUCKET_NAME,{templateUrl:"/s3/partials/bucketdetails.html",controller:"ObjectController",resolve:{translations:["$translate",function(e){return e.onReady()}]}});d.otherwise({templateUrl:"/s3/partials/buckets.html",controller:"LambController",resolve:{translations:["$translate",function(e){return e.onReady()}]}})}]);a.config(["$httpProvider",function(b){b.defaults.useXDomain=true;b.defaults.withCredentials=true}]);a.config(["$translateProvider",function(d){var b={en:"/s3/translations/messages_en.json",en_US:"/s3/translations/messages_en.json",zh:"/s3/translations/messages_zh_cn.json",zh_CN:"/s3/translations/messages_zh_cn.json",ja:"/s3/translations/messages_ja_jp.json",ja_JP:"/s3/translations/messages_ja_jp.json",fr:"/s3/translations/messages_fr.json",fr_FR:"/s3/translations/messages_fr.json",ko:"/s3/translations/messages_ko.json"};var c=$("meta[property='requestLocale']").attr("content");d.useStaticFilesLoader({filePath:b[c]}).preferredLanguage(c);d.useSanitizeValueStrategy("escapeParameters");d.forceAsyncReload(true)}]);a.filter("humanReadableBytes",["S3Constants",function(b){return function(d,c){if(d===0){return d+" "+b.UNITS[d]}if(isNaN(d)){return""}if(typeof c==="undefined"){c=1}var e=Math.floor(Math.log(d)/Math.log(1024));return(d/Math.pow(1024,Math.floor(e))).toFixed(c)+" "+b.UNITS[e]}}])})();"use strict";(function(){angular.module("s3").constant("S3Constants",{API_MAX_ITEMS:{LAMBDA_LIST_FUNCTIONS:10000,IAM_LIST_ROLES:1000},CLOG_PAGE_ID:"s3v2",CLOG_OBJECTS_PAGE_ID:"s3v2-objects",CLOG_OBJECTS_DETAILS_PAGE_ID:"s3v2-objectdetails",DELIMITER:"/",PATH_SEGMENTS:{HOME:"home",BUCKETS:"buckets",BUCKET_NAME:"bucketName",KEY_PREFIX:"prefix",OBJECT_DETAILS:"object"},SHOW_DELETED_PARAM:"showdeleted",UPLOAD:{TIMEOUT_MSECS:3600000,PART_SIZE_IN_BYTES:8388608,MAX_NUMBER_OF_PARTS:10000,MIN_NUMBER_OF_PARTS:1,ZERO_BYTE_MD5:"d41d8cd98f00b204e9800998ecf8427e",CUSTOM_ARN:"CUSTOM_ARN",USER_ERROR_MESSAGES:["Access Denied","Forbidden","Bad Request","Your proposed upload is smaller than the minimum allowed size","OptionsRequestDenied","OptionsResponseMissingHeaders"]},OBJECT_SSE:{AES256:"AES256",CUSTOM_ARN:"CUSTOM_ARN",KMS_ENCRYPTION:"aws:kms",NONE:"NONE",KMS:{ALIAS:":alias/",KEY:":key/"}},INITIATE_RESTORE:{BULK_RETRIEVAL:"Bulk",STANDARD_RETRIEVAL:"Standard",EXPEDITED_RETRIEVAL:"Expedited",EXPEDITED_RETRIEVAL_COST:{"ap-northeast-1":110,"ap-northeast-2":110,"ap-south-1":120,"ap-southeast-2":120,"ca-central-1":110,"cn-north-1":110,"eu-central-1":120,"eu-west-1":100,"eu-west-2":105,"us-east-1":100,"us-east-2":100,"us-gov-west-1":130,"us-iso-east-1":150,"us-west-1":110,"us-west-2":100}},MULTIPART_COPY:{PART_SIZE:16777216},HTTP_STATUS_CODES:{OK:200,PERMANENT_REDIRECT:301,ACCESS_DENIED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,SERVER_ERROR_THRESHOLD:500,CLIENT_ERROR_THRESHOLD:300},NETWORK_ERROR:"NETWORK_ERROR",BATCH_OPS_MAX_KEYS_PER_OP:20,LIST_OBJECTS_MAX_KEYS_PER_LISTING:100,LIST_DELETED_OBJECTS_MAX_KEYS_PER_LISTING:1000,FAC:{ACCELERATE:"s3-x-acceleration",CRR:"s3-crr",CRR_V2:"s3-crr-v2",OBJECT_TAGGING:"s3-ot",TAG_QUERY:"s3-tq",QUICKSIGHT:"s3-qs",NEW_MULTIPART_COPY:"s3-new-multipart-copy",ANALYTICS:"s3-an",INVENTORY:"s3-oi",KMS:"s3-kms",METRICS:"s3-me",NO_ENC:"s3-no-enc",S3_RRS:"s3-rrs",QUICKSIGHT_LINK:"aws-quicksight"},OPERATION:{NAME:"opName",ID:"opId",STEP:"opStep",INITIAL_BUCKET:"initialBucket",INITIAL_PATH:"initialPath",BUCKET_REGION:"bucketRegion",TIMESTAMP:"timestamp",CURRENT_BUCKET:"currentBucket",CURRENT_PATH:"currentPath",CWS_OP_ID:"cwsOpId",ERROR_STATUS:"errorStatus",THRESHOLD_PERCENTAGE:15},OPERATION_MANAGER_LOGGING:{STARTED:"S3ConsoleOperationStarted",ADDED:"S3ConsoleOperationsAdded",ENQUEUED:"S3ConsoleOperationsEnqueued",DEQUEUED:"S3ConsoleOperationsDequeued",CANCELED:"S3ConsoleOperationCanceled",COMPLETED:"S3ConsoleOperationCompleted"},OPERATION_PER_KEY_STATUS:{DONE:"SUCCESS",IN_PROGRESS:"IN_PROGRESS",ERROR:"ERROR"},S3_RESPONSE_HEADERS:{X_AMZ_ID_2:"x-amz-id-2",X_AMZ_REQUEST_ID:"x-amz-request-id",X_AMZ_BUCKET_REGION:"x-amz-bucket-region"},OPERATION_STATE:{ACTIVE:"active",WAITING:"waiting",CANCEL:"cancel",ERROR:"error",COMPLETED:"completed"},OPERATION_NAME:{ADD_OBJECT_TAG:"Add object tags",COPY:"Copy",CUT:"Cut",PASTE:"Paste",GET_INFO:"GetInfo",MAKE_PUBLIC:"Make public",DELETE_OBJECTS:"Delete objects",RESTORE_OBJECTS:"Restore objects",EDIT_PERMISSIONS:"Edit permissions",CHANGE_STORAGE_CLASS:"Change storage class",CHANGE_SSE:"Change SSE",UPLOAD:"Upload",LAMB:"LAMB",RENAME:"Rename",GET_OBJECT_DETAILS:"GetObjectDetails",LIST_DELETED_OBJECTS:"ListDeletedObjects",LIST_VERSIONS:"ListVersions",SWITCH_VERSION:"SwitchVersion",EMPTY_BUCKET:"Empty bucket",DELETE_BUCKET:"Delete bucket",CHANGE_METADATA:"Change metadata",GET_OBJECT_TAGGING:"GetObjectTagging",PUT_OBJECT_TAGGING:"PutObjectTagging",INITIATE_RESTORE:"Initiate restore",GET_METADATA:"Get object metadata",GET_OBJECT_METADATA:"getObjectMetadataProxy",METRICS_GET_CONFIG:"GetMetricsConfig",METRICS_PUT_CONFIG:"PutMetricsConfig",METRICS_DELETE_CONFIG:"DeleteMetricsConfig",ANALYTICS_GET_CONFIG:"GetAnalyticsConfig",ANALYTICS_PUT_CONFIG:"PutAnalyticsConfig",ANALYTICS_DELETE_CONFIG:"DeleteAnalyticsConfig",ANALYTICS_GET_DATA:"GetAnalyticsData",SWITCH_BACK_TO_OLD_CONSOLE:"SwitchBackToOriginal",IS_INVENTORY_ENABLED:"isInventoryEnabled",IS_ANALYTICS_ENABLED:"isAnalyticsEnabled",IS_LIFECYCLE_ENABLED:"isLifecycleEnabled",IS_METRICS_ENABLED:"isMetricsEnabled",GET_BUCKET_POLICY:"GetBucketPolicy",PUT_BUCKET_POLICY:"PutBucketPolicy"},METRIC_NAME:{LIFECYCLE_RULE_MISMATCH:"LifecycleRuleMismatch"},CWS_OPERATION_NAME:{ADD_OBJECT_TAG:"AddTags",CHANGE_METADATA:"ChangeMetadata",CHANGE_SSE:"ChangeSSE",CHANGE_STORAGE_CLASS:"ChangeStorageClass",COMPLETE_MULTIPART_COPY:"CompleteMultipartCopy",COPY:"CopyObject",GENERATE_COUNT:"Count",GENERATE_PRESIGNED_URL:"GeneratePresignedUrl",GET_METADATA:"GetObjectMetadata",INITIATE_RESTORE:"RestoreObject",MAKE_PUBLIC:"MakePublic",MULTIPART_COPY:"MultipartCopy"},OPERATION_PROGRESS_UPDATE_TYPE:{SINGLE_PART_RESULTS:"SinglePart",MULTIPART_COPY_RESULT:"MultipartCopy",MULTIPART_COPY_COMPLETE:"MultipartCopyComplete",MULTIPART_COPY_ALL_COMPLETE:"MultipartCopyAllComplete",MULTIPART_COPY_ERROR:"MultipartCopyError"},PROGRESS_BAR:{USER_CONFIRM_CANCEL_FROM_PROGRESS_BAR:"S3ConsoleUserConfirmCancelProgressBar",USER_CONFIRM_CANCEL_FROM_DETAIL_MODAL:"S3ConsoleUserConfirmCancelDetailModal"},CACHE:{SIZE:{BUCKET_LOCATION:1000,BUCKET_PROPERTIES:11,LAMB:1,LIST_OBJECTS:50}},DIRECTORY_CONTENT_TYPE:"application/x-directory",OPT_OUT_COOKIE:{COOKIE_KEY:"awsc-experiment-override",PATH:"/s3",VALUE:{PUBLIC:'{"s3_v2":"old"}',CN:'{"s3_v2":"old"}'}},HEADERS:{CACHE_CONTROL:"Cache-Control",CONTENT_DISPOSITION:"Content-Disposition",CONTENT_ENCODING:"Content-Encoding",CONTENT_LENGTH:"Content-Length",CONTENT_MD5:"Content-MD5",CONTENT_TYPE:"Content-Type",CONTENT_TYPE_JSON:"application/x-amz-json-1.1",EXPECT:"Expect",EXPIRES:"Expires",X_AMZ_MFA:"x-amz-mfa",X_AMZ_STORAGE_CLASS:"x-amz-storage-class",X_AMZ_SERVER_SIDE_ENCRYPTION:"x-amz-server-side-encryption",X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID:"x-amz-server-side-encryption-aws-kms-key-id",X_AMZ_GRANT_READ:"x-amz-grant-read",X_AMZ_RESTORE:"x-amz-restore",X_AMZ_GRANT_READ_ACP:"x-amz-grant-read-acp",X_AMZ_GRANT_WRITE:"x-amz-grant-write",X_AMZ_GRANT_WRITE_ACP:"x-amz-grant-write-acp",X_AMZ_WEBSITE_REDIRECT_LOCATION:"x-amz-websiteâ€‹-redirect-location",X_AMZ_REPLICATION_STATUS:"x-amz-replication-status",OPERATION:"X-Amazon-S3Console-Operation",X_AMZ_ID_2:"x-amz-id-2",X_AMZ_REQUEST_ID:"x-amz-request-id",X_AMZ_DATE:"X-Amz-Date",X_AMZ_EXPIRATION:"x-amz-expiration",X_AMZ_TAGGING:"x-amz-tagging",X_AMZ_TAGGING_COUNT:"x-amz-tagging-count"},STORAGE_CLASSES:{DEFAULT:"default",GLACIER:"GLACIER",Glacier:"GLACIER",REDUCED_REDUNDANCY:"REDUCED_REDUNDANCY","Reduced redundancy":"REDUCED_REDUNDANCY",STANDARD:"STANDARD",Standard:"STANDARD",STANDARD_INFREQUENT_ACCESS:"STANDARD_IA","Standard - IA":"STANDARD_IA"},UNITS:["B","KB","MB","GB","TB","PB"],LOGGING:{S3_REQUEST_PREFIX:"s3Req",S3_RESPONSE_PREFIX:"s3Res",CWS_REQUEST_PREFIX:"cwsReq",CWS_RESPONSE_PREFIX:"cwsRes"},ACL_PERMISSIONS:{READ:"READ",WRITE:"WRITE",READ_ACP:"READ_ACP",WRITE_ACP:"WRITE_ACP",FULL_CONTROL:"FULL_CONTROL"},VERSIONS:{LIST_VERSIONS_COMPLETED:"ListVersionsCompleted"},PUBLIC_PERMISSIONS_LIST:["AuthenticatedUsers","AllUsers"],SYSTEM_PERMISSIONS_LIST:["LogDelivery"],LOG_DELIVERY_VALUE:"LogDelivery",BUCKET_PERMISSIONS:{PUT_BUCKET_PERMISSIONS_REQUEST:"put-bucket-permissions-request",GET_BUCKET_OWNER:"get-bucket-owner",CREATE_BUCKET_PERMISSIONS:"CreateBucketPermissions",INITIALIZE_ACLS:{publicPermissions:[{detail:{text:"Any AWS user",value:"AuthenticatedUsers",Type:"Group",URI:"http://acs.amazonaws.com/groups/global/AuthenticatedUsers"},permissions:{READ:false,READ_ACP:false,WRITE:false,WRITE_ACP:false}},{detail:{text:"Everyone",value:"AllUsers",Type:"Group",URI:"http://acs.amazonaws.com/groups/global/AllUsers"},permissions:{READ:false,READ_ACP:false,WRITE:false,WRITE_ACP:false}}],userPermissions:[{permissions:{READ:true,READ_ACP:true,WRITE:true,WRITE_ACP:true},revokeAll:false}],systemPermissions:[{detail:{text:"LogDelivery",value:"LogDelivery",Type:"Group",URI:"http://acs.amazonaws.com/groups/s3/LogDelivery"},permissions:{READ:false,READ_ACP:false,WRITE:false,WRITE_ACP:false}}]},SAMPLE_CORS_POLICY:"<!-- Sample policy -->\n<CORSConfiguration>\n\t<CORSRule>\n\t\t<AllowedOrigin>*</AllowedOrigin>\n\t\t<AllowedMethod>GET</AllowedMethod>\n\t\t<MaxAgeSeconds>3000</MaxAgeSeconds>\n\t\t<AllowedHeader>Authorization</AllowedHeader>\n\t</CORSRule>\n</CORSConfiguration>",POLICY_GEN:{PUBLIC:"http://awspolicygen.s3.amazonaws.com/policygen.html",CN:"https://awspolicygen.s3.cn-north-1.amazonaws.com.cn/policygen.html",GOV:"https://awspolicygen.s3-fips-us-gov-west-1.amazonaws.com/policygen.html",ISO:"https://awspolicygen.s3.us-iso-east-1.c2s.ic.gov/policygen.html"}},BUCKET_PROPERTIES:{WEBSITE:{USE_BUCKET:"useBucket",PROPERTY_NAME:"website",INDEX_FILE:"index.html",CREATE_BUCKET_CARD:"create-bucket-website-card",REDIRECT_REQUEST:"redirectRequest",CONFIGURE_BUCKET_WEBSITE:"configureBucketWebsite",REDIRECT_BUCKET_WEBSITE_REQUESTS:"redirectBucketWebsiteRequests",NO_WEBSITE_CONFIGURATION_MESSAGE:"The specified bucket does not have a website configuration",DISABLE:"disable",REGION_TO_WEBSITE_ENDPOINT_MAP:{"us-east-1":"s3-website-us-east-1.amazonaws.com","us-west-2":"s3-website-us-west-2.amazonaws.com","us-west-1":"s3-website-us-west-1.amazonaws.com","eu-west-1":"s3-website-eu-west-1.amazonaws.com",EU:"s3-website-eu-west-1.amazonaws.com","ap-southeast-1":"s3-website-ap-southeast-1.amazonaws.com","ap-northeast-1":"s3-website-ap-northeast-1.amazonaws.com","ap-southeast-2":"s3-website-ap-southeast-2.amazonaws.com","sa-east-1":"s3-website-sa-east-1.amazonaws.com","eu-central-1":"s3-website.eu-central-1.amazonaws.com","ap-northeast-2":"s3-website.ap-northeast-2.amazonaws.com","ap-south-1":"s3-website.ap-south-1.amazonaws.com","us-east-2":"s3-website.us-east-2.amazonaws.com","ca-central-1":"s3-website.ca-central-1.amazonaws.com","eu-west-2":"s3-website.eu-west-2.amazonaws.com","us-gov-west-1":"s3-website-us-gov-west-1.amazonaws.com","us-iso-east-1":"s3-website.us-iso-east-1.c2s.ic.gov","cn-north-1":"s3-website.cn-north-1.amazonaws.com.cn"}},TAGGING:{PROPERTY_NAME:"tagging",CREATE_BUCKET_CARD:"create-bucket-tagging-card",PUT_BUCKET_TAGGING:"putBucketTagging",TAG_SET_NOT_EXIST_MESSAGE:"The TagSet does not exist"},PUT_BUCKET_ACL:"putBucketACL",GET_BUCKET_ACL:"getBucketACL",LOGGING:{ENABLE_BUCKET_LOGGING:"enableBucketLogging",CREATE_BUCKET_CARD:"create-bucket-logging-card",ENABLE:"enable"},VERSIONING:{ENABLE_BUCKET_VERSIONING:"enableBucketVersioning",CREATE_BUCKET_CARD:"create-bucket-versioning-card",ENABLED:"Enabled",SUSPENDED:"Suspended",ENABLE:"enable"},REPLICATION:{CREATE_BUCKET_CARD:"create-bucket-replication-card",PUT_REPLICATION:"putBucketReplication",DISABLED:"Disabled",ENABLED:"Enabled"},EVENTS:{PUT_NOTIFICATION:"putBucketNotification",CREATE_BUCKET_CARD:"create-bucket-events-card"},REPORTS:{CREATE_BUCKET_CARD:"create-bucket-reports-card",FREQUENCY:{DAILY:"DAILY",WEEKLY:"WEEKLY"},VERSIONING:{ALL:"All",CURRENT:"Current"},TYPE:{OBJECT:"OBJECT"},FORMAT:{CSV:"CSV"}},ENABLE:"enable",DISABLE:"disable",GROUP_GANTEE_TYPE:"Group",LOG_DELIVERY_GROUP:"http://acs.amazonaws.com/groups/s3/LogDelivery"},BULK_OPERATION_KEYS_PER_REQUEST:{S3_API:1000,CWS_API:20},BULK_OPERATION_KEY_COUNT_PER_ERROR_TYPE:100,BUCKET_EVENTS:{PUT:"s3:ObjectCreated:Put",POST:"s3:ObjectCreated:Post",COPY:"s3:ObjectCreated:Copy",COMPLETE_MULTIPART_UPLOAD:"s3:ObjectCreated:CompleteMultipartUpload",DELETE:"s3:ObjectRemoved:Delete",DELETE_MARKER_CREATED:"s3:ObjectRemoved:DeleteMarkerCreated",RRS_OBJECT_LOST:"s3:ReducedRedundancyLostObject",CREATE_OBJECT_ALL:"s3:ObjectCreated:*",DELETE_OBJECT_ALL:"s3:ObjectRemoved:*"},EVENTS:{PREFIX:"Prefix",SUFFIX:"Suffix",SNS:"SNS",SQS:"SQS",LAMBDA:"Lambda",CUSTOM:"custom",CLOUDCONFIG:"CloudFunctionConfiguration",QUEUECONFIG:"QueueConfiguration",TOPICCONFIG:"TopicConfiguration",TOPIC:"Topic",QUEUE:"Queue",CLOUDFN:"CloudFunction",CUSTOM_PLACEHOLDER:{LAMBDA:"us-east-1:123456789:function:my_function_name",SNS:"us-east-1:123456789012:my_topic",SQS:"us-east-1:123456789012:my_queue"}},REPLICATION:{ENABLED:"Enabled",DISABLED:"Disabled",CONFIGNOTFOUND:"The replication configuration was not found",NEWROLE:"newrole",ERROR_CODE:{ENTITY_EXIST:"EntityAlreadyExists",ACCESS_DENIED:"AccessDenied",LIMIT_EXCEED:"LimitExceeded"}},TAGGING:{ERROR_CODES:{NO_SUCH_TAG_SET:"NoSuchTagSet"},MAX_ALLOWED_TAGS:10},USER_DEFINED_METADATA:["Cache-Control","Content-Disposition","Content-Encoding","Content-Language","Content-Type","Expires","x-amz-website-redirect-location"],CONTENT_TYPE_VALUES:[{text:"binary/octet-stream"},{text:"image/png"},{text:"image/jpeg"},{text:"image/gif"},{text:"image/bmp"},{text:"image/tiff"},{text:"text/plain"},{text:"text/rtf"},{text:"application/msword"},{text:"application/zip"},{text:"audio/mpeg"},{text:"application/pdf"},{text:"application/x-gzip"},{text:"application/x-compressed"},{text:"application/zip"}],USER_DEFINED_METADATA_PREFIX:"x-amz-meta-",FILE_EXTENSIONS_ICON_MAP:{"default":"file-o","7z":"file-archive-o",dmg:"file-archive-o",gz:"file-archive-o",iso:"file-archive-o",jar:"file-archive-o",rar:"file-archive-o",tar:"file-archive-o",tgz:"file-archive-o",war:"file-archive-o",z:"file-archive-o",zip:"file-archive-o",mp3:"file-audio-o",bin:"file-code-o",c:"file-code-o","c++":"file-code-o",css:"file-code-o",html:"file-code-o",java:"file-code-o",js:"file-code-o",py:"file-code-o",sh:"file-code-o",xml:"file-code-o",xl:"file-excel-o",xlsx:"file-excel-o",xlsm:"file-excel-o",gif:"file-image-o",jpeg:"file-image-o",jpg:"file-image-o",png:"file-image-o",pdf:"file-pdf-o",ppt:"file-powerpoint-o",rt:"file-text-o",rtf:"file-text-o",rtx:"file-text-o",text:"file-text-o",txt:"file-text-o",avi:"file-video-o",flv:"file-video-o",m4v:"file-video-o",mov:"file-video-o",movie:"file-video-o",mp4:"file-video-o",qt:"file-video-o",wmv:"file-video-o",doc:"file-word-o",docm:"file-word-o",docx:"file-word-o",word:"file-word-o",trash:"trash-o"},LIFECYCLE:{NAME:"lifecycle",ENABLED:"Enabled",DISABLED:"Disabled",SIA:"SIA",GLACIER:"Glacier",EXPIRE:"Expire",AMU:"AMU",PREFIX_PROPERTY:"Prefix",PERMANENTLY_DELETE:"PermanentlyDelete",LIST_VIEW:{STANDARD_IA:"Standard-IA",GLACIER:"Amazon Glacier",PREFIX:"prefix : ",WHOLE:"Whole bucket",PermanentlyDelete:"Permanently Delete"},REVIEW_SECTION_TRANSITIONS:{SIA:"Standard-IA",Glacier:"Amazon Glacier",Expire:"Expire",PermanentlyDelete:"Permanently delete"},MAX_DAYS_ALLOWED:2147483647,EXPONENTIAL:"e",EXPIRATION:"Expiration",NON_CURRENT_VERSION_EXPIRATION:"NoncurrentVersionExpiration",NON_CURRENT_DAYS:"NoncurrentDays",DAYS:"Days",STORAGE_CLASS:"StorageClass",TRUE:"true",FALSE:"false",WHOLE_BUCKET:"whole",PREFIX:"prefix",TOTAL_OPTIONS:2,RULE_ACTIONS_MAP:{STANDARD_IA:"SIA",GLACIER:"Glacier",Expiration:"Expire",NoncurrentVersionExpiration:"PermanentlyDelete"},KEY:"Key",VALUE:"Value",TAGSET:"Tags",NONCURRENT_RULE_OPTIONS_MAP:{SIA:0,Glacier:1,PermanentlyDelete:2},CURRENT_RULE_OPTIONS_MAP:{SIA:0,Glacier:1,Expire:2},TAGS:"Tags",KEY_STRING:"Key",VALUE_STRING:"Value",BUCKET_LIFECYCLE:"BucketLifecycle",GET_BUCKET_LIFECYCLE:"getBucketLifecycle",PUT_BUCKET_LIFECYCLE:"putBucketLifecycle",ENABLED_LIFECYCLE_RULE_ACTIONS:"enabledLifecycleRuleActions",CREATE_BUCKET_LIFECYCLE:"createLifecycleRule",EDIT_BUCKET_LIFECYCLE:"editLifecycleRule",CURRENT:"current",NONCURRENT:"noncurrent",AMU_DEFAULT_DAYS:"7",LIFECYCLE_RULE_ACTION_MIN_DAYS:{SIA:30,Glacier:0,Expire:1,PermanentlyDelete:1,AMU:1,Delete:1},RECOMMENDED_DAYS:{SIA:"30",GLACIER:"1",EXPIRATION:"365"},RULE_ACTION_ERRORS:{SIA:0,GLACIER:1,EXPIRE:2,PERMANENTLY_DELETE:2,DELETE_RULE_ACTION:2,GLACIER_GREATER_THAN_SIA:"GlacierGreaterThanSIA",DELETE_RULE_ACTION_GREATER_THAN_SIA:"DeleteGreaterThanSIA",DELETE_RULE_ACTION_GREATER_THAN_GLACIER:"DeleteGreaterThanGlacier"},LIFECYCLE_DOES_NOT_EXIST_MESSAGE:"The lifecycle configuration does not exist",CONFIRMATION_MODAL:{ENABLE_POLICY:"enablePolicy",DISABLE_POLICY:"disablePolicy",DELETE_POLICY:"deletePolicy"},LIST_VIEW_MAX_LENGTH:25,ENABLE_LIFECYCLE_POLICY:"enableLifecyclePolicy",DISABLE_LIFECYCLE_POLICY:"disableLifecyclePolicy",DELETE_LIFECYCLE_POLICY:"deleteLifecyclePolicy"},KEY_CODES:{DOWN:40,ENTER:13,ESC:27,UP:38},ENTITY_MAX_LENGTH:{ROLE:64,POLICY:128,PATH:512,TAG_KEY:128,TAG_VALUE:256},REQUEST_METRICS:{SERVER_AVAILABILITY_SUFFIX:"-SerAvail",CLIENT_AVAILABILITY_SUFFIX:"-CliAvail",STATUS_CODE_INFIX:"-Code-",LATENCY_SUFFIX:"-latency"},PROXY_API_NAMES:{KMS:{LIST_KEYS:"KMS-ListKeys"},SNS:{LIST_TOPICS:"SNS-ListTopics"},SQS:{LIST_QUEUES:"SQS-ListQueues"},LAMBDA:{LIST_FUNCTIONS:"LAMBDA-listFunctions"},IAM:{LIST_ROLES:"IAM-ListRoles"},S3:{LAMB:"S3-LAMB",HEAD_BUCKET:"S3-HeadBucket",PUT_OBJECT:"S3-PutObject",HEAD_OBJECT:"S3-HeadObject",CREATE_BUCKET:"S3-CreateBucket",LIST_OBJECT:"S3-ListObject",LIST_VERSION:"S3-ListVersion",GET_OBJECT_TAG:"S3-GetObjectTag",PUT_OBJECT_TAG:"S3-PutObjectTag",GET_OBJECT_ACL:"S3-GetObjectAcl",PUT_OBJECT_ACL:"S3-PutObjectAcl",INITIAL_MULTIPART_UPLOAD:"S3-InitialMPUpload",COMPLETE_MULTIPART_UPLOAD:"S3-CompleteMPUpload",GET_OBJECT_METADATA:"S3-GetObjectMD",GET_PROPERTY_PREFIX:"S3-Get",PUT_PROPERTY_PREFIX:"S3-Put",DELETE_PROPERTY_PREFIX:"S3-Delete",DELETE:"S3-Delete",GET_OBJECT:"S3-GetObject",TAG_QUERY:"S3-TagQuery"},GLACIER:{LIST_PROVISIONED_CAPACITY:"GLACIER-ListCapacity",PURCHASE_PROVISIONED_CAPACTIY:"GLACIER-PurchaseCapacity"}},S3_DEFAULT_ENDPOINT:"https://s3.amazonaws.com",S3_ENDPOINTS:{"us-east-1":"https://s3.amazonaws.com","us-west-2":"https://s3-us-west-2.amazonaws.com","us-west-1":"https://s3-us-west-1.amazonaws.com","eu-west-1":"https://s3-eu-west-1.amazonaws.com","ap-southeast-1":"https://s3-ap-southeast-1.amazonaws.com","ap-northeast-1":"https://s3-ap-northeast-1.amazonaws.com","ap-southeast-2":"https://s3-ap-southeast-2.amazonaws.com","sa-east-1":"https://s3-sa-east-1.amazonaws.com","eu-central-1":"https://s3.eu-central-1.amazonaws.com","ap-northeast-2":"https://s3.ap-northeast-2.amazonaws.com","ap-south-1":"https://s3.ap-south-1.amazonaws.com","us-east-2":"https://s3.us-east-2.amazonaws.com","ca-central-1":"https://s3.ca-central-1.amazonaws.com","eu-west-2":"https://s3.eu-west-2.amazonaws.com","cn-north-1":"https://s3.cn-north-1.amazonaws.com.cn","us-gov-west-1":"https://s3-us-gov-west-1.amazonaws.com","us-iso-east-1":"https://s3.us-iso-east-1.c2s.ic.gov"},SESSION_TIMEOUT_MESSAGE:"Please (re)authenticate or return to https://console.aws.amazon.com",METRICS:{RANGE:{H1:"H1",H3:"H3",H12:"H12",H24:"H24",D3:"D3",W1:"W1",W2:"W2"},TYPE:{STORAGE:"storage",REQUESTS:"requests",DATA:"data"},UNIT:{COUNT:"Count",BYTES:"Bytes",MILLIS:"Milliseconds"}},MANAGEMENT:{VIEWS:{LIFECYCLE:0,REPLICATION:1,ANALYTICS:2,CLOUDWATCH:3,INVENTORY:4},ACTION:{APPLYING_CONFIG:"applyingConfig",SAVING_FILTER:"savingFilter",CONFIG_LOADING:"configLoading",DELETE_FILTER:"deleteFilter",DATA_LOADING:"dataLoading"},FILTER_NAME_REGEX:/^[a-zA-Z0-9\-_.]+$/,POLICY:{SPACING:4,ID:"S3-Console-Auto-Gen-Policy",ACTION:["s3:PutObject","s3:*"],SID:"S3PolicyStmt-DO-NOT-MODIFY",SERVICE_KEY:"Service",SERVICE_VAL:"s3.amazonaws.com",SOURCE_ARN:"aws:SourceArn",ACCOUNT_KEY:"aws:SourceAccount",X_AMZ_ACL_KEY:"s3:x-amz-acl",X_AMZ_ACL_VAL:"bucket-owner-full-control",STATUS:{FAILED:0,CREATED:1,MODIFIED:2,FOUND:3,WARN:4,DENY:5}}},ENTRY_STATE:{CREATE:0,ADDED:1,SAVED:2,REMOVE:3,UPDATE:4},STATUS_CODE_MAP:{"403":"Access Denied","404":"Data not found","500":"Internal Error"},ACCELERATE:{COMPARISON_ENDPOINT:"http://s3-accelerate-speedtest.s3-accelerate.amazonaws.com/en/accelerate-speed-comparsion.html?",ENDPOINT:{PUBLIC:".s3-accelerate.amazonaws.com"}},ANALYTICS:{STORAGE_CLASS:{STANDARD:"STANDARD",STANDARD_IA:"STANDARD-IA",GLACIER:"GLACIER",REDUCED_REDUNDANCY:"REDUCED_REDUNDANCY"},ERROR:{USER_INFO_MISSING:"USER_INFO_MISSING",DATA_FILE_NOT_FOUND:"DATA_FILE_NOT_FOUND"},TAB_VIEW:"Tab",DETAILS:"Details",CREATE_BUCKET_MODAL:"CreateBucketModal",UPLOAD_OBJECTS_MODAL:"UploadObjectsModal",LIFECYCLE_RULES_MODAL:"LifecycleRulesModal",LATEST_VERSION:"LatestVersion",DOWNLOAD_AS:"DownloadAs",ADD_GRANTEE:"AddGrantee",SAVE_LOGGING:"SaveLogging",CANCEL_LOGGING:"CancelLogging",SAVE_WEBSITE:"SaveWebsite",CANCEL_WEBSITE:"CancelWebsite",SAVE_REPLICATION:"SaveReplication",CANCEL_REPLICATION:"CancelReplication",SAVE_EVENTS:"SaveEvents",CANCEL_EVENTS:"CancelEvents",SAVE_VERSIONING:"SaveVersioning",CANCEL_VERSIONING:"CancelVersioning",CONFIRMATION_MODAL:"ConfirmationModal",CARD_OPEN:"CardOpen",SAVE_TAGGING:"SaveTagging",CANCEL_TAGGING:"CancelTagging",SAVE_OBJECT_METADATA:"SaveObjectMetadata",CANCEL_OBJECT_METADATA:"CancelObjectMetadata",SAVE_OBJECT_TAGS:"SaveObjectTags",CANCEL_OBJECT_TAGS:"CancelObjectTags",SAVE_OBJECT_SSE:"SaveObjectSSE",CANCEL_OBJECT_SSE:"CancelObjectSSE",SAVE_OBJECT_STORAGE_CLASS:"SaveObjectStorageClass",CANCEL_OBJECT_STORAGE_CLASS:"CancelObjectStorageClass",SAVE_REQUESTER_PAYS:"SaveRequesterPays",CANCEL_REQUESTER_PAYS:"CancelRequesterPays",CREATE_BUCKET_S3:"CreateBucketS3",START_CREATE_BUCKET:"Start_CreateBucket",NAME_REGION_CREATE_BUCKET:"NameRegion_CreateBucket",SET_PROP_CREATE_BUCKET:"SetProp_CreateBucket",SET_PERM_CREATE_BUCKET:"SetPerm_CreateBucket",REVIEW_CREATE_BUCKET:"Review_CreateBucket",END_CREATE_BUCKET:"End_CreateBucket",SUCCESS_CREATE_BUCKET:"Success_CreateBucket",UPLOAD_FILE_S3:"UploadFileS3",START_UPLOAD_FILE:"Start_UploadFileS3",SELECT_UPLOAD_FILE:"Select_UploadFileS3",SET_PERMISSIONS_UPLOAD_FILE:"SetPerm_UploadFileS3",SET_PROPERTIES_UPLOAD_FILE:"SetProp_UploadFileS3",REVIEW_UPLOAD_FILE:"Review_UploadFileS3",END_UPLOAD_FILE:"End_UploadFileS3",LIFECYCLE_S3:"LifeCycleS3",START_LIFECYCLE:"Start_LifeCycleS3",NAME_SCOPE_LIFECYCLE:"NameScope_LifeCycleS3",TRANSITION_LIFECYCLE:"Transition_LifeCycleS3",EXPIRATIONS_LIFECYCLE:"Expirations_LifeCycleS3",REVIEW_LIFECYCLE:"Review_LifeCycleS3",END_LIFECYCLE:"End_LifeCycleS3",CANCEL_ACCELERATE:"CancelAccelerate",GET_BUCKET_ACCELERATE:"GetBucketAccelerate",PUT_BUCKET_ACCELERATE:"PutBucketAccelerate",SAVE_ACCELERATE:"SaveAccelerate",MANAGEMENT:{ADD_CONFIG:"AddConfig",SAVE_CONFIG:"SaveConfig",DELETE_CONFIG:"DeleteConfig",EDIT_CONFIG:"EditConfig",SEARCH_CONFIG:"SearchConfig",CANCEL_CONFIG:"CancelAddConfig",ANALYTICS:{CONTEXT:"StorageClassAnalysis",QUICKSIGHT_LINK:"QuicksightDeepLink",CHANGE_STORAGE_CLASS:"ChangeStorageClass"},METRICS:{CONTEXT:"StorageCloudwatchMetrics",CLOUDWATCH_LINK:"CloudwatchDeepLink",REFRESH:"RefreshMetrics",PERIOD:{W2:"MetricsPeriod2Weeks",W1:"MetricsPeriod1Week",H24:"MetricsPeriod1Day",H12:"MetricsPeriodHalfDay",H3:"MetricsPeriod3Hours",H1:"MetricsPeriod1Hour"},TYPE:{storage:"StorageMetrics",requests:"RequestsMetrics",data:"DataTransferMetrics"}},INVENTORY:{CONTEXT:"ObjectInventoryContext"}}},LEARN_MORE_LINKS:{ACCELERATE:"console/s3/transfer-acceleration",ENCRYPTION:"console/s3/usingencryption",EVENTS:"console/s3/event-notifications",LAMB:{MAIN:"documentation/s3/"},LOGGING:"console/s3/server-access-logging",METADATA:"console/s3/using-metadata",OBJECT_TAGGING:"console/s3/object-tagging",PERMISSIONS:{POLICY:"console/s3/using-iam-policies",CORS:"console/s3/enablecors"},REPLICATION:"console/s3/replication",STORAGE_CLASS:"console/s3/storageclasses",TAGGING:"console/s3/cost-allocation-tagging",VERSIONING:"console/s3/enable-bucket-versioning",REQUESTER_PAYS:"console/s3/requesterpaysbucket",WEBSITE:{configure:"console/s3/configurebucketforwebsite",redirect:"console/s3/website-redirect",hosting:"console/s3/hostingstaticwebsite"},bucket:["console/s3/usingbucket","console/s3/upload-object","console/s3/accesscontrol"],object:["console/s3/upload-object","console/s3/object-properties","console/s3/accesscontrol"],lifecycle:["console/s3/lifecyclerules","console/s3/lifecycle-transitions","console/s3/lifecycle-expire"],"storage-management":{"analytics-storage-class":"console/s3/analytics-storage-class","configure-metrics-filter":"console/s3/cloudwatch-request-metrics-filter","configure-inventory":"console/s3/configure-inventory",quicksight:"https://quicksight.aws"},replication:["console/s3/replication"]},SUCCESS_MESSAGE_TIMEOUT:5000,TARGET_MEDIATOR:{SUPPORTED_LANGUAGES:["en","jp","cn","fr"],LANGUAGE_MAP:{en:"en",en_us:"en",ja:"jp",ja_jp:"jp",zh:"cn",zh_cn:"cn",fr:"fr",fr_fr:"fr"}},FALLBACK_REGION_LIST:{PUBLIC:["us-east-1","us-east-2","us-west-1","us-west-2","eu-west-1","eu-west-2","eu-central-1","ap-south-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","ap-northeast-2","ca-central-1","sa-east-1"],CN:["cn-north-1"],GOV:["us-gov-west-1"],ISO:["us-iso-east-1"]},DEFAULT_REGION:{PUBLIC:"us-east-1",CN:"cn-north-1",GOV:"us-gov-west-1",ISO:"us-iso-east-1"},ARN_SERVICE:{IAM:"iam::",LAMBDA:"lambda:",S3:"s3:::",SNS:"sns:",SQS:"sqs:"},AWS_SERVICE:{S3:"S3",LAMBDA:"LAMBDA",IAM:"IAM",SQS:"SQS",SNS:"SNS"},BUCKET_PERMISSION_TYPE:{ACL:"acl",CORS:"cors",POLICY:"policy"},CARD_SUMMARY_INIT:{isActive:false,isMultiValue:false,isLoading:false,activeSummary:{text:"",value:""},inactiveSummary:{text:""}},YOUTUBE_VIDEO_LINK:"https://youtu.be/U7e97oK_Elg?list=PLhr1KZpdzukeIOiqk59BgvpmHXOfPon92",CONTEXT_MENU:{OBJECT:{METRIC_NAME:"ObjectContextMenu",Y_OFFSET:125}},PROPERTIES_TITLE_OPNAME_MAPPING:{StorageClass:"Change storage class",Encryption:"Change SSE",Tags:"Add object tags"},LBR_ENDPOINTS:{PUBLIC:"s3.console.aws.amazon.com"},S3_SHARED_DATA:{OBJECT_TEMPLATE:"<account-id>/<bucket-name>/<config-id>/data.csv",BUCKET_TEMPLATE:"s3-analytics-export-shared-<region>-prod"},TABS:{OBJECT:{OBJECTS:0,PROPERTIES:1,PERMISSIONS:2,MANAGEMENT:3},OBJECT_DETAILS:{OVERVIEW:0,PROPERTIES:1,PERMISSIONS:2},OBJECT_LIST:{OVERVIEW:"overview",PROPERTIES:"properties",PERMISSIONS:"permissions"}},MODAL_TYPE:{CREATE_BUCKET:"createbucket",UPLOAD:"upload"}})})();"use strict";(function(){angular.module("s3").directive("fileread",function(){return{restrict:"A",link:function a(d,c,b){c.bind("change",function(e){d.filesSelected(e.target);this.value=""})}}})})();"use strict";(function(){angular.module("s3").controller("LambController",["$filter","$location","$parse","$route","$routeParams","$scope","$window","$translate","APIProxyService","AWSC","AwsUrlsService","BucketPropertiesService","BulkOperationService","CachingService","ConsoleOperation","FAC","Region","S3Constants","SCLogService","UtilService",a]);function a(w,l,e,p,g,z,r,A,B,x,b,m,u,h,q,n,d,v,c,F){var E=new q("InitialLAMBcall","StartLAMBcall");z.loadBuckets=function(I){var H=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var J=arguments.length<=2||arguments[2]===undefined?true:arguments[2];c.log("LoadBucketsReceived",1,I);x.Clog.setPageId(v.CLOG_PAGE_ID);B.listAllMyBuckets(I,J).then(function(K){z.bucketList=K.response.ListAllMyBucketsResult.Buckets.Bucket;x.Timer.customerReady();c.log("LoadBuckets",1,I);z.bucketList.forEach(function(L){m.getBucketLocation(L.Name).then(function(M){z.regions.forEach(function(N){if(N.value===M){L.Location=N.text}})})})})["catch"](function(L){var K=F.handleErrors(L);x.Timer.customerReady();c.log("LoadBuckets",0,I,{errorMessage:K});z.error=K})["finally"](function(){z.isRefreshing=false;if(H){z.isLoadingPage=false}})};c.setEndpoint();z.docLink=b.getMarketingUrl(v.LEARN_MORE_LINKS.LAMB.MAIN);z.currentRegion=d.getCurrentRegion();z.isConfirmationModalOpen={flag:false};z.bucketConfirmationDetails={headerTitle:"",warningMessage:"",operation:"",isDelete:false};z.isLoadingPage=true;z.loadBuckets(E,true);z.isRefreshing=false;z.panelHide=true;z.selectBucket=function(H){l.path(""+v.DELIMITER+v.PATH_SEGMENTS.BUCKETS+v.DELIMITER+H+v.DELIMITER).search("tab","overview")};z.configData={properties:{eventsCount:null,versioning:null,logging:null,staticWebHost:null,tags:null,requesterpays:null},permissions:{owner:null,bucketPolicy:null,accessControlList:null,corsConfiguration:null},management:{lifecycle:null}};if(F.CRRFACHandle().v1){z.configData.properties.replication=null}if(F.CRRFACHandle().v2){z.configData.management.replication=null}if(n.isFeatureEnabled(v.FAC.ACCELERATE)){z.configData.properties.accelerate=null}if(n.isFeatureEnabled(v.FAC.ANALYTICS)){z.configData.management.analytics=null}if(n.isFeatureEnabled(v.FAC.INVENTORY)){z.configData.management.inventory=null}if(n.isFeatureEnabled(v.FAC.METRICS)){z.configData.management.metrics=null}z.regions=[];F.getFACRegions(d.regionMapping,z.regions);z.openConfigPanel=function(H){z.panelHide=false;z.selectedBucket=H;z.panelOpen=true;z.getConfigData(H.Name)};z.notificationShow=true;z.closeNotification=function(){z.notificationShow=false};var i=A.instant("bucketlambda.replicationconfig.notexist");var y=A.instant("bucketlambda.corsconfig.notexist");var f=A.instant("bucketlambda.tag.notexist");var o=A.instant("bucketlambda.website.notexist");z.bucket_more_dropdown=[{items:[{id:"pasteinto",text:A.instant("moreDropDown.pasteinto")}]},{items:[{id:"managecloudtraillog",text:A.instant("moreDropDown.managecloudtraillog")}]}];var j=[{servicesCall:m.getVersioningStatus,scopeBinding:"configData.properties.versioning",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"getVersioningStatus"},{servicesCall:m.getEventCount,scopeBinding:"configData.properties.eventsCount",resultDisplay:A.instant("bucketsidepanel.activenotification"),defaultValue:"0 ".concat(A.instant("bucketsidepanel.activenotification")),name:"getEventCount",isNumber:true},{servicesCall:m.isLoggingEnabled,scopeBinding:"configData.properties.logging",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isLoggingEnabled"},{servicesCall:m.getTagCount,scopeBinding:"configData.properties.tags",resultDisplay:" ".concat(A.instant("bucketsidepanel.tags")),defaultValue:"0 ".concat(A.instant("bucketsidepanel.tags")),name:"getTagCount",isNumber:true,nomessage:f},{servicesCall:m.isReplicationEnabled,scopeBinding:F.CRRFACHandle().v2?"configData.management.replication":"configData.properties.replication",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isReplicationEnabled",nomessage:i,facId:v.FAC.CRR},{servicesCall:m.getBucketAccelerate,scopeBinding:"configData.properties.accelerate",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"getBucketAccelerate",nomessage:A.instant("bucketproperty.disabled"),facId:v.FAC.ACCELERATE},{servicesCall:m.getBucketOwnerDisplayName,scopeBinding:"configData.permissions.owner",resultDisplay:"",defaultValue:A.instant("bucketproperty.no"),name:"getBucketOwnerDisplayName"},{servicesCall:m.isCORSEnabled,scopeBinding:"configData.permissions.corsConfiguration",resultDisplay:A.instant("bucketproperty.yes"),defaultValue:A.instant("bucketproperty.no"),name:"isCORSEnabled",nomessage:y},{servicesCall:m.getBucketGrantees,scopeBinding:"configData.permissions.accessControlList",resultDisplay:" ".concat(A.instant("bucketsidepanel.grantees")),defaultValue:"0 ".concat(A.instant("bucketsidepanel.grantees")),granteeCount:true,name:"getBucketGrantees",isNumber:true},{servicesCall:m.getBucketPolicy,scopeBinding:"configData.permissions.bucketPolicy",resultDisplay:A.instant("bucketproperty.yes"),defaultValue:A.instant("bucketproperty.no"),name:"getBucketPolicy"},{servicesCall:m.isLifecycleEnabled,scopeBinding:"configData.management.lifecycle",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isLifecycleEnabled"},{servicesCall:m.isAnalyticsEnabled,scopeBinding:"configData.management.analytics",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isAnalyticsEnabled",facId:v.FAC.ANALYTICS},{servicesCall:m.isMetricsEnabled,scopeBinding:"configData.management.metrics",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isMetricsEnabled",facId:v.FAC.METRICS},{servicesCall:m.isInventoryEnabled,scopeBinding:"configData.management.inventory",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isInventoryEnabled",facId:v.FAC.INVENTORY},{servicesCall:m.isRequesterPaysEnabled,scopeBinding:"configData.properties.requesterpays",resultDisplay:A.instant("bucketproperty.enabled"),defaultValue:A.instant("bucketproperty.disabled"),name:"isRequesterPaysEnabled"}];function D(H,K,J,I){if(K&&H!==K||H){c.log(J,0,I);z.bucketPanelInfoError=H}else{c.log(J,1,I)}}function k(J,I,H){angular.forEach(J,function(L){var K=e(L.scopeBinding);if(!L.facId||L.facId&&n.isFeatureEnabled(L.facId)){L.servicesCall(I,H).then(function(M){c.log(L.name,1,H);if(L.hasOwnProperty("granteeCount")){M=Object.keys(M).length}if(M&&M!=="Suspended"){if(L.isNumber){K.assign(z,M+" "+L.resultDisplay)}else{if(L.resultDisplay){K.assign(z,L.resultDisplay)}else{K.assign(z,M)}}}else{K.assign(z,L.defaultValue)}})["catch"](function(M){K.assign(z,L.defaultValue);D(M,L.nomessage,L.name,H)})}})}function s(I,H){B.getBucketProperty(H,I,"website").then(function(L){var J=L.response;c.log("getBucketWebsite",1,H);var K=J.WebsiteConfiguration;if(K.RedirectAllRequestsTo){z.configData.properties.staticWebHost=A.instant("bucketproperty.websitehosting.redirectAll")}else{if(K.IndexDocument){z.configData.properties.staticWebHost=A.instant("bucketproperty.websitehosting.enableHosting")}}})["catch"](function(J){z.configData.properties.staticWebHost=A.instant("bucketproperty.disabled");D(J,o,"getBucketWebsite",H)})}var t=null;z.hoverSidePanelAction=function(H){if(!t){t=$(".storage-console-config-panel")}F.bodyFreezeScroll(H,t)};z.getConfigData=function(I){var H=new q("BucketProperties","getBucketConfigProperties");k(j,I,H);s(I,H)};z.closePanel=function(){var H=arguments.length<=0||arguments[0]===undefined?true:arguments[0];z.panelHide=true;if(H){z.hoverSidePanelAction(false)}};z.copyARNToClipboard=function(I){I.stopPropagation();var H=F.getBucketARN(z.selectedBucket.Name);F.copyToClipboard(H)};z.isCreateBucketModalOpen={flag:false};z.showCreateBucketModal=function(){var H=new q("CreateBucket","populateBucketSelectorDropdown");B.listAllMyBuckets(H).then(function(J){var I=J.response;c.log("listBucketsComplete",1,H);z.bucketList=I.ListAllMyBucketsResult.Buckets.Bucket;z.bucketList.forEach(function(K){m.getBucketLocation(K.Name).then(function(L){d.regionMapping.forEach(function(M){if(M.value===L){K.Location=M.text}})})})});z.isCreateBucketModalOpen.flag=true;F.analyticsTrackClick(v.ANALYTICS.CREATE_BUCKET_MODAL,v.ANALYTICS.DETAILS);F.analyticsTrackClick(v.ANALYTICS.START_CREATE_BUCKET,v.ANALYTICS.CREATE_BUCKET_S3);F.analyticsTrackView(v.ANALYTICS.NAME_REGION_CREATE_BUCKET,v.ANALYTICS.CREATE_BUCKET_S3);F.bodyFreezeScroll(z.isCreateBucketModalOpen.flag)};z.moveToBucketTab=function(H){z.hoverSidePanelAction(false);r.scrollTo(0,0);l.path("/"+v.PATH_SEGMENTS.BUCKETS+"/"+z.selectedBucket.Name).search("tab",H)};z.reloadBuckets=function(){z.isRefreshing=true;var H=new q("RefreshLAMB","RefreshLAMB");z.loadBuckets(H,false,false)};z.deleteBucket=function(){var I=u.createBulkOperation(v.OPERATION_NAME.DELETE_BUCKET,[],[{Prefix:""}],1000,{});I.changeInitialBucketForOperation(z.selectedBucket.Name);I.defer.promise.then(function(){_.remove(z.bucketList,function(K){return K.Name===I.initialBucket});z.reloadBuckets();h.evictAllBucketData(I.initialBucket);z.closePanel()});z.bucketConfirmationDetails.headerTitle=A.instant("confirmationmodal.deletebucket.title");var J=z.selectedBucket.Name;var H=A.instant("confirmationmodal.deletebucketwarning");z.bucketConfirmationDetails.warningMessage=H+' "'+J+'" ?';z.bucketConfirmationDetails.operation=I;z.bucketConfirmationDetails.isDelete=true;z.isConfirmationModalOpen.flag=true};z.emptyBucket=function(){var H=u.createBulkOperation(v.OPERATION_NAME.EMPTY_BUCKET,[],[{Prefix:""}],1000,{});H.changeInitialBucketForOperation(z.selectedBucket.Name);H.defer.promise.then(function(){h.evictBucketObjects(z.selectedBucket.Name)});z.bucketConfirmationDetails.headerTitle=A.instant("confirmationmodal.emptybucket.title");var J=A.instant("confirmationmodal.emptybucketwarning");var I=z.selectedBucket.Name;z.bucketConfirmationDetails.warningMessage=J+' "'+I+'" ?';z.bucketConfirmationDetails.operation=H;z.isConfirmationModalOpen.flag=true};z.tableFiltering={};z.clearFilter=function(){z.tableFiltering.filterText=""};z.filterKeyDown=function(H){if(H&&H.keyCode===v.KEY_CODES.ESC){$(".input-field").blur();z.clearFilter()}if(H&&H.keyCode===v.KEY_CODES.ENTER){$(".input-field").blur();r.scrollTo(0,0)}};z.$watch(function(){z.numRegions=_.without(_.uniq(_.pluck(w("filter")(z.bucketList,z.tableFiltering.filterText),"Location")),undefined).length;return z.tableFiltering.filterText},function(I,H){if(H!==I){z.selectedItem=null;z.totalItems=w("filter")(z.bucketList,z.tableFiltering.filterText).length}});z.setSortOrder=function(H){z.sortColumnName=H;z.reverseSortOrder=!z.reverseSortOrder};z.isFeatureEnabled=function(H){return n.isFeatureEnabled(H)};if(l.search().bucket){var G=l.search().bucket;var C=l.search().prefix;if(C&&C!==""&&C.slice(-1)!=="/"){C=C+"/"}delete l.search().bucket;delete l.search().prefix;l.path("/"+v.PATH_SEGMENTS.BUCKETS+"/"+G+"/"+(C||""));l.replace()}if(E.initialBucket===""&&l.path().indexOf(v.PATH_SEGMENTS.BUCKETS+"/")===-1){l.path(""+v.DELIMITER+v.PATH_SEGMENTS.HOME)}}})();"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}angular.module("s3").controller("ObjectController",["$filter","$location","$rootScope","$q","$routeParams","$scope","$timeout","$translate","APIProxyService","AWSC","BucketPropertiesService","BulkOperationService","CachingService","ConsoleOperation","CopyService","CountService","DownloadService","DirectoryExplorerService","FAC","KeySelectionService","ListDeletedObjectsService","ObjectListingService","ObjectPropertiesService","PathService","Region","S3Constants","SCLogService","UploadOperationService","UtilService","XMLParser",ObjectController]);function ObjectController(aw,ar,y,Z,c,E,U,n,S,j,J,au,av,g,ap,e,an,A,ay,ae,al,s,Q,O,X,b,w,ac,k,u){var h,am,af;var m={label:n.instant("details.tab.management"),id:"management"};E.currLocation={objects:{relativePaths:[],error:null},folders:{relativePaths:[]}};E.tabs=[{label:n.instant("details.tab.overview"),id:"overview"},{label:n.instant("details.tab.properties"),id:"properties"},{label:n.instant("details.tab.permissions"),id:"permissions"}];E.createFolder={displayed:false};E.displayCRRV1=k.CRRFACHandle().v1;var aA=(h={},_defineProperty(h,b.OPERATION_NAME.CHANGE_STORAGE_CLASS,{headTitle:n.instant("confirmationmodal.storageclass.title")}),_defineProperty(h,b.OPERATION_NAME.CHANGE_SSE,{headTitle:n.instant("confirmationmodal.sse.title")}),_defineProperty(h,b.OPERATION_NAME.INITIATE_RESTORE,{headTitle:n.instant("confirmationmodal.initiaterestore.title")}),_defineProperty(h,b.OPERATION_NAME.ADD_OBJECT_TAG,{headTitle:n.instant("confirmationmodal.addtags.title")}),h);var ag=(am={},_defineProperty(am,b.OPERATION_NAME.CHANGE_STORAGE_CLASS,{values:[[b.STORAGE_CLASSES.STANDARD,n.instant("storageclasses.standard"),"sidepanel.storageclass.standarddescription"],[b.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS,n.instant("storageclasses.standardia"),"sidepanel.storageclass.standardiadescription"],[b.STORAGE_CLASSES.REDUCED_REDUNDANCY,n.instant("storageclasses.rrs"),"sidepanel.storageclass.rrsdescription"]],setting:undefined}),_defineProperty(am,b.OPERATION_NAME.CHANGE_SSE,{values:[[b.OBJECT_SSE.NONE,n.instant("sse.none"),""],[b.OBJECT_SSE.AES256,n.instant("sse.aes256"),"sidepanel.sse.aes256description"]],setting:undefined}),_defineProperty(am,b.OPERATION_NAME.INITIATE_RESTORE,{inputErrorMsg:"",setting:undefined}),_defineProperty(am,b.OPERATION_NAME.ADD_OBJECT_TAG,{values:[{Key:"",Value:""}],setting:{maxKeys:b.TAGGING.MAX_ALLOWED_TAGS}}),am);E.customARN=b.OBJECT_SSE.CUSTOM_ARN;E.awsKMS=b.OBJECT_SSE.KMS_ENCRYPTION;var T=b.OBJECT_SSE.NONE,K;if(ay.isFeatureEnabled(b.FAC.KMS)){var aq=[b.OBJECT_SSE.KMS_ENCRYPTION,n.instant("sse.aws.kms"),""];ag[b.OPERATION_NAME.CHANGE_SSE].values.push(aq)}if(!ay.isFeatureEnabled(b.FAC.NO_ENC)){var z=ag[b.OPERATION_NAME.CHANGE_SSE].values;z=_.reject(z,function(aB){return aB[0]===b.OBJECT_SSE.NONE});ag[b.OPERATION_NAME.CHANGE_SSE].values=z;ag[b.OPERATION_NAME.CHANGE_SSE].setting=b.OBJECT_SSE.AES256}E.maxKeys=b.LIST_OBJECTS_MAX_KEYS_PER_LISTING;E.toggleVersioning=false;E.toggleLogging=false;E.toggleWebsite=false;E.toggleEvents=false;E.toggleAccelerate=false;E.toggleCRR=false;E.toggleTagging=false;E.toggleRequesterPays=false;E.disabledButton=true;E.versioning={selectedValue:b.BUCKET_PROPERTIES.DISABLE};E.website={selectedValue:b.BUCKET_PROPERTIES.DISABLE,websiteEnabledOption:"",websiteEnabledContent:""};E.logging={selectedValue:b.BUCKET_PROPERTIES.DISABLE};E.bucketTags={tagSet:{tags:[]}};E.selectedTab=ar.search().tab||"overview";E.confirmationSelectedFiles={folders:[],objects:[],currFolderPathPrefix:""};E.isUploadModalDisplayed={flag:false};E.isInitiateRestoreDisplayed={flag:false};E.flags={uploadDisabled:false};E.isRefreshing=false;E.isConfirmationModalOpen={flag:false,sidePanelOpen:false,dialogOpen:{flag:false},isRestorePanel:false};E.objectPropertiesPanel={show:false};E.showDeleted=false;E.copyFinished={flag:false};E.filters={input:"",prefixFilters:[],tagFilters:[]};j.Clog.setPageId(b.CLOG_OBJECTS_PAGE_ID);E.tagQueryDeferred=Z.defer();E.allKeys={selected:false};E.getIconClass=function(aB){return aB.selected?"awsui-icon-light "+k.getIconClassFromFilename(aB.Key):k.getIconClassFromFilename(aB.Key)};E.hoverObjectPropertiesPanel=function(aB){k.bodyFreezeScroll(aB,true)};E.moveToObjectTab=function(aC){E.hoverObjectPropertiesPanel(false);var aD=E.getSelectedObjects()[0];var aB=aD.Path?aD.Path+aD.Key:aD.Key;if(!_.isEmpty(aD.ETag)){av.setCurrentObject(aD)}ar.path("/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/"+O.getCurrentBucket()+"/"+O.relativeToAbsoluteObjectPath(aB)).search("tab",aC)};E.hoverDownloadPanel=function(aB){k.bodyFreezeScroll(aB,true)};E.hoverConfirmationPanel=function(aB){k.bodyFreezeScroll(aB,true)};E.$watch("isConfirmationModalOpen",function(aB){k.bodyFreezeScroll(!!aB.dialogOpen.flag)},true);E.$watch("isInitiateRestoreDisplayed",function(aB){k.bodyFreezeScroll(!!aB.flag)},true);E.$watch("isUploadModalDisplayed",function(aB){k.bodyFreezeScroll(!!aB.flag)},true);E.more_dropdown=[{items:[{id:"getinfo",text:n.instant("objectMoreDropDown.getinfo"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.GET_INFO)}},{id:"download",text:n.instant("objectMoreDropDown.download"),disabled:false,action:function ad(){E.openDownloadAsPanel()},facID:"s3-download"}]},{items:[{id:"rename",text:n.instant("objectMoreDropDown.rename"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.RENAME)},opName:b.OPERATION_NAME.RENAME,facID:"s3-rename"},{id:"delete",text:n.instant("objectMoreDropDown.delete"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.DELETE_OBJECTS)},opName:b.OPERATION_NAME.DELETE_OBJECTS,facID:"s3-delete"},{id:"undodelete",text:n.instant("objectMoreDropDown.undodelete"),disabled:true,action:function ad(){E.takeActions(b.OPERATION_NAME.RESTORE_OBJECTS)},opName:b.OPERATION_NAME.RESTORE_OBJECTS,facID:"s3-delete"}]},{items:[{id:"cut",text:n.instant("objectMoreDropDown.cut"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.CUT)},opName:b.OPERATION_NAME.CUT,facID:"s3-copy"},{id:"copy",text:n.instant("objectMoreDropDown.copy"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.COPY)},opName:b.OPERATION_NAME.COPY,facID:"s3-copy"},{id:"paste",text:n.instant("objectMoreDropDown.paste"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.PASTE)},opName:b.OPERATION_NAME.PASTE,facID:"s3-copy"}]},{items:[{id:"changestorageclass",text:n.instant("objectMoreDropDown.changestorageclass"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.CHANGE_STORAGE_CLASS)},opName:b.OPERATION_NAME.CHANGE_STORAGE_CLASS,facID:"s3-change-storage-class"},{id:"initialrestore",text:n.instant("objectMoreDropDown.initialrestore"),disabled:true,action:function ad(){E.takeActions(b.OPERATION_NAME.INITIATE_RESTORE)},opName:b.OPERATION_NAME.INITIATE_RESTORE,facID:"s3-initiate-restore"},{id:"changeencryption",text:n.instant("objectMoreDropDown.changeencryption"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.CHANGE_SSE)},opName:b.OPERATION_NAME.CHANGE_SSE,facID:"s3-change-encryption"},{id:"makeobjectpublic",text:n.instant("objectdetails.button.makepublic"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.MAKE_PUBLIC)},opName:b.OPERATION_NAME.MAKE_PUBLIC,facID:"s3-make-public"},{id:"addobjecttags",text:n.instant("objectMoreDropDown.addtags"),disabled:false,action:function ad(){E.takeActions(b.OPERATION_NAME.ADD_OBJECT_TAG)},opName:b.OPERATION_NAME.ADD_OBJECT_TAG,facID:"s3-ot"}]}];_.each(E.more_dropdown,function(aB){aB.items=_.filter(aB.items,function(aD){var aC=aD.facID;return !aC||ay.isFeatureEnabled(aC)})});E.batchOps={error:null,numKeysOperatedOn:null,size:20};E.timing={fetchAllObjects:{start:null,end:null,duration:null}};E.validateInitialRestoreValue=function(aB){if(isNaN(aB.setting)||parseInt(aB.setting)<1){aB.inputErrorMsg="initialrestorevalue.invalidwarning"}else{aB.inputErrorMsg=""}};E.startKeyNum=0;E.fetchPageInProgress=false;E.markers=[];E.tagContinuationTokens=[];E.sortColumnName="";E.reverseSortOrder=false;f();E.downloadAsPanel=false;E.operations={};E.objectSelectedForSidePanel={};var v=["Key","Size","ExpirationDate","ExpirationRule","ETag","LastModified","Link"];var D=Object.keys(b.PROPERTIES_TITLE_OPNAME_MAPPING);var ao="getObjectMetadata";var B="getObjectAcl";var ak=b.VERSIONS.LIST_VERSIONS_COMPLETED;var d={isTruncated:true,currentPage:0,lastCachedPage:0};E.createFolder={show:false};E.selected={selectedItems:{currFolderPathPrefix:"",folders:[],objects:[]}};var ab={flag:true,folders:0,objects:0,size:0,currLevelObjs:0,countResultEachFolder:{}};E.countInfo=_.cloneDeep(ab);E.bucketName=c[b.PATH_SEGMENTS.BUCKET_NAME];J.getBucketRegion(E.bucketName).then(function(aB){E.bucketRegion=aB});E.setSortOrder=function(aB){E.sortColumnName=aB;E.reverseSortOrder=!E.reverseSortOrder};E.showCreateFolder=function(){E.operation=new g("CreateFolder");E.createFolder.displayed=true;E.showEmptyScreen=false;E.noResultsMessage=false};E.navigateIntoFolder=function(aC){var aB=""+ar.path()+aC+b.DELIMITER;if(E.showDeleted){ar.path(aB).search(b.SHOW_DELETED_PARAM,"true")}ar.path(aB)};E.closeObjectPropertiesPanel=function(){var aB=arguments.length<=0||arguments[0]===undefined?true:arguments[0];E.objectPropertiesPanel.show=false;E.switchedFromSidePanel=false;if(aB){E.hoverObjectPropertiesPanel(false)}};E.closeDownloadAsPanel=function(){E.downloadAsPanel=false;E.hoverDownloadPanel(false)};E.openDownloadAsPanel=function(){E.objectPropertiesPanel.show=false;E.downloadAsPanel=true;E.downloadAsPanelGenerating=true;E.downloadPanelError=false;E.downloadPanel={};an.generatePresignedUrlForCurrentObject(E.getSelectedObjects()[0]).then(function aB(aD){E.downloadAsPanelGenerating=false;E.downloadPanel.url=aD.data.presignedUrl},function aC(aD){E.downloadAsPanelGenerating=false;E.downloadPanelError=true})};E.downloadSelectedObject=function(){var aB=arguments.length<=0||arguments[0]===undefined?false:arguments[0];if(!aB){an.downloadCurrentSelection(E.versionsDropdownSelectedObject.obj,false)["catch"](function(aC){if(aC.error&&aC.error.status){E.batchOpsError=aC.error.status}})}};E.showAllObjects=function(){if(E.fetchPageInProgress){return}else{E.fetchPageInProgress=true}var aB=ar.path();ar.path(aB).search(b.SHOW_DELETED_PARAM,"false");ar.path(aB)};E.showDeletedObjects=function(){if(E.fetchPageInProgress){return}else{E.fetchPageInProgress=true}av.resetDeletedObjects();var aB=ar.path();ar.path(aB).search(b.SHOW_DELETED_PARAM,"true");ar.path(aB)};function L(){return E.isSingleObjectOnlySelected()}function Y(aB){for(var aC in E.currLocation.objects.relativePaths){var aD=E.currLocation.objects.relativePaths[aC];if(aD.Key===aB.Key&&aD.selected){E.currLocation.objects.relativePaths[aC]=aB;return}}}E.getSelectedFolders=function(){return _.filter(E.currLocation.folders.relativePaths,function(aB){return aB.selected===true})};E.getSelectedObjects=function(){return _.filter(E.currLocation.objects.relativePaths,function(aB){return aB.selected===true})};E.getSelectedKeys=function(){return E.getSelectedFolders().concat(E.getSelectedObjects())};E.isSingleObjectOnlySelected=function(){return E.getSelectedObjects().length===1&&E.getSelectedFolders().length===0};E.showVersionsDropdown={show:false};E.objectsPage={show:true};E.bucketForVersionsDropdown={name:E.bucketName};E.listVersions=function(aB){aB.stopPropagation();if(E.showVersionsDropdown.show){E.showVersionsDropdown.show=false}else{E.showVersionsDropdown.show=true;k.analyticsTrackClick(b.ANALYTICS.LATEST_VERSION,b.ANALYTICS.DETAILS)}};function o(){E.objectPropertiesConfig={};if(L()){var aB=function(){var aD=E.getSelectedObjects()[0];E.objectSelectedForSidePanel={};E.objectSelectedForSidePanel.obj=angular.copy(aD);E.objectSelectedForSidePanel.obj.disableDownload=false;E.objectSelectedForSidePanel.error="";var aF=new g(b.OPERATION_NAME.LIST_VERSIONS);E.versionDropdownKey={};E.versionDropdownKey.name=O.getCurrentAbsoluteFolderPath()?O.getCurrentAbsoluteFolderPath()+aD.Key:aD.Key;E.objectSelectedForSidePanel.obj.versionLabel=n.instant("versionsdropdown.label.latestVersion");E.versionsDropdownSelectedObject={obj:_.cloneDeep(aD)};E.versionsDropdownSelectedObject.obj.Key=O.relativeToAbsoluteObjectPath(E.versionsDropdownSelectedObject.obj.Key);Q.listVersions(E.bucketName,E.versionDropdownKey.name,aF).then(function(aG){E.objectSelectedForSidePanel.versions=aG;E.objectSelectedForSidePanel.versionId=aG&&aG[0]&&aG[0].VersionId;w.log(ak,1,aF,{objectKey:E.versionDropdownKey.name,versions:aG})})["catch"](function(aG){E.objectSelectedForSidePanel.error=k.handleErrors(aG);w.log(ak,0,aF,aG)});if(_.isEmpty(aD.ETag)&&!E.showDeleted){var aC=new g(b.OPERATION_NAME.GET_OBJECT_DETAILS),aE={bucket:E.bucketName,prefix:aD.Path+aD.Key,maxKeys:1,cacheAllowed:true};S.listObjects(aC,aE).then(function(aG){var aH=aG.response.ListBucketResult.Contents[0];aH.ETag=aH.ETag.replace(/[\\"]+/g,"");aH.Path=aD.Path;aH.VersionId=aD.VersionId;aH.selected=true;if(aH.Key.lastIndexOf(b.DELIMITER)!==-1){aH.Key=aH.Key.substring(aH.Key.lastIndexOf(b.DELIMITER)+1)}Y(aH);o()});return{v:undefined}}E.setUpObjectMetadataForPropertiesPanel(aD);E.updateObjAcl(aD);E.updateObjMetadata(aD);E.showVersionsDropdown.show=false;E.objectPropertiesPanel.show=true}();if((typeof aB==="undefined"?"undefined":_typeof(aB))==="object"){return aB.v}}else{E.objectPropertiesPanel.show=false}}function a(){if(E.isSingleObjectOnlySelected()){if(E.downloadAsPanel){E.openDownloadAsPanel()}}else{E.downloadAsPanel=false}}function M(){o();a()}function x(aB){for(var aC=0;aC<aB.length;aC++){aB[aC].selected=E.allKeys.selected}M()}E.selectAllKeys=function(){if(E.currLocation.folders.relativePaths!==undefined){x(E.currLocation.folders.relativePaths)}if(E.currLocation.objects.relativePaths!==undefined){x(E.currLocation.objects.relativePaths)}};E.selectOneMoreKey=function(aC){var aD=arguments.length<=1||arguments[1]===undefined?true:arguments[1];var aB=arguments.length<=2||arguments[2]===undefined?true:arguments[2];if(aB){aC.selected=_.has(aC,"selected")&&aC.selected?false:true;if(!aC.selected){E.allKeys.selected=false}}else{aC.selected=true}if(aD){E.shiftSelectAxis=aC}M();l()};E.selectCurrentKeyOnly=function(aB){E.resetSelection();aB.selected=true;E.shiftSelectAxis=aB;M()};E.resetSelection=function(){E.allKeys.selected=false;ae.setSelectedFlagAsFalse(E.currLocation.folders.relativePaths,E.currLocation.objects.relativePaths);M()};E.shiftSelectAxis=null;E.shiftSelect=function(aF){E.resetSelection();var aB=aw("orderBy")(E.currLocation.folders.relativePaths,E.sortColumnName,E.reverseSortOrder);var aJ=aw("orderBy")(E.currLocation.objects.relativePaths,E.sortColumnName,E.reverseSortOrder);if(!E.shiftSelectAxis){if(E.currLocation.folders.relativePaths&&E.currLocation.folders.relativePaths.length>0){E.shiftSelectAxis=aB[0]}else{if(E.currLocation.objects.relativePaths&&E.currLocation.objects.relativePaths.length>0){E.shiftSelectAxis=aJ[0]}}}if(aF===E.shiftSelectAxis){E.selectOneMoreKey(aF);return}var aI=false;var aG=false;if(E.currLocation.folders.relativePaths){for(var aD=0;aD<E.currLocation.folders.relativePaths.length;aD++){if(aI&&aG){break}var aE=aB[aD];if(aI&&!aG){E.selectOneMoreKey(aE,false,false)}if(aE===E.shiftSelectAxis||aE===aF){if(!aI){E.selectOneMoreKey(aE,false,false);aI=true}else{aG=true}}}}if(E.currLocation.objects.relativePaths){for(var aC=0;aC<E.currLocation.objects.relativePaths.length;aC++){if(aI&&aG){break}var aH=aJ[aC];if(aI&&!aG){E.selectOneMoreKey(aH,false,false)}if(aH===E.shiftSelectAxis||aH===aF){if(!aI){E.selectOneMoreKey(aH,false,false);aI=true}else{aG=true}}}}};E.clickObjectRow=function(aC,aB){if(aC.ctrlKey||aC.metaKey){E.selectOneMoreKey(aB,true,true)}else{if(aC.shiftKey){E.shiftSelect(aB)}else{E.selectCurrentKeyOnly(aB)}}};var G=(af={},_defineProperty(af,b.OPERATION_NAME.DELETE_OBJECTS,{numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.S3_API}),_defineProperty(af,b.OPERATION_NAME.RESTORE_OBJECTS,{numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.S3_API}),_defineProperty(af,b.OPERATION_NAME.MAKE_PUBLIC,{numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}),_defineProperty(af,b.OPERATION_NAME.CUT,{isCut:true,numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}),_defineProperty(af,b.OPERATION_NAME.COPY,{isCut:false,numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}),_defineProperty(af,b.OPERATION_NAME.RENAME,{isRename:true,numberOfKeysPerBulkOperation:b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}),af);function N(){var aC=0;var aB=E.getSelectedKeys();if(aB.length===1){if(aB[0].Key){E.currLocation.objects.relativePaths.forEach(function(aD){if(aD.Key===aB[0].Key){aD.beingRenamed=true}else{aC++}})}}}E.addTag=function(){var aB={Key:"",Value:""};if(E.panelSettingValues.values){E.panelSettingValues.values.push(aB)}else{E.panelSettingValues.values=[aB]}};E.isAnyKeyEmpty=function(){return !_.isEmpty(E.panelSettingValues.values)&&_.some(E.panelSettingValues.values,function(aB){return _.isEmpty(aB.Key)})};E.removeTag=function(aB){E.panelSettingValues.values.splice(aB,1)};function C(aB){k.analyticsTrackClick(b.ANALYTICS.CONFIRMATION_MODAL,aB)}E.takeActionFromSidePanel=function(aB,aD,aC){if(aB===b.TABS.OBJECT_LIST.PROPERTIES&&E.objectPropertiesConfig.properties.StorageClass.toUpperCase()!==b.STORAGE_CLASSES.GLACIER&&aD&&aD!=="Tags"){aC.stopPropagation();E.takeActions(b.PROPERTIES_TITLE_OPNAME_MAPPING[aD]);E.switchedFromSidePanel=true}};E.takeActions=function(aB){E.opName=aB;E.isConfirmationModalOpen.flag=false;E.isConfirmationModalOpen.dialogOpen.flag=false;E.tagError=false;E.isConfirmationModalOpen.sidePanelOpen=false;E.isConfirmationModalOpen.isRestorePanel=false;E.countInfo=_.cloneDeep(ab);E.panelSettingValues=null;E.operation=null;E.modalInfo={headTitle:"",buttonName:"",warningInfo:{flag:false,text:""}};C(aB);var aD=undefined;switch(aB){case b.OPERATION_NAME.PASTE:E.isConfirmationModalOpen.flag=true;E.isConfirmationModalOpen.dialogOpen.flag=true;V(aB);break;case b.OPERATION_NAME.COPY:case b.OPERATION_NAME.CUT:V(aB);ap.setClipboardOperation(E.operation);break;case b.OPERATION_NAME.INITIATE_RESTORE:V(aB,true);if(ay.isFeatureEnabled("s3-gl-tier-"+E.bucketRegion.value)){E.isInitiateRestoreDisplayed.flag=true}else{E.isConfirmationModalOpen.isRestorePanel=true;E.modalInfo=aA[aB];E.panelSettingValues=_.cloneDeep(ag)[E.operation.name];E.operation.panelSettingValues=E.panelSettingValues;E.isConfirmationModalOpen.sidePanelOpen=true}aD={currFolderPathPrefix:E.operation.initialPath,folders:E.operation.selectedFolders,objects:E.operation.selectedKeys};E.countInfo.countFinish=true;E.isCounting={flag:false};e.countAllFiles(aD,E.countInfo,E.operation,E.isCounting);break;case b.OPERATION_NAME.CHANGE_STORAGE_CLASS:V(aB,true);E.modalInfo=aA[aB];E.panelSettingValues=_.cloneDeep(ag)[E.operation.name];var aC=_.get(E.objectPropertiesConfig,"properties.StorageClass");if(aC&&E.isSingleObjectOnlySelected()){E.panelSettingValues.setting=b.STORAGE_CLASSES[aC]}E.operation.panelSettingValues=E.panelSettingValues;E.isConfirmationModalOpen.sidePanelOpen=true;aD={currFolderPathPrefix:E.operation.initialPath,folders:E.operation.selectedFolders,objects:E.operation.selectedKeys};E.countInfo.countFinish=true;E.isCounting={flag:false};e.countAllFiles(aD,E.countInfo,E.operation,E.isCounting);break;case b.OPERATION_NAME.CHANGE_SSE:V(aB,true);E.modalInfo=aA[aB];E.panelSettingValues=_.cloneDeep(ag)[E.operation.name];if(T&&E.isSingleObjectOnlySelected()){if(T===b.OBJECT_SSE.KMS_ENCRYPTION){E.panelSettingValues.setting=T;W().then(function(){E.panelSettingValues.kmsOption={kmsId:k.getKMSAliasForArn(K,E.kmsKeys)}})}else{E.panelSettingValues.setting=b.OBJECT_SSE[T]}}E.operation.panelSettingValues=E.panelSettingValues;E.isConfirmationModalOpen.sidePanelOpen=true;aD={currFolderPathPrefix:E.operation.initialPath,folders:E.operation.selectedFolders,objects:E.operation.selectedKeys};E.countInfo.countFinish=true;E.isCounting={flag:false};e.countAllFiles(aD,E.countInfo,E.operation,E.isCounting);break;case b.OPERATION_NAME.ADD_OBJECT_TAG:V(aB,true);E.modalInfo=aA[aB];E.panelSettingValues=_.cloneDeep(ag)[E.operation.name];E.operation.panelSettingValues=E.panelSettingValues;E.isConfirmationModalOpen.sidePanelOpen=true;aD={currFolderPathPrefix:E.operation.initialPath,folders:E.operation.selectedFolders,objects:E.operation.selectedKeys};E.countInfo.countFinish=true;E.isCounting={flag:false};e.countAllFiles(aD,E.countInfo,E.operation,E.isCounting);break;case b.OPERATION_NAME.RENAME:V(aB);ap.setClipboardOperation(E.operation);N();break;case b.OPERATION_NAME.GET_INFO:E.isConfirmationModalOpen.flag=true;E.isConfirmationModalOpen.dialogOpen.flag=true;V(aB);break;default:E.isConfirmationModalOpen.flag=true;E.isConfirmationModalOpen.dialogOpen.flag=true;V(aB)}E.closeObjectPropertiesPanel(false)};E.saveConfirmationPanel=function(aB){aB.stopPropagation();if(r()){E.isConfirmationModalOpen.sidePanelOpen=false;E.isConfirmationModalOpen.flag=true;E.isConfirmationModalOpen.isRestorePanel=false;E.isConfirmationModalOpen.dialogOpen.flag=true}};E.cancelConfirmationPanel=function(aB){aB.stopPropagation();E.isConfirmationModalOpen.countFinish=false;E.isConfirmationModalOpen.sidePanelOpen=false;E.isConfirmationModalOpen.isRestorePanel=false;E.panelSettingValues=null;E.operation=null;if(E.switchedFromSidePanel){M()}};function r(){if(E.opName===b.OPERATION_NAME.ADD_OBJECT_TAG){var aD=E.operation.panelSettingValues&&E.operation.panelSettingValues.values;if(aD){var aC=aD.length;for(var aF=0;aF<aC;aF++){var aE=aD[aF].Key;var aG=0;for(var aB=0;aB<aC;aB++){if(aD[aB].Key===aE){aG++}}if(aG>1){E.tagError=true;E.tagErrorMessage=n.instant("objectproperties.tags.duplicatekeynames");return false}}}}return true}function V(aC,aD){if(aC===b.OPERATION_NAME.PASTE){E.operation=ap.getClipboardOperation()}else{var aB=0;if(aC===b.OPERATION_NAME.RENAME){aB=1}var aE=aD?null:G[aC];E.operation=au.createBulkOperation(aC,E.getSelectedObjects(),E.getSelectedFolders(),aB,aE)}E.operation.defer.promise.then(function(){I(E.operation)},function(){},function(){I(E.operation)})}function I(aB){if(E.switchedFromSidePanel){M()}if(E.showDeleted){av.evictBucketObjects(aB.initialBucket);E.showAllObjects()}else{if(aB.name===b.OPERATION_NAME.DELETE_OBJECTS||aB.name===b.OPERATION_NAME.CHANGE_STORAGE_CLASS||aB.name===b.OPERATION_NAME.RESTORE_OBJECTS){av.evictBucketObjects(aB.initialBucket);E.refreshWithSelection()}else{if(aB.name===b.OPERATION_NAME.COPY||aB.name===b.OPERATION_NAME.CUT){av.evictBucketObjects(aB.initialBucket);av.evictBucketObjects(aB.dstBucket);E.refreshWithSelection()}}}}E.refreshAndClearObjectsCacheForCurrentBucket=function(){av.evictBucketObjects(O.getCurrentBucket());E.refreshWithSelection()};E.refreshWithSelection=function(){E.isRefreshing=true;var aC=O.getCurrentAbsoluteFolderPath()||"";var aB=typeof E.currentMarker==="string"?E.currentMarker:"";E.tagContinuationTokens=[];E.filters.prefixFilters=[];E.filters.tagFilters=[];s.listObjects(aC,aB,E.maxKeys,b.DELIMITER,false).then(function(aH){var aE=aH.response.ListBucketResult;var aG=_.pluck(E.getSelectedObjects(),"Key");var aD=_.pluck(E.getSelectedFolders(),"Prefix");az(aE,true);at();var aF=_.filter(E.currLocation.objects.relativePaths,function(aJ){return _.indexOf(aG,aJ.Key)!==-1});var aI=_.filter(E.currLocation.folders.relativePaths,function(aJ){return _.indexOf(aD,aJ.Prefix)!==-1});aF.forEach(function(aJ){E.selectOneMoreKey(aJ,false,false)});aI.forEach(function(aJ){E.selectOneMoreKey(aJ,false,false)});E.currentMarker=aE.Marker;E.nextMarker=aE.NextMarker})["catch"](function(aD){i(aD)})};E.batchOpsAlertDismissed=function(){E.batchOps.error=null};E.goToObjectDetails=function(aC){if(E.showDeleted){return}var aB=aC.Path?aC.Path+aC.Key:aC.Key;if(!_.isEmpty(aC.ETag)){av.setCurrentObject(aC)}ar.path("/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/"+O.getCurrentBucket()+"/"+O.relativeToAbsoluteObjectPath(aB))};E.openObjectInBrowser=function(aB){if(aB.StorageClass.toUpperCase()!==b.STORAGE_CLASSES.GLACIER){an.openInBrowser(aB.Key,aB.Size)}};E.setUpObjectMetadataForPropertiesPanel=function(aG){E.objectPropertiesConfig={};var aF={overview:v,properties:D,permissions:[]};_.map(aF,function(aI,aH){E.objectPropertiesConfig[aH]={};_.map(aI,function(aJ){E.objectPropertiesConfig[aH][aJ]=aG[aJ]})});var aE=O.relativeToAbsoluteObjectPath(aG.Key);var aD=aG.versionId;aE=aG.Path?aG.Path+aE:aE;S.getObjectMetadata(new g("getObjectMetadata"),E.bucketName,aE,aD).then(function(aH){if(aH.headers()&&E.isSingleObjectOnlySelected()){var aJ=aH.headers();if(aJ[b.HEADERS.X_AMZ_REPLICATION_STATUS]){E.objectPropertiesConfig.overview.ReplicationStatus=aJ[b.HEADERS.X_AMZ_REPLICATION_STATUS]}if(E.isFeatureEnabled("s3-ot")){var aI=aJ[b.HEADERS.X_AMZ_TAGGING_COUNT]||0;if(!_.isNaN(parseInt(aI))){E.objectPropertiesConfig.properties.Tags=n.instant("objectproperties.tags.keyvalue",{tagsCount:aI})}}}})["catch"](function(aH){E.objectPropertiesConfig.properties.Encryption=k.getErrorMessage(aH);E.objectPropertiesConfig.properties.Tags=k.getErrorMessage(aH)});var aB=E.objectPropertiesConfig.overview;var aC=E.objectPropertiesConfig.properties;aB.LastModified=aw("date")(aB.LastModified,"MMM d, y h:mm:ss a 'GMT'Z");if(E.showDeleted){aB.Size="-"}aC.StorageClass=aC.StorageClass?k.getStorageClassTranslations()[aC.StorageClass]:"-";if(E.showDeleted||_.isEmpty(aC.Encryption)){aC.Encryption="-"}aB.ETag=aB.ETag&&!E.showDeleted?aB.ETag.replace(/[\\"]+/g,""):"-";aB.Link="-";aB.ExpirationDate=aB.ExpirationDate?aB.ExpirationDate:"N/A";aB.ExpirationRule=aB.ExpirationRule?aB.ExpirationRule:"N/A";S.getBucketLocation(E.operation,E.bucketName,{}).then(function(aH){var aI=E.showDeleted?"":O.getObjectLink(aE,aH.region);aB.Link=aB.Path?aB.Path+aI:aI})};function f(){ax();E.flags.uploadDisabled=false;E.isUploadModalDisplayed.flag=false;E.isInitiateRestoreDisplayed.flag=false}function ax(){E.batchOps.error=null;E.batchOps.numKeysOperatedOn=null}E.updateObjMetadataForTest=function(aB){E.updateObjMetadata(aB)};E.updateObjMetadata=function(aD){var aB=new g("getObjectMetadata");var aC=O.relativeToAbsoluteObjectPath(aD.Key);aC=aD.Path?aD.Path+aC:aC;var aE=O.getCurrentBucket();S.getObjectMetadata(aB,aE,aC).then(function(aG){w.log(ao,1,aB,{bucket:aE,key:aC});if(!E.objectPropertiesConfig){E.objectPropertiesConfig={}}if(!E.objectPropertiesConfig.properties){E.objectPropertiesConfig.properties={}}if(!E.objectPropertiesConfig.overview){E.objectPropertiesConfig.overview={}}if(ae.isCurrentlySelectedObject(aG.config.data.path,E.getSelectedObjects())){T=b.OBJECT_SSE.NONE;E.objectPropertiesConfig.properties.Encryption=k.getEncryptionTranslations()[T];E.objectPropertiesConfig.overview.ExpirationDate="N/A";E.objectPropertiesConfig.overview.ExpirationRule="N/A";if(aG.headers()&&E.isSingleObjectOnlySelected()){var aI=aG.headers();var aF=aI[b.HEADERS.X_AMZ_RESTORE];if(aF){var aH=k.extractFromQuotes(aF);if(aH==="true"){E.objectPropertiesConfig.overview.Restoration=n.instant("objectdetails.value.restoration")}else{if(aH==="false"){E.objectPropertiesConfig.overview.RestorationExpiry=aw("date")(new Date(k.extractFromQuotes(aF,1)),"medium")}}}if(aI[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]){T=aI[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION];E.objectPropertiesConfig.properties.Encryption=k.getEncryptionTranslations()[T];if(T===b.OBJECT_SSE.KMS_ENCRYPTION){K=aI[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID]}}if(aI[b.HEADERS.X_AMZ_EXPIRATION]){var aJ=aI[b.HEADERS.X_AMZ_EXPIRATION];E.objectPropertiesConfig.overview.ExpirationDate=k.extractFromQuotes(aJ,0);E.objectPropertiesConfig.overview.ExpirationRule=k.extractFromQuotes(aJ,1)}}}},function(aG){var aF={};aF.error=k.handleErrors(aG);aF.key=aC;aF.bucket=aE;w.log(ao,0,aB,aF);if(!E.objectPropertiesConfig){E.objectPropertiesConfig={}}if(!E.objectPropertiesConfig.properties){E.objectPropertiesConfig.properties={}}if(!E.objectPropertiesConfig.overview){E.objectPropertiesConfig.overview={}}E.objectPropertiesConfig.properties.Encryption=k.getErrorMessage(aG);E.objectPropertiesConfig.overview.ExpirationDate="";E.objectPropertiesConfig.overview.ExpirationRule=""})};function W(){var aB=Z.defer();E.kmsKeys=[];var aD=new g("GetKMSKeysForObjectSSE");var aC={};S.getKmsKeys(aD,E.bucketName,aC).then(function(aF){var aE=aF.response.Keys;w.log("GetKMSKeys",1,aD);angular.forEach(aE,function(aG,aH){E.kmsKeys.push({value:aG.KeyId,text:k.getKmsKeyAlias(aG)})});E.kmsKeys.push({value:b.OBJECT_SSE.CUSTOM_ARN,text:n.instant("objectproperties.kms.customarn")});aB.resolve()})["catch"](function(aE){E.KMSServiceError=k.handleErrors(aE);w.log("GetKMSKeys",0,aD,aE);aB.reject()});return aB.promise}E.updateConfigPanel=function(){if(E.panelSettingValues.setting===b.OBJECT_SSE.KMS_ENCRYPTION){W()}};E.updateObjAclForTest=function(aB){E.updateObjAcl(aB)};function P(aB,aD){var aC=function aC(aE){return aE.URI?aE.URI.split("/").pop():aE.ID};if(aB&&aB.Grantee){return aB.Grantee.DisplayName||aC(aB.Grantee)}else{return aD}}E.updateObjAcl=function(aC){var aB=new g("getObjectAcl");var aE=O.getCurrentBucket();var aD=O.relativeToAbsoluteObjectPath(aC.Key);S.getObjectAcl(aB,aE,aD).then(function(aJ){if(aJ&&aJ.response&&aJ.response.AccessControlPolicy&&aJ.response.AccessControlPolicy.AccessControlList){var aH;var aF=aJ.response.AccessControlPolicy;var aI=(aH={},_defineProperty(aH,b.ACL_PERMISSIONS.READ,[]),_defineProperty(aH,b.ACL_PERMISSIONS.WRITE,[]),_defineProperty(aH,b.ACL_PERMISSIONS.READ_ACP,[]),_defineProperty(aH,b.ACL_PERMISSIONS.WRITE_ACP,[]),aH);var aG=aF.AccessControlList.Grant;var aL=aF.Owner.DisplayName;var aK=function aK(aM){var aO=P(aM,aL);if(aM.Permission===b.ACL_PERMISSIONS.FULL_CONTROL){for(var aN in aI){if(aI[aN].indexOf(aO)===-1){aI[aN].push(aO)}}}else{if(aI[aM.Permission].indexOf(aO)===-1){aI[aM.Permission].push(aO)}}};if(aG){if(Array.isArray(aG)){aG.forEach(function(aM){aK(aM)})}else{aK(aG)}if(ae.isCurrentlySelectedObject(aJ.request.path,E.getSelectedObjects())){if(!E.objectPropertiesConfig){E.objectPropertiesConfig={}}if(!E.objectPropertiesConfig.permissions){E.objectPropertiesConfig.permissions={}}E.objectPropertiesConfig.permissions.owner=aL;E.objectPropertiesConfig.permissions.grantees={};E.objectPropertiesConfig.permissions.grantees.object={};E.objectPropertiesConfig.permissions.grantees.object[b.ACL_PERMISSIONS.READ]=aI[b.ACL_PERMISSIONS.READ].length;E.objectPropertiesConfig.permissions.grantees.object[b.ACL_PERMISSIONS.WRITE]=aI[b.ACL_PERMISSIONS.WRITE].length;E.objectPropertiesConfig.permissions.grantees.objectPermissions={};E.objectPropertiesConfig.permissions.grantees.objectPermissions[b.ACL_PERMISSIONS.READ_ACP]=aI[b.ACL_PERMISSIONS.READ_ACP].length;E.objectPropertiesConfig.permissions.grantees.objectPermissions[b.ACL_PERMISSIONS.WRITE_ACP]=aI[b.ACL_PERMISSIONS.WRITE_ACP].length}}w.log(B,1,aB,{bucket:aE,key:aD})}},function(aG){var aF={};aF.key=aD;aF.bucket=aE;aF.error=k.handleErrors(aG);w.log(B,0,aB,aF);if(!E.objectPropertiesConfig){E.objectPropertiesConfig={}}if(!E.objectPropertiesConfig.permissions){E.objectPropertiesConfig.permissions={}}E.objectPropertiesConfig.permissions=k.handleErrors(aG)})};function aj(aB){if(typeof aB!=="string"){return""}return aB}E.fetchObjects=function(aE){var aC=arguments.length<=1||arguments[1]===undefined?true:arguments[1];var aB=arguments.length<=2||arguments[2]===undefined?"":arguments[2];E.isRefreshing=true;E.filters.tagFilters=[];E.filters.prefixFilters=[];E.filters.input="";E.sortColumnName="";E.isConfirmationModalOpen.sidePanelOpen=false;E.resetSelection();E.timing.fetchAllObjects.start=new Date().getTime();var aD=O.getCurrentAbsoluteFolderPath();if(aD===undefined){aD=""}E.markers=[];if(E.showDeleted){p(aD)}else{if(aE){aa(aD,aB,aC)}else{H(aD,aB,aC)}}};function az(aC,aG){E.showEmptyScreen=false;E.noResultsMessage=undefined;var aE=aj(aC.Prefix);if(E.filters.input){aE=aE.substring(0,aE.length-E.filters.input.length)}var aB=O.absoluteToRelativeObjectPaths(aC.Contents,aE);E.currLocation.objects.relativePaths=aG?aB:E.currLocation.objects.relativePaths.concat(aB);var aF=O.absoluteToRelativeFolderPaths(aC.CommonPrefixes,aE);E.currLocation.folders.relativePaths=aG?aF:E.currLocation.folders.relativePaths.concat(aF);j.Timer.customerReady();var aD=0;if(aB){aD+=aB.length}if(aF){aD+=aF.length}if(aD===0){if(aj(aC.Prefix)===""){if(E.showDeleted){E.noResultsMessage=n.instant("objectlisting.nodeletedobjects")}else{E.showEmptyScreen=true}}else{if(E.filters.input){E.noResultsMessage=n.instant("prefixsearch.noresults")}else{E.noResultsMessage=n.instant("objectlisting.noobjects")}}}E.startKeyNum=aD===0?0:E.maxKeys*E.markers.length+1;E.endKeyNum=E.maxKeys*E.markers.length+aD;l();E.isRefreshing=false;E.fetchPageInProgress=false}function l(){var aB=E.currLocation.folders.relativePaths?E.currLocation.folders.relativePaths.concat(E.currLocation.objects.relativePaths):E.currLocation.objects.relativePaths;if(aB){E.allKeys.selected=_.every(aB,function(aC){return _.has(aC,"selected")&&aC.selected===true})}else{E.allKeys.selected=false}}function H(aD,aB){var aC=arguments.length<=2||arguments[2]===undefined?true:arguments[2];E.isConfirmationModalOpen.sidePanelOpen=false;E.resetSelection();E.isRefreshing=true;s.listObjects(aD,aB,E.maxKeys,b.DELIMITER,aC).then(function(aF){var aE=aF.response.ListBucketResult;az(aE,true);at();E.currentMarker=aE.Marker;E.nextMarker=aE.NextMarker})["catch"](function(aE){i(aE)})}function F(aD){var aB={Contents:aD.deletedFiles,CommonPrefixes:aD.folders},aC={Contents:aD.cachedDeletedFiles,CommonPrefixes:aD.cachedFolders};az(aB,true);E.startKeyNum=d.currentPage*E.maxKeys+1;E.endKeyNum=E.startKeyNum+aB.Contents.length+aB.CommonPrefixes.length-1;av.setPageOfDeletedObjects(aB,d.currentPage);d.lastCachedPage=d.currentPage;if(aC.Contents.length+aC.CommonPrefixes.length>0){av.setPageOfDeletedObjects(aC,d.currentPage+1)}d.nextKeyMarker=aD.NextKeyMarker;d.nextVersionIdMarker=aD.NextVersionIdMarker;d.isTruncated=k.convertStringToBoolean(aD.IsTruncated)}function p(aB){E.currLocation.folders.relativePaths=[];E.currLocation.objects.relativePaths=[];E.isRefreshing=true;d.currentPage=0;d.lastCachedPage=0;E.startKeyNum=0;E.endKeyNum=0;av.resetDeletedObjects();al.listDeletedObjects(new g(b.LIST_DELETED_OBJECTS),aB).then(function(aC){F(aC)},function(aC){i(aC)})}E.fetchOnePagePrefix=function(aC,aB){H(aC,aB)};E.fetchOnePageTag=function(aB){var aC=arguments.length<=1||arguments[1]===undefined?true:arguments[1];E.showEmptyScreen=false;E.noResultsMessage=undefined;E.isConfirmationModalOpen.sidePanelOpen=false;E.resetSelection();if(aC){E.currLocation.folders.relativePaths=[];E.currLocation.objects.relativePaths=E.nextTagObjs||[];E.startKeyNum=E.tagContinuationTokens.length===0?0:E.maxKeys*E.markers.length+1;E.endKeyNum=E.startKeyNum;E.isRefreshing=true}E.tagQueryDeferred=Z.defer();E.tagQueryDeferred.promise.then(function(aD){return ai(aD)},function(aD){if(aD.status===b.HTTP_STATUS_CODES.METHOD_NOT_ALLOWED){E.currLocation.objects.error=n.instant("prefixtagsearch.methodnotallowed")}else{E.currLocation.objects.error=n.instant("utilities.unknown.error")}E.isRefreshing=false;E.fetchPageInProgress=false;E.showAllObjects()});s.tagQuery(E.filters.tagFilters,E.maxKeys,aB).then(function(aD){return E.tagQueryDeferred.resolve(aD)},function(aD){return E.tagQueryDeferred.reject(aD)})};function ai(aE){var aB=u.convertXmlStringToJson(aE.response).TagQueryResult;var aD=true;if(aB.Contents){var aC=[].concat(aB.Contents);angular.forEach(aC,function(aF){return aD=t(aF.Key)})}if(aB.IsTruncated===true&&_.isString(aB.NextContinuationToken)){if(aD){E.fetchOnePageTag(aB.NextContinuationToken,false)}else{E.tagContinuationTokens.push(aB.NextContinuationToken);E.isRefreshing=false;E.showAllObjects()}}else{if(E.currLocation.objects.relativePaths.length===0){E.noResultsMessage=n.instant("tagsearch.noresults")}E.isRefreshing=false;E.showAllObjects()}E.fetchPageInProgress=false}function t(aC,aB){var aE=aC.split("/"),aD=aE[aE.length-1],aF={ETag:"",Key:aD,LastModified:"",Owner:{DisplayName:"",ID:""},Path:aE.length>1?aC.substring(0,aC.lastIndexOf(aD)):"",Size:"",StorageClass:"",VersionId:aB,beingRenamed:false};if(E.endKeyNum-E.startKeyNum<E.maxKeys-1){E.currLocation.objects.relativePaths.push(aF);if(E.startKeyNum===0){E.startKeyNum=1}E.endKeyNum++;return true}else{if(E.nextTagObjs){E.nextTagObjs.push(aF)}else{E.nextTagObjs=[aF]}return false}}function q(){if(d.currentPage>d.lastCachedPage){d.lastCachedPage=d.currentPage}var aB=av.getPageOfDeletedObjects(d.currentPage);az(aB,true);E.startKeyNum=d.currentPage*E.maxKeys+1;E.endKeyNum=E.startKeyNum+aB.Contents.length+aB.CommonPrefixes.length-1}E.fetchNextPageOfObjects=function(){if(E.fetchPageInProgress){return}else{E.fetchPageInProgress=true}var aB=O.getCurrentAbsoluteFolderPath();if(aB===undefined){aB=""}if(E.showDeleted){d.currentPage++;if(d.currentPage<=d.lastCachedPage||!d.isTruncated){q();E.fetchPageInProgress=false}else{al.fetchDeletedPageOfObjects(aB,d.currentPage,d.nextKeyMarker,d.nextVersionIdMarker).then(function(aC){F(aC);E.fetchPageInProgress=false},function(aC){i(aC);E.fetchPageInProgress=false})}}else{if(E.tagContinuationTokens.length>0){E.fetchOnePageTag(E.tagContinuationTokens[E.tagContinuationTokens.length-1])}else{aB=aB.concat(E.filters.input||"");E.markers.push(E.currentMarker);E.startKeyNum=E.maxKeys*E.markers.length+1;H(aB,E.nextMarker)}}};E.fetchPreviousPageOfObjects=function(){if(E.showDeleted){d.currentPage--;q()}else{var aB=O.getCurrentAbsoluteFolderPath();if(aB===undefined){aB=""}aB=aB.concat(E.filters.input||"");var aC=E.markers.pop();if(!aC||Object.keys(aC).length===0){aC=""}E.startKeyNum=E.maxKeys*E.markers.length+1;H(aB,aC)}};function aa(aD,aB){var aC=arguments.length<=2||arguments[2]===undefined?true:arguments[2];s.listObjects(aD,aB,E.maxKeys,b.DELIMITER,aC).then(function(aF){var aE=aF.response.ListBucketResult;az(aE);if(aE.IsTruncated&&k.convertStringToBoolean(aE.IsTruncated)){aa(aE.NextMarker)}else{at()}})["catch"](function(aE){i(aE)})}function i(aB){E.currLocation.objects.error=k.handleErrors(aB);j.Timer.customerReady();E.currLocation.loading=false;E.isRefreshing=false}function at(){E.timing.fetchAllObjects.duration=new Date().getTime()-E.timing.fetchAllObjects.start;E.currLocation.loading=false;E.currLocation.objects.error=false;E.isRefreshing=false;E.fetchPageInProgress=false}E.openUploadModal=function(){E.currentPath=O.getAbsolutePathWithBucket();E.flags.uploadDisabled=true;k.analyticsTrackClick(b.ANALYTICS.UPLOAD_OBJECTS_MODAL,b.ANALYTICS.DETAILS);k.analyticsTrackClick(b.ANALYTICS.START_UPLOAD_FILE,b.ANALYTICS.UPLOAD_FILE_S3);k.analyticsTrackView(b.ANALYTICS.SELECT_UPLOAD_FILE,b.ANALYTICS.UPLOAD_FILE_S3);E.isUploadModalDisplayed.flag=true};var R=y.$on("fileDropEvent",function(aD,aC){if(E.isUploadModalDisplayed.flag){return}aD.defaultFired=true;E.operations.dragAndDropOperation=ac.createUploadOperation();var aB=A.createExplorer(aC,E.operations.dragAndDropOperation);aB.then(function(aE){E.operations.dragAndDropOperation.explorers.push(aE);E.selected={selectedItems:aE.getSelectedItems()};E.flags.uploadDisabled=false},function(aE){E.error=aE});E.openUploadModal()});E.getPropertyTitleConditionally=function(aD,aB,aC){if(aD){return n.instant(aB+aC)}return""};E.setTabParam=function(aB){ar.search("tab",aB);k.analyticsTrackClick(""+b.ANALYTICS.TAB_VIEW+aB,b.ANALYTICS.DETAILS)};E.$on("$destroy",function(){R();ae.setSelectedFlagAsFalse(E.currLocation.folders.relativePaths,E.currLocation.objects.relativePaths)});E.getStorageClassTranslation=function(aB){return k.getStorageClassTranslations()[aB]};E.isFeatureEnabled=function(aB){return ay.isFeatureEnabled(aB)};E.isFetchPreviousPageDisabled=function(){if(E.fetchPageInProgress){return true}if(!E.showDeleted){return E.markers.length===0}else{return d.currentPage===0}};E.isFetchNextPageDisabled=function(){if(E.fetchPageInProgress){return true}if(!E.showDeleted){return !E.nextMarker}else{if(!d.isTruncated&&d.currentPage===d.lastCachedPage){if(av.getPageOfDeletedObjects(d.currentPage+1)){return false}return true}return false}};E.copySelectedObjectPath=function(aB){k.copyPathToClipboard(aB,E.copyFinished)};E.rightClick=function(aB,aE){w.log(b.CONTEXT_MENU.OBJECT.METRIC_NAME,1,{details:aE});aB.stopPropagation();var aC=angular.element("#context-menu");aC.css({position:"absolute",top:aB.pageY-b.CONTEXT_MENU.OBJECT.Y_OFFSET,left:aB.pageX});if(aE){var aD=_.pluck(E.getSelectedObjects(),"Key").concat(_.pluck(E.getSelectedFolders(),"Prefix"));if(aD.length===0||_.indexOf(aD,aE.Key||aE.Prefix)===-1){E.clickObjectRow(aB,aE)}}U(function(){aC.find("awsui-button-dropdown").find("button").trigger("click")},0,false)};function ah(){w.setEndpoint();if(E.isFeatureEnabled("s3-si")){E.tabs.push(m)}if(c[b.SHOW_DELETED_PARAM]){E.showDeleted=k.convertStringToBoolean(c[b.SHOW_DELETED_PARAM])}E.fetchObjects(false);J.getVersioningStatus(E.bucketName).then(function(aB){E.isVersionedBucket=aB===b.BUCKET_PROPERTIES.VERSIONING.ENABLED||aB===b.BUCKET_PROPERTIES.VERSIONING.SUSPENDED})}ah()};"use strict";(function(){angular.module("s3").directive("createBucketModal",[function(){return{restrict:"E",scope:{isOpen:"=",bucketList:"=",regions:"=",numRegions:"=",loadBuckets:"="},templateUrl:"/s3/partials/createbucketmodal.html",controller:"CreateBucketController"}}]);angular.module("s3").controller("CreateBucketController",["$q","$scope","$translate","APIProxyService","BucketPropertiesService","CachingService","ConsoleOperation","PermissionsUtilService","Region","S3Constants","SCLogService","UtilService",a]);function a(v,p,q,s,l,i,m,k,e,o,c,x){p.STEP={NAME_AND_REGION:{name:"NAME_AND_REGION",value:q.instant("createbucketmodal.label.nameandregion")},PROPERTIES:{name:"PROPERTIES",value:q.instant("createbucketmodal.label.setproperties")},PERMISSIONS:{name:"PERMISSIONS",value:q.instant("createbucketmodal.label.setpermissions")},REVIEW:{name:"REVIEW",value:q.instant("createbucketmodal.label.review")}};p.state=p.STEP.NAME_AND_REGION;p.headerTitle=q.instant("createbucketmodal.header.title");p.createBucketValues={firstLoad:true};p.createBucketValues.region=_.find(p.regions,function(z){return z.value===e.getCurrentRegion()});p.createBucketProperties={getResponse:{tagging:{tags:[]},logging:{selectedValue:o.BUCKET_PROPERTIES.DISABLE},versioning:{selectedValue:o.BUCKET_PROPERTIES.DISABLE}}};p.forCreateBucketModal=true;p.defaultAcls=_.cloneDeep(o.BUCKET_PERMISSIONS.INITIALIZE_ACLS);p.currPermissions=_.cloneDeep(o.BUCKET_PERMISSIONS.INITIALIZE_ACLS);p.sourceBucketPermissions={grantees:{},aclGrants:{},owner:{}};p.isCreatingBucket=false;p.propertyStatuses=[];y();p.bucketNameValidationErrors=[];p.MODAL_TYPE=o.MODAL_TYPE;function t(){return v.reject()}function g(z){return z.then(function(){})["catch"](function(){return t()})}function r(A){var z=new m(o.BUCKET_PROPERTIES.VERSIONING.ENABLE_BUCKET_VERSIONING);return g(l.enableBucketVersioning(A,z))}function f(A,z){var B=new m(o.BUCKET_PROPERTIES.TAGGING.PUT_BUCKET_TAGGING);return g(l.putBucketTagging(A,z,B))}function u(z){var A=new m(o.BUCKET_PERMISSIONS.PUT_BUCKET_PERMISSIONS_REQUEST);return l.putBucketACL(z,k.updateAcl(p.sourceBucketPermissions,p.currPermissions),A).then(function(){})["catch"](function(B){return t(B)})}function y(){var z=new m(o.BUCKET_PERMISSIONS.GET_BUCKET_OWNER);s.getBucketOwner(z).then(function(A){c.log("getBucketOwner",1,z);p.currPermissions.ownerName=A.DisplayName;p.defaultAcls.userPermissions[0].detail=_.clone(A);p.currPermissions.userPermissions[0].detail=_.clone(A)})["catch"](function(A){c.log("getBucketOwner",0,z);p.sourceBucketPermissions.owner.isError=true;p.sourceBucketPermissions.owner.errorMessage=x.handleErrors(A)})}function b(C,z,A,B){C.push({Grantee:{Type:o.BUCKET_PROPERTIES.GROUP_GANTEE_TYPE,DisplayName:"",EmailAddress:"",ID:"",URI:o.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:z});c.log("LogDeliveryGroupGranteeAdded",1,A,{bucketName:B})}function w(B,E,D,z){var A=new m(o.BUCKET_PROPERTIES.LOGGING.ENABLE_BUCKET_LOGGING);var C=false;A.step=o.BUCKET_PROPERTIES.GET_BUCKET_ACL;return l.getBucketACL(E,A).then(function(F){var G=x.transformObjectToArray(F);if(_.findIndex(F,{Grantee:{URI:o.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:o.ACL_PERMISSIONS.WRITE})===-1){b(G,o.ACL_PERMISSIONS.WRITE,A,B);C=true}if(_.findIndex(F,{Grantee:{URI:o.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:o.ACL_PERMISSIONS.READ_ACP})===-1){b(G,o.ACL_PERMISSIONS.READ_ACP,A,B);C=true}if(C){A.step=o.BUCKET_PROPERTIES.PUT_BUCKET_ACL;return l.putBucketACL(E,G,A).then(function(){A.step=o.BUCKET_PROPERTIES.LOGGING.ENABLE_BUCKET_LOGGING;return l.enableBucketLogging(B,E,D,z,A).then(function(){})["catch"](function(H){return t(H)})})["catch"](function(H){return t(H)})}else{return l.enableBucketLogging(B,E,D,z,A).then(function(){})["catch"](function(H){return t(H)})}})["catch"](function(F){return t(F)})}function d(B,E){if(p.createBucketProperties.getResponse.versioning.selectedValue===o.BUCKET_PROPERTIES.ENABLE){E.push(r(B))}if(p.createBucketProperties.getResponse.tagging.tags.length>0){var A=p.createBucketProperties.getResponse.tagging.tags;E.push(f(B,A))}if(p.createBucketProperties.getResponse.logging.selectedValue===o.BUCKET_PROPERTIES.ENABLE){var D=p.createBucketProperties.getResponse.logging.targetBucket;var C=p.createBucketProperties.getResponse.logging.targetPrefix;var z=x.transformObjectToArray(p.createBucketProperties.getResponse.logging.targetGrants);E.push(w(B,D,C,z))}if(JSON.stringify(k.updateAcl(p.sourceBucketPermissions,p.currPermissions))!==JSON.stringify(k.updateAcl(p.defaultAcls,p.defaultAcls))){E.push(u(B))}}p.createBucket=function(A,B){x.analyticsTrackClick(o.ANALYTICS.END_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);p.isCreatingBucket=true;var z=new m("CreateBucket","CreateBucketRequestReceived");c.log("CreateBucketRequestReceived",1,z,{bucketName:A,region:B.value});s.createBucket(z,A,B.value).then(function(){x.analyticsTrackClick(o.ANALYTICS.SUCCESS_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);i.evictLamb();c.log("CreateBucketSuccess",1,z,{bucketName:A,region:B.value});var E=[];d(A,E);v.all(E).then(function D(F){p.closeCreateBucketModal()},function C(){p.createS3BucketWarning=q.instant("createbucketmodal.errormsg",{bucketName:A})});p.loadBuckets(z)})["catch"](function(C){p.createS3BucketError=x.handleErrors(C);c.log("CreateBucketSuccess",0,z,{bucketName:A,region:B.value,errorMessage:C})})["finally"](function(){p.isCreatingBucket=false;if(p.createS3BucketError){p.setState(p.STEP.REVIEW)}})};p.closeCreateBucketModal=function(){p.isOpen.flag=false;p.createS3BucketError=undefined;p.createS3BucketWarning=null;p.createBucketValues.region=_.find(p.regions,function(z){return z.value===e.getCurrentRegion()});p.createBucketValues.name="";p.createBucketValues.copySettingsSourceBucket=undefined;p.state=p.STEP.NAME_AND_REGION;p.createBucketProperties={getResponse:{tagging:{tags:[]},logging:{selectedValue:o.BUCKET_PROPERTIES.DISABLE},versioning:{selectedValue:o.BUCKET_PROPERTIES.DISABLE}}};p.sourceBucketPermissions.aclGrants={};p.sourceBucketPermissions.grantees={};p.currPermissions.publicPermissions=_.cloneDeep(p.defaultAcls.publicPermissions);p.currPermissions.userPermissions=_.cloneDeep(p.defaultAcls.userPermissions);p.currPermissions.systemPermissions=_.cloneDeep(p.defaultAcls.systemPermissions);p.bucketNameValidationErrors=[];x.bodyFreezeScroll(false)};p.goToPreviousState=function(){p.bucketNameValidationErrors=[];p.previousState()};p.generateSummary=function(){if(p.state===p.STEP.NAME_AND_REGION){s.headBucket(new m("checkBucketAvailability"),p.createBucketValues.name).then(function(A){p.bucketNameValidationErrors=[q.instant("createbucketmodal.bucketname.exists.error")]})["catch"](function(A){if(A.status===o.HTTP_STATUS_CODES.NOT_FOUND){x.analyticsTrackClick(o.ANALYTICS.NAME_REGION_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);x.analyticsTrackView(o.ANALYTICS.SET_PROP_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);p.nextState()}else{p.bucketNameValidationErrors=[q.instant("createbucketmodal.bucketname.access.error")]}})}else{if(p.state===p.STEP.PROPERTIES){x.analyticsTrackClick(o.ANALYTICS.SET_PROP_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);x.analyticsTrackView(o.ANALYTICS.SET_PERM_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);var z=[{name:q.instant("bucketproperties.versioning.label.versioning"),value:"versioning"},{name:q.instant("bucketproperties.logging.label.logging"),value:"logging"},{name:q.instant("bucketproperties.tagging.label.tagging"),value:"tagging"}];p.propertyStatuses=[];z.forEach(function(A){p.propertyStatuses.push(n(A))});p.nextState()}else{x.analyticsTrackClick(o.ANALYTICS.SET_PERM_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);x.analyticsTrackView(o.ANALYTICS.REVIEW_CREATE_BUCKET,o.ANALYTICS.CREATE_BUCKET_S3);p.aclsSummaries[1].value=h(p.currPermissions.publicPermissions);p.aclsSummaries[2].value=h(p.currPermissions.systemPermissions);p.nextState()}}};p.validateBucketName=function(){var z=[];if(x.isValidBucketName(p.createBucketValues.name,z)){if(j(p.createBucketValues.name)){p.bucketNameValidationErrors=[q.instant("createbucketmodal.bucketname.exists.error")]}else{p.bucketNameValidationErrors=[]}}else{p.bucketNameValidationErrors=z}};function j(z){return p.bucketList.some(function(A){return A.Name===z})}function n(C){var z=p.createBucketProperties.getResponse[C.value];var B={name:C.name};var A={enabled:q.instant("createbucketmodal.review.enabled"),disabled:q.instant("createbucketmodal.review.disabled"),activenotifs:q.instant("createbucketmodal.review.activenotifications"),tags:q.instant("createbucketmodal.review.tags")};switch(C.value){case"versioning":B.status=z.selectedValue;B.status=z.selectedValue===o.BUCKET_PROPERTIES.VERSIONING.ENABLE?A.enabled:A.disabled;break;case"logging":B.status=z.selectedValue===o.BUCKET_PROPERTIES.LOGGING.ENABLE?A.enabled:A.disabled;break;case"tagging":B.status=z.tags.length+" "+A.tags;break}return B}var h=function h(z){return _.map(z,"permissions").filter(function(A){return A&&(A.READ||A.READ_ACP||A.WRITE||A.WRITE_ACP)}).length>0?q.instant("modal.acl.summary.enabled"):q.instant("modal.acl.summary.disabled")};p.aclsSummaries=[{summaryTitle:q.instant("modal.acl.summary.users"),value:p.currPermissions.userPermissions.length},{summaryTitle:q.instant("modal.acl.summary.publicacls"),value:q.instant("modal.acl.summary.disabled")},{summaryTitle:q.instant("modal.acl.summary.systemacls"),value:q.instant("modal.acl.summary.disabled")}]}})();"use strict";angular.module("s3").factory("APIProxyService",["CachingService","FAC","Md5GenerationService","SCLogService","S3Service","S3WrapperService","S3Constants","UtilService","KMSService","GlacierService","$q","$window",function(n,Y,S,e,p,K,W,t,T,O,b,P){var q=function q(aa,af,ad,ac){ac.step=W.LOGGING.S3_REQUEST_PREFIX+ad;if(af.path){af.path=t.escapePath(af.path)}e.log(ac.step.replace(/ /g,""),1,ac,af);var ab=ad.replace(/ /g,"");var ae=P.Date.now();return aa(af).then(function(ah){var ag=P.Date.now();var ai={};var aj=ah.headers();ai[W.S3_RESPONSE_HEADERS.X_AMZ_ID_2]=aj[W.S3_RESPONSE_HEADERS.X_AMZ_ID_2];ai[W.S3_RESPONSE_HEADERS.X_AMZ_REQUEST_ID]=aj[W.S3_RESPONSE_HEADERS.X_AMZ_REQUEST_ID];e.log(""+ab+W.REQUEST_METRICS.STATUS_CODE_INFIX+ah.status,1,ac,ai);e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,1,ac);e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,1,ac);e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.LATENCY_SUFFIX,ag-ae,ac);if(ah&&ah.response&&ah.response.error){return b.reject(t.handleErrors(ah.response.error))}return ah})["catch"](function(ah){var ag=P.Date.now();var ai={};var aj=ah.headers();ai[W.S3_RESPONSE_HEADERS.X_AMZ_ID_2]=aj[W.S3_RESPONSE_HEADERS.X_AMZ_ID_2];ai[W.S3_RESPONSE_HEADERS.X_AMZ_REQUEST_ID]=aj[W.S3_RESPONSE_HEADERS.X_AMZ_REQUEST_ID];e.log(""+ab+W.REQUEST_METRICS.STATUS_CODE_INFIX+ah.status,1,ac,{response:ah,details:ai});if(ah.status>=W.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD){e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,0,ac)}else{e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,1,ac)}if(ah.status>=W.HTTP_STATUS_CODES.CLIENT_ERROR_THRESHOLD&&ah.status<W.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD){e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,0,ac)}else{e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,1,ac)}e.logWithSimplifiedOperation(""+ab+W.REQUEST_METRICS.LATENCY_SUFFIX,ag-ae,ac);return b.reject(ah)})};function a(ab,ad,aa,ac){return H(ab,ad,{path:ad+"/"+aa,params:{versionId:ac}}).then(function(ae){return q(p.getObjectMetadata,ae,W.PROXY_API_NAMES.S3.GET_OBJECT_METADATA,ab)})}function v(aa){var ad=arguments.length<=1||arguments[1]===undefined?true:arguments[1];if(ad){var ae=n.getLamb();if(ae){return b.when(ae)}}function ac(ag,af){return q(ag,af,W.PROXY_API_NAMES.S3.HEAD_BUCKET,aa)}var ab=t.getRegionOrder();_.remove(ab,function(af){return af===W.DEFAULT_REGION[t.getCloudSystem()]});ab.unshift(W.DEFAULT_REGION[t.getCloudSystem()]);return K.lambWithFallback(ab,ac).then(function(ag){var af=_.get(ag,"response.ListAllMyBucketsResult.Buckets");af.Bucket=g(af.Bucket);af.Bucket.forEach(function(ah){H(aa,ah.Name)});n.putLamb(ag);return ag})}function B(aa){var ab=n.getLamb();if(ab){return b.when(ab.response.ListAllMyBucketsResult.Owner)}return q(p.listAllMyBuckets,{region:W.DEFAULT_REGION[t.getCloudSystem()]},W.PROXY_API_NAMES.S3.LAMB,aa).then(function(ac){return _.get(ac,"response.ListAllMyBucketsResult.Owner")})}function c(aa,ab){var ac={path:ab};return q(p.headBucket,ac,W.PROXY_API_NAMES.S3.HEAD_BUCKET,aa)}function R(aa){var ab={path:aa.initialBucket};return H(aa,aa.initialBucket,ab).then(function(ac){return q(p.deleteBucket,ac,aa.name,aa)})}function o(ab,ag,ac,ae,af){var aa=b.defer();ac=ac||"";var ad={path:ag+"/"+ac+ae+"/"};if(af){ad.headers=af}H(ab,ag,ad).then(function(ah){q(p.putObject,ah,W.PROXY_API_NAMES.S3.PUT_OBJECT,ab).then(function(ai){aa.resolve(ai)})["catch"](function(ai){aa.reject(ai)})})["catch"](function(ah){aa.reject(ah)});return aa.promise}function I(ab,ae,ac){var aa=b.defer();var ad={path:ae+"/"+ac};H(ab,ae,ad).then(function(af){q(p.headObject,af,W.PROXY_API_NAMES.S3.HEAD_OBJECT,ab).then(function(ag){aa.resolve(ag)})["catch"](function(ag){aa.reject(ag)})})["catch"](function(af){aa.reject(af)});return aa.promise}function i(ab,ac,ae){var aa;if(ae==="us-east-1"){aa=""}else{aa="<CreateBucketConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'><LocationConstraint>"+ae+"</LocationConstraint></CreateBucketConfiguration>"}var ad={content:aa,path:ac,region:ae};return q(p.createBucket,ad,W.PROXY_API_NAMES.S3.CREATE_BUCKET,ab).then(function(af){return af})["catch"](function(af){if(af.response&&af.response.Error&&af.response.Error.Message){return b.reject(af.response.Error.Message)}else{return b.reject(af)}})}var H=function H(ab,af,ae){var aa=n.getBucketLocation(af);if(aa){if(ae){ae.region=aa}return b.when(ae)}var ac=t.getRegionOrder();function ad(ag,ah){return q(ag,ah,W.PROXY_API_NAMES.S3.HEAD_BUCKET,ab)}return K.getBucketLocationWithFallback(af,ac,ad).then(function(ag){n.putBucketLocation(af,ag);if(ae){ae.region=ag}return ae})};var J=function J(ab,ad){var ac=ad.cacheAllowed;delete ad.cacheAllowed;if(ac){var aa=n.getBucketObjects(ad.path,JSON.stringify(ad));if(aa){return b.when(aa)}}return q(p.listObjects,ad,W.PROXY_API_NAMES.S3.LIST_OBJECT,ab).then(function(ag){var af=ag.response.ListBucketResult;if(af.Contents){af.Contents=g(af.Contents);af.Contents=af.Contents.map(function(ah){ah.Size=parseInt(ah.Size);return ah})}if(af.CommonPrefixes){af.CommonPrefixes=g(af.CommonPrefixes)}if(af.IsTruncated&&af.IsTruncated==="true"&&!af.NextMarker){var ae=af.Contents[af.Contents.length-1].Key;af.NextMarker=ae}if(!ac||ac&&!aa){n.putBucketObjects(ad.path,JSON.stringify(ad),ag)}return ag})};function G(ab,ac){var aa={path:ac.bucket,params:{prefix:ac.prefix,"max-keys":ac.maxKeys,marker:ac.marker,delimiter:ac.delimiter},cacheAllowed:ac.cacheAllowed};if(Y.isFeatureEnabled("s3-log-response-data")){aa.details={shouldLogResponseData:true}}return H(ab,ac.bucket,aa).then(function(ad){return J(ab,ad)})}function l(ab,ad){var aa=b.defer(),ac={path:ad.bucket,params:{delimiter:ad.delimiter,"key-marker":ad.keyMarker,"max-keys":ad.maxKeys,prefix:ad.prefix,"version-id-marker":ad.versionIdMarker},cacheAllowed:ad.cacheAllowed};H(ab,ad.bucket,ac).then(function(ae){q(p.listVersions,ae,W.PROXY_API_NAMES.S3.LIST_VERSION,ab).then(function(af){aa.resolve(af)})["catch"](function(af){aa.reject(af)})})["catch"](function(ae){aa.reject(ae)});return aa.promise}var X=function X(aa,ab){return q(p.getObjectAcl,ab,W.PROXY_API_NAMES.S3.GET_OBJECT_ACL,aa).then(function(ad){var ac=ad.response.AccessControlPolicy.AccessControlList;ac.Grant=g(ac.Grant);return ad})};function y(ab,ac,aa){return H(ab,ac,{path:ac+"/"+aa}).then(function(ad){return X(ab,ad)})}function h(ab,ac,ad){var aa=b.defer();H(ab,ac,{path:ac,content:ad}).then(function(ae){q(p.tagQuery,ae,W.PROXY_API_NAMES.S3.TAG_QUERY,ab).then(function(af){return aa.resolve(af)},function(af){return aa.reject(af)})});return aa.promise}var w=function w(ab,ac){var aa=b.defer();q(p.getObjectTag,ac,W.PROXY_API_NAMES.S3.GET_OBJECT_TAG,ab).then(function(ad){return aa.resolve(ad)},function(ad){return aa.reject(ad)});return aa.promise};function z(ac,ae,ab){var ad=arguments.length<=3||arguments[3]===undefined?null:arguments[3];var aa=b.defer(),af={path:ae+"/"+ab};if(!_.isEmpty(ad)){af.params={versionId:ad}}H(ac,ae,af).then(function(ag){w(ac,ag).then(function(ah){aa.resolve(ah)},function(ah){aa.reject(ah)})},function(ag){aa.reject(ag)});return aa.promise}function j(ab,ad,ag,af){var ac=arguments.length<=4||arguments[4]===undefined?null:arguments[4];var aa=b.defer(),ae={path:ad+"/"+ag,content:af};if(!_.isEmpty(ac)){ae.params={versionId:ac}}H(ab,ad,ae).then(function(ah){q(p.putObjectTag,ah,W.PROXY_API_NAMES.S3.PUT_OBJECT_TAG,ab).then(function(ai){aa.resolve(ai)},function(ai){aa.reject(ai)})});return aa.promise}function N(aa,ac,ab,ae){var ad={path:ac+"/"+ab,content:ae};return H(aa,ac,ad).then(function(af){return q(p.putObjectAcl,af,W.PROXY_API_NAMES.S3.PUT_OBJECT_ACL,aa).then(function(ag){return ag},function(ag){return ag})})["catch"](function(af){if(af.response){return b.reject(af.response.Error.Message)}else{return b.reject(af)}})}function m(aa,ab,ac){return H(aa,ab,ac).then(function(ad){return q(p.getObjectInventory,ad,"S3-GetObjectInventory",aa).then(function(ae){return ae})})["catch"](function(ad){if(ad.response){return b.reject(ad.response.Error.Message)}else{return b.reject(ad)}})}var d=function d(aa,ab,ac){return H(aa,ab,ac).then(function(ad){return q(p.deleteObjectInventoryConfig,ad,"S3-DeleteObjectInventoryConfig",aa).then(function(ae){return ae})})["catch"](function(ad){if(ad.response){return b.reject(ad.response.Error.Message)}else{return b.reject(ad)}})};var M=function M(aa,ab,ac){return H(aa,ab,ac).then(function(ad){return q(p.putObjectInventoryConfig,ad,"S3-PutObjectInventoryConfig",aa).then(function(ae){return ae})})["catch"](function(ad){if(ad.response){return b.reject(ad.response.Error.Message)}else{return b.reject(ad)}})};function g(aa){if(!aa){return[]}var ab;if(!angular.isArray(aa)){ab=new Array(aa)}else{ab=aa}return ab}function C(ad,ac,ae,ab,aa){var af={content:"",path:ad+"/"+ac,params:{uploads:""},headers:ae,config:{timeout:ab}};return H(aa,ad,af).then(function(ag){return q(p.initiateMultipartUpload,ag,W.PROXY_API_NAMES.S3.INITIAL_MULTIPART_UPLOAD,aa)})}function x(af,ac,ae,ag,ab,aa){var ad={content:ae,path:af+"/"+ac,params:{uploadId:ag},config:{timeout:ab}};return H(aa,af,ad).then(function(ah){return q(p.completeMultipartUpload,ah,W.PROXY_API_NAMES.S3.COMPLETE_MULTIPART_UPLOAD,aa)})}function L(aa,ab,ad){var ae=arguments.length<=3||arguments[3]===undefined?{}:arguments[3];var ac=arguments.length<=4||arguments[4]===undefined?true:arguments[4];return ac&&U(ab,ad)||H(aa,ab,{path:ab}).then(function(af){angular.extend(af,ae);return q(A[ad].getterFunction,af,W.PROXY_API_NAMES.S3.GET_PROPERTY_PREFIX+ad,aa).then(function(ag){if(ac){n.putBucketProperty(ab,ad,ag)}return ag})})["catch"](function(af){if(af.response&&af.response.Error&&af.response.Error.Message){return b.reject(af.response.Error.Message)}else{return b.reject(af)}})}function U(aa,ab){var ac=n.getBucketProperty(aa,ab);if(ac){return b.when(ac)}}function u(aa,ab,ac){var ad=arguments.length<=3||arguments[3]===undefined?{}:arguments[3];var ae=_.extend({path:ab},ad);return H(aa,ab,ae).then(function(af){return q(A[ac].deleteFunction,af,W.PROXY_API_NAMES.S3.DELETE_PROPERTY_PREFIX+ac,aa).then(function(ag){n.evictBucketProperty(ab,ac);return ag})})["catch"](function(af){if(af.response&&af.response.Error&&af.response.Error.message){return b.reject(af.response.Error.Message)}else{return b.reject(af)}})}var A={acl:{name:"acl",getterFunction:function f(aa){return p.getBucketAcl(aa)},putterFunction:function V(aa){return p.putBucketAcl(aa)}},cors:{name:"cors",getterFunction:function f(aa){return p.getBucketCORS(aa)},putterFunction:function V(aa){return p.putBucketCORS(aa)},deleteFunction:function F(aa){return p.deleteBucketCORS(aa)}},policy:{name:"policy",getterFunction:function f(aa){return p.getBucketPolicy(aa)},putterFunction:function V(aa){return p.putBucketPolicy(aa)},deleteFunction:function F(aa){return p.deleteBucketPolicy(aa)}},logging:{name:"logging",getterFunction:function f(aa){return p.getBucketLogging(aa)},putterFunction:function V(aa){return p.putBucketLogging(aa)}},lifecycle:{name:"lifecycle",getterFunction:function f(aa){return p.getLifecycleConfiguration(aa)},putterFunction:function V(aa){return p.putLifecycleConfiguration(aa)},deleteFunction:function F(aa){return p.deleteLifecycleConfiguration(aa)}},website:{name:"website",getterFunction:function f(aa){return p.getBucketWebsite(aa)},putterFunction:function V(aa){return p.putBucketWebsite(aa)},deleteFunction:function F(aa){return p.deleteBucketWebsite(aa)}},notification:{name:"notification",getterFunction:function f(aa){return p.getBucketNotification(aa)},putterFunction:function V(aa){return p.putBucketNotification(aa)}},versioning:{name:"versioning",getterFunction:function f(aa){return p.getBucketVersioning(aa)},putterFunction:function V(aa){return p.putBucketVersioning(aa)}},replication:{name:"replication",getterFunction:function f(aa){return p.getBucketReplication(aa)},putterFunction:function V(aa){return p.putBucketReplication(aa)},deleteFunction:function F(aa){return p.deleteBucketReplication(aa)}},tagging:{name:"tagging",getterFunction:function f(aa){return p.getBucketTagging(aa)},putterFunction:function V(aa){return p.putBucketTagging(aa)},deleteFunction:function F(aa){return p.deleteBucketTagging(aa)}},requestPayment:{name:"requestPayment",getterFunction:function f(aa){return p.getRequestPayment(aa)},putterFunction:function V(aa){return p.putRequestPayment(aa)}},metrics:{name:"metrics",getterFunction:function f(aa){return p.getBucketMetrics(aa)},putterFunction:function V(aa){return p.putBucketMetrics(aa)},deleteFunction:function F(aa){return p.deleteBucketMetrics(aa)}},analytics:{name:"analytics",getterFunction:function f(aa){return p.getBucketAnalytics(aa)},putterFunction:function V(aa){return p.putBucketAnalytics(aa)},deleteFunction:function F(aa){return p.deleteBucketAnalytics(aa)}},accelerate:{name:"accelerate",getterFunction:function f(aa){return p.getBucketAccelerate(aa)},putterFunction:function V(aa){return p.putBucketAccelerate(aa)}}};var D=["tagging","cors","replication","lifecycle"];function E(aa,ab,ac,af){var ad=arguments.length<=4||arguments[4]===undefined?{}:arguments[4];var ae=_.extend({path:ab,content:af},ad);if(D.indexOf(ac)!==-1){ae.headers={"Content-Type":"application/x-amz-json-1.1","X-Amz-Date":new Date().toUTCString(),"Content-MD5":S.getContentMd5(af)}}return H(aa,ab,ae).then(function(ag){return q(A[ac].putterFunction,ag,W.PROXY_API_NAMES.S3.PUT_PROPERTY_PREFIX+ac,aa).then(function(ah){n.evictBucketProperty(ab,ac);return ah})})["catch"](function(ai){if(ai.response&&ai.response.Error&&ai.response.Error.Message){var ah=ai.response.Error;var ag=ah.ArgumentValue1?ah.Message+". "+ah.ArgumentValue1+". ("+ah.ArgumentName1+")":ah.Message;return b.reject(ag)}else{return b.reject(ai)}})}var k=function k(aa,ab){return q(p.getObject,ab,W.PROXY_API_NAMES.S3.GET_OBJECT,aa).then(function(ac){return ac.response})["catch"](function(ac){if(ac.response&&ac.response.Error&&ac.response.Error.Message){return b.reject(ac.response.Error.Message)}else{return b.reject(ac)}})};function Q(ab,ac,aa,ad){if(!ad){ad={"response-content-type":"text"}}return H(ab,ac,{path:ac+"/"+aa}).then(function(ae){ae.params=ad;return k(ab,ae)})}function s(ab,ac,ad){var aa=b.defer();H(ab,ac,ad).then(function(ae){e.log("GetBucketLocation",1,ab);q(T.listKeysForService,{Service:"s3",region:ae.region,Limit:1000},W.PROXY_API_NAMES.KMS.LIST_KEYS,ab).then(function(af){e.log("ListKeysForService",1,ab);aa.resolve(af)})["catch"](function(af){e.log("ListKeysForService",0,ab,af);aa.reject(af)})})["catch"](function(ae){e.log("GetBucketLocation",0,ab,ae);aa.reject(ae)});return aa.promise}function Z(ab,ac,ad){var aa=b.defer();q(O.listProvisionedCapacity,{region:ad},W.PROXY_API_NAMES.GLACIER.LIST_PROVISIONED_CAPACITY,ab).then(function(ae){e.log("ListProvisionedCapacity",1,ab);var af=_.get(ae,"response.ProvisionedCapacityList");aa.resolve(af)})["catch"](function(ae){e.log("ListProvisionedCapacity",0,ab,ae);aa.reject(ae)});return aa.promise}function r(ab,ac,ad){var aa=b.defer();q(O.purchaseProvisionedCapacity,{region:ad,content:JSON.stringify({})},W.PROXY_API_NAMES.GLACIER.PURCHASE_PROVISIONED_CAPACTIY,ab).then(function(ae){e.log("PurchaseProvisionedCapacity",1,ab);aa.resolve(ae)})["catch"](function(ae){e.log("PurchaseProvisionedCapacity",0,ab,ae);aa.reject(ae)});return aa.promise}return{bucketPropertiesMap:A,completeMultipartUpload:x,createBucket:i,deleteBucket:R,deleteBucketProperty:u,getBucketProperty:L,getBucketLocation:H,getBucketOwner:B,getObject:Q,getObjectAcl:y,getObjectMetadata:a,getObjectTag:z,makeProxyRequest:q,putObjectTag:j,getObjectInventory:m,deleteObjectInventoryConfig:d,putObjectInventoryConfig:M,headBucket:c,headObject:I,initiateMultipartUpload:C,listAllMyBuckets:v,listObjects:G,listVersions:l,putBucketProperty:E,putObject:o,putObjectAcl:N,tagQuery:h,getKmsKeys:s,listProvisionedCapacity:Z,purchaseProvisionedCapacity:r}}]);"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};angular.module("s3").factory("S3CWSAPIService",["$q","APIProxyService","S3Constants","$http","UtilService","UUIDService","SCLogService","ConsoleOperation","Region","S3CWSEndpoint",function(g,a,e,j,l,d,n,h,p,i){var f=function f(t,x,r,s){if(!r){r={}}if(!r.headers){r.headers={}}r.headers[e.HEADERS.OPERATION]=x;var v=d.generateUUID();t.cwsRequestId=v;var u=e.OPERATION.CWS_OP_ID;var q={};q[u]=v;s.step=e.LOGGING.CWS_REQUEST_PREFIX+x;var w=t.region||p.getCurrentRegion();var y=(typeof i==="undefined"?"undefined":_typeof(i))==="object"?i[w]:i;return j.post(y,t,r).then(function(z){var A={};A[u]=v;s.step=e.LOGGING.CWS_RESPONSE_PREFIX+x;n.log(""+x+e.REQUEST_METRICS.STATUS_CODE_INFIX+z.status,1,s,A);n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,1,s);n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,1,s);if(z&&z.data&&z.data.error){return g.reject(l.handleErrors(z.data.error))}return z},function(z){var A={};A[u]=v;A.message=z.statusText;s.step=e.LOGGING.CWS_RESPONSE_PREFIX+x;n.log(""+x+e.REQUEST_METRICS.STATUS_CODE_INFIX+z.status,1,s,A);if(z.status>=e.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD){n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,0,s)}else{n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.SERVER_AVAILABILITY_SUFFIX,1,s)}if(z.status>=e.HTTP_STATUS_CODES.CLIENT_ERROR_THRESHOLD&&z.status<e.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD){n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,0,s)}else{n.logWithSimplifiedOperation(""+x+e.REQUEST_METRICS.CLIENT_AVAILABILITY_SUFFIX,1,s)}return g.reject(z)})};return{makeS3ConsoleOperationRequest:f,makePublic:function m(q,r,t){if(!q){q=new h("FAKE CWS CALL OPERATION IN "+e.CWS_OPERATION_NAME.MAKE_PUBLIC)}var s={};s.bucket=q.initialBucket;s.region=t;s.keys=r;return a.getBucketLocation(q,s.bucket,s).then(function(u){return f(u,e.CWS_OPERATION_NAME.MAKE_PUBLIC,{},q)})},fetchPresignedUrl:function c(u,y,r,z,w,v,q,t){if(!t){t=new h("FAKE CWS CALL OPERATION IN "+e.CWS_OPERATION_NAME.GENERATE_PRESIGNED_URL)}var x={};x.bucket=u;x.key=y;x.httpMethod=r;x.headerOverrides=z;x.subresourceMap=w;x.customRequestHeaders=q;var s={};if(v){s.timeout=v}return a.getBucketLocation(t,u,x).then(function(A){return f(A,e.CWS_OPERATION_NAME.GENERATE_PRESIGNED_URL,s,t)})},generateCount:function k(s,r,t,q){var u={};u.bucket=s;u.folders=r;u.continuationTokens=t;return a.getBucketLocation(q,s,u).then(function(v){return f(v,e.CWS_OPERATION_NAME.GENERATE_COUNT,{},q)})},getMetadata:function b(s,r,q){var t={};t.bucket=s;t.key=r;return a.getBucketLocation(q,s,t).then(function(u){return f(u,e.CWS_OPERATION_NAME.GET_METADATA,{},q)})},wasOperationSuccessful:function o(q){return q.data.requestStatus==="success"}}}]);"use strict";angular.module("s3").factory("FileUpload",["$translate","S3Constants",function(c,b){function a(A,w,o,G,x,j,r,g){function d(){return w}function J(){return A}function h(){return o}function y(){return G}function e(){return x}function D(){return j}var k=c.instant("utilities.unknown.error");function L(){return k}function l(N){k=N}function M(){if(r&&r.storageClass){return r.storageClass}return b.STORAGE_CLASSES.STANDARD}function f(){if(r&&r.serverSideEncryption&&r.serverSideEncryption===b.OBJECT_SSE.KMS_ENCRYPTION){return r.kmsId}}function B(){if(r&&r.serverSideEncryption&&r.serverSideEncryption===b.OBJECT_SSE.KMS_ENCRYPTION&&r.kmsId===b.UPLOAD.CUSTOM_ARN){return r.kmsARN}}function p(){if(r&&r.metadata){return r.metadata}return undefined}function n(){if(r&&r.tags){var N="";angular.forEach(r.tags,function(Q,P){var O=encodeURIComponent(P)+"="+encodeURIComponent(Q)+"&";N=N.concat(O)});return N.slice(0,-1)}return undefined}function E(N){var O=n();if(!_.isEmpty(O)){N[b.HEADERS.X_AMZ_TAGGING]=O}}function I(O){var N="";if(r&&r.permissions){if(r.permissions.publicPermissions){r.permissions.publicPermissions.forEach(function(P){if(P.permissions[O]===true){N+=N.length>0?", ":"";N+='uri="'+P.detail.URI+'"'}})}if(r.permissions.userPermissions){if(!Array.isArray(r.permissions.userPermissions)){r.permissions.userPermissions=[r.permissions.userPermissions]}r.permissions.userPermissions.forEach(function(P){if(P.permissions[O]===true){N+=N.length>0?", ":"";N+='id="'+P.detail.ID+'"'}})}return N}}function s(N){if(I(b.ACL_PERMISSIONS.READ)!==""){N[b.HEADERS.X_AMZ_GRANT_READ]=I(b.ACL_PERMISSIONS.READ)}if(I(b.ACL_PERMISSIONS.READ_ACP)!==""){N[b.HEADERS.X_AMZ_GRANT_READ_ACP]=I(b.ACL_PERMISSIONS.READ_ACP)}if(I(b.ACL_PERMISSIONS.WRITE)!==""){N[b.HEADERS.X_AMZ_GRANT_WRITE]=I(b.ACL_PERMISSIONS.WRITE)}if(I(b.ACL_PERMISSIONS.WRITE_ACP)!==""){N[b.HEADERS.X_AMZ_GRANT_WRITE_ACP]=I(b.ACL_PERMISSIONS.WRITE_ACP)}}function m(O){var N=_.get(r,"serverSideEncryption");if(N===b.OBJECT_SSE.KMS_ENCRYPTION){O[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]=b.OBJECT_SSE.KMS_ENCRYPTION;O[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID]=f()===b.UPLOAD.CUSTOM_ARN?B():f()}else{if(N===b.OBJECT_SSE.AES256){O[b.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]=b.OBJECT_SSE.AES256}else{if(N===b.OBJECT_SSE.NONE){}else{if(N){throw"$translate.instant('upload.encryption.error'): "+N}}}}}function i(){var O={};O[b.HEADERS.X_AMZ_STORAGE_CLASS]=M();m(O);s(O);E(O);if(p()){var N=p();O=angular.extend({},O,N)}if(!O[b.HEADERS.CONTENT_TYPE]){O[b.HEADERS.CONTENT_TYPE]=undefined}return O}var z;function t(){return z}function K(N){z=N}var H={};function F(){return H}this.addEtag=function(O,N){H[O]=N};var u=Math.ceil(w.size/g);function q(){return u}var C=0;function v(){return C}this.incrementCompletedParts=function(){C+=1};Object.defineProperties(this,{filePointer:{get:d},id:{get:J},cancelDeferredObject:{get:h},uploadDeferredObject:{get:y},destKey:{get:e},destBucket:{get:D},errorMessage:{get:L,set:l},headers:{get:i},timeoutPromise:{get:t,set:K},etags:{get:F},numberOfParts:{get:q},completedParts:{get:v}})}return a}]);"use strict";(function(){angular.module("s3").service("PathService",["$routeParams","$location","S3Constants",function(d,f,b){this.getCurrentBucket=function(){return c()};var c=function c(){var g=f.path();if(g.indexOf("/"+b.PATH_SEGMENTS.BUCKETS+"/")===0||g.indexOf("/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/")===0){return d[b.PATH_SEGMENTS.BUCKET_NAME]}return undefined};this.getCurrentAbsoluteFolderPath=function(){return a()};function a(){var g=f.path();if(g.indexOf("/"+b.PATH_SEGMENTS.BUCKETS+"/")===0){if(d[b.PATH_SEGMENTS.KEY_PREFIX]){return d[b.PATH_SEGMENTS.KEY_PREFIX]}}if(g.indexOf("/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/")===0){if(d[b.PATH_SEGMENTS.KEY_PREFIX]){return d[b.PATH_SEGMENTS.KEY_PREFIX].substring(0,d[b.PATH_SEGMENTS.KEY_PREFIX].lastIndexOf(b.DELIMITER)+1)}}return undefined}this.relativeToAbsoluteFolderPath=function(h){var g=a();if(g!==undefined){return g+h+b.DELIMITER}return h+b.DELIMITER};this.relativeToAbsoluteObjectPath=function(g){return e(g)};this.getObjectLink=function(g,h){var i=b.S3_ENDPOINTS[h]||b.S3_DEFAULT_ENDPOINT;return i+"/"+c()+"/"+encodeURIComponent(g).replace(/%20/g,"+").replace(/%2F/g,"/")};var e=function e(h){var g=a();if(g!==undefined){return g+h}return h};this.getAbsolutePathWithBucket=function(){var i=c();var g=a();var h=i;if(g){h=""+i+b.DELIMITER+g}return h};this.getAbsolutePathToObjectWithBucket=function(i){var j=c();var g=e(i);var h=j;if(g){h=""+j+b.DELIMITER+g}return h};this.absoluteToRelativeObjectPaths=function(h,g){if(!h){return}h=h.filter(function(i){return i.Key!==g});h.forEach(function(i){if(i.Key===g){i.Key=b.DELIMITER}else{i.Key=i.Key.replace(g,"")}i.beingRenamed=false});return h};this.absoluteToRelativeFolderPaths=function(g,h){if(!g){return}g.forEach(function(i){i.Prefix=i.Prefix.replace(h,"").replace(b.DELIMITER,"");i.beingRenamed=false});return g};this.getCurrentObject=function(){var h="/"+b.PATH_SEGMENTS.BUCKETS+"/",g="/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/",i=f.path();if(i.indexOf(h)===0){return i.split(""+h+c()+"/")[1]}else{if(i.indexOf(g)===0){return i.split(""+g+c()+"/")[1]}}};this.getUrlForBucketAndPrefix=function(h,i,k){var g=h.split("s3")[0];var j=h.split("region=")[1].split("&")[0];if(i){return g+"s3/buckets/"+i+b.DELIMITER+k+"?region="+j+"&tab=overview"}else{return g+"s3/home?region="+j}};this.getFolderList=function(){var l=d.bucketName;var j=f.path();var i=j.indexOf("/"+b.PATH_SEGMENTS.OBJECT_DETAILS+"/");j=j.substring(j.indexOf(l));var k=j.split(b.DELIMITER);var g="";var h=[];k.pop();k.forEach(function(m){g+="/"+m;h.push({name:m,path:""+g+b.DELIMITER})});if(i!==0){delete h[h.length-1].path}return h}}])})();"use strict";(function(){angular.module("s3").service("CachingService",["S3Constants","$cacheFactory",function(b,g){var c=g(".bucketLocationCache",{capacity:b.CACHE.SIZE.BUCKET_LOCATION});var d=g(".lambCache",{capacity:b.CACHE.SIZE.LAMB});var e="lamb";var h=".properties";var a=".objects";var f;var i={};var j=[];this.putLamb=function(k){d.put(e,k)};this.evictLamb=function(){d.removeAll()};this.getLamb=function(){return d.get(e)};this.getBucketLocation=function(k){return c.get(k)};this.putBucketLocation=function(l,k){c.put(l,k)};this.evictBucketLocation=function(k){c.remove(k)};this.getBucketProperty=function(m,l){var k=g.get(m+h);if(k){return k.get(l)}return undefined};this.putBucketProperty=function(m,l,k){if(!g.get(m+h)){g(m+h,{capacity:b.CACHE.SIZE.BUCKET_PROPERTIES})}g.get(m+h).put(l,k)};this.evictBucketProperty=function(m,l){var k=g.get(m+h);if(k){k.remove(l)}};this.evictAllBucketProperties=function(l){var k=g.get(l+h);if(k){k.removeAll()}};this.getBucketObjects=function(m,l){var k=g.get(m+a);if(k){return k.get(l)}return undefined};this.putBucketObjects=function(m,k,l){if(!g.get(m+a)){g(m+a,{capacity:b.CACHE.SIZE.LIST_OBJECTS})}g.get(m+a).put(k,l)};this.evictBucketObjects=function(l){var k=g.get(l+a);if(k){k.removeAll()}};this.evictAllBucketData=function(k){c.remove(k);this.evictBucketObjects(k);this.evictAllBucketProperties(k)};this.setCurrentObject=function(k){f=k};this.getCurrentObject=function(){return f};this.setCurrentVersions=function(l,k){i[l]=k};this.getCurrentVersions=function(k){return i[k]};this.deleteCurrentVersions=function(k){delete i[k]};this.setPageOfDeletedObjects=function(l,k){j[k]=l};this.getPageOfDeletedObjects=function(k){return j[k]};this.resetDeletedObjects=function(){j=[]}}])})();"use strict";(function(){angular.module("s3").service("UploadRequestsService",["$q","S3Constants","S3CWSAPIService","APIProxyService","SCLogService","XMLParser",function(b,c,e,f,d,a){this.initiateMultipartUpload=function(i,k,j,h,g){return f.initiateMultipartUpload(k,i,j,h,g).then(function(m){var l=m.response;var n=m.headers();l=a.convertXmlStringToJson(l);if(l&&l.InitiateMultipartUploadResult&&l.InitiateMultipartUploadResult.UploadId){d.logS3("InitiateMultipart",1,g,n[c.HEADERS.X_AMZ_ID_2],n[c.HEADERS.X_AMZ_REQUEST_ID],m);return l.InitiateMultipartUploadResult.UploadId}d.logS3("InitiateMultipart",0,g,n[c.HEADERS.X_AMZ_ID_2],n[c.HEADERS.X_AMZ_REQUEST_ID],m);return b.reject(l)},function(l){var n=l.headers();var m=Number(l.status<c.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD);d.logS3("InitiateMultipart",m,g,n[c.HEADERS.X_AMZ_ID_2],n[c.HEADERS.X_AMZ_REQUEST_ID],l);return b.reject(l)})};this.completeMultipartUpload=function(n,g,m,h,j,i){var k="<CompleteMultipartUpload>";for(var o in h){var l="<Part><PartNumber>"+o+"</PartNumber>";l+="<ETag>"+h[o]+"</ETag>";l+="</Part>";k+=l}k+="</CompleteMultipartUpload>";return f.completeMultipartUpload(g,n,k,m,j,i).then(function(p){var q=p.headers();if(p.response&&p.response.CompleteMultipartUploadResult){d.logS3("CompleteMultipartUpload",1,i,q[c.HEADERS.X_AMZ_ID_2],q[c.HEADERS.X_AMZ_REQUEST_ID],p);return p.response.CompleteMultipartUploadResult}d.logS3("CompleteMultipartUpload",0,i,q[c.HEADERS.X_AMZ_ID_2],q[c.HEADERS.X_AMZ_REQUEST_ID],p);return b.reject({statusText:p.response})},function(p){var q=p.headers();d.logS3("CompleteMultipartUpload",0,i,q[c.HEADERS.X_AMZ_ID_2],q[c.HEADERS.X_AMZ_REQUEST_ID],p);return b.reject({statusText:p.response.Error.Message})})};this.generatePresignedUrlForUpload=function(i,l,h,k,j,g){return e.fetchPresignedUrl(l,i,"PUT",{},k,h,j).then(function(m){if(m.data&&m.data.presignedUrl){d.log("UploadPresignedUrl",1,g,m);return m}if(Array.isArray(_.get(m,"error"))&&m.error[0]===c.SESSION_TIMEOUT_MESSAGE){d.log("UploadPresignedUrl",1,g,m)}else{d.log("UploadPresignedUrl",0,g,m)}return b.reject(m)},function(m){var n=Number(m.status<c.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD);d.log("UploadPresignedUrl",n,g,m);return b.reject(m)})}}])})();"use strict";(function(){angular.module("s3").service("ReadAndSendBlobService",["$http","$q","$window","S3Constants","SCLogService",function(h,b,g,c,d){var f="UploadPut";this.readAndPutBlobToUrl=function(l,q,i,k,o,m){var n=b.defer();if(k&&!k[c.HEADERS.CONTENT_TYPE]){k["Content-Type"]=undefined}var p={method:"PUT",url:i,data:q,headers:k,timeout:o,transformRequest:[]};d.log("UploadReader",1,m,p);var j=g.Date.now();h(p).then(e(n,m,j),a(n,m));return n.promise};var e=function e(i,j,k){return function(m){var l=g.Date.now();i.resolve(m);d.log(f+"Time",l-k,j);var n=m.headers();d.logS3(f+"Request",1,j,n[c.HEADERS.X_AMZ_ID_2],n[c.HEADERS.X_AMZ_REQUEST_ID],m)}};var a=function a(i,j){return function(k){var m=k.headers();d.log(""+f+c.REQUEST_METRICS.STATUS_CODE_INFIX+k.status,1,j,k);var l=Number(k.status<c.HTTP_STATUS_CODES.SERVER_ERROR_THRESHOLD);d.logS3(f+"Request",l,j,m[c.HEADERS.X_AMZ_ID_2],m[c.HEADERS.X_AMZ_REQUEST_ID]);if(k.status===-1){k.statusText="OptionsRequestDenied"}else{if(k.status===0){k.statusText="OptionsResponseMissingHeaders"}}i.reject(k)}}}])})();"use strict";(function(){angular.module("s3").service("UploadService",["$http","$q","$timeout","$translate","CachingService","S3Constants","FileUpload","UploadRequestsService","ReadAndSendBlobService","SCLogService","UploadVerificationService","UtilService",function(o,a,D,x,p,H,G,m,F,e,l,t){var c=0;var h={};var j=function j(){c++;return c};var v=function v(L){if(h[L]){D.cancel(h[L].timeoutPromise)}};function n(N,M,P,O,L){O.uploadedEtag=M[0].headers().etag;O.calculatedEtag=M[1];var Q=L?"MD5MPVerification":"MD5Verification";if(I(M)){if(B(P.filePointer)){O.errorReason="FileChanged";e.log("UploadFileChanged",1,N,O)}else{O.errorReason="EtagsDoNotMatch";e.log(Q,0,N,O)}}else{e.log(Q,1,N,O)}}var r=function r(L,M){return function(N){v(L,M);N=t.transformObjectToArray(N);var P=N[0];var O={fileName:h[L].filePointer.name};if(!P||!P.headers()||!P.headers().etag){J(L,{statusText:"No etag was provided by S3"},M)}else{if(z(M)){n(M,N,h[L],O,false);if(O.errorReason){J(L,{statusText:O.errorReason},M)}else{s(L,P.headers().etag,M)}}else{s(L,P.headers().etag,M)}}}};var I=function I(L){var M=L[1];var N=L[0].headers().etag;return M!==N.substring(1,N.length-1)};var B=function B(L){return L.lastModified&&L.lastModified!==L.initialLastModified};var K=function K(M,L){if(h[L].isCancelled){return x.instant("upload.cancelled")}var N=t.transformObjectToArray(M)[0];if(N.statusText){return N.statusText}else{return t.handleErrors(N)}};var E=function E(L,M){return function(N){v(L,M);J(L,K(N,L),M)}};var b=function b(L,M){return function(N){s(L,N.ETag||"",M)}};var s=function s(M,O,N){var L={};L.id=M;L.name=h[M].filePointer.name;L.etag=O.substring(1,O.length-1);L.operation=N;if(Object.keys(h[M].etags).length>0){L.multiPartEtags=_.mapValues(h[M].etags,function(P){return P.substring(1,P.length-1)})}h[M].uploadDeferredObject.resolve(L);delete h[M]};var k=function k(L,M){return function(N){J(L,K(N,L),M)}};var J=function J(M,O,N){var L={};L.errorMessage=O;L.name=h[M].filePointer.name;L.id=M;L.operation=N;L.isCancelled=h[M].isCancelled;h[M].uploadDeferredObject.reject(L);delete h[M]};var z=function z(L){return !L.options.serverSideEncryption||L.options.serverSideEncryption===H.OBJECT_SSE.NONE};var g=function g(M,P,S,Q,O){var L=F.readAndPutBlobToUrl(M,h[M].filePointer,P,Q,S.promise,O);var N=undefined;if(z(O)){var R=l.verifyUpload(h[M].filePointer,M,O.id);N=a.all([L,R])}else{N=L}N.then(r(M,O),E(M,O),function(T){T.destKey=h[M].destKey;T.destBucket=h[M].destBucket;T.operation=O;h[M].uploadDeferredObject.notify(T)});if(h[M]){d(h[M],O)}};var A=function A(N,L){var M=D(function(){N.cancelDeferredObject.resolve(N.id);N.errorMessage="Upload timed out."},H.UPLOAD.TIMEOUT_MSECS);N.timeoutPromise=M;m.generatePresignedUrlForUpload(N.destKey,N.destBucket,N.cancelDeferredObject.promise,{},N.headers,L).then(function(O){g(N.id,O.data.presignedUrl,N.cancelDeferredObject,N.headers,L)},function(){J(N.id,"There was an issue generating a presigned url for the upload",L)});d(N,L)};var y=function y(M,N,L){return function(){return m.generatePresignedUrlForUpload(M.destKey,M.destBucket,M.cancelDeferredObject.promise,N,undefined,L)}};var u=function u(M,O,N,L){return function(R){var S=M.filePointer.slice(O,N);S.name=M.filePointer.name;var P=F.readAndPutBlobToUrl(M.id,S,R.data.presignedUrl,{},M.cancelDeferredObject.promise,L);var Q=undefined;if(!L.options.serverSideEncryption||L.options.serverSideEncryption===H.OBJECT_SSE.NONE){var T=l.verifyUpload(S,M.id,L.id);Q=a.all([P,T])}else{Q=P}return Q}};var C=function C(M,N,L){return function(O){O=t.transformObjectToArray(O);var Q=O[0];if(!Q||!Q.headers()||!Q.headers().etag){return a.reject(O[0])}var P={partNumber:N,fileName:M.filePointer.name};if(z(L)){n(L,O,M,P,true);if(P.errorReason){return a.reject(O[0])}}M.incrementCompletedParts();M.uploadedByte+=Math.min(H.UPLOAD.PART_SIZE_IN_BYTES,M.totalBytes-(N-1)*H.UPLOAD.PART_SIZE_IN_BYTES);M.progress=100*M.uploadedByte/M.totalBytes;d(M,L);M.addEtag(N,Q.headers().etag)}};var q=function q(S,T,P,N){var U=0;var M=H.UPLOAD.PART_SIZE_IN_BYTES;var L=function L(V){if(V){V.operation=N;S.uploadDeferredObject.notify(V)}};var Q=function Q(V){P.reject(V)};S.uploadedByte=0;S.totalBytes=S.filePointer.size;var O;for(var R=1;R<=S.numberOfParts;R++){if(O){O=O.then(y(S,{uploadId:T,partNumber:R},N))}else{O=y(S,{uploadId:T,partNumber:R},N)()}O=O.then(u(S,U,M,N)).then(C(S,R,N),Q,L);U+=H.UPLOAD.PART_SIZE_IN_BYTES;M+=H.UPLOAD.PART_SIZE_IN_BYTES}if(!O){P.reject({statusText:x.instant("utilities.unknown.error")});return}O.then(function(){P.resolve(T)})};var d=function d(N,M){var L={};L.destKey=N.destKey;L.destBucket=N.destBucket;L.id=N.id;L.fileName=N.filePointer.name;L.uploadedByte=N.uploadedByte;L.totalBytes=N.totalBytes;L.progress=N.completedParts/N.numberOfParts*100;L.operation=M;N.uploadDeferredObject.notify(L)};var w=function w(M,L){return function(O){var N=a.defer();d(M,L);q(M,O,N,L);return N.promise}};var i=function i(M,L){if(M.numberOfParts>H.UPLOAD.MAX_NUMBER_OF_PARTS||M.numberOfParts<=H.UPLOAD.MIN_NUMBER_OF_PARTS){k(M.id,L)({statusText:"A multipart upload needs between 2 and 10000 parts to be a valid upload."});return}var N=m.initiateMultipartUpload(M.destKey,M.destBucket,M.headers,M.cancelDeferredObject.promise,L);N.then(w(M,L)).then(function(O){return m.completeMultipartUpload(M.destKey,M.destBucket,O,M.etags,M.cancelDeferredObject.promise,L)}).then(b(M.id,L))["catch"](k(M.id,L))};var f=function f(M,L){e.log("UploadFileSize",M.filePointer.size,L,{name:M.filePointer.name});if(M.filePointer.size<=H.UPLOAD.PART_SIZE_IN_BYTES){A(M,L)}else{i(M,L)}};this.upload=function(O,T,M,N,P,V){if(!M){e.log("UploadNoBucketError",1,P);return}p.evictBucketObjects(M);if(!N||h[N]!==undefined){e.log("InvalidUploadFileId",1,P);return}var S=a.defer();var Q=a.defer();var U=O.name;if(T){U=T+U}var L=angular.copy(V);if(!L.metadata["Content-Type"]){L.metadata["Content-Type"]=O.type}var R=new G(N,O,S,Q,U,M,L,H.UPLOAD.PART_SIZE_IN_BYTES);h[N]=R;f(R,P);p.deleteCurrentVersions(U);return R.uploadDeferredObject.promise};this.cancelUpload=function(M,L){if(h[M]){h[M].cancelDeferredObject.resolve(M);h[M].isCancelled=true;e.log("UploadCancel",1,L)}else{e.log("UploadCancel",0,L)}};this.fileSelected=function(){return j()}}])})();"use strict";(function(){angular.module("s3").service("DirectoryExplorerService",["$q","ConsoleOperation","S3Constants","SCLogService","UploadService","UtilService",function(n,h,k,a,i,p){var s={createExplorer:l,processFile:c};var f="CreatedExplorer",q="ExplorerTraversalComplete",e="GetFolderSize",b="InitialFolderTraversal",j="OverrideFolders",m="SkipOverriddenFolder";return s;function l(L,J){var B=n.defer(),E=J.explorers.length+1,A={getNext:C,getSelectedItems:F,explorerId:E,setOverriddenFolders:u,operation:J};var z=undefined,H=[],t=[],G=[],O=[],M=0,w=undefined,x=undefined,v=undefined,D={},P=true,K=L.length;for(var R=0;R<K;R++){z=L[R].webkitGetAsEntry();if(z.isDirectory){H.push(z)}else{o(z,G,t,"",J).then(function(){M++},function(T){a.log(J.name+f,0,J,{error:T,explorerId:E});B.reject(T)})}}for(var Q in H){var S=n.defer();w=H[Q];N(w,d(w.createReader()),0,0,p.createQueue(),S);t.push(S.promise);S.promise.then(function(T){O.push(T);if(T.objsCount===0){M++}})}n.all(t).then(function(){v=p.createQueue(H);w=undefined;x=undefined;a.log(J.name+f,1,J,{explorerId:E,selectedItems:F()});B.resolve(A)},function(T){a.log(J.name+f,0,J,{error:T,explorerId:E});B.reject(T)});function N(U,T,Z,Y,W,X){var V=[];T.readEntries(function(aa){var ac=undefined;if(aa.length===0){if(W.getLength()===0){a.log(J.name+b,1,J,{explorerId:E,folderSize:Z,folderName:U.name,fullPath:U.fullPath,objsCount:Y});X.resolve(r(U,Z,Y))}else{var ae=d(W.dequeue().createReader());N(U,ae,Z,Y,W,X)}return}for(var ab in aa){ac=aa[ab];if(ac.isDirectory){W.enqueue(ac)}else{Y++;M++;var ad=g(ac);V.push(ad);ad.then(function(af){Z+=af})}}n.all(V).then(function(){N(U,T,Z,Y,W,X)},function(ag){var af=r(U,Z,Y);a.log(J.name+e,0,J,{error:ag,explorerId:E,folder:af});X.resolve(af)})},function(aa){a.log(J.name+b,0,J,{error:aa,explorerId:E});X.reject(aa)})}function C(){var T=n.defer();if(!w){w=I();x=w?d(w.createReader()):undefined}if(!x){if(v.getLength()===0){a.log(J.name+q,1,J,{explorerId:E,selectedItems:F()});T.resolve(undefined);return T.promise}else{w=I();x=d(w.createReader());P=true}}y(T,J);return T.promise}function y(W,U){var X=undefined,V=[],T=[];x.readEntries(function(aa){var Y=undefined;if(aa.length===0){if(P){Y=r(w,0,0)}w=I();x=w?d(w.createReader()):undefined;P=true}else{P=false}for(var Z in aa){X=aa[Z];if(X.isDirectory){v.enqueue(X)}else{o(X,V,T,w.fullPath.substr(1)+"/",U)}}n.all(T).then(function(){W.resolve({fileList:V,emptyFolderToBeUploaded:Y})},function(ab){a.log(U.name+q,0,U,{error:ab,explorerId:E});W.reject(ab)})},function(Y){a.log(U.name+q,0,U,{error:Y,explorerId:E});W.reject(Y)})}function F(){return{currFolderPathPrefix:"",folders:O,objects:G,totalObjCount:M}}function u(T){for(var U in T){D[T[U]]=true}a.log(J.name+j,1,J,{explorerId:E,originalFolders:F().folders,newlyOveriddenFolders:T})}function I(){var T=v.dequeue();while(T){if(T.fullPath!=="/"+T.name||!D[T.name]){return T}else{a.log(J.name+m,1,J,{explorerId:E,skippedFolderName:T.name});T=v.dequeue()}}}return B.promise}function c(u,v,t){return{file:u,fullPath:t,id:v,Key:u.name,Size:u.size}}function r(t,w,v){var u=t.fullPath.substr(1);u=u.substr(0,u.length-t.name.length-1);u=u===""?u:u+"/";return{folderSize:w,fullPath:u,Prefix:t.name,objsCount:v||1}}function o(y,x,v,w,u){var t=n.defer();v.push(t.promise);y.file(function(A){var z=i.fileSelected(A,u);x.push(c(A,z,w));t.resolve()},function(z){t.reject(z)});return t.promise}function g(u){var t=n.defer();u.file(function(v){t.resolve(v.size)});return t.promise}function d(t){var v=3;var w=[];function u(y,x){if(w.length===0){t.readEntries(function(z){if(z.length>v){w=z;y(w.splice(0,v))}else{y(z)}},x)}else{y(w.splice(0,v))}}return{readEntries:u}}}])})();"use strict";(function(){angular.module("s3").controller("UploadController",["$scope","$rootScope","$translate","$window","APIProxyService","ConsoleOperation","DirectoryExplorerService","FAC","OperationDispatcherService","PathService","S3Constants","SCLogService","UploadOperationService","UtilService",a]);function a(x,p,y,t,z,s,l,q,i,f,w,e,r,C){var A="FilesSelectedFor",c="MultipleDropEvents",h="OverrideExplorers",g="SimultaneousDrop",o="FolderRemoved",n="FileRemoved",j="STANDARD";var d=_.cloneDeep(w.BUCKET_PERMISSIONS.INITIALIZE_ACLS);z.getBucketOwner(new s("getBucketOwner")).then(function(D){d.userPermissions[0].detail=D;x.options.permissions.userPermissions[0].detail=D});var m=C.createQueue();x.operation=null;x.S3Constants=w;x.$watchCollection("selected",function(){x.selectedItems=x.selected.selectedItems});x.$watchCollection("flags",function(){x.uploadDisabled=x.flags.uploadDisabled});x.STEP={SELECT_FILES:{name:"SELECT_FILES",value:y.instant("uploadmodal.label.selectfiles")},PERMISSIONS:{name:"PERMISSIONS",value:y.instant("uploadmodal.label.setpermissions")},PROPERTIES:{name:"PROPERTIES",value:y.instant("uploadmodal.label.setproperties")},REVIEW:{name:"REVIEW",value:y.instant("uploadmodal.label.review")}};x.state=x.STEP.SELECT_FILES;x.headerTitle=y.instant("uploadmodal.header.title");x.currentTagging={Key:"",Value:""};x.MODAL_TYPE=w.MODAL_TYPE;var v=p.$on("fileDropEvent",function(F,E){if(!x.modalOpen.flag||F.defaultFired){return}x.state=x.STEP.SELECT_FILES;x.uploadDisabled=true;if(!x.operation){x.operation=r.createUploadOperation()}var D=l.createExplorer(E,x.operation);m.enqueue(D);if(m.getLength()===1){b(m.peek())}else{e.log(x.operation.name+g,1,x.operation,{numberOfDropsToBeProcessed:m.getLength()})}});function B(H,G){var I=G?x.operation.explorers.length-1:x.operation.explorers.length,D=[];for(var F=0;F<H.length;F++){D.push(H[F].Prefix)}for(var E=0;E<I;E++){x.operation.explorers[E].setOverriddenFolders(D)}e.log(x.operation.name+h,1,x.operation,{folderNames:D,numberOfExplorersOverridden:I,selectedFilesData:x.getSelectedFilesData()})}function b(D){D.then(function(M){var K=M.getSelectedItems(),H=K.folders,N=K.objects,F=undefined,I=undefined,G=function G(O){return F.Prefix!==O.Prefix},E=function E(O){return I.Key!==O.Key};for(var L=0;L<H.length;L++){F=H[L];x.selectedItems.folders=_.filter(x.selectedItems.folders,G)}for(var J=0;J<N.length;J++){I=N[J];x.selectedItems.objects=_.filter(x.selectedItems.objects,E)}x.selectedItems.folders=x.selectedItems.folders.concat(H);x.selectedItems.objects=x.selectedItems.objects.concat(N);x.operation.explorers.push(M);if(x.operation.explorers.length>1){e.log(x.operation.name+c,1,x.operation,{newExplorerId:M.explorerId,numberOfExplorersCreated:x.operation.explorers.length,selectedItems:M.getSelectedItems()});B(H,true)}m.dequeue();if(m.getLength()>0){b(m.peek())}else{x.uploadDisabled=false}},function(E){x.error=E})}x.goToNextState=function(){if(x.state===x.STEP.SELECT_FILES){C.analyticsTrackClick(w.ANALYTICS.SELECT_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3);C.analyticsTrackView(w.ANALYTICS.SET_PERMISSIONS_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3)}else{if(x.state===x.STEP.PERMISSIONS){C.analyticsTrackClick(w.ANALYTICS.SET_PERMISSIONS_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3);C.analyticsTrackView(w.ANALYTICS.SET_PROPERTIES_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3)}else{if(x.state===x.STEP.PROPERTIES){C.analyticsTrackClick(w.ANALYTICS.SET_PROPERTIES_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3);C.analyticsTrackView(w.ANALYTICS.REVIEW_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3)}}}x.nextState()};x.removeItemFromUpload=function(D){if(D.Key){x.selectedItems.objects=_.filter(x.selectedItems.objects,function(E){return D.Key!==E.Key});e.log(x.operation.name+n,1,x.operation,{fileName:D.Key})}else{if(D.Prefix){x.selectedItems.folders=_.filter(x.selectedItems.folders,function(E){return D.Prefix!==E.Prefix});B([D],false);e.log(x.operation.name+o,1,x.operation,{folderName:D.Prefix})}}if(!x.haveSelectedItems()){x.uploadDisabled=true}};x.filesSelected=function(D){if(!x.operation){x.operation=r.createUploadOperation()}x.$apply(function(){if(D&&D.files&&D.files.length>0){x.operation.newlySelectedFiles=D.files;e.log(A+x.operation.name,D.files.length,x.operation);for(var F=0;F<D.files.length;F++){var E=D.files[F],G=k(E.name),H=r.selectFile(E,x.operation);if(G>-1){x.selectedItems.objects.splice(G,1,l.processFile(E,H))}else{x.selectedItems.objects.push(l.processFile(E,H))}}x.uploadDisabled=false}})};function k(E){for(var D=0;D<x.selectedItems.objects.length;D++){if(x.selectedItems.objects[D].Key===E){return D}}return -1}x.uploadNow=function(){if(!x.operation||!x.selectedItems.objects&&!x.selectedItems.folders||x.selectedItems.objects.length===0&&x.selectedItems.folders.length===0){throw"No file selected"}C.analyticsTrackClick(w.ANALYTICS.END_UPLOAD_FILE,w.ANALYTICS.UPLOAD_FILE_S3);function D(){x.$parent.refreshWithSelection()}if(_.eq(angular.toJson(x.options.permissions),angular.toJson(d))){x.options.permissions=undefined}r.setupUploadOperation(x.operation,x.selectedItems.folders,x.selectedItems.objects,x.getSelectedFilesData(),x.options,D);x.clearFileInput();i.addOperation(x.operation);x.closeModal();x.selected.selectedItems={currFolderPathPrefix:"",folders:[],objects:[]};x.resetOptions()};x.clearFileInput=function(){var D=$("#uploadInput");if(D&&D.get(0)){D.wrap("<form>").closest("form").get(0).reset();D.unwrap()}};x.closeModal=function(){if(x.state===x.STEP.SELECT_FILES){x.clearFileInput()}x.state=x.STEP.SELECT_FILES;x.selected.selectedItems={currFolderPathPrefix:"",folders:[],objects:[]};x.modalOpen.flag=false;x.uploadDisabled=true;x.operation=undefined;x.resetOptions()};x.haveSelectedItems=function(){return x.selectedItems&&x.selectedItems.folders&&!_.isEmpty(x.selectedItems.folders)||x.selectedItems&&x.selectedItems.objects&&!_.isEmpty(x.selectedItems.objects)};x.isValidMetadata=function(F,E,D){if(D&&!_.startsWith(F,w.USER_DEFINED_METADATA_PREFIX)){x.metadataErrorMsg=y.instant("metadatacard.startingwith");return false}if(D&&!/^[\x20-\x7E]+$/.test(F)||!/^[\x20-\x7E]+$/.test(E)){x.metadataErrorMsg=y.instant("metadatacard.nonasc");return false}x.metadataErrorMsg="";return true};x.addMetadataOptionsHeader=function(F,E,D){x.metadataErrorMsg="";if(x.isValidMetadata(F,E,D)){x.options.metadata[F]=E;if(D){x.metadataHeaders.customHeader=w.USER_DEFINED_METADATA_PREFIX;x.metadataHeaders.customValue=""}else{x.metadataHeaders.selectedValue="";x.metadataHeaders.selectedHeader=""}}};x.metaErrorReset=function(){x.metadataErrorMsg=""};x.deleteMetadataHeader=function(D){delete x.options.metadata[D]};x.addTag=function(D,E){if(_.isEmpty(D)){return}if(Object.keys(x.options.tags).indexOf(D)>-1){x.taggingError=y.instant("objectproperties.tags.duplicatekeynames");return}if(Object.keys(x.options.tags).length>=w.TAGGING.MAX_ALLOWED_TAGS){x.taggingError=y.instant("objectproperties.tags.morethantentagswarning");return}x.taggingError=null;x.options.tags[D]=E;x.currentTagging={Key:"",Value:""}};x.deleteTag=function(D){delete x.options.tags[D]};x.updateTaggingError=function(D){if(Object.keys(x.options.tags).indexOf(D)>-1||Object.keys(x.options.tags).length>=w.TAGGING.MAX_ALLOWED_TAGS){return}x.taggingError=null};x.resetOptions=function(){x.options={};x.metadataHeaders={};x.metadataErrorMsg="";x.errorMessage=null;x.KMSServiceError=null;x.metadataHeaders.acceptedHeaders=[];x.options.metadata={};x.options.tags={};x.taggingError=null;x.currentTagging={Key:"",Value:""};x.options.permissions=_.cloneDeep(d);x.metadataHeaders.headerNames=[w.HEADERS.CACHE_CONTROL,w.HEADERS.CONTENT_DISPOSITION,w.HEADERS.CONTENT_ENCODING,w.HEADERS.CONTENT_LENGTH,w.HEADERS.CONTENT_TYPE,w.HEADERS.EXPECT,w.HEADERS.EXPIRES,w.HEADERS.X_AMZ_WEBSITE_REDIRECT_LOCATION];x.metadataHeaders.headers=[];for(var E in x.metadataHeaders.headerNames){var D=x.metadataHeaders.headerNames[E];x.metadataHeaders.headers.push({value:D,text:D,disabled:false})}};x.getSelectedFilesData=function(){if(!x.selectedItems){return{files:0,size:0}}var D=0,H=0,I=undefined,F=undefined;for(var G in x.selectedItems.folders){I=x.selectedItems.folders[G];H+=I.objsCount;D+=I.folderSize}for(var E in x.selectedItems.objects){F=x.selectedItems.objects[E];H++;D+=F.Size}return{files:H,size:D}};x.getGranteeCount=function(){var D=0;Object.keys(x.options.permissions).forEach(function(E){x.options.permissions[E].forEach(function(F){if(_.findKey(F.permissions,function(G){return G===true})!==undefined){D++}})});return D};x.$on("$destroy",function(){v()});x.resetOptions();x.getStorageClassTranslation=function(){return C.getStorageClassTranslations()[x.options.storageClass]};x.getEncryptionTranslation=function(){var D=x.options.serverSideEncryption===w.OBJECT_SSE.NONE?"uploadmodal.review.encryption.no":"uploadmodal.review.encryption.yes";return y.instant(D)};x.setStorageClassOption=function(){if(!x.options.storageClass){x.options.storageClass=j}};x.updateKMSKey=function(D){if(D===w.OBJECT_SSE.KMS_ENCRYPTION){u()}else{if(!_.isEmpty(x.errorMessage)&&x.errorMessage===x.KMSServiceError){x.errorMessage=null}x.KMSServiceError=null}};x.setEncryptionOption=function(){if(!x.options.serverSideEncryption){if(q.isFeatureEnabled(w.FAC.NO_ENC)){x.options.serverSideEncryption=w.OBJECT_SSE.NONE}else{x.options.serverSideEncryption=w.OBJECT_SSE.AES256}}};function u(){x.kmsKeys=[];var E=new s("GetKMSKeysForUpload");var D={};z.getKmsKeys(E,f.getCurrentBucket(),D).then(function(G){var F=G.response.Keys;e.log("GetKMSKeys",1,E);angular.forEach(F,function(H,I){x.kmsKeys.push({value:H.KeyId,text:C.getKmsKeyAlias(H)})});x.kmsKeys.push({value:w.UPLOAD.CUSTOM_ARN,text:y.instant("uploadmodal.kms.customarn")});if(x.errorMessage===x.KMSServiceError){x.errorMessage=null}x.KMSServiceError=null})["catch"](function(F){x.KMSServiceError=C.handleErrors(F);x.errorMessage=C.handleErrors(F);e.log("GetKMSKeys",0,E,F)})}x.isDragAndDropAvailable=function(){return t.DataTransferItem!==undefined}}angular.module("s3").directive("uploadModal",[function(){return{scope:{modalOpen:"=",currentPath:"=",fetchObjects:"=",operation:"=",selected:"=",flags:"="},templateUrl:"/s3/partials/upload.html",controller:"UploadController"}}])})();"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};angular.module("s3").factory("SCLogService",["$filter","$location","AWSC","CachingService","ConsoleOperation","PathService","Region","S3Constants","UtilService",function(r,h,t,e,m,b,c,s,w){var a={unit:"",metricType:"",logLevel:""},p={explorers:true};function n(y){var x;for(x=0;x<y.length;++x){if(y[x]===undefined||y[x]===null){return false}}return true}function o(y,z){if(z!==null&&(typeof z==="undefined"?"undefined":_typeof(z))==="object"){for(var x in z){if(z.hasOwnProperty(x)&&!a.hasOwnProperty(x)){y[x]=z[x]}}}}function u(x,y){if(y!==undefined&&y!==null){for(var z in a){if(a.hasOwnProperty(z)&&y.hasOwnProperty(z)){x[z]=y[z]}}}}function j(y,z){for(var x in z){if(z.hasOwnProperty(x)){y[x]=z[x]}}}function f(H,G,B,E,C,A){var D={};D[s.OPERATION.NAME]=B.name;D[s.OPERATION.ID]=B.id;D[s.OPERATION.STEP]=B.step;D[s.OPERATION.INITIAL_BUCKET]=B.initialBucket;D[s.OPERATION.INITIAL_PATH]=B.initialPath;D[s.OPERATION.BUCKET_REGION]=B.bucketRegion;var y=Object.keys(B);for(var z in y){if(!p[y[z]]){D[y[z]]=B[y[z]]}}if(!(E instanceof Date)){E=new Date()}D[s.OPERATION.TIMESTAMP]=r("date")(E,"yyyy-MM-dd-HH-mm-ss.sss","UTC");D[s.OPERATION.CURRENT_BUCKET]=b.getCurrentBucket()||"";D[s.OPERATION.CURRENT_PATH]=b.getCurrentAbsoluteFolderPath()||"";j(D,C);o(D,A);var x="";if(D[s.OPERATION.CURRENT_BUCKET]){x=e.getBucketLocation(D[s.OPERATION.CURRENT_BUCKET])}var F={key:H,value:G,detail:JSON.stringify(D).replace(/\\\"/g," "),pageId:s.CLOG_PAGE_ID};u(F,A);t.Clog.log(F);return true}function i(x,A,C,z,y){if(!(C instanceof m)){return false}var B=[x,A,C,C.name,C.id,C.initialBucket,C.initialPath];if(!n(B)){return false}return f(x,A,C,y,{},z)}return{log:i,logCws:function d(y,B,E,x,A,z){if(!(E instanceof m)){return false}var C=[y,B,E.name,E.id,E.initialBucket,E.initialPath,x];if(!n(C)){return false}var D={};D[s.OPERATION.CWS_OP_ID]=x;return f(y,B,E,z,D,A)},logS3:function g(F,E,A,D,B,y,C){if(!(A instanceof m)){return false}var x=[F,E,A,A.name,A.id,A.initialBucket,A.initialPath,D,B];if(!n(x)){return false}var z={};z[s.S3_RESPONSE_HEADERS.X_AMZ_ID_2]=D;z[s.S3_RESPONSE_HEADERS.X_AMZ_REQUEST_ID]=B;return f(F,E,A,C,z,y)},logWithSimplifiedOperation:function q(y,A,B){if(!(B instanceof m)){return false}var z={};z[s.OPERATION.ID]=B.id;z[s.OPERATION.TIMESTAMP]=r("date")(new Date(),"yyyy-MM-dd-HH-mm-ss.sss","UTC");var x={key:y,value:A,detail:JSON.stringify(z).replace(/\\\"/g," "),pageId:s.CLOG_PAGE_ID};t.Clog.log(x)},logRequestReceived:function k(y){var x=new m(y,"requestReceived");i(y,1,x);return x},logRequestComplete:function v(y,x){x.step="requestComplete";i(y,1,x)},setEndpoint:function l(){var y=w.getAWSCMezzRegion();var x=c.DOMAINS.PUBLIC;if(y&&w.getCloudSystem()===x.NAME&&h.host().indexOf(s.LBR_ENDPOINTS.PUBLIC)===0){t.Clog.setEndpointOverride("https://"+y+"."+x.PROD)}}}}]);"use strict";(function(){angular.module("s3").factory("UUIDService",[function(){return{generateUUID:function a(){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var c=Math.floor(Math.random()*16);return(d==="x"?c:c&3|8).toString(16)});return b}}}])})();"use strict";(function(){angular.module("s3").service("ObjectListingService",["$q","ConsoleOperation","ListVerificationService","S3Constants","PathService","APIProxyService","SCLogService","XMLParser",function(g,h,b,e,j,a,l,i){var f={getBatchOfItems:c,listObjects:d,tagQuery:k};var m=undefined;return f;function d(r,o,n,p,q){var s={bucket:j.getCurrentBucket(),prefix:r,marker:o,maxKeys:n,delimiter:p,cacheAllowed:q};return a.listObjects(new h("listObjects"),s)}function k(p,r,q){var o={TagQuery:{MaxKeys:r,IncludeTags:true,ContinuationToken:q,And:{Filter:[]}}};var n="";angular.forEach(p,function(s){var u=s.tagKey,v=s.tagVal,t=v.split(", ");o.TagQuery.And.Filter.push({Key:u,Or:{Value:t}})});n=i.jsonToXml(o);return a.tagQuery(new h("tagQuery"),j.getCurrentBucket(),n)}function c(t,v,z,q,o,y,w,r){if(!b.verifyPrefixesToBeListed(t,w)){l.log("BulkOpPrefixesMalformed",1,t);return g.reject({error:"Bulk operation prefixes malformed"})}var s={bucket:t.initialBucket,maxKeys:z,cacheAllowed:q};if(!r){m=z}r=r?r:{keys:[],truncated:false};var x=undefined;if(v){for(x=0;x<w.length;x++){if(!w[x].folderListed&&v.indexOf(w[x].Prefix)===0){s.prefix=w[x].Prefix;break}}if(o){s.keyMarker=v;s.versionIdMarker=y}else{s.marker=v}}else{for(x=0;x<w.length;x++){if(!w[x].folderListed){s.prefix=w[x].Prefix;break}}if(w[w.length-1].folderListed===true){r.truncated=false;var n=g.defer();n.resolve(r);return n.promise}}if(o===true){l.log("getBatchOfVersionsReceived",1,t,s);return a.listVersions(t,s).then(function(B){var A=B.response.ListVersionsResult;l.log("getBatchOfVersionsComplete",1,t,s);var p=[];if(A.Version){p=p.concat(A.Version)}if(A.DeleteMarker){p=p.concat(A.DeleteMarker)}return u(p,A.IsTruncated,A.NextKeyMarker,A.NextVersionIdMarker)})["catch"](function(p){s.error=p;l.log("getBatchOfVersionsComplete",0,t,s);return g.reject(p)})}else{l.log("getBatchOfObjectsReceived",1,t,s);return a.listObjects(t,s).then(function(A){var p=A.response.ListBucketResult;l.log("getBatchOfObjectsComplete",1,t,s);return u(p.Contents,p.IsTruncated,p.NextMarker)})["catch"](function(p){s.error=p;l.log("getBatchOfObjectsComplete",0,t,s);return g.reject(p)})}function u(D,p,C,A){if(D){r.keys=r.keys.concat(D);var B=_.uniq(_.pluck(r.keys,"Key"));if(b.verify(B,w)===false){if(b.verifyEmptyKeyInSelectedPrefixes(B,w)){l.log("batchListVerification",1,t,s);l.log("emptyKeyBatchListVerification",1,t,s)}else{l.log("batchListVerification",0,t,s)}r.error="List verification failed.";return g.reject(r)}else{l.log("batchListVerification",1,t,s)}}else{if(s.prefix!==""){a.headObject(t,t.initialBucket,s.prefix).then(function(){l.log("prefixNotExistForListing",0,t)})["catch"](function(){l.log("prefixNotExistForListing",1,t)})}}if(p==="true"){r.marker=C;if(A){r.versionIdMarker=A}r.truncated=true;return r}else{var E=undefined;for(E=0;E<w.length;E++){if(w[E].Prefix===s.prefix){w[E].folderListed=true;break}}r.truncated=E<w.length-1;if(r.keys.length===m||!r.truncated){return r}else{return c(t,null,z-D.length,q,o,null,w,r)}}}}}])})();"use strict";(function(){angular.module("s3").service("ListDeletedObjectsService",["$q","APIProxyService","CachingService","ConsoleOperation","S3Constants","UtilService",a]);function a(f,c,b,h,d,j){var g={fetchDeletedPageOfObjects:i,listDeletedObjects:e};return g;function e(p,q,o){var n=arguments.length<=3||arguments[3]===undefined?d.LIST_OBJECTS_MAX_KEYS_PER_LISTING:arguments[3];var r=arguments.length<=4||arguments[4]===undefined?{}:arguments[4];var k=arguments.length<=5||arguments[5]===undefined?d.LIST_DELETED_OBJECTS_MAX_KEYS_PER_LISTING:arguments[5];var m=arguments.length<=6||arguments[6]===undefined?d.DELIMITER:arguments[6];var l=f.defer();if(!o){o={cachedDeletedFiles:[],cachedFolders:[],deletedFiles:[],folders:[]}}r.bucket=p.initialBucket;r.delimiter=m;r.maxKeys=k;r.prefix=q;c.listVersions(p,r).then(function(u){var s=_.get(u,"response.ListVersionsResult");if(s){if(s.CommonPrefixes){var v=j.transformObjectToArray(s.CommonPrefixes);angular.forEach(v,function(w){if(!_.isEmpty(q)&&w.Prefix.lastIndexOf(q)!==-1){w.Prefix=w.Prefix.substring(w.Prefix.lastIndexOf(q)+q.length)}if(o.deletedFiles.length+o.folders.length<n){o.folders.push(w)}else{o.cachedFolders.push(w)}})}if(s.DeleteMarker){var t=j.transformObjectToArray(s.DeleteMarker);angular.forEach(t,function(w){if(j.convertStringToBoolean(w.IsLatest)){if(w.Key.lastIndexOf("/")!==-1){w.Key=w.Key.substring(w.Key.lastIndexOf(d.DELIMITER)+1)}w.Size="";w.StorageClass="";if(o.deletedFiles.length+o.folders.length<n){o.deletedFiles.push(w)}else{o.cachedDeletedFiles.push(w)}}})}o.IsTruncated=s.IsTruncated;if(s.IsTruncated==="true"){if(o.deletedFiles.length+o.folders.length<n){r.keyMarker=s.NextKeyMarker;r.versionIdMarker=s.NextVersionIdMarker;e(p,q,o,n,r).then(function(w){l.resolve(w)},function(w){l.reject(w)})}else{o.NextKeyMarker=s.NextKeyMarker;o.NextVersionIdMarker=s.NextVersionIdMarker;l.resolve(o)}}else{l.resolve(o)}}else{l.reject()}},function(s){l.reject(s)});return l.promise}function i(q,t,s,n){var v=f.defer(),r=b.getPageOfDeletedObjects(t);var m=d.LIST_OBJECTS_MAX_KEYS_PER_LISTING,l={keyMarker:s,versionIdMarker:n};if(r){m=m-(r.Contents.length+r.CommonPrefixes.length)}if(m>=0){e(new h(d.LIST_DELETED_OBJECTS),q,null,m,l).then(function(w){if(r){w.deletedFiles=r.Contents.concat(w.deletedFiles);w.folders=r.CommonPrefixes.concat(w.folders)}v.resolve(w)},function(w){v.reject(w)})}else{var k=r.CommonPrefixes,p=r.Contents,o={cachedDeletedFiles:[],cachedFolders:[],deletedFiles:[],folders:[],IsTruncated:"true",NextKeyMarker:s,NextVersionIdMarker:n};if(k.length>d.LIST_OBJECTS_MAX_KEYS_PER_LISTING){o.folders=k.slice(0,d.LIST_OBJECTS_MAX_KEYS_PER_LISTING);o.cachedFolders=k.slice(d.LIST_OBJECTS_MAX_KEYS_PER_LISTING);o.cachedDeletedFiles=p}else{var u=d.LIST_OBJECTS_MAX_KEYS_PER_LISTING-k.length;o.folders=k;o.deletedFiles=p.slice(0,u);o.cachedDeletedFiles=p.slice(u)}v.resolve(o)}return v.promise}}})();"use strict";(function(){angular.module("s3").service("ListVerificationService",["S3Constants",function(b){function a(g,f){return g.indexOf(f)===0}function e(g,f){return g.length>0&&g.lastIndexOf(f)===g.length-f.length}function c(h,g){var f=h.indexOf(g);return f>=0&&f===h.lastIndexOf(g)}function d(f){return f.name===b.OPERATION_NAME.DELETE_BUCKET||f.name===b.OPERATION_NAME.EMPTY_BUCKET}this.verifyPrefixesToBeListed=function(f,k){if(d(f)){return k.length===1&&k[0].Prefix===""}else{for(var g in k){var j=k[g];var i=undefined;if(f.initialPath.length===0){i=j.Prefix}else{var h=j.Prefix.split(f.initialPath);i=h[1];if(h.length===3&&i.lastIndexOf(b.DELIMITER)===-1){i=""+h[1]+f.initialPath}}if(!(a(j.Prefix,f.initialPath)&&c(i,b.DELIMITER)&&e(i,b.DELIMITER))){return false}}return true}};this.verify=function(l,f){if(!l){throw"keys is undefined."}if(l&&!angular.isArray(l)){l=new Array(l)}for(var k=0;k<l.length;k++){var h=false;for(var g=0;g<f.length;g++){if(a(l[k],f[g].Prefix)){h=true;break}}if(!h){return false}}return true};this.verifyEmptyKeyInSelectedPrefixes=function(k,f){var m=_.find(k,function(i){return i===""});if(m!==undefined){var o=_.find(f,function(i){return i.Prefix===""});if(o===undefined){var n=[];for(var l=0;l<k.length;l++){var h=false;for(var g=0;g<f.length;g++){if(_.startsWith(k[l],f[g].Prefix)){h=true;break}}if(!h){n.push(k[l])}if(n.length>1){break}}return n.length===1&&n[0]===""}}return false}}])})();"use strict";(function(){angular.module("s3").factory("ConsoleOperation",["$q","CachingService","KeySelectionService","PathService","S3Constants","UtilService","UUIDService",function(d,c,f,h,e,b,a){function g(an,X){var aa=a.generateUUID();var H=h.getCurrentBucket()||"";var A=c.getBucketLocation(H)||"";var ay=h.getCurrentAbsoluteFolderPath()||"";var L={};var K="";var ai="";var k="";var v="";var al=d.defer();var aI=0;var B=0;var i=0;var t="";var aG=0;var o=0;var az=0;var aH=[];var aj={};var C=function C(){};var aT=function aT(){};var ax=null;var y=null;var aA=function aA(aW){H=aW};var aP;var aC;var aK=0;var ao=0;var aR=e.OPERATION_STATE.WAITING;function aF(){return al}function aD(){if(b.isNumeric(aI)){if(aI>=0&&aI<=100){return Number(Number(aI).toFixed(2))}else{if(aI>100){return 100}}}return"--"}function J(aW){aI=aW}function aE(aW){B=aW}function aQ(){if(b.isNumeric(B)){if(B>=0&&B<=100){return Number(Number(B).toFixed(2))}else{if(B>100){return 100}}}return"--"}function P(){if(b.isNumeric(i)){return Math.min(Number(Number(i).toFixed(2)),100)}return"--"}function E(aW){i=aW}function G(){return A}function M(aW){A=aW}function R(aW){t=aW}function w(){return t}function aO(aW){aG=aW}function u(){return aG}function I(aW){o=aW}function l(){return o}function am(){return az}function ah(aW){az=aW}function ae(){return aH}function af(aW){aH=aW}function ap(){return aj}function aw(aW){aj=aW}function T(){return C}function W(aW){C=aW}function ad(){return aT}function ag(aW){aT=aW}function O(){return ax}function S(aW){ax=aW}function x(){return y}function V(aW){y=aW}function aB(aW){aR=aW}function z(){return aR}function aN(aW){L=aW}function aM(){return L}function Q(){return an}function q(){return X}function aU(aW){X=aW}function D(){return aa}function aJ(){return H}function N(){return ay}function F(){return aP}function p(aW){aP=aW}function aL(){return aC}function aS(aW){aC=aW}function Z(){return aK}function s(aW){aK=aW}function au(){return ao}function ak(aW){ao=aW}function n(){return aA}function at(){return""+H+e.DELIMITER+ay}function ar(){return""+K+e.DELIMITER+ai}function j(){return h.getUrlForBucketAndPrefix(window.location.href,H,ay)}function av(){return h.getUrlForBucketAndPrefix(window.location.href,K,ai)}function r(){return K}function m(aW){K=aW}function ab(){return ai}function Y(aW){ai=aW}function ac(){return v}function U(aW){v=aW}function aq(){return k}function aV(aW){k=aW}Object.defineProperties(this,{defer:{get:aF},name:{get:Q},step:{get:q,set:aU},id:{get:D},initialBucket:{get:aJ},initialPath:{get:N},bucketRegion:{get:G,set:M},dstBucket:{get:r,set:m},dstPrefix:{get:ab,set:Y},dstName:{get:aq,set:aV},dstBucketRegion:{get:ac,set:U},progressPercentage:{get:aD,set:J},succeedKeyCount:{get:u,set:aO},failedKeyCount:{get:l,set:I},totalOperatedObjectCount:{get:am,set:ah},successPercentage:{get:aQ,set:aE},errorPercentage:{get:P,set:E},progressText:{get:w,set:R},errorTypes:{get:ae,set:af},errorDetails:{get:ap,set:aw},state:{get:z,set:aB},start:{get:T,set:W},cancel:{get:ad,set:ag},errorCallBack:{get:O,set:S},finishCallBack:{get:x,set:V},parameters:{get:aM,set:aN},selectedObjects:{get:aL,set:aS},selectedFolders:{get:F,set:p},keyCount:{get:Z,set:s},totalSizeInBytes:{get:au,set:ak},changeInitialBucketForOperation:{get:n},operationPath:{get:at},operationDestinationPath:{get:ar},operationInitialLocationUrl:{get:j},operationDestinationUrl:{get:av}})}return g}])})();"use strict";(function(){angular.module("s3").service("UploadVerificationService",["$filter","$http","$log","$window","$q","$translate","ConsoleOperation","Md5WorkerService","S3Constants","SCLogService",function(h,p,j,g,n,k,f,q,i,a){var o=[];var e={};var r={verifyUpload:b};return r;function b(w,s,u){var t=new f("uploadVerification","requestReceived");var v={fileName:w.name,fileSize:w.size,uploadOpId:u};a.log("MD5CalculationSize",w.size,t,v);var x=n.defer();if(w.size===0){x.resolve(i.UPLOAD.ZERO_BYTE_MD5)}else{d(s,w,u,x,t)}return x.promise}function d(u,t,v,z,y){y.step="MD5CalculationStart";var s={fileName:t.name,uploadOpId:v};a.log("MD5CalculationStart",1,y,s);var x=u+"-";var A=q.generateWorker(u,t,v,z,y);A.worker.addEventListener("message",m(x));A.worker.addEventListener("error",c(x));e[x]=A;var w={file_size:t.size,start:0,end:t.size};A.worker.postMessage({message:t,block:w})}function c(s){return function(){var t=e[s];t.uploadVerificationDeferredObject.reject(k.instant("upload.md5calculation.error"));l(t,"MD5CalculationSuccess",0);delete e[s]}}function m(s){return function(u){if(u.data.result){var v=e[s];o[v.fileId]=u.data.result;var t=g.Date.now()-v.startTime;l(v,"MD5CalculationSuccess",1);l(v,"MD5CalculationTime",t);j.log("Etag calculated for "+v.file.name+": "+u.data.result);v.uploadVerificationDeferredObject.resolve(o[v.fileId]);delete e[s]}}}function l(v,u,t){v.operation.step=u;var s={fileName:v.file.name,uploadOpId:v.uploadOpId};a.log(u,t,v.operation,s)}}])})();"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};(function(){angular.module("s3").service("Md5WorkerService",["$window",function(c){this.generateWorker=function(d,g,f,h,e){if(!a){b()}var i=new c.Worker(a);var j={fileId:d,worker:i,file:g,startTime:c.Date.now(),uploadOpId:f,uploadVerificationDeferredObject:h,operation:e};return j};var a;function b(){if(_typeof(c.Blob)===(typeof Function==="undefined"?"undefined":_typeof(Function))||_typeof(c.Blob)==="object"){var d=new c.Blob(['/*                          * Crypto-JS v2.5.1                          * http://code.google.com/p/crypto-js/                          * (c) 2009-2011 by Jeff Mott. All rights reserved.                          * http://code.google.com/p/crypto-js/wiki/License                          */                         /*global Crypto, self*/                        (typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=self.Crypto={},g=e.util={rotl:function(a,b){return a<<b|a>>>32-b},rotr:function(a,b){return a<<32-b|a>>>b},endian:function(a){if(a.constructor==Number)return g.rotl(a,8)&16711935|g.rotl(a,24)&4278255360;for(var b=0;b<a.length;b++)a[b]=g.endian(a[b]);return a},randomBytes:function(a){for(var b=[];a>0;a--)b.push(Math.floor(Math.random()*256));return b},bytesToWords:function(a){for(var b=[],c=0,d=0;c<a.length;c++,d+=8)b[d>>>5]|=a[c]<<24-                        d%32;return b},wordsToBytes:function(a){for(var b=[],c=0;c<a.length*32;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b},bytesToHex:function(a){for(var b=[],c=0;c<a.length;c++)b.push((a[c]>>>4).toString(16)),b.push((a[c]&15).toString(16));return b.join("")},hexToBytes:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},bytesToBase64:function(a){if(typeof btoa=="function")return btoa(f.bytesToString(a));for(var b=[],c=0;c<a.length;c+=3)for(var d=a[c]<<16|a[c+1]<<8|                        a[c+2],e=0;e<4;e++)c*8+e*6<=a.length*8?b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>>6*(3-e)&63)):b.push("=");return b.join("")},base64ToBytes:function(a){if(typeof atob=="function")return f.stringToBytes(atob(a));for(var a=a.replace(/[^A-Z0-9+/]/ig,""),b=[],c=0,d=0;c<a.length;d=++c%4)d!=0&&b.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c-1))&Math.pow(2,-2*d+8)-1)<<d*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c))>>>                        6-d*2);return b}},e=e.charenc={};e.UTF8={stringToBytes:function(a){return f.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(f.bytesToString(a)))}};var f=e.Binary={stringToBytes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&255);return b},bytesToString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}}}();                        function FF(a, b, c, d, x, s, t) {                            var n = a + (b & c | ~b & d) + (x >>> 0) + t;                            return ((n << s) | (n >>> (32 - s))) + b;                        }                        function GG(a, b, c, d, x, s, t) {                            var n = a + (b & d | c & ~d) + (x >>> 0) + t;                            return ((n << s) | (n >>> (32 - s))) + b;                        }                        function HH(a, b, c, d, x, s, t) {                            var n = a + (b ^ c ^ d) + (x >>> 0) + t;                            return ((n << s) | (n >>> (32 - s))) + b;                        }                        function II(a, b, c, d, x, s, t) {                            var n = a + (c ^ (b | ~d)) + (x >>> 0) + t;                            return ((n << s) | (n >>> (32 - s))) + b;                        }                        function md5(m, hash) {                            var a = hash[0], b = hash[1], c = hash[2], d = hash[3];                            for (var i = 0; i < m.length; i += 16) {                                var aa = a, bb = b, cc = c, dd = d;                                a = FF(a, b, c, d, m[i + 0], 7, -680876936);                                d = FF(d, a, b, c, m[i + 1], 12, -389564586);                                c = FF(c, d, a, b, m[i + 2], 17, 606105819);                                b = FF(b, c, d, a, m[i + 3], 22, -1044525330);                                a = FF(a, b, c, d, m[i + 4], 7, -176418897);                                d = FF(d, a, b, c, m[i + 5], 12, 1200080426);                                c = FF(c, d, a, b, m[i + 6], 17, -1473231341);                                b = FF(b, c, d, a, m[i + 7], 22, -45705983);                                a = FF(a, b, c, d, m[i + 8], 7, 1770035416);                                d = FF(d, a, b, c, m[i + 9], 12, -1958414417);                                c = FF(c, d, a, b, m[i + 10], 17, -42063);                                b = FF(b, c, d, a, m[i + 11], 22, -1990404162);                                a = FF(a, b, c, d, m[i + 12], 7, 1804603682);                                d = FF(d, a, b, c, m[i + 13], 12, -40341101);                                c = FF(c, d, a, b, m[i + 14], 17, -1502002290);                                b = FF(b, c, d, a, m[i + 15], 22, 1236535329);                                a = GG(a, b, c, d, m[i + 1], 5, -165796510);                                d = GG(d, a, b, c, m[i + 6], 9, -1069501632);                                c = GG(c, d, a, b, m[i + 11], 14, 643717713);                                b = GG(b, c, d, a, m[i + 0], 20, -373897302);                                a = GG(a, b, c, d, m[i + 5], 5, -701558691);                                d = GG(d, a, b, c, m[i + 10], 9, 38016083);                                c = GG(c, d, a, b, m[i + 15], 14, -660478335);                                b = GG(b, c, d, a, m[i + 4], 20, -405537848);                                a = GG(a, b, c, d, m[i + 9], 5, 568446438);                                d = GG(d, a, b, c, m[i + 14], 9, -1019803690);                                c = GG(c, d, a, b, m[i + 3], 14, -187363961);                                b = GG(b, c, d, a, m[i + 8], 20, 1163531501);                                a = GG(a, b, c, d, m[i + 13], 5, -1444681467);                                d = GG(d, a, b, c, m[i + 2], 9, -51403784);                                c = GG(c, d, a, b, m[i + 7], 14, 1735328473);                                b = GG(b, c, d, a, m[i + 12], 20, -1926607734);                                a = HH(a, b, c, d, m[i + 5], 4, -378558);                                d = HH(d, a, b, c, m[i + 8], 11, -2022574463);                                c = HH(c, d, a, b, m[i + 11], 16, 1839030562);                                b = HH(b, c, d, a, m[i + 14], 23, -35309556);                                a = HH(a, b, c, d, m[i + 1], 4, -1530992060);                                d = HH(d, a, b, c, m[i + 4], 11, 1272893353);                                c = HH(c, d, a, b, m[i + 7], 16, -155497632);                                b = HH(b, c, d, a, m[i + 10], 23, -1094730640);                                a = HH(a, b, c, d, m[i + 13], 4, 681279174);                                d = HH(d, a, b, c, m[i + 0], 11, -358537222);                                c = HH(c, d, a, b, m[i + 3], 16, -722521979);                                b = HH(b, c, d, a, m[i + 6], 23, 76029189);                                a = HH(a, b, c, d, m[i + 9], 4, -640364487);                                d = HH(d, a, b, c, m[i + 12], 11, -421815835);                                c = HH(c, d, a, b, m[i + 15], 16, 530742520);                                b = HH(b, c, d, a, m[i + 2], 23, -995338651);                                a = II(a, b, c, d, m[i + 0], 6, -198630844);                                d = II(d, a, b, c, m[i + 7], 10, 1126891415);                                c = II(c, d, a, b, m[i + 14], 15, -1416354905);                                b = II(b, c, d, a, m[i + 5], 21, -57434055);                                a = II(a, b, c, d, m[i + 12], 6, 1700485571);                                d = II(d, a, b, c, m[i + 3], 10, -1894986606);                                c = II(c, d, a, b, m[i + 10], 15, -1051523);                                b = II(b, c, d, a, m[i + 1], 21, -2054922799);                                a = II(a, b, c, d, m[i + 8], 6, 1873313359);                                d = II(d, a, b, c, m[i + 15], 10, -30611744);                                c = II(c, d, a, b, m[i + 6], 15, -1560198380);                                b = II(b, c, d, a, m[i + 13], 21, 1309151649);                                a = II(a, b, c, d, m[i + 4], 6, -145523070);                                d = II(d, a, b, c, m[i + 11], 10, -1120210379);                                c = II(c, d, a, b, m[i + 2], 15, 718787259);                                b = II(b, c, d, a, m[i + 9], 21, -343485551);                                a = (a + aa) >>> 0;                                b = (b + bb) >>> 0;                                c = (c + cc) >>> 0;                                d = (d + dd) >>> 0;                            }                            return [a, b, c, d];                        }                        var hash = [1732584193, -271733879, -1732584194, 271733878];                        onmessage = function (event) {                            var uint8_array, message, block, output, nBitsTotal, nBitsLeft, nBitsTotalH, nBitsTotalL;                            var reader = new FileReaderSync();                            uint8_array = new Uint8Array(reader.readAsArrayBuffer(event.data.message));                            message = Crypto.util.endian(Crypto.util.bytesToWords(uint8_array));                            block = event.data.block;                            event = null;                            uint8_array = null;                            output = {};                            nBitsTotal =  block.file_size * 8;                            nBitsLeft = (block.end - block.start) * 8;                            message[nBitsLeft >>> 5] |= 0x80 << (nBitsLeft % 32);                            nBitsTotalH = Math.floor(nBitsTotal / 0x100000000);                            nBitsTotalL = nBitsTotal & 0xFFFFFFFF;                            message[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotalH;                            message[(((nBitsLeft + 64) >>> 9) << 4) + 14] = nBitsTotalL;                            self.hash = md5(message, self.hash);                            output.result = Crypto.util.bytesToHex(Crypto.util.wordsToBytes(Crypto.util.endian(self.hash)));                            message = null;                            self.postMessage(output);                            close();                        }'],{type:"application/javascript"});a=c.URL.createObjectURL(d)}}}])})();"use strict";(function(){angular.module("s3").service("BucketPropertiesService",["$window","$q","APIProxyService","Region","S3Constants","SCLogService","XMLParser","PermissionsUtilService","UtilService",function(ag,f,aa,w,aq,m,Q,Z,y){var j={deleteBucketCORS:O,deleteBucketPolicy:aj,getBucketACL:o,getBucketOwnerDisplayName:c,getBucketLocation:N,getBucketGranteeCounts:s,getBucketCORS:ao,getBucketGrantees:u,getBucketNotification:q,getBucketPolicy:A,getBucketVersioning:r,getEventCount:E,getBucketLifecycleConfiguration:K,getLoggingTargetBucket:k,getTagCount:al,getVersioningStatus:ae,isAnalyticsEnabled:U,isBucketPolicyApplied:G,isCORSEnabled:R,isInventoryEnabled:e,isLifecycleEnabled:ad,isLoggingEnabled:W,isMetricsEnabled:H,isReplicationEnabled:J,isRequesterPaysEnabled:an,enableBucketRequestPayment:ah,disableBucketRequestPayment:D,isWebsiteEnabled:P,putBucketACL:g,putBucketNotification:z,parseBucketNotificationObject:l,putBucketCORS:ai,putBucketPolicy:M,enableBucketVersioning:ap,disableBucketVersioning:T,enableBucketLogging:i,disableBucketLogging:C,putBucketTagging:af,deleteBucketTagging:ab,configureBucketWebsite:L,redirectBucketWebsiteRequests:F,deleteBucketWebsite:p,getBucketReplication:Y,putBucketReplication:d,deleteBucketReplication:ak,parseBucketReplicationObject:t,parseBucketReplicationObject_v1:ac,getBucketLifecycle:am,putBucketLifecycle:B,deleteBucketLifecycle:I,getBucketInventory:x,putBucketInventory:b,deleteBucketInventory:h,getBucketAccelerate:X,putBucketAccelerate:a,getBucketRegion:v};return j;function c(){var ar=m.logRequestReceived("getBucketOwnerDisplayName");return aa.getBucketOwner().then(function(at){m.logRequestComplete("getBucketOwnerDisplayName",ar);return at.DisplayName})}function v(ar){return j.getBucketLocation(ar).then(function(at){return _.find(w.regionMapping,{value:at})})}function N(at){var ar=m.logRequestReceived("getBucketLocation");return aa.getBucketLocation(ar,at,{}).then(function(au){m.logRequestComplete("getBucketLocation",ar);return au.region})}function s(at){var ar=m.logRequestReceived("getBucketGranteeCounts");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.acl.name).then(function(ay){var av=ay.response;m.logRequestComplete("getBucketGranteeCounts",ar);var ax={READ:0,WRITE:0,READ_ACP:0,WRITE_ACP:0};if(av){var au=av.AccessControlPolicy.AccessControlList.Grant;var aw=function aw(az){if(az.Permission==="FULL_CONTROL"){for(var aA in ax){ax[aA]++}}else{ax[az.Permission]++}};if(au){if(au.forEach){au.forEach(function(az){aw(az)})}else{aw(au)}}}return ax})}function u(at,ar){m.log("getBucketGranteesReceived",1,ar,{bucketName:at});ar.step="getBucketAclComplete";return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.acl.name).then(function(ax){var av=ax.response;var aw={};m.log("getBucketACL",1,ar,{bucketName:at});var au=av.AccessControlPolicy.AccessControlList.Grant;if(au){if(au.forEach){au.forEach(function(ay){Z.updateGranteesHelperFunction(ay,aw)})}else{Z.updateGranteesHelperFunction(au,aw)}}m.logRequestComplete("getBucketGrantees",ar);return aw})["catch"](function(au){m.log("getBucketGrantees",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function n(at,ar){m.log("getBucketACPReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.acl.name).then(function(av){var au=av.response;m.logRequestComplete("getBucketACP",ar);return au.AccessControlPolicy})["catch"](function(au){m.log("getBucketACP",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function o(at,ar){m.log("getBucketACLReceived",1,ar,{bucketName:at});return n(at,ar).then(function(au){m.logRequestComplete("getBucketACL",ar);return au.AccessControlList.Grant})["catch"](function(au){m.log("getBucketACL",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function g(au,ar,at){m.log("putBucketACLReceived",1,at,{bucketName:au});var av="";return n(au,at).then(function(aw){av+='<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/"><Owner><ID>'+aw.Owner.ID+"</ID>";av+="<DisplayName>"+aw.Owner.DisplayName+"</DisplayName></Owner><AccessControlList>";ar.forEach(function(ax){ax.Grantee.Type=ax.Grantee.URI?"Group":ax.Grantee.EmailAddress?"AmazonCustomerByEmail":"CanonicalUser";av+='<Grant><Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="'+ax.Grantee.Type+'">';av+=ax.Grantee.ID?"<ID>"+ax.Grantee.ID+"</ID>":"";av+=ax.Grantee.DisplayName?"<DisplayName>"+ax.Grantee.DisplayName+"</DisplayName>":"";av+=ax.Grantee.EmailAddress?"<EmailAddress>"+ax.Grantee.EmailAddress+"</EmailAddress>":"";av+=ax.Grantee.URI?"<URI>"+ax.Grantee.URI+"</URI>":"";av+="</Grantee>";av+="<Permission>"+ax.Permission+"</Permission></Grant>"});av+="</AccessControlList></AccessControlPolicy>";return aa.putBucketProperty(at,au,aa.bucketPropertiesMap.acl.name,av).then(function(ay){var ax=ay.response;m.logRequestComplete("putBucketACL",at);return ax})["catch"](function(ax){m.log("putBucketACL",0,at,{bucketName:au,error:ax});return f.reject(y.handleErrors(ax))})})["catch"](function(aw){return f.reject(aw)})}function z(av,at,ar){m.log("putBucketNotificationReceived",1,at,{bucketName:av});var au=l(ar);return aa.putBucketProperty(at,av,aa.bucketPropertiesMap.notification.name,au).then(function(ax){var aw=ax.response;m.log("putBucketNotification",1,at,{bucketName:av});return aw})["catch"](function(aw){m.log("putBucketNotification",0,at,{bucketName:av,error:aw});return f.reject(y.handleErrors(aw))})}function l(ar){var at={};var au=[{name:aq.EVENTS.TOPIC,value:aq.EVENTS.TOPICCONFIG},{name:aq.EVENTS.QUEUE,value:aq.EVENTS.QUEUECONFIG},{name:aq.EVENTS.CLOUDFN,value:aq.EVENTS.CLOUDCONFIG}];au.forEach(function(aw){var av=[];if(ar[aw.name]){ar[aw.name].forEach(function(ax){av.push(S(ax))});at[aw.value]=av}});at={NotificationConfiguration:at};return Q.jsonToXml(at)}function S(av){var au={};au.Id=av.id;var ar=[];if(av.prefix&&av.prefix!==""){ar.push({Name:"Prefix",Value:av.prefix})}if(av.suffix&&av.suffix!==""){ar.push({Name:"Suffix",Value:av.suffix})}if(ar.length!==0){V(ar);au.Filter={S3Key:{FilterRule:ar}}}switch(av.type){case aq.EVENTS.SNS:au.Topic=av.arn;break;case aq.EVENTS.SQS:au.Queue=av.arn;break;case aq.EVENTS.LAMBDA:au.CloudFunction=av.arn}var at=V(av.events);au.Event=at;return au}function V(ar){if(ar.length===1){return ar[0]}return ar}function R(at){var ar=m.logRequestReceived("isCORSEnabled");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.cors.name).then(function(au){m.logRequestComplete("isCORSEnabled",ar);return au.response!==undefined})}function ai(au,at,ar){m.log("putBucketCORSReceived",1,ar,{bucketName:au});return aa.putBucketProperty(ar,au,aa.bucketPropertiesMap.cors.name,at).then(function(av){m.logRequestComplete("putBucketCORS",ar);return av.response})["catch"](function(av){m.log("putBucketCORS",0,ar,{bucketName:au,error:av});return f.reject(y.handleErrors(av))})}function ao(at,ar){m.log("getBucketCORSReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.cors.name).then(function(au){m.logRequestComplete("getBucketCORS",ar);return au.response})["catch"](function(av){var au=y.handleErrors(av);if(au!=="The CORS configuration does not exist"){m.log("getBucketCORS",0,ar,{bucketName:at,error:av});return f.reject(au)}else{m.logRequestComplete("getBucketCORS",ar)}})}function O(at,ar){m.log("deleteBucketCORSReceived",1,ar,{bucketName:at});return aa.deleteBucketProperty(ar,at,aa.bucketPropertiesMap.cors.name).then(function(au){m.logRequestComplete("deleteBucketCORS",ar);return au.response})["catch"](function(au){m.log("deleteBucketCORS",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function G(at){var ar=m.logRequestReceived("isBucketPolicyApplied");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.policy.name).then(function(au){m.logRequestComplete("isBucketPolicyApplied",ar);return au.response!==undefined})}function A(at,ar){var au=arguments.length<=2||arguments[2]===undefined?true:arguments[2];m.log("getBucketPolicyReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.policy.name,{},au).then(function(av){m.logRequestComplete("getBucketPolicy",ar);return av.response})["catch"](function(aw){var av=y.handleErrors(aw);if(av!=="The bucket policy does not exist"){m.log("getBucketPolicy",0,ar,{bucketName:at,error:aw});return f.reject(av)}else{m.logRequestComplete("getBucketPolicy",ar)}})}function M(at,au,ar){m.log("putBucketPolicyReceived",1,ar,{bucketName:at});return aa.putBucketProperty(ar,at,aa.bucketPropertiesMap.policy.name,au).then(function(av){m.logRequestComplete("putBucketPolicy",ar);return av.response})["catch"](function(aw){var av=y.handleErrors(aw);m.log("putBucketPolicy",0,ar,{bucketName:at,error:aw});return f.reject(av)})}function aj(at,ar){m.log("deleteBucketPolicyReceived",1,ar,{bucketName:at});return aa.deleteBucketProperty(ar,at,aa.bucketPropertiesMap.policy.name).then(function(au){m.logRequestComplete("deleteBucketPolicy",ar);return au.response})["catch"](function(au){m.log("deleteBucketPolicy",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function K(at){var ar=m.logRequestReceived("getBucketLifecycleConfiguration");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.lifecycle.name).then(function(au){m.logRequestComplete("getBucketLifecycleConfiguration",ar);if(au.response){return Q.convertXmlStringToJson(au.response)}else{return au}})}function ae(at){var ar=m.logRequestReceived("getVersioningStatus");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.versioning.name).then(function(au){m.logRequestComplete("getVersioningStatus",ar);var av=Q.convertXmlStringToJson(au.response);return av.VersioningConfiguration&&av.VersioningConfiguration.Status})}function E(at){var ar=m.logRequestReceived("getEventCount");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.notification.name).then(function(au){m.logRequestComplete("getEventCount",ar);var av=Q.convertXmlStringToJson(au.response);var ax=0;for(var aw in av.NotificationConfiguration){ax+=av.NotificationConfiguration[aw].length||1}return ax})}function q(at,ar){m.log("getBucketNotificationReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.notification.name).then(function(au){m.logRequestComplete("getBucketNotification",ar);return au})["catch"](function(au){m.log("getBucketNotification",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function W(at){var ar=m.logRequestReceived("isLoggingEnabled");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.logging.name).then(function(au){m.logRequestComplete("isLoggingEnabled",ar);return au.response&&au.response.BucketLoggingStatus.LoggingEnabled!==undefined})}function k(at){var ar=m.logRequestReceived("getLoggingTargetBucket");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.logging.name).then(function(au){m.logRequestComplete("getLoggingTargetBucket",ar);var av=au.response.BucketLoggingStatus.LoggingEnabled;if(av){return av.TargetBucket}else{return"Logging is not enabled"}})}function an(at){var ar=m.logRequestReceived("isRequesterPaysEnabled");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.requestPayment.name).then(function(au){m.logRequestComplete("isRequesterPaysEnabled",ar);var av=Q.convertXmlStringToJson(au.response);return av.RequestPaymentConfiguration.Payer==="Requester"})}function J(at){var ar=m.logRequestReceived("isReplicationEnabled");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.replication.name).then(function(au){var av=Q.convertXmlStringToJson(au.response);var aw=false;if(av.ReplicationConfiguration){m.logRequestComplete("isReplicationEnabled",ar);if(av.ReplicationConfiguration.Rule.length){aw=_.filter(av.ReplicationConfiguration.Rule,function(ax){return ax.Status==="Enabled"}).length>0}else{aw=av.ReplicationConfiguration.Rule.Status==="Enabled"}}return aw})}function U(at){var au=aq.OPERATION_NAME.IS_ANALYTICS_ENABLED;var ar=m.logRequestReceived(au);return aa.getBucketProperty(ar,at,"analytics",{},false).then(function(ay){var av=ay.response;m.log(au,1,ar);var ax=Q.convertXmlStringToJson(av);var aw=ax.ListBucketAnalyticsConfigurationsResult;if(aw&&aw.AnalyticsConfiguration){return true}return false})["catch"](function(av){m.log(au,0,ar,{bucketName:at,error:av});return false})}function ad(at){var au=aq.OPERATION_NAME.IS_LIFECYCLE_ENABLED;var ar=m.logRequestReceived(au);return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.lifecycle.name).then(function(aw){m.log(au,1,ar);if(aw.response){var av=Q.convertXmlStringToJson(aw.response);if(av&&av.LifecycleConfiguration&&av.LifecycleConfiguration.Rule){var ax=y.transformObjectToArray(av.LifecycleConfiguration.Rule);return _.some(ax,function(ay){return ay.Status==="Enabled"})}}return false})["catch"](function(av){m.log(au,0,ar,{bucketName:at,error:av});return false})}function e(at){var au=aq.OPERATION_NAME.IS_INVENTORY_ENABLED;var ar=m.logRequestReceived(au);return aa.getObjectInventory(ar,at,{path:at}).then(function(aw){var av=aw.response;m.log(au,1,ar);if(av){var ax=Q.convertXmlStringToJson(av);if(ax.ListInventoryConfigurationsResult&&ax.ListInventoryConfigurationsResult.InventoryConfiguration){return true}}return false})["catch"](function(av){m.log(au,0,ar,{bucketName:at,error:av});return false})}function H(at){var au=aq.OPERATION_NAME.IS_METRICS_ENABLED;var ar=m.logRequestReceived(au);return aa.getBucketProperty(ar,at,"metrics",{},false).then(function(ax){var av=ax.response;m.log(au,1,ar);if(av){var ay=Q.convertXmlStringToJson(av);var aw=ay.ListMetricsConfigurationsResult;if(ay&&aw&&aw.MetricsConfiguration){return true}}return false})["catch"](function(av){m.log(au,0,ar,{bucketName:at,error:av});return false})}function al(at){var ar=m.logRequestReceived("getTagCount");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.tagging.name).then(function(au){m.logRequestComplete("getTagCount",ar);var av=Q.convertXmlStringToJson(au.response);var aw=0;if(av.Tagging){aw=av.Tagging.TagSet.Tag.length||1}return aw})}function P(at){var ar=m.logRequestReceived("isWebsiteEnabled");return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.website.name).then(function(au){m.logRequestComplete("isWebsiteEnabled",ar);return au.response!==undefined})}function r(at,ar){var au=arguments.length<=2||arguments[2]===undefined?true:arguments[2];m.log("getBucketVersioningReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.versioning.name,{},au).then(function(av){m.logRequestComplete("getBucketVersioning",ar);var aw=Q.convertXmlStringToJson(av.response);return aw.VersioningConfiguration&&aw.VersioningConfiguration.Status})["catch"](function(av){m.log("getBucketVersioning",0,ar,{bucketName:at,error:av});return f.reject(y.handleErrors(av))})}function ap(at,ar){m.log("putBucketVersioningReceived",1,ar,{bucketName:at});var au="<VersioningConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'><Status>Enabled</Status></VersioningConfiguration>";return aa.putBucketProperty(ar,at,aa.bucketPropertiesMap.versioning.name,au).then(function(av){m.logRequestComplete("putBucketVersioning",ar);return av})["catch"](function(av){m.log("putBucketVersioning",0,ar,{bucketName:at,error:av});return f.reject(y.handleErrors(av))})}function T(at,ar){m.log("putBucketVersioningReceived",1,ar,{bucketName:at});var au="<VersioningConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'><Status>Suspended</Status></VersioningConfiguration>";return aa.putBucketProperty(ar,at,aa.bucketPropertiesMap.versioning.name,au).then(function(av){m.logRequestComplete("putBucketVersioning",ar);return av})["catch"](function(av){m.log("putBucketVersioning",0,ar,{bucketName:at,error:av});return f.reject(y.handleErrors(av))})}function ah(au,ar){m.log("putBucketRequestPaymentReceived",1,ar,{bucketName:au});var at="<RequestPaymentConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'><Payer>Requester</Payer></RequestPaymentConfiguration>";return aa.putBucketProperty(ar,au,aa.bucketPropertiesMap.requestPayment.name,at).then(function(av){m.logRequestComplete("putBucketRequestPayment",ar);return av})["catch"](function(av){m.log("putBucketRequestPayment",0,ar,{bucketName:au,error:av});return f.reject(y.handleErrors(av))})}function D(au,ar){m.log("putBucketRequestPaymentReceived",1,ar,{bucketName:au});var at="<RequestPaymentConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'><Payer>BucketOwner</Payer></RequestPaymentConfiguration>";return aa.putBucketProperty(ar,au,aa.bucketPropertiesMap.requestPayment.name,at).then(function(av){m.logRequestComplete("putBucketRequestPayment",ar);return av})["catch"](function(av){m.log("putBucketRequestPayment",0,ar,{bucketName:au,error:av});return f.reject(y.handleErrors(av))})}function i(av,ay,ax,at,au){m.log("enableBucketLoggingReceived",1,au,{bucketName:av});var ar;if(at===undefined||at.length===0){ar=""}else{ar="<TargetGrants>";at.forEach(function(az){az.Grantee.Type=az.Grantee.URI?"Group":az.Grantee.EmailAddress?"AmazonCustomerByEmail":"CanonicalUser";ar+='<Grant><Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="'+az.Grantee.Type+'">';ar+=az.Grantee.ID?"<ID>"+az.Grantee.ID+"</ID>":"";ar+=az.Grantee.DisplayName?"<DisplayName>"+az.Grantee.DisplayName+"</DisplayName>":"";ar+=az.Grantee.EmailAddress?"<EmailAddress>"+az.Grantee.EmailAddress+"</EmailAddress>":"";ar+=az.Grantee.URI?"<URI>"+az.Grantee.URI+"</URI>":"";ar+="</Grantee>";ar+="<Permission>"+az.Permission+"</Permission></Grant>"});ar+="</TargetGrants>"}var aw="<BucketLoggingStatus xmlns='http://doc.s3.amazonaws.com/2006-03-01'>"+("<LoggingEnabled><TargetBucket>"+ay+"</TargetBucket><TargetPrefix>"+ax+"</TargetPrefix>"+ar+"</LoggingEnabled></BucketLoggingStatus>");return aa.putBucketProperty(au,av,aa.bucketPropertiesMap.logging.name,aw).then(function(az){m.logRequestComplete("enableBucketLogging",au);return az})["catch"](function(az){m.log("enableBucketLogging",0,au,{bucketName:av,error:az});return f.reject(y.handleErrors(az))})}function C(at,ar){m.log("disableBucketLoggingReceived",1,ar,{bucketName:at});var au="<BucketLoggingStatus xmlns='http://doc.s3.amazonaws.com/2006-03-01/' />";return aa.putBucketProperty(ar,at,aa.bucketPropertiesMap.logging.name,au).then(function(av){m.logRequestComplete("disableBucketLogging",ar);return av})["catch"](function(av){m.log("disableBucketLogging",0,ar,{bucketName:at,error:av});return f.reject(y.handleErrors(av))})}function af(av,au,at){var aw={Tagging:{TagSet:{Tag:[]}}};angular.forEach(au,function(ax){aw.Tagging.TagSet.Tag.push({Key:ax.Key,Value:ax.Value})});var ar=Q.jsonToXml(aw);m.log("putBucketTaggingReceived",1,at,{bucketName:av});return aa.putBucketProperty(at,av,aa.bucketPropertiesMap.tagging.name,ar).then(function(ax){m.logRequestComplete("putBucketTagging",at);return ax})["catch"](function(ax){m.log("putBucketTagging",0,at,{bucketName:av,error:ax});return f.reject(y.handleErrors(ax))})}function ab(au,at,ar){m.log("deleteBucketTaggingReceived",1,ar,{bucketName:au});return aa.deleteBucketProperty(ar,au,aa.bucketPropertiesMap.tagging.name).then(function(av){m.logRequestComplete("deleteBucketTagging",ar);return av})["catch"](function(av){m.log("deleteBucketTagging",0,ar,{bucketName:au,error:av});return f.reject(y.handleErrors(av))})}function L(av,aw,at,ax,au){m.log("putBucketWebsiteReceived",1,au,{bucketName:av});var ar="<WebsiteConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>"+("<IndexDocument><Suffix>"+aw+"</Suffix></IndexDocument>");ar+=at?"<ErrorDocument><Key>"+at+"</Key></ErrorDocument>":"";ar+=ax+"</WebsiteConfiguration>";return aa.putBucketProperty(au,av,aa.bucketPropertiesMap.website.name,ar).then(function(ay){m.logRequestComplete("putBucketWebsite",au);return ay})["catch"](function(ay){m.log("putBucketWebsite",0,au,{bucketName:av,error:ay});return f.reject(y.handleErrors(ay))})}function F(au,av,aw,at){m.log("putBucketWebsiteReceived",1,at,{bucketName:au});var ar="<WebsiteConfiguration xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>"+("<RedirectAllRequestsTo><HostName>"+av+"</HostName>");if(aw){ar+="<Protocol>"+aw+"</Protocol>"}ar+="</RedirectAllRequestsTo></WebsiteConfiguration>";return aa.putBucketProperty(at,au,aa.bucketPropertiesMap.website.name,ar).then(function(ax){m.logRequestComplete("putBucketWebsite",at);return ax})["catch"](function(ax){m.log("putBucketWebsite",0,at,{bucketName:au,error:ax});return f.reject(y.handleErrors(ax))})}function p(at,ar){m.log("deleteBucketWebsiteReceived",1,ar,{bucketName:at});return aa.deleteBucketProperty(ar,at,aa.bucketPropertiesMap.website.name).then(function(au){m.logRequestComplete("deleteBucketWebsite",ar);return au})["catch"](function(au){m.log("deleteBucketWebsite",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function Y(at,ar){m.log("getBucketReplicationReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.replication.name).then(function(au){m.logRequestComplete("getBucketReplication",ar);return au})["catch"](function(au){m.log("getBucketReplication",0,ar,{bucketName:at});return f.reject(y.handleErrors(au))})}function d(aw,au,ar,at){m.log("putBucketReplicationReceived",1,au,{bucketName:aw});var av=at?ac(ar):t(ar);return aa.putBucketProperty(au,aw,aa.bucketPropertiesMap.replication.name,av).then(function(ax){m.logRequestComplete("putBucketReplication",au);return ax})["catch"](function(ax){m.log("putBucketReplication",0,au,{bucketName:aw});return f.reject(y.handleErrors(ax))})}function ac(ar){var av=[];var at=ar.destinationBucket.value||ar.destinationBucket;ar.rules.forEach(function(ax){var aw={ID:ax.id,Status:ax.status,Prefix:ax.prefix,Destination:{Bucket:y.getBucketARN(at),StorageClass:ax.storageClass}};av.push(aw)});if(av.length===1){av=av[0]}var au={ReplicationConfiguration:{Role:ar.role,Rule:av}};return Q.jsonToXml(au)}function t(ar){var av=[];var at=ar.destinationBucket;ar.rules.forEach(function(ax){var aw={ID:ax.ID,Status:_.isEmpty(ax.Status)?"Disabled":ax.Status,Prefix:_.isEmpty(ax.Prefix)?"":ax.Prefix,Destination:{Bucket:y.getBucketARN(at),StorageClass:_.get(ax.Destination,"StorageClass.value",undefined)}};av.push(aw)});if(av.length===1){av=av[0]}var au={ReplicationConfiguration:{Role:ar.role,Rule:av}};return Q.jsonToXml(au)}function ak(at,ar){m.log("deleteBucketReplicationReceived",1,ar,{bucketName:at});return aa.deleteBucketProperty(ar,at,aa.bucketPropertiesMap.replication.name).then(function(au){m.logRequestComplete("deleteBucketReplication",ar);return au})["catch"](function(au){m.log("deleteBucketReplication",0,ar,{bucketName:at});return f.reject(y.handleErrors(au))})}function I(av,au,ar,ax,aw,at){m.log("deleteBucketLifecycleReceived",1,at);return aa.deleteBucketProperty(at,av,aa.bucketPropertiesMap.lifecycle.name).then(function(ay){m.log("deleteBucketLifecycle",1,at,{initialXml:au,finalXml:ar,ruleBeforeEdit:ax,ruleAfterEdit:aw,"x-amz-id-2":ay.headers(aq.HEADERS.X_AMZ_ID_2),"x-amz-request-id":ay.headers(aq.HEADERS.X_AMZ_REQUEST_ID)});return ay})["catch"](function(ay){m.log("deleteBucketLifecycle",0,at,{initialXml:au,finalXml:ar,ruleBeforeEdit:ax,ruleAfterEdit:aw,error:ay});return f.reject(y.handleErrors(ay))})}function B(av,au,ar,ax,aw,at){m.log("putBucketLifecycleReceived",1,at);return aa.putBucketProperty(at,av,aa.bucketPropertiesMap.lifecycle.name,ar).then(function(ay){m.log("putBucketLifecycle",1,at,{initialXml:au,finalXml:ar,ruleBeforeEdit:ax,ruleAfterEdit:aw,"x-amz-id-2":ay.headers(aq.HEADERS.X_AMZ_ID_2),"x-amz-request-id":ay.headers(aq.HEADERS.X_AMZ_REQUEST_ID)});return ay})["catch"](function(ay){m.log("putBucketLifecycle",0,at,{initialXml:au,finalXml:ar,ruleBeforeEdit:ax,ruleAfterEdit:aw,error:ay});return f.reject(y.handleErrors(ay))})}function am(at,ar){m.log("getBucketLifecycleReceived",1,ar);return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.lifecycle.name).then(function(au){if(au.response){m.log("getBucketLifecycle",1,ar,{content:au.response});return au.response}else{m.log("getBucketLifecycle",1,ar,{content:au});return au}})["catch"](function(av){var au=y.handleErrors(av);if(av!==aq.LIFECYCLE.LIFECYCLE_DOES_NOT_EXIST_MESSAGE){m.log("getBucketLifecycle",0,ar,{error:av})}else{m.log("getBucketLifecycle",1,ar,{content:aq.LIFECYCLE.LIFECYCLE_DOES_NOT_EXIST_MESSAGE})}return f.reject(au)})}function x(at,ar){m.log("getBucketInventoryReceived",1,ar,{bucketName:at});return aa.getBucketProperty(at,aa.bucketPropertiesMap.inventory.name).then(function(au){m.logRequestComplete("getBucketInventory",ar);return au})["catch"](function(au){m.log("getBucketInventory",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function b(at,au,ar){m.log("putBucketInventoryReceived",1,ar);return aa.putBucketProperty(at,aa.bucketPropertiesMap.inventory.name,au).then(function(av){m.log("putBucketInventory",1,ar,{content:au});return av})["catch"](function(av){m.log("putBucketInventory",0,ar,{error:av});return f.reject(y.handleErrors(av))})}function h(at,ar){m.log("deleteBucketInventoryReceived",1,ar);return aa.deleteBucketProperty(at,aa.bucketPropertiesMap.inventory.name).then(function(au){m.logRequestComplete("deleteBucketInventory",ar);return au})["catch"](function(au){m.log("deleteBucketInventory",0,ar,{error:au});return f.reject(y.handleErrors(au))})}function X(at,ar){m.log("getBucketAccelerateReceived",1,ar,{bucketName:at});return aa.getBucketProperty(ar,at,aa.bucketPropertiesMap.accelerate.name).then(function(au){m.logRequestComplete("getBucketAccelerate",ar);var av=Q.convertXmlStringToJson(au.response);return av.AccelerateConfiguration&&av.AccelerateConfiguration.Status})["catch"](function(au){m.log("getBucketAccelerate",0,ar,{bucketName:at,error:au});return f.reject(y.handleErrors(au))})}function a(au,ar,at){var aw={},av=undefined;aw.AccelerateConfiguration={};aw.AccelerateConfiguration.Status=at;av=Q.jsonToXml(aw);av=av.replace("<AccelerateConfiguration>",'<?xml version="1.0" encoding="UTF-8"?> <AccelerateConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">');m.log("putBucketAccelerateReceived",1,ar);return aa.putBucketProperty(ar,au,aa.bucketPropertiesMap.accelerate.name,av).then(function(ax){m.log("putBucketAccelerate",1,ar,{content:av});return ax})["catch"](function(ax){m.log("putBucketAccelerate",0,ar,{content:av,error:ax});return f.reject(y.handleErrors(ax))})}}])})();"use strict";(function(){angular.module("s3").service("ObjectPropertiesService",["$q","APIProxyService","CachingService","PathService","S3Constants","SCLogService","UtilService","XMLParser",function(h,c,b,k,g,n,l,i){var e="putObjectTagging";var j="putObjectVersionTagging";function a(p){var r=_.cloneDeep(p);for(var s in r){var q=r[s];if(q.StorageClass===g.STORAGE_CLASSES.GLACIER){q.downloadDisabled=true;q.deleteDisabled=true}q.StorageClass=l.getStorageClassTranslations()[q.StorageClass]}return r}function m(s,t){var q=_.cloneDeep(s);var p=undefined;t.downloadDisabled=true;for(var r=0;r<q.length;r++){p=q[r];if(p.LastModified<t.LastModified){q.splice(r,0,t);break}}return q}function f(t,s,r){var p=b.getCurrentVersions(s);if(p){r.isCached=true;n.log(r.name+"IsCached",0,r);return h.resolve(p)}var q=h.defer(),u={bucket:t,prefix:s};r.isCached=false;c.listVersions(r,u).then(function(B){var A=_.cloneDeep(B),x=undefined,w=undefined,y=undefined;if(A.response){if(typeof A.response==="string"){x=i.convertXmlStringToJson(A.response).ListVersionsResult}else{if(A.response.ListVersionsResult){x=A.response.ListVersionsResult}else{n.log(r.name+"ListVersionsCall",0,r);q.reject("There is no data in the listVersions response.");return}}w=x.Version;w=l.transformObjectToArray(w);w=_.filter(w,function(C){return C.Key===s});n.log(r.name+"ListVersionsCall",1,r)}else{n.log(r.name+"ListVersionsCall",0,r);q.reject("There is no data in the listVersions response.");return}r.listVersionsResponse=A;var v=l.getIconClassFromFilename(s);_.map(w,function(C){C.fileIconClass=v;return C});y=a(w);if(y&&x.DeleteMarker){var z=l.transformObjectToArray(x.DeleteMarker);_.each(z,function(C){C.fileIconClass=g.FILE_EXTENSIONS_ICON_MAP.trash;if(C.Key===s){y=m(y,C)}})}b.setCurrentVersions(s,y);q.resolve(y)})["catch"](function(v){q.reject(l.handleErrors(v))});return q.promise}function d(v,t,r,q){var s=k.getCurrentBucket();if(!t){n.log("putObjectTaggingReceived",1,q,{bucketName:s,object:v})}else{n.log("putObjectVersionTaggingReceived",1,q,{bucketName:s,object:v,versionId:t})}var u={Tagging:{TagSet:{Tag:[]}}};angular.forEach(r,function(w){if(w.Key){u.Tagging.TagSet.Tag.push({Key:w.Key,Value:w.Value})}});var p=i.jsonToXml(u);return c.putObjectTag(q,s,v,p,t).then(function(w){if(!t){n.logRequestComplete(e,q)}else{n.logRequestComplete(j,q)}return w})["catch"](function(w){if(!t){n.log(e,0,q,{objectName:v,error:w})}else{n.log(j,0,q,{objectName:v,versionId:t,error:w})}return h.reject(l.handleErrors(w))})}var o={convertToReadableStorageClass:a,insertDeleteMarker:m,listVersions:f,putObjectTagging:d};return o}])})();"use strict";(function(){angular.module("s3").directive("modal",[function(){return{restrict:"E",templateUrl:"/s3/partials/modal.html",scope:{isOpen:"=",closeCallback:"=?",headerTitle:"=",state:"=?",steps:"=?",nextState:"=?",previousState:"=?",setState:"=?"},transclude:{header:"?modalHeader",content:"modalContent",footer:"modalFooter"},controller:"ModalController"}}]);angular.module("s3").controller("ModalController",["$scope","UtilService",function(b,a){b.closeModal=function(){b.isOpen.flag=false;b.closeCallback();a.bodyFreezeScroll(b.isOpen&&b.isOpen.flag)};b.getState=function(c){var d=Object.keys(b.steps)[c];if(d){return b.steps[d]}return};b.setState=function(c){b.state=c};b.nextState=function(){var c=Object.keys(b.steps).indexOf(b.state.name);b.setState(b.getState(c+1))};b.previousState=function(){var c=Object.keys(b.steps).indexOf(b.state.name);b.setState(b.getState(c-1))}}])})();"use strict";(function(){angular.module("s3").directive("focusWhen",[function(){return{restrict:"A",link:function a(c,d,b){c.$on("focusOn",function(e,f){if(f===b.focusWhen){d[0].focus()}})}}}]);angular.module("s3").factory("focusOn",["$rootScope","$timeout",function(a,b){return function(c){b(function(){a.$broadcast("focusOn",c)})}}])})();"use strict";angular.module("s3").directive("clickoutside",["$document","UUIDService",function(c,a){return{restrict:"A",scope:{onClickOutside:"=",isEnabled:"=?"},link:function b(e,f,d){if(d.id){e.mainElementId=d.id}else{e.mainElementId=a.generateUUID();$(f).attr("id",e.mainElementId)}var g=function g(h){if(e.isEnabled===false){return}if(!h||!h.target){return}for(var i=h.target;i;i=i.parentNode){var j=i.id;if(j!==undefined&&j===e.mainElementId){return}}e.$apply(function(){e.onClickOutside()})};c.on("click",g);e.$on("$destroy",function(){c.off("click",g)})}}}]);"use strict";angular.module("s3").directive("bucketSelector",[function(){return{restrict:"E",controller:"BucketSelectorController",scope:{bucketList:"=?",copySettingsSourceBucket:"=?",operation:"=?",getSourceBucketProperties:"=?",getSourceBucketPermissions:"=?",currBucketPermissions:"=?",defaultAcls:"=?",editable:"=?",selectedReport:"=?",showBucketNameOnly:"=?",chooseAccounts:"=?",isOpen:"=?",sameRegion:"=?",bucketReplication:"=?",enableDeselect:"=?"},templateUrl:"/s3/partials/bucketselector.html"}}]);angular.module("s3").controller("BucketSelectorController",["$filter","$scope","$translate","BucketPropertiesService","BucketPropertiesUtilService","APIProxyService","XMLParser","SCLogService","ConsoleOperation","Region","PathService","PermissionsUtilService","S3Constants","UtilService",function(p,t,u,i,f,v,y,b,m,d,c,g,q,x){t.emptyText=u.instant("lamb.nobuckets");t.noSelectedBucketText=u.instant("bucketselector.selecteditem.placeholder");t.filterColumn="Name";var n=c.getCurrentBucket();var k="false";var e="";t.savingBucket=false;t.account={outside:k};t.tmpValues={accountId:"",bucket:"",regionError:""};t.tableFiltering={filter:{}};t.tableFiltering.filter[t.filterColumn]=t.defaultFilterValue;t.filterBlur=function(){if(!t.tableFiltering.filter[t.filterColumn]){t.tableFiltering.showClear=false}};t.clearFilter=function(){t.tableFiltering.filter[t.filterColumn]="";t.tableFiltering.showClear=false};t.filterKeyDown=function(z){if(z&&z.keyCode===q.KEY_CODES.ESC){$(".input-field").blur();t.clearFilter()}};function w(){i.getBucketLocation(t.copySettingsSourceBucket.Name).then(function(z){t.copySettingsSourceBucket.Location=d.twoWayMapping[z];if(t.selectedReport){t.selectedReport.Location=t.copySettingsSourceBucket.Location}})["catch"](function(z){if(t.selectedReport){t.selectedReport.bucketUnknown=u.instant("bucketselector.invalid.bucket");t.selectedReport.bucketError=true}})}t.$watch(function(){return t.tableFiltering.filter[t.filterColumn]},function(A,z){if(z!==A){t.selectedItem=null;if(t.bucketList){t.totalItems=p("filter")(t.bucketList,t.tableFiltering.filter).length}}});t.toggleDropDown=function(){t.isOpen=!t.isOpen;if(t.bucketList){t.bucketList.forEach(function(z){return z.isExpanded=false})}};t.closeDropDown=function(){t.isOpen=false;if(t.bucketList){t.bucketList.forEach(function(z){return z.isExpanded=false})}};t.getBucketPlaceHolder=function(){var z="bucketselector.selecteditem.placeholder";if(t.editable){z="bucketselector.selecteditem.notoptional.placeholder"}return u.instant(z)};t.getSearchPlaceHolder=function(){var z="bucketselector.inputfield.placeholder";if(t.editable){z="bucketselector.inputfield.enter.placeholder"}return u.instant(z)};t.getResultsMessage=function(){var z="bucketselector.nomatchesfound";if(t.editable&&!t.chooseAccounts){z="bucketselector.cross.account"}return u.instant(z)};function s(z){if(t.editable&&t.selectedReport){t.selectedReport.bucket=z.Name;t.selectedReport.Location=z.Location;t.selectedReport.bucketError=false;t.selectedReport.bucketUnknown=""}if(t.editable&&t.bucketReplication){t.bucketReplication.destinationBucket.name=z.Name;if(!t.bucketReplication.isCrossAccount){t.bucketReplication.destinationBucket.region=z.Location}i.getBucketVersioning(z.Name,new m("GetBucketVersioning"),false).then(function(A){l();t.bucketReplication.destinationBucket.versioningEnabled=A===q.BUCKET_PROPERTIES.VERSIONING.ENABLED})["catch"](function(A){l();t.bucketReplication.destinationBucket.Errors.getVersioningError=A})["finally"](function(){t.savingBucket=false;t.closeDropDown()})}}function l(){t.bucketReplication.destinationBucket.Errors={};t.bucketReplication.destinationBucket.versioningEnabled=null;t.bucketReplication.destinationBucket.createNewDestBucket=false;t.bucketReplication.destinationBucket.bucketNameValidationErrors.length=0}t.savePressed=function(z){z.stopPropagation();t.tmpValues.regionError="";t.savingBucket=true;var A=f.stripBucketARN(t.tmpValues.bucket);if(A.length===0){return}if(t.bucketReplication){t.bucketReplication.isCrossAccount=true;t.bucketReplication.destinationBucket.name=t.tmpValues.bucket;t.copySettingsSourceBucket={Name:A,Location:""};l();t.clearFilter();v.headBucket(new m("checkBucketAvailability"),t.bucketReplication.destinationBucket.name).then(function(){s(t.copySettingsSourceBucket)})["catch"](function(B){if(B.status===q.HTTP_STATUS_CODES.NOT_FOUND){t.bucketReplication.destinationBucket.Errors.bucketNotExistError=u.instant("crr.error.destinationbucketdoesnotexist");t.savingBucket=false;t.closeDropDown()}else{i.getBucketRegion(t.bucketReplication.destinationBucket.name).then(function(C){if(C.text===t.bucketReplication.sourceRegion){t.bucketReplication.destinationBucket.Errors.generalErrors=u.instant("crr.errormsg.bucketinsameregion");t.savingBucket=false;t.closeDropDown()}else{s(t.copySettingsSourceBucket)}})["catch"](function(){s(t.copySettingsSourceBucket)})}})}else{i.getBucketLocation(t.tmpValues.bucket).then(function(B){if(t.sameRegion){var C=d.twoWayMapping[B];if(e!==C){t.tmpValues.regionError=u.instant("management.analytics.bucket.region.error",{dest:C,src:e})}}})["catch"](function(B){t.tmpValues.regionError=u.instant("management.connection.error")})["finally"](function(){if(!t.tmpValues.regionError){if(t.selectedReport){t.selectedReport.bucket=t.tmpValues.bucket;t.selectedReport.accountId=t.tmpValues.accountId}t.copySettingsSourceBucket={Name:A,Location:""};t.closeDropDown();t.clearFilter();s(t.copySettingsSourceBucket);w();z.stopPropagation()}t.savingBucket=false})}};t.createNewBucket=function(){l();t.bucketReplication.destinationBucket.name=null;t.bucketReplication.destinationBucket.region=null;t.bucketReplication.destinationBucket.createNewDestBucket=true;t.copySettingsSourceBucket={Name:u.instant("bucketselector.createnew")};t.closeDropDown()};t.selectBucket=function(z){t.copySettingsSourceBucket=z;if(t.bucketReplication){t.bucketReplication.isCrossAccount=false;t.bucketReplication.destinationBucket.createNewDestBucket=false;l();s(z)}else{(function(){s(z);t.getSourceBucketProperties={tagging:{tags:[]},logging:{selectedValue:q.BUCKET_PROPERTIES.DISABLE},versioning:{selectedValue:q.BUCKET_PROPERTIES.DISABLE}};var C=new m("CreateBucketLogging");var B=new m("CreateBucketTagging");var A=new m("CreateBucketVersioning");v.getBucketProperty(B,z.Name,"tagging").then(function(F){var D=F.response;r("getBucketTagging",true,B,"");var E=y.convertXmlStringToJson(D);if(E.Tagging){f.populateTagsFields(E,t.getSourceBucketProperties.tagging.tags)}})["catch"](function(E){var D=x.handleErrors(E);if(D!==q.BUCKET_PROPERTIES.TAGGING.TAG_SET_NOT_EXIST_MESSAGE){r("getBucketTagging",false,B,E);t.getSourceBucketProperties.tagging.isError=true;t.getSourceBucketProperties.tagging.errorMessage=D}else{r("getBucketTagging",true,B,"")}});i.getBucketVersioning(t.copySettingsSourceBucket.Name,A).then(function(D){if(D===q.BUCKET_PROPERTIES.VERSIONING.ENABLED){t.getSourceBucketProperties.versioning.selectedValue=q.BUCKET_PROPERTIES.ENABLE;if(t.bucketReplication&&t.bucketReplication.destinationBucket){l();t.bucketReplication.destinationBucket.Errors.versioningEnabled=true}}else{t.getSourceBucketProperties.versioning.selectedValue=q.BUCKET_PROPERTIES.DISABLE;if(t.bucketReplication&&t.bucketReplication.destinationBucket){l();t.bucketReplication.destinationBucket.Errors.versioningEnabled=false}}})["catch"](function(D){t.getSourceBucketProperties.versioning.isError=true;t.getSourceBucketProperties.versioning.errorMessage=D;if(t.bucketReplication&&t.bucketReplication.destinationBucket){l();t.bucketReplication.destinationBucket.Errors.getVersioningError=D;t.bucketReplication.destinationBucket.versioningEnabled=null}});v.getBucketProperty(C,t.copySettingsSourceBucket.Name,"logging").then(function(E){var D=E.response;r("getBucketLogging",true,C,"");if(D){f.populateLoggingFields(D,t.getSourceBucketProperties.logging)}})["catch"](function(D){r("getBucketLogging",false,C,D);t.getSourceBucketProperties.logging.isError=true;t.getSourceBucketProperties.logging.errorMessage=x.handleErrors(D)});o()})()}t.isOpen=false;if(!t.account.outside&&(t.selectedReport||t.bucketReplication)){t.tmpValues.accountId="";t.tmpValues.bucket="";t.tmpValues.regionError=""}};function o(){var z=new m(q.BUCKET_PERMISSIONS.CREATE_BUCKET_PERMISSIONS);i.getBucketGrantees(t.copySettingsSourceBucket.Name,z).then(function(A){r("getBucketGrantees",true,z,"");t.getSourceBucketPermissions.grantees=A;i.getBucketACL(t.copySettingsSourceBucket.Name,z).then(function(B){r("getBucketAcls",true,z,"");t.getSourceBucketPermissions.aclGrants=B?Array.isArray(B)?B:[B]:B;g.populateAclsFields(t.currBucketPermissions,t.getSourceBucketPermissions.grantees)})["catch"](function(B){r("getBucketAcls",false,z,B);t.getSourceBucketPermissions.aclGrants.isError=true;t.getSourceBucketPermissions.aclGrants.errorMessage=B})})["catch"](function(A){r("getBucketGrantees",false,z,A);t.getSourceBucketPermissions.grantees.isError=true;t.getSourceBucketPermissions.grantees.errorMessage=x.handleErrors(A)})}function r(A,C,z,B){C===true?b.log(A,1,z,{bucketName:t.copySettingsSourceBucket.Name}):b.log(A,0,z,{bucketName:t.copySettingsSourceBucket.Name,error:B})}t.deselectBucket=function(){if(!t.editable){t.copySettingsSourceBucket=undefined;t.getSourceBucketProperties={tagging:{tags:[]},logging:{selectedValue:q.BUCKET_PROPERTIES.DISABLE},versioning:{selectedValue:q.BUCKET_PROPERTIES.DISABLE}};t.getSourceBucketPermissions.aclGrants={};t.getSourceBucketPermissions.grantees={};t.currBucketPermissions.publicPermissions=_.cloneDeep(t.defaultAcls.publicPermissions);t.currBucketPermissions.userPermissions=_.cloneDeep(t.defaultAcls.userPermissions)}};t.toggleBucket=function(z,A){A.isExpanded=!A.isExpanded;z.stopPropagation();if(A.isExpanded){b.log("getPropertiesForBucketSelector",1,t.operation,{bucketName:A.Name});A.propertyCount=0;i.getBucketGranteeCounts(A.Name).then(function(B){A.permissionCount=B;A.granteeCount=A.permissionCount.READ+A.permissionCount.WRITE+A.permissionCount.READ_ACP+A.permissionCount.WRITE_ACP});i.isLoggingEnabled(A.Name).then(function(B){if(B){A.loggingStatus=u.instant("bucketproperty.enabled");A.propertyCount++}else{A.loggingStatus=u.instant("bucketproperty.disabled")}});i.getVersioningStatus(A.Name).then(function(B){if(B==="Enabled"){A.versioningStatus=u.instant("bucketproperty.enabled");A.propertyCount++}else{if(B==="Suspended"){A.versioningStatus=u.instant("bucketproperty.suspended")}else{A.versioningStatus=u.instant("bucketproperty.disabled")}}});i.getTagCount(A.Name).then(function(B){A.tagCount=B})}};function j(){i.getBucketLocation(n).then(function(z){e=d.twoWayMapping[z]})["finally"](function(){h(t.operation)})}function h(z){var A=arguments.length<=1||arguments[1]===undefined?true:arguments[1];t.bucketsLoaded=false;b.log("LoadBucketsReceived",1,z);t.isLoadingBuckets=true;v.listAllMyBuckets(z,A).then(function(C){b.log("listAllMyBuckets",1,z);var B=C.response.ListAllMyBucketsResult.Buckets.Bucket;if(B&&B.length>0){(function(){var D=B.length;B.forEach(function(E){i.getBucketLocation(E.Name).then(function(F){E.Location=d.twoWayMapping[F]})["finally"](function(){D--;if(D<=0){if(t.sameRegion&&e){var F=_.filter(B,function(H){return H.Location===e});t.bucketList=F;if(t.selectedReport&&t.selectedReport.bucket){var G=_.findIndex(B,function(H){return H.Name===t.selectedReport.bucket})===-1;t.account.outside=G?"true":"false";if(G){t.tmpValues.bucket=t.selectedReport.bucket;t.tmpValues.regionError=""}}}else{if(t.bucketReplication&&t.bucketReplication.sourceBucket){t.bucketReplication.bucketListCurrAccount.length=0;B.forEach(function(H){t.bucketReplication.bucketListCurrAccount.push(H)});t.bucketList=_.filter(B,function(H){return H.Name!==t.bucketReplication.sourceBucket&&H.Location!==t.bucketReplication.sourceRegion});if(t.bucketReplication.destinationBucket&&!t.bucketReplication.destinationBucket.createNewDestBucket&&!_.isEmpty(t.bucketReplication.destinationBucket.name)){t.bucketReplication.isCrossAccount=_.findIndex(B,function(H){return H.Name===t.bucketReplication.destinationBucket.name})===-1;t.account.outside=t.bucketReplication.isCrossAccount?"true":"false";if(t.bucketReplication.isCrossAccount){t.tmpValues.bucket=t.bucketReplication.destinationBucket.name;t.tmpValues.regionError=""}}}else{t.bucketList=B}}t.isLoadingBuckets=false}})})})()}else{t.bucketList=[]}})["catch"](function(B){b.log("listAllMyBuckets",0,z);t.bucketList=[];t.bucketsLoaded=true})}function a(){t.bucketsLoaded=false;t.outside=false;if(t.chooseAccounts&&t.selectedReport){t.tmpValues.bucket=t.selectedReport.bucket;t.tmpValues.accountId=t.selectedReport.accountId;t.tmpValues.regionError=""}if(t.chooseAccounts&&t.bucketReplication&&t.bucketReplication.isCrossAccount){t.tmpValues.bucket=t.bucketReplication.destinationBucket.name;t.tmpValues.regionError="";t.account.outside=t.bucketReplication.isCrossAccount?"true":"false"}if(!t.bucketList&&t.editable){t.operation=new m("SelectBucket");var A={};var z=q.BUCKET_PROPERTIES;var B=q.BUCKET_PERMISSIONS;A.createBucketProperties={getResponse:{tagging:{tags:[]},logging:{selectedValue:z.DISABLE},versioning:{selectedValue:z.DISABLE}}};A.sourceBucketPermissions={grantees:{},aclGrants:{}};A.currPermissions=_.cloneDeep(B.INITIALIZE_ACLS);A.createBucketValues={firstLoad:true,copySettingsSourceBucket:null};A.operation=new m("CreateBucket","CreateBucketRequestReceived");A.defaultAcls=_.cloneDeep(B.INITIALIZE_ACLS);t.copySettingsSourceBucket={};if(t.selectedReport&&t.selectedReport.bucket){t.copySettingsSourceBucket.Name=t.selectedReport.bucket}if(t.bucketReplication&&t.bucketReplication.destinationBucket){t.copySettingsSourceBucket.Name=t.bucketReplication.destinationBucket.createNewDestBucket?u.instant("bucketselector.createnew"):t.bucketReplication.destinationBucket.name}t.getSourceBucketProperties=A.createBucketProperties.getResponse;t.getSourceBucketPermissions=A.sourceBucketPermissions;t.currBucketPermissions=A.createBucketValues.copySettingsSourceBucket;t.defaultAcls=A.defaultAcls;j()}else{t.bucketsLoaded=true}}a()}]);"use strict";(function(){angular.module("s3").directive("operationManager",[function(){return{restrict:"AE",scope:{selectedTab:"="},templateUrl:"/s3/partials/progressbar.html",controller:"ProgressbarController"}}]);angular.module("s3").controller("ProgressbarController",["$filter","$scope","$translate","OperationDispatcherService","$window","SCLogService","S3Constants",function(f,a,e,h,g,d,c){a.isExpanded=false;a.thresholdPercentage=c.OPERATION.THRESHOLD_PERCENTAGE;a.isActiveUploadOperation=function(i){return i.name===c.OPERATION_NAME.UPLOAD&&i.state===c.OPERATION_STATE.ACTIVE};a.$watch(function(i){return i.isExpanded&&i.showingOperations===i.allOperations.ongoingOperations&&i.totalOngoingOperations.length>0},function(i){a.isExpanded=i});a.modalOpen={flag:false};a.detailOperation=null;a.allOperations={ongoingOperations:a.totalOngoingOperations,completedOperations:a.completedOperations,incompleteOperations:a.incompleteOperations};a.$watch(function(i){i.allOperations.ongoingOperations=i.totalOngoingOperations;i.allOperations.completedOperations=i.completedOperations;i.allOperations.incompleteOperations=i.incompleteOperations;return i.allOperations},function(i){a.allOperations=i});a.showingOperations=a.allOperations.ongoingOperations;a.totalOperationCount=Object.keys(h.getAllOperations()).length;a.$watch(function(){return Object.keys(h.getAllOperations()).length},function(i){a.totalOperationCount=i});a.incompleteOperations=[];a.$watch(function(i){i.incompleteOperations.length=0;h.getOperationsWithState(c.OPERATION_STATE.ERROR,i.incompleteOperations);var j=[];h.getOperationsWithState(c.OPERATION_STATE.CANCEL,j);j.forEach(function(k){i.incompleteOperations.push(k)});return i.incompleteOperations},function(i){a.incompleteOperations=i});a.completedOperations=[];a.$watch(function(i){i.completedOperations.length=0;h.getOperationsWithState(c.OPERATION_STATE.COMPLETED,i.completedOperations);return i.completedOperations},function(i){a.completedOperations=i});a.waitingOperations=h.getWaitingOperations();a.ongoingOperations=h.getOngoingOperations();a.totalOngoingOperations=[];var b=0;a.$watch(function(j){b=j.totalOngoingOperations.length;if(j.totalOngoingOperations.length===Object.keys(j.ongoingOperations).length+j.waitingOperations.length){j.totalOngoingOperations.length=0}else{j.totalOngoingOperations=[]}for(var k in j.ongoingOperations){j.totalOngoingOperations.push(j.ongoingOperations[k])}j.waitingOperations.forEach(function(i){j.totalOngoingOperations.push(i)});return j.totalOngoingOperations},function(i){if(b<i.length){a.expandOrCollapseOperations(a.totalOngoingOperations,true,"ongoingOperations")}else{if(b!==0&&i.length===0){a.operationState.ongoingOperations=false}}a.totalOngoingOperations=i});a.expandOrCollapseOperations=function(l,k,j){var i=a.showingOperations!==l;a.operationState={ongoingOperations:false,completedOperations:false,incompleteOperations:false};a.operationState[j]=!a.isExpanded&&k;a.showingOperations=l;if(a.showingOperations.length===0){a.isExpanded=false;return}a.isExpanded=i&&a.showingOperations.length>0||!a.isExpanded};a.openModal=function(i){a.modalOpen.flag=true;a.detailOperation=i;a.detailCancelButtonText=i.state===c.OPERATION_STATE.ACTIVE?e.instant("operation.detail.cancel"):e.instant("operation.detail.close")};a.cancelOperation=function(i){if(i.state===c.OPERATION_STATE.ACTIVE){if(g.confirm(e.instant("operation.warning.cancel"))){d.log(c.PROGRESS_BAR.USER_CONFIRM_CANCEL_FROM_PROGRESS_BAR,1,i);h.cancelOperation(i)}}else{h.cancelOperation(i)}if(i===a.detailOperation){a.modalOpen.flag=false;a.detailOperation=null}};a.cancelFromDetailView=function(i){if(i.state===c.OPERATION_STATE.ACTIVE){if(g.confirm(e.instant("operation.warning.cancel"))){d.log(c.PROGRESS_BAR.USER_CONFIRM_CANCEL_FROM_DETAIL_MODAL,1,i);h.cancelOperation(i);a.modalOpen.flag=false}}else{a.modalOpen.flag=false}};a.closeDetailView=function(){a.modalOpen.flag=false;a.detailOperation=null};a.getIconForOperation=function(i){var l="cog",n="files-o",k="key",j="trash-o",m="upload";switch(i){case c.OPERATION_NAME.MAKE_PUBLIC:case c.OPERATION_NAME.CHANGE_STORAGE_CLASS:case c.OPERATION_NAME.CHANGE_METADATA:case c.OPERATION_NAME.INITIATE_RESTORE:return l;case c.OPERATION_NAME.CHANGE_SSE:return k;case c.OPERATION_NAME.DELETE_OBJECTS:case c.OPERATION_NAME.RESTORE_OBJECTS:case c.OPERATION_NAME.DELETE_BUCKET:case c.OPERATION_NAME.EMPTY_BUCKET:return j;case c.OPERATION_NAME.UPLOAD:return m;case c.OPERATION_NAME.COPY:case c.OPERATION_NAME.CUT:case c.OPERATION_NAME.ADD_OBJECT_TAG:case c.OPERATION_NAME.RENAME:return n}}}])})();"use strict";(function(){angular.module("s3").directive("detailProgress",[function(){return{restrict:"AE",templateUrl:"/s3/partials/detailprogress.html",scope:{isOpen:"=",cancelButtonText:"=",targetOperation:"=",closeCallback:"=?",cancelOperationFunction:"=?"},controller:"detailProgressController"}}]);angular.module("s3").controller("detailProgressController",["$scope","UtilService","S3Constants",function(b,a,c){b.deleteBucketOperationName=c.OPERATION_NAME.DELETE_BUCKET;b.UPLOAD_OPERATION=c.OPERATION_NAME.UPLOAD;b.isActiveUploadOperation=function(){return _.get(b.targetOperation,"name")===b.UPLOAD_OPERATION&&b.targetOperation.state===c.OPERATION_STATE.ACTIVE};b.shouldShowByteText=function(){return _.get(b.targetOperation,"name")===b.UPLOAD_OPERATION&&!b.targetOperation.parameters.isDeleteBucketSuccessful};b.getFileIconClass=function(d){return a.getIconClassFromFilename(d)}}])})();"use strict";(function(){angular.module("s3").directive("bucketVersioning",[function(){return{restrict:"E",scope:{cardOpen:"=",versioning:"=",forCreateBucketModal:"=?",id:"@?"},templateUrl:"/s3/partials/bucketversioning.html",controller:"BucketVersioningController"}}]);angular.module("s3").controller("BucketVersioningController",["$scope","$timeout","$translate","AwsUrlsService","BucketPropertiesService","ConsoleOperation","PathService","S3Constants","SCLogService","UtilService",a]);function a(p,d,b,e,f,k,l,i,o,n){p.docLink=e.getDocUrl(i.LEARN_MORE_LINKS.VERSIONING);p.versioningError=false;p.versioningStates={enable:"enable",disable:"disable"};var c="enable",j="disable";var h=new k("BucketVersioning","getVersioning");function g(){var s=document.getElementById(i.BUCKET_PROPERTIES.VERSIONING.CREATE_BUCKET_CARD);s.scrollIntoView()}p.cardSummaryObj=_.cloneDeep(i.CARD_SUMMARY_INIT);p.cardSummaryObj.inactiveSummary.text=b.instant("bucketproperty.disabled");p.cardSummaryObj.activeSummary.text=b.instant("bucketproperty.enabled");function r(){p.cardSummaryObj.isActive=p.versioning.selectedValue===p.versioningStates.enable}p.getBucketVersioning=function(){p.cardSummaryObj.isLoading=true;var s=l.getCurrentBucket();f.getBucketVersioning(s,h).then(function(t){p.versioningError=false;if(t==="Enabled"){p.versioning.selectedValue=angular.copy(p.versioningStates.enable)}else{p.versioning.selectedValue=angular.copy(p.versioningStates.disable)}p.cachedVersioning=angular.copy(p.versioning);r()})["catch"](function(t){p.versioningError=true;p.versioningErrorMessage=t;p.cachedVersioning=angular.copy(p.versioning)})["finally"](function(){p.cardSummaryObj.isLoading=false})};function q(s){if(p.versioning.selectedValue===c&&p.cachedVersioning.selectedValue===j){p.versioningWarningMsg=s?b.instant("bucketversioning.enablewarning"):null}else{if(p.versioning.selectedValue===j&&p.cachedVersioning.selectedValue===c){p.versioningWarningMsg=s?b.instant("bucketversioning.disablewarning"):null}else{p.versioningWarningMsg=null}}}p.updateWarningMsg=function(){m()};function m(){var s=new k(i.LIFECYCLE.BUCKET_LIFECYCLE);s.step=i.LIFECYCLE.GET_BUCKET_LIFECYCLE;f.getBucketLifecycle(l.getCurrentBucket(),s).then(function(){q(true)})["catch"](function(){q(false)})}if(p.forCreateBucketModal){p.$watch("cardOpen",function(t,s){d(g,1)});if(!_.isEmpty(p.versioning)&&p.versioning.errorMessage){p.versioningError=true;p.versioningErrorMessage=p.versioning.errorMessage}p.cachedVersioning=angular.copy(p.versioning);r()}else{p.scrollCardId="#"+p.id;p.getBucketVersioning()}p.cancelBucketVersioning=function(s){n.analyticsTrackClick(i.ANALYTICS.CANCEL_VERSIONING,i.ANALYTICS.DETAILS);s.stopPropagation();p.versioning=angular.copy(p.cachedVersioning);p.versioningError=false;p.versioningErrorMessage="";p.cardOpen=false;p.versioningWarningMsg=null};p.saveBucketVersioning=function(t){n.analyticsTrackClick(i.ANALYTICS.SAVE_VERSIONING,i.ANALYTICS.DETAILS);t.stopPropagation();p.versioningError=false;p.versioningErrorMessage="";var v;var s=null;if(!p.forCreateBucketModal){var u=l.getCurrentBucket();if(p.versioning.selectedValue===p.versioningStates.enable){v=f.enableBucketVersioning;s=new k("enableBucketVersioning")}else{v=f.disableBucketVersioning;s=new k("disableBucketVersioning")}v(u,s).then(function(){p.cachedVersioning.selectedValue=angular.copy(p.versioning.selectedValue);p.cardOpen=false;p.versioningWarningMsg=null;r()})["catch"](function(w){p.versioningError=true;p.versioningErrorMessage=w})}else{p.cachedVersioning=angular.copy(p.versioning);p.cardOpen=false;r()}}}})();"use strict";(function(){angular.module("s3").directive("bucketTagging",[function(){return{restrict:"E",scope:{cardOpen:"=",bucketTags:"=",forCreateBucketModal:"=?",id:"@?"},templateUrl:"/s3/partials/buckettagging.html",controller:"BucketTaggingController"}}]);angular.module("s3").controller("BucketTaggingController",["$scope","$timeout","$translate","APIProxyService","AwsUrlsService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","PathService","S3Constants","SCLogService","UtilService","XMLParser",a]);function a(p,d,b,c,e,f,j,l,m,i,o,n,k){p.docLink=e.getDocUrl(i.LEARN_MORE_LINKS.TAGGING);p.tagError=false;p.tagErrorMessage="";p.cachedBucketTags={tags:[]};p.tagCount=0;p.cardSummaryObj=_.cloneDeep(i.CARD_SUMMARY_INIT);function q(){p.cardSummaryObj.isActive=p.tagCount>0;if(p.tagCount>0){p.cardSummaryObj.activeSummary.text=p.tagCount+b.instant("bucketproperties.tagging.summarylable")}else{p.cardSummaryObj.inactiveSummary.text=p.tagCount+b.instant("bucketproperties.tagging.summarylable")}}p.cancelBucketTagging=function(r){n.analyticsTrackClick(i.ANALYTICS.CANCEL_TAGGING,i.ANALYTICS.DETAILS);r.stopPropagation();p.bucketTags.tags=angular.copy(p.cachedBucketTags.tags);p.tagError=false;p.tagErrorMessage="";p.cardOpen=false};p.removeTag=function(r){p.bucketTags.tags.splice(r,1)};p.addTag=function(){p.bucketTags.tags.push({Key:"",Value:""})};var h=new l("BucketTagging","getTagging");function g(){var r=document.getElementById(i.BUCKET_PROPERTIES.TAGGING.CREATE_BUCKET_CARD);r.scrollIntoView()}p.getBucketTags=function(){p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);p.cardSummaryObj.isLoading=true;o.log("getBucketTaggingReceived",1,h,{bucketName:m.getCurrentBucket()});c.getBucketProperty(h,m.getCurrentBucket(),"tagging").then(function(t){var r=t.response;o.logRequestComplete("getBucketTagging",h);p.tagError=false;if(r){var s=k.convertXmlStringToJson(r);if(s.Tagging){j.populateTagsFields(s,p.bucketTags.tags);p.tagCount=s.Tagging.TagSet.Tag.length||1}}p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);q()})["catch"](function(r){var s=n.handleErrors(r);if(r!==i.BUCKET_PROPERTIES.TAGGING.TAG_SET_NOT_EXIST_MESSAGE){o.log("getBucketTagging",0,h,{bucketName:m.getCurrentBucket(),error:r});p.tagError=true;p.tagErrorMessage=s}else{o.logRequestComplete("getBucketTagging",h)}p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);q()})["finally"](function(){p.cardSummaryObj.isLoading=false})};if(!p.forCreateBucketModal){p.scrollCardId="#"+p.id;p.getBucketTags()}else{p.$watch("cardOpen",function(s,r){d(g,1)});if(!_.isEmpty(p.bucketTags.tags)&&p.bucketTags.errorMessage){p.tagError=true;p.tagErrorMessage=p.bucketTags.errorMessage}p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);p.tagCount=p.bucketTags&&p.bucketTags.tags.length?p.bucketTags.tags.length:0;q()}p.saveBucketTagging=function(t){n.analyticsTrackClick(i.ANALYTICS.SAVE_TAGGING,i.ANALYTICS.DETAILS);t.stopPropagation();p.tagError=false;p.tagErrorMessage="";if(!p.forCreateBucketModal){var u=m.getCurrentBucket();var s=p.bucketTags.tags;var v=undefined;var r=null;if(s.length>0){v=f.putBucketTagging;r=new l("putBucketTagging")}else{v=f.deleteBucketTagging;r=new l("deleteBucketTagging")}v(u,s,r).then(function(){p.tagCount=p.bucketTags.tags.length;p.cardOpen=false;p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);q()})["catch"](function(w){p.tagError=true;p.tagErrorMessage=w})}else{p.cachedBucketTags.tags=angular.copy(p.bucketTags.tags);p.tagCount=p.bucketTags.tags.length;p.cardOpen=false;q()}}}})();"use strict";(function(){angular.module("s3").directive("bucketLogging",[function(){return{restrict:"E",scope:{cardOpen:"=",logging:"=",forCreateBucketModal:"=?",bucketList:"=?",createBucketValues:"=?",id:"@?"},templateUrl:"/s3/partials/bucketlogging.html",controller:"BucketLoggingController"}}]);angular.module("s3").controller("BucketLoggingController",["$scope","$timeout","$translate","APIProxyService","AwsUrlsService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","PathService","S3Constants","SCLogService","UtilService",a]);function a(n,r,o,p,b,j,g,l,d,m,c,s){n.saving=false;n.docLink=b.getDocUrl(m.LEARN_MORE_LINKS.LOGGING);n.cachedLogging={};n.logging.targetBucketOptions=[];n.loggingError=false;n.resetLoggingValue=true;n.loggingErrorMessage="";n.loggingState={enable:"enable",disable:"disable"};n.cancelBucketLogging=function(t){s.analyticsTrackClick(m.ANALYTICS.CANCEL_LOGGING,m.ANALYTICS.DETAILS);t.stopPropagation();n.logging=angular.copy(n.cachedLogging);n.cardOpen=false;n.loggingError=false;n.loggingErrorMessage="";f()};n.cardSummaryObj=_.cloneDeep(m.CARD_SUMMARY_INIT);n.cardSummaryObj.activeSummary.text=o.instant("bucketproperty.enabled");n.cardSummaryObj.inactiveSummary.text=o.instant("bucketproperty.disabled");f();function f(){n.cardSummaryObj.isActive=n.logging.selectedValue===n.loggingState.enable}function q(t){n.loggingError=true;n.loggingErrorMessage=t}function e(u,t){u.push({Grantee:{Type:m.BUCKET_PROPERTIES.GROUP_GANTEE_TYPE,DisplayName:"",EmailAddress:"",ID:"",URI:m.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:t})}function h(){var t=document.getElementById(m.BUCKET_PROPERTIES.LOGGING.CREATE_BUCKET_CARD);t.scrollIntoView()}function i(w,t,u){var v=arguments.length<=3||arguments[3]===undefined?null:arguments[3];if(_.isEmpty(v)){j.getBucketLocation(u).then(function(x){w.forEach(function(y){j.getBucketLocation(y.Name).then(function(z){if(x===z){t.push({value:y.Name,text:y.Name});n.cachedLogging.targetBucketOptions=_.cloneDeep(t)}})})})}else{t.push({value:n.createBucketValues.name,text:n.createBucketValues.name});n.cachedLogging.targetBucketOptions=_.cloneDeep(t);w.forEach(function(x){j.getBucketLocation(x.Name).then(function(y){if(v&&v.value===y){t.push({value:x.Name,text:x.Name});if(x.Name===n.logging.targetBucket&&n.resetLoggingValue){n.resetLoggingValue=false}n.cachedLogging.targetBucketOptions=_.cloneDeep(t)}})});if(n.createBucketValues.name===n.logging.targetBucket&&n.resetLoggingValue){n.resetLoggingValue=false}}}n.getBucketLogging=function(){var t=new l("BucketLogging","getLogging");var u=d.getCurrentBucket();n.cardSummaryObj.isLoading=true;c.log("getBucketLoggingReceived",1,t,{bucketName:u});t.step="listAllMyBuckets";p.listAllMyBuckets(t).then(function(x){var v=x.response;c.log("ListAllMyBuckets",1,t,{bucketName:u});var w=v.ListAllMyBucketsResult.Buckets.Bucket;i(w,n.logging.targetBucketOptions,u)})["catch"](function(v){c.log("ListAllMyBuckets",0,t,{bucketName:u,error:v});n.loggingError=true;n.loggingErrorMessage=s.handleErrors(v)});t.step="getBucketLogging";p.getBucketProperty(t,u,"logging").then(function(w){var v=w.response;n.loggingError=false;c.logRequestComplete("getBucketLogging",t);if(v){g.populateLoggingFields(v,n.logging);n.cachedLogging=angular.copy(n.logging);f()}})["catch"](function(v){c.log("getBucketLogging",0,t,{bucketName:u,error:v});n.loggingError=true;n.loggingErrorMessage=s.handleErrors(v);n.cachedLogging=angular.copy(n.logging)})["finally"](function(){n.cardSummaryObj.isLoading=false})};if(n.forCreateBucketModal){n.$watch("cardOpen",function(u,t){r(h,1)});i(n.bucketList,n.logging.targetBucketOptions,n.createBucketValues.name,n.createBucketValues.region);n.$watch("resetLoggingValue",function(t){if(t){n.logging.selectedValue=m.BUCKET_PROPERTIES.DISABLE;n.cachedLogging.selectedValue=angular.copy(n.logging.selectedValue);f()}});if(!_.isEmpty(n.logging)&&n.logging.errorMessage){n.loggingError=true;n.loggingErrorMessage=n.logging.errorMessage}n.cachedLogging=angular.copy(n.logging)}else{n.scrollCardId="#"+n.id;n.getBucketLogging()}function k(v,x,w,t,u){u.step=m.BUCKET_PROPERTIES.LOGGING.ENABLE_BUCKET_LOGGING;j.enableBucketLogging(v,x,w,t,u).then(function(){n.cachedLogging=_.cloneDeep(n.logging);f();n.cardOpen=false;n.saving=false})["catch"](function(y){q(y);n.saving=false})}n.saveBucketLogging=function(u){s.analyticsTrackClick(m.ANALYTICS.SAVE_LOGGING,m.ANALYTICS.DETAILS);u.stopPropagation();n.loggingError=false;n.loggingErrorMessage="";if(!n.forCreateBucketModal){var w;var v;var t;(function(){n.saving=true;var x=d.getCurrentBucket();w=n.logging.targetBucket;v=n.logging.targetPrefix;t=n.logging.targetGrants;if(!Array.isArray(t)){var y=t;t=[y]}if(n.logging.selectedValue===n.loggingState.enable){(function(){var z=new l(m.BUCKET_PROPERTIES.LOGGING.ENABLE_BUCKET_LOGGING);var A=false;z.step=m.BUCKET_PROPERTIES.GET_BUCKET_ACL;j.getBucketACL(w,z).then(function(B){var C=s.transformObjectToArray(B);if(_.findIndex(B,{Grantee:{URI:m.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:m.ACL_PERMISSIONS.WRITE})===-1){e(C,m.ACL_PERMISSIONS.WRITE);A=true}if(_.findIndex(B,{Grantee:{URI:m.BUCKET_PROPERTIES.LOG_DELIVERY_GROUP},Permission:m.ACL_PERMISSIONS.READ_ACP})===-1){e(C,m.ACL_PERMISSIONS.READ_ACP);A=true}if(A){z.step=m.BUCKET_PROPERTIES.PUT_BUCKET_ACL;j.putBucketACL(w,C,z).then(function(){k(x,w,v,t,z)})["catch"](function(D){q(D);n.saving=false})}else{k(x,w,v,t,z)}})["catch"](function(B){q(B);n.saving=false})})()}else{j.disableBucketLogging(x,new l("disableBucketLogging")).then(function(z){n.cachedLogging=_.cloneDeep(n.logging);f();n.cardOpen=false})["catch"](function(z){q(z)})["finally"](function(){n.saving=false})}})()}else{if(!n.logging.targetGrants){n.logging.targetGrants=[]}n.cachedLogging=angular.copy(n.logging);n.cardOpen=false;f()}}}})();"use strict";(function(){angular.module("s3").directive("bucketWebsite",[function(){return{restrict:"E",scope:{cardOpen:"=",website:"=",forCreateBucketModal:"=?",region:"=?",createBucketName:"=?",id:"@?"},templateUrl:"/s3/partials/bucketwebsite.html",controller:"BucketWebsiteController"}}]);angular.module("s3").controller("BucketWebsiteController",["$filter","$scope","$timeout","$translate","$window","APIProxyService","AwsUrlsService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","PathService","S3Constants","SCLogService","UtilService","XMLParser",a]);function a(m,o,r,p,l,q,b,h,e,k,d,n,c,s,t){o.docLinks={configure:b.getDocUrl(n.LEARN_MORE_LINKS.WEBSITE.configure),redirect:b.getDocUrl(n.LEARN_MORE_LINKS.WEBSITE.redirect),hosting:b.getDocUrl(n.LEARN_MORE_LINKS.WEBSITE.hosting)};o.websiteErrorMessage="";o.websiteError=false;o.bucketEndpoint="";o.websitePlaceholder=n.BUCKET_PROPERTIES.WEBSITE.INDEX_FILE;o.websiteStates={disable:"disable",useBucket:"useBucket",redirectRequest:"redirectRequest"};function g(){var u=document.getElementById(n.BUCKET_PROPERTIES.WEBSITE.CREATE_BUCKET_CARD);u.scrollIntoView()}o.cardSummaryObj=_.cloneDeep(n.CARD_SUMMARY_INIT);o.cardSummaryObj.inactiveSummary.text=p.instant("bucketproperty.disabled");function i(){o.cardSummaryObj.isActive=o.website.selectedValue!==o.websiteStates.disable;o.cardSummaryObj.activeSummary.text=o.website.selectedValue!==o.websiteStates.disable?o.website.websiteEnabledOption:""}o.cancelBucketWebsite=function(u){s.analyticsTrackClick(n.ANALYTICS.CANCEL_WEBSITE,n.ANALYTICS.DETAILS);u.stopPropagation();o.website=angular.copy(o.cachedWebsite);o.cardOpen=false;o.websiteError=false;o.websiteErrorMessage=""};o.shouldDisableSaveButton=function(){if(o.website.selectedValue===o.websiteStates.useBucket){return _.isEmpty(o.website.indexDocument)}else{if(o.website.selectedValue===o.websiteStates.redirectRequest){return _.isEmpty(o.website.targetDomain)}}return false};o.getBucketWebsite=function(){var v=d.getCurrentBucket();var u=new k("BucketWebsite","getWebsite");o.cardSummaryObj.isLoading=true;c.log("getBucketWebsiteReceived",1,u,{bucketName:v});q.getBucketProperty(u,v,"website").then(function(x){var w=x.response;c.logRequestComplete("getBucketWebsite",u);o.websiteError=false;e.populateWebsiteFields(w,o.website);o.cachedWebsite=angular.copy(o.website);i()})["catch"](function(x){var w=s.handleErrors(x);if(x!==n.BUCKET_PROPERTIES.WEBSITE.NO_WEBSITE_CONFIGURATION_MESSAGE){c.log("getBucketWebsite",0,u,{bucketName:v,error:x});o.websiteError=true;o.websiteErrorMessage=w}else{c.logRequestComplete("getBucketWebsite",u)}o.cachedWebsite=angular.copy(o.website)})["finally"](function(){o.cardSummaryObj.isLoading=false})};if(o.forCreateBucketModal){o.$watch("cardOpen",function(v,u){r(g,1)});if(!_.isEmpty(o.website)&&o.website.errorMessage){o.websiteError=true;o.websiteErrorMessage=o.website.errorMessage}var j=o.createBucketName;var f=n.BUCKET_PROPERTIES.WEBSITE.REGION_TO_WEBSITE_ENDPOINT_MAP[o.region];o.bucketEndpoint="http://"+j+"."+f;o.cachedWebsite=angular.copy(o.website)}else{(function(){o.scrollCardId="#"+o.id;var u=d.getCurrentBucket();h.getBucketLocation(u).then(function(w){var v=n.BUCKET_PROPERTIES.WEBSITE.REGION_TO_WEBSITE_ENDPOINT_MAP[w];o.bucketEndpoint="http://"+u+"."+v})["catch"](function(v){o.websiteError=true;o.websiteErrorMessage=v});o.getBucketWebsite()})()}o.openBucketEndpoint=function(){l.open(o.bucketEndpoint,"_blank")};o.saveBucketWebsite=function(w){s.analyticsTrackClick(n.ANALYTICS.SAVE_WEBSITE,n.ANALYTICS.DETAILS);w.stopPropagation();o.websiteError=false;o.websiteErrorMessage="";if(!o.forCreateBucketModal){var x=d.getCurrentBucket();if(o.website.selectedValue===o.websiteStates.useBucket){var z=!_.isEmpty(o.website.indexDocument)?s.encodeXml(o.website.indexDocument):"";var v=!_.isEmpty(o.website.errorDocument)?s.encodeXml(o.website.errorDocument):"";var B=!_.isEmpty(o.website.routingXML)?o.website.routingXML:"";var u=new k(n.BUCKET_PROPERTIES.WEBSITE.CONFIGURE_BUCKET_WEBSITE);h.configureBucketWebsite(x,z,v,B,u).then(function(){o.website.websiteEnabledOption=p.instant("bucketproperties.website.footer.buckethosting");o.website.websiteEnabledContent=angular.copy(o.website.indexDocument);o.cardOpen=false;o.website.targetDomain="";o.website.redirectRequestProtocol="";o.cachedWebsite=angular.copy(o.website);i()})["catch"](function(C){o.websiteError=true;o.websiteErrorMessage=C})}else{if(o.website.selectedValue===o.websiteStates.redirectRequest){var y=!_.isEmpty(o.website.targetDomain)?s.encodeXml(o.website.targetDomain):"";var A=!_.isEmpty(o.website.redirectRequestProtocol)?o.website.redirectRequestProtocol:"";var u=new k(n.BUCKET_PROPERTIES.WEBSITE.REDIRECT_BUCKET_WEBSITE_REQUESTS);h.redirectBucketWebsiteRequests(x,y,A,u).then(function(){o.website.websiteEnabledOption=p.instant("bucketproperties.website.footer.redirectallrequests");o.website.websiteEnabledContent=angular.copy(o.website.targetDomain);o.cardOpen=false;o.website.indexDocument="";o.website.errorDocument="";o.website.routingXML="";o.cachedWebsite=angular.copy(o.website);i()})["catch"](function(C){o.websiteError=true;o.websiteErrorMessage=C})}else{var u=new k("deleteBucketWebsite");h.deleteBucketWebsite(x,u).then(function(){o.cardOpen=false;e.clearAllWebsiteFields(o.website);o.cachedWebsite=angular.copy(o.website);i()})["catch"](function(C){o.websiteError=true;o.websiteErrorMessage=C})}}}else{o.cachedWebsite=angular.copy(o.website);o.cardOpen=false;i()}}}})();"use strict";(function(){angular.module("s3").directive("card",function(){return{restrict:"E",scope:{isOpen:"=",cardId:"=?",disableExpand:"=?",cardSummaryObj:"=?"},transclude:{header:"cardHeader",content:"cardContent",footer:"cardFooter"},templateUrl:"/s3/partials/card.html",controller:"CardController"}});angular.module("s3").controller("CardController",["$scope","$timeout","$translate","S3Constants","UtilService",a]);function a(c,e,f,d,b){c.openCard=function(){if(!c.disableExpand&&!c.cardSummaryObj.isLoading){c.isOpen=true}b.analyticsTrackClick(d.ANALYTICS.CARD_OPEN,d.ANALYTICS.DETAILS)};c.cardloadingMsg=f.instant("loading");if(c.cardId){c.$watch("isOpen",function(h,g){if(g!==h){e(function(){b.scrollCardToViewSmoothly(c.cardId)},1)}})}}})();"use strict";(function(){angular.module("s3").service("Md5GenerationService",function(){this.getContentMd5=function(a){return require("crypto").createHash("md5").update(a).digest("base64")}})})();"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};(function(){angular.module("s3").directive("bucketpermissions",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/bucketpermissions.html",controller:"BucketPermissionsController"}}]);angular.module("s3").controller("BucketPermissionsController",["$filter","$scope","$translate","AwsUrlsService","BucketPropertiesService","ConsoleOperation","PathService","S3Constants","SCLogService","UtilService","PermissionsUtilService",function(h,m,a,c,d,g,i,f,l,k,j){m.permissionTypes=[{text:a.instant("permissions.types.acl"),value:"acl"},{text:a.instant("permissions.types.policy"),value:"policy"},{text:a.instant("permissions.types.cors"),value:"cors"}];m.S3Constants=f;m.policyGenLink=f.BUCKET_PERMISSIONS.POLICY_GEN[k.getCloudSystem()];m.policyDocLink=c.getDocUrl(f.LEARN_MORE_LINKS.PERMISSIONS.POLICY);m.corsDocLink=c.getDocUrl(f.LEARN_MORE_LINKS.PERMISSIONS.CORS);m.permissions={};m.permissions.selectedItem=m.permissionTypes[0];m.bucket=i.getCurrentBucket();m.bucketARN=k.getBucketARN(m.bucket);m.gettingPolicy=true;m.gettingCors=true;m.corsChanged=false;m.policyChanged=false;var e=new g("BucketPermissions","getPermissions");l.log("GetBucketPermissions",1,e,{bucketName:m.bucket});d.getBucketGrantees(m.bucket,e).then(function(n){m.permissionObj={};m.permissionObj.grantees=j.updateGrantees(n);d.getBucketACL(m.bucket,e).then(function(o){m.permissionObj.aclGrants=[];if(o){m.permissionObj.aclGrants=Array.isArray(o)?o:[o]}})["catch"](function(o){m.error=o})})["catch"](function(n){m.error=n});d.getBucketPolicy(m.bucket,e,false).then(function(n){m.policy=b(n)})["catch"](function(n){m.error=n})["finally"](function(){m.gettingPolicy=false});d.getBucketCORS(m.bucket,e).then(function(n){if(n){m.cors=k.formatXml(n)}else{m.cors=f.BUCKET_PERMISSIONS.SAMPLE_CORS_POLICY}})["catch"](function(n){m.error=n})["finally"](function(){m.gettingCors=false});m.showView=function(n){switch(n){case f.BUCKET_PERMISSION_TYPE.CORS:m.permissions.selectedItem={text:a.instant("permissions.types.cors"),value:f.BUCKET_PERMISSION_TYPE.CORS};return;case f.BUCKET_PERMISSION_TYPE.ACL:m.permissions.selectedItem={text:a.instant("permissions.types.acl"),value:f.BUCKET_PERMISSION_TYPE.ACL};return;case f.BUCKET_PERMISSION_TYPE.POLICY:m.permissions.selectedItem={text:a.instant("permissions.types.policy"),value:f.BUCKET_PERMISSION_TYPE.POLICY};return}};m.putAcl=function(n){return d.putBucketACL(m.bucket,n,new g("putBucketACL"))};m.save=function(){if(m.isDeleting){return}m.error=undefined;m.isSaving=true;if(m.permissions.selectedItem.value==="cors"){(function(){var n=k.formatXml(m.corsEditorSession.getDocument().getValue());m.corsEditorSession.getDocument().setValue(n);d.putBucketCORS(m.bucket,n.trim(),new g("putBucketCORS")).then(function(){m.corsChanged=false;m.cors=n})["catch"](function(o){m.error=o})["finally"](function(){m.isSaving=false})})()}else{if(m.permissions.selectedItem.value==="policy"){(function(){var n=m.policyEditorSession.getDocument().getValue();d.putBucketPolicy(m.bucket,n.trim(),new g("putBucketPolicy")).then(function(){m.policyChanged=false;m.policy=b(JSON.parse(n))})["catch"](function(o){m.error=o})["finally"](function(){m.isSaving=false})})()}}};m.deletePermission=function(){if(m.isSaving){return}m.error=undefined;m.isDeleting=true;if(m.permissions.selectedItem.value==="cors"){d.deleteBucketCORS(m.bucket,new g("deleteBucketCORS")).then(function(){m.corsEditorSession.getDocument().setValue("");m.cors=undefined;m.corsChanged=false})["catch"](function(n){m.error=n})["finally"](function(){m.isDeleting=false})}else{if(m.permissions.selectedItem.value==="policy"){d.deleteBucketPolicy(m.bucket,new g("deleteBucketPolicy")).then(function(){m.policyEditorSession.getDocument().setValue("");m.policy=undefined;m.policyChanged=false})["catch"](function(n){m.error=n})["finally"](function(){m.isDeleting=false})}}};m.cancel=function(){if(m.isSaving||m.isDeleting){return}m.error=undefined;if(m.permissions.selectedItem.value==="cors"){if(m.cors){m.corsEditorSession.getDocument().setValue(k.formatXml(m.cors))}else{m.corsEditorSession.getDocument().setValue("")}m.corsChanged=false}else{if(m.permissions.selectedItem.value==="policy"){if(m.policy){m.policyEditorSession.getDocument().setValue(m.policy)}else{m.policyEditorSession.getDocument().setValue("")}m.policyChanged=false}}};m.clearError=function(){m.error=undefined};m.policyEditorLoaded=function(n){m.policyEditorSession=n.getSession();if(m.policy){if(_typeof(m.policy)==="object"){m.policy=b(m.policy)}m.policyEditorSession.getDocument().setValue(m.policy)}m.policyChanged=false};m.policyEditorChanged=function(n){m.policyChanged=true};m.corsEditorLoaded=function(n){m.corsEditorSession=n.getSession();if(m.cors){m.corsEditorSession.getDocument().setValue(k.formatXml(m.cors))}m.corsChanged=false};m.corsEditorChanged=function(n){m.corsChanged=true};m.disableSave=function(){if(m.isDeleting){return true}if(m.permissions.selectedItem.value==="policy"){return m.policyEditorSession&&m.policyEditorSession.getDocument().getValue()===""||!m.policyChanged}return m.corsEditorSession&&m.corsEditorSession.getDocument().getValue()===""||!m.corsChanged};function b(n){return JSON.stringify(n,null,"    ")}}])})();"use strict";(function(){angular.module("s3").directive("dropdown",function(){return{restrict:"E",controller:"DropdownController",scope:{items:"=",selectedItem:"=",filter:"=",placeholder:"@",disabled:"=?",enableInput:"=?",inputField:"=?"},templateUrl:"/s3/partials/dropdown.html"}});angular.module("s3").controller("DropdownController",["$filter","$scope","S3Constants","$translate","$window",function(d,a,b,c,e){a.filterColumn="text";a.tableFiltering={filter:{}};a.getDisplayWidth=function(){return parseInt($("#current-displayed-table").width()/10)*10*0.9};angular.element(e).on("resize",function(){$(".truncate-dropdown").css({width:a.getDisplayWidth()})});if(!a.placeholder){a.selectedItem=a.items[0]}a.tableFiltering.filter[a.filterColumn]=a.defaultFilterValue;a.updateInput=function(f){a.selectedItem=f;f.error=null};a.filterBlur=function(){if(!a.tableFiltering.filter[a.filterColumn]){a.tableFiltering.showClear=false}};a.clearFilter=function(){a.tableFiltering.filter[a.filterColumn]="";a.tableFiltering.showClear=false};a.filterKeyDown=function(f){if(f&&f.keyCode===b.KEY_CODES.ESC){$(".input-field").blur();a.clearFilter()}};a.$watch(function(){return a.tableFiltering.filter[a.filterColumn]},function(g,f){if(f!==g){a.totalItems=d("filter")(a.items,a.tableFiltering.filter).length}});a.toggleDropDown=function(f){if(!f){a.isOpen=!a.isOpen}};a.closeDropDown=function(){a.isOpen=false};a.selectItem=function(f){a.selectedItem=_.cloneDeep(f);if(a.enableInput&&a.inputField){a.inputField.text=f.text||f;a.inputField.error=null}if(a.selectedItem.displayTextField){a.selectedItem.inputValue=a.selectedItem.value}a.closeDropDown()};a.toggleBucket=function(f,g){g.isExpanded=!g.isExpanded;f.stopPropagation()}}])})();"use strict";(function(){angular.module("s3").directive("versionsDropdown",function(){return{restrict:"E",controller:"VersionsDropdownController",scope:{selectedTab:"=?",bucket:"=",error:"=",getMetadata:"&?",setUpMetadata:"&?",key:"=",obj:"=",showVersionsDropdown:"=",objectsPage:"=?",updateObjMetadata:"&?",updateObjAcl:"&?",refresh:"&?",objectPropertiesPanel:"=?",tabs:"=?",versions:"=?",versionsDropdownSelectedObject:"=?"},templateUrl:"/s3/partials/versionsdropdown.html"}});angular.module("s3").controller("VersionsDropdownController",["$filter","$scope","$window","$location","$translate","CachingService","ConsoleOperation","DeleteService","ObjectPropertiesService","S3Constants","S3CWSAPIService","SCLogService","UtilService",function(j,n,c,h,b,a,i,d,g,f,l,m,k){function e(){var o="ListVersionsCompleted",p=new i(f.OPERATION_NAME.LIST_VERSIONS);g.listVersions(n.bucket,n.key,p).then(function(q){n.versions=q;n.obj.versionId=q&&q[0]&&q[0].VersionId;m.log(o,1,p,{objectKey:n.key,versions:q})})["catch"](function(q){n.error=q;p.error=q;p.errorMessage=b.instant("versionsdropdown.errorMessage");m.log(o,0,p,q)})}n.closeDropdown=function(){n.showVersionsDropdown.show=false};n.deleteVersion=function(r,p){r.stopPropagation();if(!p||!p.Key){return}if(p.deleteDisabled){return}var o="DeleteVersion",q=new i(o);d.deleteKeysAndVersions(q,[{Key:p.Key,VersionId:p.VersionId}],{}).then(function s(v){var w=p.IsLatest==="true";var t=n.versions.length,u=Object.keys(v.result).length;n.versions=_.filter(n.versions,function(y){var x=v.result[y.Key+":"+y.VersionId],z=x?x.status:"";return z!==f.OPERATION_PER_KEY_STATUS.DONE});if(u!==1){m.log(q.name+"MoreThanOne",1,q,v.result)}else{if(n.versions.length!==t-u){m.log(q.name+"AlreadyDeleted",1,q,v.result)}}a.setCurrentVersions(p.Key,n.versions);if(n.objectsPage&&(_.isEmpty(n.versions)||w)){n.refresh();n.objectPropertiesPanel.show=false}})["catch"](function(t){n.error=t})};n.downloadVersion=function(r,o){r.stopPropagation();if(o.downloadDisabled){return}var q={"Content-Disposition":"attachment"};var p=new i("objectDownload","objDLPresignFetchStart");l.fetchPresignedUrl(n.bucket,o.Key,"GET",q,{versionId:o.VersionId},null,null,p).then(function(s){c.location.href=s.data.presignedUrl;m.log("fetchPresignedUrl",1,p,{bucket:n.bucket,key:o.Key})})["catch"](function(s){m.log("fetchPresignedUrl",0,p,s);n.error=s})};n.switchVersion=function(q,o){var p=new i(f.OPERATION_NAME.SWITCH_VERSION);q.stopPropagation();m.log(f.OPERATION_NAME.SWITCH_VERSION,1,p,{version:o});if(o.ETag&&!n.objectsPage){n.getMetadata({operation:p,versionId:o.VersionId})}n.obj.versionId=o.VersionId;n.obj.ETag=k.extractFromQuotes(o.ETag);n.obj.IsLatest=o.IsLatest;if(_.isArray(n.tabs)&&_.size(n.tabs)>1){n.tabs[f.TABS.OBJECT_DETAILS.PERMISSIONS]["disabled"]=o.IsLatest!=="true"}n.obj.Key=o.Key;if(n.obj.Key.lastIndexOf("/")!==-1){n.obj.Key=n.obj.Key.substring(n.obj.Key.lastIndexOf("/")+1)}n.obj.LastModified=o.LastModified;n.obj.Owner=o.Owner;n.obj.Size=o.Size;n.obj.StorageClass=f.STORAGE_CLASSES[o.StorageClass];n.obj.versionLabel=o.IsLatest==="true"?b.instant("versionsdropdown.label.latestVersion"):j("date")(o.LastModified,"medium");n.showVersionsDropdown.show=false;if(n.selectedTab){n.selectedTab="overview"}n.versionsDropdownSelectedObject=_.cloneDeep(o);if(n.objectsPage){var r=angular.copy(n.obj);n.setUpMetadata({obj:r});n.updateObjAcl({obj:r});n.updateObjMetadata({obj:r})}};if(_.isEmpty(n.versions)){e()}}])})();"use strict";(function(){angular.module("s3").directive("editor",[function(a,c){return{restrict:"AE",scope:{code:"=",mode:"=",readonly:"=",onLoad:"&"},templateUrl:"/s3/partials/editor.html",link:{pre:function d(f,g,e){a.fullscreen=false;f.theme="dawn";var h=function h(j,i){f.editor.setTheme("ace/theme/"+j)};f.toggleFullscreen=function(i){a.fullscreen=!a.fullscreen;if(i){f.$apply()}c(function(){f.editor.resize()})};f.themes=["cobalt","dawn","eclipse","monokai","solarized_dark"].map(function(i){return{value:i,text:window.messages.ide.theme[i]}});f.modals={settings:{open:false}};f.saveSettings=function(){f.theme=f.modals.settings.theme;h(f.theme,true);f.modals.settings.open=false};f.aceLoaded=function(i){f.editor=i;i.$blockScrolling=Infinity;i.resize(true);c(function(){h(f.theme)});f.onLoad({editor:f.editor})}},post:function b(e){e.$watch("mode",function(){if(!e.mode){return}e.editor.session.setMode("ace/mode/"+e.mode)});e.$watch("readonly",function(){e.editor.setReadOnly(e.readonly)})}}}}])})();"use strict";(function(){angular.module("s3").service("OperationDispatcherService",["PathService","$interval","ConsoleOperation","S3Constants","SCLogService","APIProxyService",function(j,h,i,g,l,d){var m=20;var e=5;var b={};var f={};var a=[];this.addOperation=function(n){for(var o in f){l.log("HaveConflictingOperation",this.isConflict(f[o],n)?1:0,n,{},Date())}b[n.id]=n;if(!n.finishCallBack){n.finishCallBack=this.operationDoneCallBack}n.errorCallBack=this.operationErrorCallBack;if(k(n)){f[n.id]=n;n.state=g.OPERATION_STATE.ACTIVE;l.log(g.OPERATION_MANAGER_LOGGING.STARTED,1,n);n.start()}else{n.state=g.OPERATION_STATE.WAITING;l.log(g.OPERATION_MANAGER_LOGGING.ENQUEUED,1,n);a.push(n)}l.log(g.OPERATION_MANAGER_LOGGING.ADDED,1,n)};this.getOngoingOperations=function(){return f};this.getWaitingOperations=function(){return a};this.getOperationById=function(n){return b[n]};this.getAllOperations=function(){return b};this.getOperationsWithState=function(o,n){for(var p in b){if(b[p].state===o){n.push(b[p])}}};var k=function k(n){if(Object.keys(f).length<m){if(n.initialBucket){var s={};d.getBucketLocation(n,n.initialBucket,s);var r=s.region;var q=0;for(var o in f){var p={};d.getBucketLocation(n,f[o].initialBucket,p);if(p.region===r){q+=1}}return q<e}return true}return false};this.operationDoneCallBack=function(n){if(b[n].state===g.OPERATION_STATE.COMPLETED){return}b[n].state=g.OPERATION_STATE.COMPLETED;b[n].defer.resolve(b[n].errorDetails);l.log(g.OPERATION_MANAGER_LOGGING.COMPLETED,1,b[n]);delete f[n];c()};this.operationErrorCallBack=function(n){b[n].state=g.OPERATION_STATE.ERROR;b[n].defer.reject(b[n].errorDetails);l.log(g.OPERATION_MANAGER_LOGGING.ERROR,1,b[n]);delete f[n];c()};this.cancelOperation=function(n){if(n.id in f){delete f[n.id];c();n.cancel();n.state=g.OPERATION_STATE.CANCEL}else{if(n.state===g.OPERATION_STATE.WAITING){n.cancel();for(var o=0;o<a.length;o++){if(a[o]===n){a.splice(o,1);break}}}delete b[n.id]}l.log(g.OPERATION_MANAGER_LOGGING.CANCELED,1,n)};var c=function c(){for(var o=0;o<a.length;o++){if(k(a[o])){var n=a[o];n.state=g.OPERATION_STATE.ACTIVE;l.log(g.OPERATION_MANAGER_LOGGING.DEQUEUED,1,n);f[n.id]=n;a.splice(o,1);n.start();l.log(g.OPERATION_MANAGER_LOGGING.STARTED,1,n);break}}};this.isConflict=function(o,n){if(o.initialBucket!==undefined&&n.initialBucket!==undefined&&o.initialBucket===n.initialBucket){if(o.initialPath.length>n.initialPath.length){return o.initialPath.lastIndexOf(n.initialPath)>=0}else{return n.initialPath.lastIndexOf(o.initialPath)>=0}}return false};this.setMaximumOngoingOperation=function(n){m=n};this.setMaximumOngoingOperationsPerRegion=function(n){e=n}}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").service("BulkOperationService",["$translate","ConsoleOperation","SCLogService","S3Service","Md5GenerationService","PathService","S3Constants","ObjectListingService","OperationDispatcherService","ListVerificationService","APIProxyService","$q","DeleteService","CopyService","OperationUtilService","$filter",function(y,g,h,q,H,C,I,n,w,s,E,d,z,x,k,D){var b,G,t;var u=(b={},_defineProperty(b,I.OPERATION_NAME.DELETE_OBJECTS,z.deleteKeysAndVersions),_defineProperty(b,I.OPERATION_NAME.RESTORE_OBJECTS,z.deleteKeysAndVersions),_defineProperty(b,I.OPERATION_NAME.EMPTY_BUCKET,z.deleteKeysAndVersions),_defineProperty(b,I.OPERATION_NAME.DELETE_BUCKET,z.deleteKeysAndVersions),_defineProperty(b,I.OPERATION_NAME.MAKE_PUBLIC,k.defaultCWSBulkOperationCaller),_defineProperty(b,I.OPERATION_NAME.COPY,x.copyObjects),_defineProperty(b,I.OPERATION_NAME.CUT,x.copyObjects),_defineProperty(b,I.OPERATION_NAME.RENAME,x.copyObjects),_defineProperty(b,I.OPERATION_NAME.CHANGE_SSE,k.defaultCWSBulkOperationCaller),_defineProperty(b,I.OPERATION_NAME.CHANGE_STORAGE_CLASS,k.defaultCWSBulkOperationCaller),_defineProperty(b,I.OPERATION_NAME.CHANGE_METADATA,k.defaultCWSBulkOperationCaller),_defineProperty(b,I.OPERATION_NAME.INITIATE_RESTORE,k.defaultCWSBulkOperationCaller),_defineProperty(b,I.OPERATION_NAME.ADD_OBJECT_TAG,k.defaultCWSBulkOperationCaller),b);var e=(G={},_defineProperty(G,I.OPERATION_NAME.DELETE_OBJECTS,y.instant("operationname.deleteobjects")),_defineProperty(G,I.OPERATION_NAME.RESTORE_OBJECTS,y.instant("operationname.undodelete")),_defineProperty(G,I.OPERATION_NAME.EMPTY_BUCKET,y.instant("operationname.emptybucket")),_defineProperty(G,I.OPERATION_NAME.DELETE_BUCKET,y.instant("operationname.deletebucket")),_defineProperty(G,I.OPERATION_NAME.MAKE_PUBLIC,y.instant("operationname.makepublic")),_defineProperty(G,I.OPERATION_NAME.COPY,y.instant("operationname.copy")),_defineProperty(G,I.OPERATION_NAME.CUT,y.instant("operationname.cut")),_defineProperty(G,I.OPERATION_NAME.RENAME,y.instant("operationname.rename")),_defineProperty(G,I.OPERATION_NAME.CHANGE_SSE,y.instant("operationname.changesse")),_defineProperty(G,I.OPERATION_NAME.CHANGE_STORAGE_CLASS,y.instant("operationname.changestorageclass")),_defineProperty(G,I.OPERATION_NAME.CHANGE_METADATA,y.instant("operationname.changemetadata")),_defineProperty(G,I.OPERATION_NAME.INITIATE_RESTORE,y.instant("operationname.initiaterestore")),_defineProperty(G,I.OPERATION_NAME.ADD_OBJECT_TAG,y.instant("operationname.addtags")),G);var B=(t={},_defineProperty(t,I.OPERATION_NAME.DELETE_OBJECTS,v),_defineProperty(t,I.OPERATION_NAME.RESTORE_OBJECTS,v),_defineProperty(t,I.OPERATION_NAME.EMPTY_BUCKET,v),_defineProperty(t,I.OPERATION_NAME.DELETE_BUCKET,v),_defineProperty(t,I.OPERATION_NAME.MAKE_PUBLIC,v),_defineProperty(t,I.OPERATION_NAME.COPY,p),_defineProperty(t,I.OPERATION_NAME.CUT,p),_defineProperty(t,I.OPERATION_NAME.RENAME,p),_defineProperty(t,I.OPERATION_NAME.CHANGE_SSE,p),_defineProperty(t,I.OPERATION_NAME.CHANGE_STORAGE_CLASS,p),_defineProperty(t,I.OPERATION_NAME.CHANGE_METADATA,p),_defineProperty(t,I.OPERATION_NAME.INITIATE_RESTORE,v),_defineProperty(t,I.OPERATION_NAME.ADD_OBJECT_TAG,v),t);var f={createBulkOperation:l,listAndOperateObjectsRecursively:i,updateUIWithSuccessResponse:a,populateErrorDetails:J,completeOperation:F,updateUIWithError:o,getOperationAPIMap:r,getOperationCompleteCallBack:A,shouldListVersion:m,updateProgress:j,updateOperationProgressBasedOnFileCount:v,updateOperationProgressBasedOnSize:p};return f;function l(L,P,K,N,O){if(P.length===0&&K.length===0){throw"No keys or folders were passed in for "+L+" operation"}var M=new g(L);M.displayName=e[M.name];M.selectedKeys=angular.copy(P);M.selectedKeys.forEach(function(Q){Q.Key=Q.Path?Q.Path+Q.Key:M.initialPath+Q.Key});M.selectedFolders=angular.copy(K);if(!c(M)){M.selectedFolders.forEach(function(Q){Q.Prefix=M.initialPath+Q.Prefix+I.DELIMITER});if(M.selectedFolders.length>0){M.originFolders=angular.copy(K)}}M.totalObjectCount=N;M.totalOperatedObjectCount=0;M.start=function(){var T=M.additionalInfo?M.additionalInfo:O;var Q=function Q(V){f.updateUIWithSuccessResponse(V)};var U=function U(V){f.updateUIWithError(V)};var R=function R(V){f.updateProgress(V)};if(M.selectedKeys.length>0){for(var S=0;S<P.length/T.numberOfKeysPerBulkOperation;S++){u[L](M,M.selectedKeys.slice(S*T.numberOfKeysPerBulkOperation,(S+1)*T.numberOfKeysPerBulkOperation),T).then(Q,U,R)}}if(M.selectedFolders.length>0){f.listAndOperateObjectsRecursively(M,null,T)}};M.cancel=function(){M.state=I.OPERATION_STATE.CANCEL};M.finishCallBack=f.getOperationCompleteCallBack(M);h.log(L.replace(/\s/g,"")+"OperationCreated",1,M);return M}function i(K,M,L){if(!M&&K.state===I.OPERATION_STATE.ACTIVE||M.truncated&&K.state===I.OPERATION_STATE.ACTIVE){n.getBatchOfItems(K,M?M.marker:null,L.numberOfKeysPerBulkOperation,false,m(K,L),M?M.versionIdMarker:null,K.selectedFolders,null).then(function(N){h.log(K.name.replace(/\s/g,"")+"FolderListing",1,K,N);if(N.keys.length>0){u[K.name](K,N.keys,L).then(function(O){f.updateUIWithSuccessResponse(O);f.listAndOperateObjectsRecursively(K,N,L)},function(O){f.updateUIWithError(O)},function(O){f.updateProgress(O)})}else{f.completeOperation(K)}})["catch"](function(N){h.log(K.name.replace(/\s/g,"")+"FolderListing",0,K,N);f.updateUIWithError({operation:K,result:N})})}else{if(K.state===I.OPERATION_STATE.CANCEL){return}else{f.completeOperation(K)}}}function j(N){var L=N.operation;var K=N.result;if(N.updateType===I.OPERATION_PROGRESS_UPDATE_TYPE.SINGLE_PART_RESULTS){L.totalOperatedObjectCount+=Object.keys(K).length;B[L.name](N);f.populateErrorDetails(L,K)}else{if(N.updateType===I.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_RESULT||N.updateType===I.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_COMPLETE){L.successPercentage+=K/L.totalSizeInBytes*100;L.progressPercentage=L.successPercentage+L.errorPercentage;if(N.updateType===I.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_COMPLETE){L.succeedKeyCount+=1;L.totalOperatedObjectCount+=1}}else{if(N.updateType===I.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_ERROR){L.errorPercentage+=K/L.totalSizeInBytes*100;L.progressPercentage=L.successPercentage+L.errorPercentage;L.failedKeyCount+=1;L.totalOperatedObjectCount+=1;var M={};M[N.keys[0]]={status:I.OPERATION_PER_KEY_STATUS.ERROR,errorMessage:N.error};f.populateErrorDetails(L,M)}}}if(N.isLastOne){N.notifyDefer.resolve(N)}if(L.totalOperatedObjectCount===L.totalObjectCount&&L.selectedFolders.length===0){f.completeOperation(L)}}function a(M){if(M.updateType!==I.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_ALL_COMPLETE){var L=M.operation;var K=M.result;L.totalOperatedObjectCount+=Object.keys(K).length;B[L.name](M);f.populateErrorDetails(L,K);if(L.totalOperatedObjectCount===L.totalObjectCount&&L.selectedFolders.length===0){f.completeOperation(L)}}}function p(M){var L=M.operation;var O=M.keys;var K=M.result;var P=0;var N=0;if(L.totalSizeInBytes===0){f.updateOperationProgressBasedOnFileCount(M);return}Object.keys(K).forEach(function(Q){if(K[Q].status===I.OPERATION_PER_KEY_STATUS.DONE){L.succeedKeyCount+=1;O.forEach(function(R){if(R.Key===Q){P+=R.Size}})}else{L.failedKeyCount+=1;O.forEach(function(R){if(R.Key===Q){N+=R.Size}})}});L.defer.notify();L.successPercentage+=P/L.totalSizeInBytes*100;L.errorPercentage+=N/L.totalSizeInBytes*100;L.progressPercentage=L.successPercentage+L.errorPercentage}function v(M){var L=M.operation;var K=M.result;Object.keys(K).forEach(function(N){if(K[N].status===I.OPERATION_PER_KEY_STATUS.DONE){L.succeedKeyCount+=1}else{L.failedKeyCount+=1}});L.defer.notify();L.progressPercentage=L.totalOperatedObjectCount/L.totalObjectCount*100;L.successPercentage=L.succeedKeyCount/L.totalObjectCount*100;L.errorPercentage=L.failedKeyCount/L.totalObjectCount*100}function F(K){if(K.state===I.OPERATION_STATE.COMPLETED){return}if(c(K)){K.totalObjectCount=K.totalOperatedObjectCount;if(K.totalObjectCount===0){K.errorPercentage=0}else{K.errorPercentage=K.failedKeyCount/K.totalObjectCount*100}K.errorTypes.forEach(function(L){L.errorPercentage=Number(L.errorCount/K.totalObjectCount*100).toFixed(2)})}K.successPercentage=Number(100-K.errorPercentage).toFixed(2);K.progressPercentage=100;h.log(K.name.replace(/\s/g,"")+"Success",1,K);if(K.errorPercentage===0){K.parameters.operationSuccessful=true}else{if(K.successPercentage===0){K.parameters.operationUnsuccessful=true}else{K.parameters.operationPartiallySuccessful=true}}if(K.name===I.OPERATION_NAME.DELETE_BUCKET){K.successPercentage/=2;K.errorPercentage/=2;if(K.errorPercentage!==0&&K.name===I.OPERATION_NAME.DELETE_BUCKET){K.errorPercentage+=50}K.errorTypes.forEach(function(L){L.errorPercentage=Number(L.errorCount/K.totalObjectCount*100).toFixed(2);L.errorPercentage/=2})}if(K.errorPercentage!==0){K.errorCallBack(K.id)}else{K.finishCallBack(K.id)}}function o(K){var L=K.operation;L.defer.notify();h.log(L.name.replace(/\s/g,"")+"Success",0,L,K);L.errorPercentage=100-L.progressPercentage;if(L.name===I.OPERATION_NAME.DELETE_BUCKET){L.errorPercentage=L.errorPercentage/2;L.errorPercentage+=50}L.errorCallBack(L.id)}function A(K){if(K.name===I.OPERATION_NAME.DELETE_BUCKET){return function(){E.deleteBucket(K).then(function(){K.parameters.isDeleteBucketSuccessful=true;K.successPercentage+=50;h.log("DeleteBucketRequest",1,K);w.operationDoneCallBack(K.id)})["catch"](function(L){K.errorPercentage+=50;K.parameters.isDeleteBucketSuccessful=false;h.log("DeleteBucketRequest",0,K,L);if(L&&L.Error&&L.Error.Message){K.errorMessage=L.Error.Message}else{K.errorMessage=y.instant("operation.errormessage.cantdeletebucket")}w.operationErrorCallBack(K.id)})}}else{return K.finishCallBack}}function J(K,L){Object.keys(L).forEach(function(M){if(L[M].status!==I.OPERATION_PER_KEY_STATUS.DONE){(function(){var N=L[M].errorMessage;var O=_.filter(K.errorTypes,function(P){return P.errorMessage===N});if(O.length===0){K.errorTypes.push({errorMessage:N,errorCount:1,errorPercentage:Number(1/K.totalObjectCount*100).toFixed(2)})}else{O[0].errorCount+=1;O[0].errorPercentage=Number(O[0].errorCount/K.totalObjectCount*100).toFixed(2)}if(K.errorDetails[N]){if(K.errorDetails[N].length<I.BULK_OPERATION_KEY_COUNT_PER_ERROR_TYPE){K.errorDetails[N].push(M)}}else{K.errorDetails[N]=[M]}})()}})}function m(K,L){if(K.name===I.OPERATION_NAME.EMPTY_BUCKET||K.name===I.OPERATION_NAME.DELETE_BUCKET){return L.versioning==="Enabled"||L.versioning==="Suspended"}return false}function c(K){return K.name===I.OPERATION_NAME.EMPTY_BUCKET||K.name===I.OPERATION_NAME.DELETE_BUCKET}function r(){return u}}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").service("OperationUtilService",["ConsoleOperation","FAC","MultipartCopyService","SCLogService","S3Service","S3Constants","S3CWSAPIService","APIProxyService","$q",function(l,j,A,c,x,n,d,s,u){var y;var i="BulkOpKeyCountMatch";var e="BulkOpKeyCountMismatch";var g="ObjectCount";var w="RequestFailed";var f="GetBucketLocationError";var p=[n.OPERATION_NAME.CHANGE_METADATA,n.OPERATION_NAME.CHANGE_SSE,n.OPERATION_NAME.CHANGE_STORAGE_CLASS];var m=(y={},_defineProperty(y,n.OPERATION_NAME.MAKE_PUBLIC,n.CWS_OPERATION_NAME.MAKE_PUBLIC),_defineProperty(y,n.OPERATION_NAME.CHANGE_SSE,n.CWS_OPERATION_NAME.CHANGE_SSE),_defineProperty(y,n.OPERATION_NAME.CHANGE_STORAGE_CLASS,n.CWS_OPERATION_NAME.CHANGE_STORAGE_CLASS),_defineProperty(y,n.OPERATION_NAME.CHANGE_METADATA,n.CWS_OPERATION_NAME.CHANGE_METADATA),_defineProperty(y,n.OPERATION_NAME.INITIATE_RESTORE,n.CWS_OPERATION_NAME.INITIATE_RESTORE),_defineProperty(y,n.OPERATION_NAME.ADD_OBJECT_TAG,n.CWS_OPERATION_NAME.ADD_OBJECT_TAG),y);var z={handleCWSSuccessResponse:o,handleCWSErrorResponse:k,handleGetBucketLocationError:h,initializeBulkOperationResult:a,defaultCWSBulkOperationCaller:v,generateParameterForSpecificOperation:b,verifyKeysMatching:q,getAllSinglePartCopyResult:t,verifyInput:r};return z;function a(B,C){return{operation:B,keys:C,result:{},error:null,updateType:""}}function b(B,D,C,E){var G={};var F=_.pluck(D,"Key");G.bucket=B.initialBucket;G.keys=F;G.region=E;if(B.name===n.OPERATION_NAME.CHANGE_STORAGE_CLASS){G.storageClass=C.targetStorageClass}else{if(B.name===n.OPERATION_NAME.CHANGE_SSE){G.sseAlgo=C.sseAlgo;if(C.sseKmsKeyId){G.sseKmsKeyId=C.sseKmsKeyId}}else{if(B.name===n.OPERATION_NAME.CHANGE_METADATA){G.metadataMap=C.addAndChangeMetadata;G.deleteMetadata=C.deleteMetadata}else{if(B.name===n.OPERATION_NAME.INITIATE_RESTORE){G.expirationDays=C.expirationDays;if(C.tier){G.tier=C.tier}}else{if(B.name===n.OPERATION_NAME.ADD_OBJECT_TAG){G.tags=C.tags}}}}}if(p.indexOf(B.name)>=0&&j.isFeatureEnabled(n.FAC.NEW_MULTIPART_COPY+"-"+E)){G.isNewMultipartCopy=true}return G}function v(B,G,E){var F={};var D=u.defer();var C=z.initializeBulkOperationResult(B,G);if(!z.verifyInput(B,G)){throw"The call has invalid input."}s.getBucketLocation(B,B.initialBucket,F).then(function(){var I=z.generateParameterForSpecificOperation(B,G,E,F.region);var H=m[B.name];if(!H){throw B.name+" is not supported"}d.makeS3ConsoleOperationRequest(I,H,{},B).then(function(J){if(A.isMultipartCopyNeeded(B,J)){var K=z.getAllSinglePartCopyResult(B,J,G);if(K.error){D.reject(K);return}D.notify(K);A.startMultipartCopyForFiles(B,B.initialBucket,I.region,I.region,G,_.pluck(G,"Key"),J,false,D)}else{z.handleCWSSuccessResponse(B,G,J,C,D)}})["catch"](function(J){z.handleCWSErrorResponse(B,J,C,D)})})["catch"](function(H){z.handleGetBucketLocationError(B,H,C,D)});return D.promise}function t(D,C,F){var B=z.initializeBulkOperationResult(D);B.updateType=n.OPERATION_PROGRESS_UPDATE_TYPE.SINGLE_PART_RESULTS;B.keys=F;var E=_.pluck(F,"Key");C.data.statusPerKey.forEach(function(G){if(!A.isMultipartCopyObject(G)){if(E.lastIndexOf(G.key)>=0){B.result[G.key]=G.result}else{c.log(i,0,{operation:D,originalKeys:F,response:C});B.error=e}}});return B}function h(C,D,B,E){c.log(f,1,C,D);B.error=D;E.reject(B)}function k(C,D,B,E){c.log((C.name+w).replace(/ /g,""),1,C,D);B.error=D;E.reject(B)}function o(D,E,C,B,F){if(d.wasOperationSuccessful(C)){C.data.statusPerKey.forEach(function(G){B.result[G.key]=G.result});if(!z.verifyKeysMatching(E,B.result)){c.log(i,0,{operation:D,keys:E,response:C});B.error=e;F.reject(B)}else{c.log(i,1,D);c.log((D.name+g).replace(/ /g,""),Object.keys(E).length,D,B.result);F.resolve(B)}}}function r(B,D){if(isNaN(B.totalSizeInBytes)||B.totalSizeInBytes<0){return false}for(var C in D){if(isNaN(D[C].Size)||D[C].Size<0){return false}}return true}function q(F,D){var E={};var C=_.pluck(F,"Key");C.forEach(function(G){E[G]=false});var B=Object.keys(D);if(F.length!==B.length){return false}B.forEach(function(G){if(E[G]===false){E[G]=true}else{return false}});C.forEach(function(G){if(!E[G]){return false}});return true}}])})();"use strict";(function(){angular.module("s3").service("DeleteService",["$q","ConsoleOperation","ListVerificationService","Md5GenerationService","ObjectListingService","PathService","S3Constants","SCLogService","APIProxyService","S3Service","UtilService",function(p,j,v,i,g,b,l,a,o,r,t){var e="GetBucketLocationError";var h="DeleteCountMatch";var c="DeleteCountMismatch";var m="DeleteRequestGenerated";var d="DeleteObjectCount";var u={createDeleteMultipleObjectsXml:q,deleteKeysAndVersions:s,generateDeleteRequest:f,getKeyAndVersionIdSetFromResponse:n,compareRequestAndResponse:k};return u;function q(y){var w="<Delete>";for(var x in y){w+="<Object>";w+="<Key>"+t.encodeXml(y[x].Key)+"</Key>";if(y[x].VersionId){w+="<VersionId>"+t.encodeXml(y[x].VersionId)+"</VersionId>"}w+="</Object>"}w+="</Delete>";return w}function s(z,B,A){var w=u.createDeleteMultipleObjectsXml(B);var C=u.generateDeleteRequest(z,w,A.mfaString);var x=p.defer();var y={operation:z,error:null,result:null};o.getBucketLocation(z,z.initialBucket,C).then(function(D){o.makeProxyRequest(r.deleteObjects,D,l.PROXY_API_NAMES.S3.DELETE,z).then(function(F){if(F.response.DeleteResult){var E=u.getKeyAndVersionIdSetFromResponse(F.response.DeleteResult,z);if(!u.compareRequestAndResponse(B,E)){a.log(h,0,z,{original:B,result:E});y.error=c;x.reject(y)}else{a.log(h,1,z,{original:B,result:E});y.result=E;x.resolve(y)}}else{if(F.response.Error){y.error=F.response.Error;x.reject(y)}}})["catch"](function(E){y.error=E;x.reject(y)})})["catch"](function(D){a.log(e,1,z,D);y.error=D;x.reject(y)});return x.promise}function f(w,x,z){var y={content:x,path:w.initialBucket};y.headers={};y.headers[l.HEADERS.CONTENT_TYPE]=l.HEADERS.CONTENT_TYPE_JSON;y.headers[l.HEADERS.X_AMZ_DATE]=new Date().toUTCString();y.headers[l.HEADERS.CONTENT_MD5]=i.getContentMd5(x);if(z){y.headers[l.HEADERS.X_AMZ_MFA]=z}a.log(m,1,w,y);return y}function n(y,x){var w={};if(y.Deleted){if(y.Deleted.length>1){a.log(d,y.Deleted.length,x);y.Deleted.forEach(function(z){if(z.VersionId){w[z.Key+":"+z.VersionId]={status:l.OPERATION_PER_KEY_STATUS.DONE}}else{w[z.Key]={status:l.OPERATION_PER_KEY_STATUS.DONE}}})}else{a.log(d,1,x);if(y.Deleted.VersionId){w[y.Deleted.Key+":"+y.Deleted.VersionId]={status:l.OPERATION_PER_KEY_STATUS.DONE}}else{w[y.Deleted.Key]={status:l.OPERATION_PER_KEY_STATUS.DONE}}}}if(y.Error){if(y.Error.length>1){y.Error.forEach(function(z){if(z.VersionId){w[z.Key+":"+z.VersionId]={status:l.OPERATION_PER_KEY_STATUS.ERROR,errorCode:z.Code,errorMessage:z.Message}}else{w[z.Key]={status:l.OPERATION_PER_KEY_STATUS.ERROR,errorCode:z.Code,errorMessage:z.Message}}})}else{if(y.Error.VersionId){w[y.Error.Key+":"+y.Error.VersionId]={status:l.OPERATION_PER_KEY_STATUS.ERROR,errorCode:y.Error.Code,errorMessage:y.Error.Message}}else{w[y.Error.Key]={status:l.OPERATION_PER_KEY_STATUS.ERROR,errorCode:y.Error.Code,errorMessage:y.Error.Message}}}}return w}function k(z,x){var w={};z.forEach(function(A){if(A.VersionId){w[A.Key+":"+A.VersionId]=false}else{w[A.Key]=false}});var y=Object.keys(x);if(Object.keys(w).length!==y.length){return false}y.forEach(function(A){if(w[A]===undefined||w[A]===true){return false}w[A]=true});Object.keys(w).forEach(function(A){if(!w[A]){return false}});return true}}])})();"use strict";(function(){angular.module("s3").service("CopyService",["ConsoleOperation","FAC","MultipartCopyService","OperationDispatcherService","OperationUtilService","PathService","SCLogService","S3Service","S3Constants","S3CWSAPIService","APIProxyService","$q",function(m,j,v,e,k,c,b,t,o,d,p,s){var r="PasteObjects";var q="RenameObject";var a=null;var u={copyObjects:l,setClipboardOperation:n,isOperationInClipboard:f,startClipboardOperation:i,generateCopyRequestPayload:g,getClipboardOperation:h};return u;function n(w){if(a!==null){a.state=o.OPERATION_STATE.CANCEL}a=w}function f(){return a===null}function i(){var x=arguments.length<=0||arguments[0]===undefined?false:arguments[0];var w=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(a===null){throw"There is no operation in the clipboard."}a.dstBucket=c.getCurrentBucket();a.dstPrefix=c.getCurrentAbsoluteFolderPath();if(a.dstPrefix===undefined){a.dstPrefix=""}if(x){a.dstName=w&&w.name;b.log(q,1,a,{dstName:a.dstName})}else{b.log(r,1,a,{dstBucket:a.dstBucket,dstPrefix:a.dstPrefix})}e.addOperation(a);a=null}function g(x,y,w,C,B){var A={bucket:x.initialBucket,prefix:x.initialPath,dstBucket:x.dstBucket,keys:_.pluck(y,"Key"),dstKeys:[],region:B};var z=undefined;if(C){(function(){var D=y[0].Key;y.forEach(function(F){var E=F.Key;z=E.replace(D,x.dstName);A.dstKeys.push(A.prefix?A.prefix+z:z)})})()}else{y.forEach(function(E){var D=E.Key;A.dstKeys.push(D.replace(E.Path||x.initialPath,x.dstPrefix))})}A.cutOperation=(w||C)===true;if(j.isFeatureEnabled(o.FAC.NEW_MULTIPART_COPY+"-"+B)){A.isNewMultipartCopy=true}return A}function l(x,C,E){var A=E.isCut;var B=E.isRename;var z=s.defer();var y=k.initializeBulkOperationResult(x,C);var D={};var w=undefined;p.getBucketLocation(x,x.initialBucket,D).then(function(){w=u.generateCopyRequestPayload(x,C,A,B,D.region);D={};p.getBucketLocation(x,x.dstBucket,D).then(function(F){w.dstBucketRegion=F.region;d.makeS3ConsoleOperationRequest(w,o.CWS_OPERATION_NAME.COPY,{},x).then(function(G){if(v.isMultipartCopyNeeded(x,G)){var H=k.getAllSinglePartCopyResult(x,G,C);if(H.error){z.reject(H);return}z.notify(H);v.startMultipartCopyForFiles(x,x.dstBucket,w.dstBucketRegion,w.region,C,w.dstKeys,G,!!(A||B),z)}else{k.handleCWSSuccessResponse(x,C,G,y,z)}})["catch"](function(G){k.handleCWSErrorResponse(x,G,y,z)})})["catch"](function(F){k.handleGetBucketLocationError(x,F,y,z)})})["catch"](function(F){k.handleGetBucketLocationError(x,F,y,z)});return z.promise}function h(){return a}}])})();"use strict";(function(){angular.module("s3").service("UploadOperationService",["$q","$window","$translate","ConsoleOperation","humanReadableBytesFilter","SCLogService","APIProxyService","PromiseQueue","S3Constants","UploadService",function(C,r,w,q,D,e,x,o,v,u){var f="DragAndDropComplete",c="OperationCreated",y="StartExplorerTraversal",d="CancelUploadOperation",g="EmptyFolder",l="Start",F="Started",j="StartedBeforeSetup",n="Complete",i="UserError";var H={createUploadOperation:B,setupUploadOperation:s,uploadFile:k,uploadSuccess:h,uploadError:b,uploadNotify:G,selectFile:m,setFlagValues:E,updateErrorPercentage:p};return H;function B(){var I=new q(v.OPERATION_NAME.UPLOAD);I.displayName=w.instant("operationname.upload");I.explorers=[];e.log(I.name+c,1,I);I.start=function(){if((!I.selectedObjects||I.selectedObjects.length===0)&&(!I.selectedFolders||I.selectedFolders.length===0)){e.log(I.name+j,1,I);throw"Setup up the upload operation before start"}e.log(I.name+F,1,I);for(var K in I.selectedFolders){if(I.selectedFolders[K].objsCount===0){A(I.selectedFolders[K],I)}}var L=new o(1);for(var J in I.selectedObjects){L.add(k,{file:I.selectedObjects[J],operation:I,isDragAndDrop:false})}if(I.explorers&&I.explorers.length>0){t(0,I)}};I.cancel=function(){I.state=v.OPERATION_STATE.CANCEL;e.log(d,1,I);for(var J in I.selectedObjects){u.cancelUpload(I.selectedObjects[J].id,I)}};return I}function t(J,I){var K=I.explorers[J];J++;e.log(I.name+y,1,I,{explorerId:K.explorerId,selectedItems:K.getSelectedItems()});z(K,I).then(function(){var L=I.succeedKeyCount+I.failedKeyCount;if(J<I.explorers.length){t(J,I)}else{e.log(I.name+f,1,I,{expectedTotalObjsCount:I.totalObjectCount,numberOfFileUploadsAttempted:L,numberOfExplorersUploaded:I.explorers.length})}},function(L){e.log(I.name+f,0,I,L);I.cancel()})}function z(L,K,M){var J=M||C.defer(),I=[];if(K.state===v.OPERATION_STATE.CANCEL){p(K);J.reject("Operation was cancelled");return}L.getNext().then(function(Q){if(!Q){J.resolve();return}var O=Q.fileList,N=Q.emptyFolderToBeUploaded;if(N){I.push(A(N,K,true))}for(var P in O){I.push(k({file:O[P],operation:K,isDragAndDrop:true}))}if(I.length>0){C.all(I).then(function(){z(L,K,J)},function(){I[I.length-1].then(function(){z(L,K,J)},function(){z(L,K,J)})})}else{z(L,K,J)}},function(N){J.reject(N)});return J.promise}function A(K,J,I){var L=x.putObject(J,J.initialBucket,J.initialPath+K.fullPath,K.Prefix);L.then(function(M){e.log(J.name+g,1,J,{fullPath:J.initialPath+K.fullPath,isDragAndDrop:I,name:K.Prefix});M.operation=J;h(M)},function(M){e.log(J.name+g,0,J,M);M.operation=J;b(M)});return L}function k(L){var J=L.file;var M=L.operation;var O=L.isDragAndDrop;var K=J.file,Q=J.fullPath?M.initialPath+J.fullPath:M.initialPath,N=M.initialBucket,R=J.id,S=M.options;K.initialLastModified=K.lastModified||"";var I=u.upload(K,Q,N,R,M,S);e.log(l+M.name,1,M,{fullPath:M.initialPath+K.fullPath,isDragAndDrop:O,fileName:K.Key});M.files[L.file.Key]=L.file.Size;if(M.state===v.OPERATION_STATE.CANCEL){var P={operation:M,name:L.file.Key,errorMessage:w.instant("upload.cancelled")};b(P);return C.reject()}else{I.then(h,b,G);return I}}function s(L,J,K,I,M,N){L.selectedFolders=J;L.selectedObjects=K;L.totalObjectCount=I.files;L.totalBytes=I.size;L.totalUploadedBytes=0;L.options=M;L.uploadUiCallBack=N;L.currentUploadSpeed=0;L.lastNotifyTime=null;L.lastMarkBytes=0;L.files={}}function m(J,I){return u.fileSelected(J,I)}function E(I){if(I.errorPercentage===0){I.parameters.operationSuccessful=true}else{if(I.successPercentage===0){I.parameters.operationUnsuccessful=true}else{I.parameters.operationPartiallySuccessful=true}}}function p(I){if(I.successPercentage+I.errorPercentage!==100){I.errorPercentage=100-I.successPercentage}}function h(I){var J=I.operation;delete I.operation;e.log(J.name+n,1,J,I);J.succeedKeyCount+=1;J.totalOperatedObjectCount+=1;J.totalUploadedBytes+=J.files[I.name];J.successPercentage=J.totalUploadedBytes/J.totalBytes*100;J.uploadUiCallBack();E(J);if(J.succeedKeyCount+J.failedKeyCount===J.totalObjectCount){J.progressPercentage=100;if(J.succeedKeyCount===J.totalObjectCount){J.successPercentage=100}p(J);if(J.errorPercentage!==0){J.errorCallBack(J.id)}else{J.finishCallBack(J.id)}}}function b(I){var J=I.operation;delete I.operation;var K=I.errorMessage;var L=_.filter(J.errorTypes,function(N){return N.errorMessage===K});if(L.length===0){J.errorTypes.push({errorMessage:K,errorCount:1,errorPercentage:Number(J.files[I.name]/J.totalBytes*100).toFixed(2)})}else{L[0].errorCount+=1;L[0].errorPercentage=Number(J.files[I.name]/J.totalBytes*100).toFixed(2)}var M=Number(a(I));e.log(J.name+n,M,J,I);if(M===1){e.log(J.name+i,1,J,I.errorMessage)}if(J.errorDetails[K]){J.errorDetails[K].push(I.name)}else{J.errorDetails[K]=[I.name]}J.failedKeyCount+=1;J.totalOperatedObjectCount+=1;J.errorPercentage+=J.files[I.name]/J.totalBytes*100;J.successPercentage=J.totalUploadedBytes/J.totalBytes*100;J.progressPercentage=J.totalOperatedObjectCount/J.totalObjectCount*100;J.uploadUiCallBack();E(J);if(J.succeedKeyCount+J.failedKeyCount===J.totalObjectCount){if(J.failedKeyCount===J.totalObjectCount){J.errorPercentage=100}p(J);if(J.errorPercentage!==0){J.errorCallBack(J.id)}else{J.finishCallBack(J.id)}}}function G(K){var I=K.operation;if(K.totalBytes&&K.uploadedByte){var L=I.totalUploadedBytes;L+=K.uploadedByte;I.progressPercentage=L/I.totalBytes*100;I.successPercentage=I.progressPercentage;var J=r.Date.now();if(I.lastNotifyTime&&J!==I.lastNotifyTime){I.currentUploadSpeed=D((L-I.lastMarkBytes)/((J-I.lastNotifyTime)/1000))}I.lastMarkBytes=L;I.lastNotifyTime=J}delete K.operation;e.log("UploadProgress",1,I,K)}function a(I){return v.UPLOAD.USER_ERROR_MESSAGES.indexOf(I.errorMessage)!==-1||I.isCancelled===true}}])})();"use strict";(function(){angular.module("s3").service("MultipartCopyService",["$q","$translate","ConsoleOperation","PathService","SCLogService","S3Constants","S3CWSAPIService","UtilService",function(t,r,o,d,c,p,e,u){var q="MultipartCopyCompleted";var k="multipartCopyId:";var l="MultipartCopyPartCompleted";var f=[p.OPERATION_NAME.COPY,p.OPERATION_NAME.CUT,p.OPERATION_NAME.RENAME,p.OPERATION_NAME.CHANGE_METADATA,p.OPERATION_NAME.CHANGE_STORAGE_CLASS,p.OPERATION_NAME.CHANGE_SSE];var w={completeMultipartCopy:g,doMultipartCopy:h,getEtagsFromResponse:b,recursivelyMultipartCopy:a,startMultipartCopyForFiles:i,isMultipartCopyNeeded:m,isMultipartCopyObject:v,initializeNotifyResult:s,notifyProgress:j,notifyError:n};return w;function m(y,x){if(f.lastIndexOf(y.name)<0){return false}else{for(var z in x.data.statusPerKey){if(x.data.statusPerKey[z].result.additionalInfoWhenSuccess&&x.data.statusPerKey[z].result.additionalInfoWhenSuccess.lastIndexOf(k)!==-1){return true}}}return false}function v(x){return x.result.additionalInfoWhenSuccess&&x.result.additionalInfoWhenSuccess.lastIndexOf(k)!==-1}function i(A,I,C,D,H,E,B,F,y){var x={};var z=false;B.data.statusPerKey.forEach(function(K){if(K.result.additionalInfoWhenSuccess&&K.result.additionalInfoWhenSuccess.lastIndexOf(k)!==-1){for(var M in H){if(H[M].Key===K.key){var O=K.result.additionalInfoWhenSuccess.split(k)[1];x[O]={key:H[M]};x[O].dstKey=E[M];x[O].dstBucket=I;x[O].dstBucketRegion=C;x[O].srcBucketRegion=D;x[O].isCut=F;x[O].objectSizeInByte=H[M].Size;x[O].partCount=Math.ceil(H[M].Size/p.MULTIPART_COPY.PART_SIZE);var L=Object.keys(x[O]);for(var N in L){if(x[O][L[N]]===undefined){c.log(q,0,A,x[O]);var J=w.initializeNotifyResult(A,[x[O].key]);J.updateType=p.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_ERROR;J.error=r.instant("operation.errormessage.multipartcopyfailed");y.notify(J);z=true}}break}}}});if(!z){var G=Object.keys(x);w.recursivelyMultipartCopy(A,G,x,0,0,B,y)}}function h(x,y,z,A){var B={bucket:x.initialBucket,multipartCopyId:y,key:z.key.Key,dstBucket:z.dstBucket,dstKey:z.dstKey,objectSizeInByte:z.objectSizeInByte,dstBucketRegion:z.dstBucketRegion,region:z.dstBucketRegion,startPartNumber:A*p.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API+1,endPartNumber:Math.min((A+1)*p.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API,z.partCount)};return e.makeS3ConsoleOperationRequest(B,p.CWS_OPERATION_NAME.MULTIPART_COPY,{},x)}function b(x){var A=[];var y="";var z=null;x.data.statusPerKey.forEach(function(B){if(B.result.status===p.OPERATION_PER_KEY_STATUS.DONE){A.push({partNumber:Number(B.key),eTag:B.result.additionalInfoWhenSuccess})}else{if(B.result.status===p.OPERATION_PER_KEY_STATUS.ERROR){y=B.result.errorMessage;z=B.result.errorCode}}});if(!y){return A}else{return{errorMessage:y,errorCode:z}}}function g(x,y,z){var A={bucket:x.initialBucket,etags:z.partEtags,copyId:y,dstKey:z.dstKey,srcKey:z.key.Key,objectSize:z.objectSizeInByte,dstBucket:z.dstBucket,srcRegion:z.srcBucketRegion,region:z.dstBucketRegion,isCut:z.isCut};return e.makeS3ConsoleOperationRequest(A,p.CWS_OPERATION_NAME.COMPLETE_MULTIPART_COPY,{},x)}function s(x,y,z){return{operation:x,keys:y,result:{},error:null,updateType:"",notifyDefer:z,isLastOne:false}}function n(y,C,D,x,B,z){var F=w.initializeNotifyResult(y,[C.key.Key],z?x:null);F.error=B;F.updateType=p.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_ERROR;F.isLastOne=z;var E=D*p.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API+1;var A=C.partCount;F.result=(A-E)*p.MULTIPART_COPY.PART_SIZE+Math.min(p.MULTIPART_COPY.PART_SIZE,C.objectSizeInByte-(A-1)*p.MULTIPART_COPY.PART_SIZE);x.notify(F)}function j(z,C,D,x,y,A){var F=w.initializeNotifyResult(z,[C.key.Key],A?x:null);if(y){F.updateType=p.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_COMPLETE}else{F.updateType=p.OPERATION_PROGRESS_UPDATE_TYPE.MULTIPART_COPY_RESULT}F.isLastOne=A;var E=D*p.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API+1;var B=Math.min((D+1)*p.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API,C.partCount);F.result=(B-E)*p.MULTIPART_COPY.PART_SIZE+Math.min(p.MULTIPART_COPY.PART_SIZE,C.objectSizeInByte-(B-1)*p.MULTIPART_COPY.PART_SIZE);x.notify(F)}function a(C,D,B,x,E,F,z){if(x===D.length||C.state===p.OPERATION_STATE.CANCEL){return}var y=B[D[x]];var A=x+1===D.length;w.doMultipartCopy(C,D[x],y,E).then(function(G){var H=b(G);if(H.errorMessage){c.log(l,0,C,{params:y,error:H.errorMessage});c.log(q,0,C);w.notifyError(C,y,E,z,H.errorMessage,A);w.recursivelyMultipartCopy(C,D,B,x+1,0,F,z)}else{c.log(l,1,C,y);if(y.partEtags){y.partEtags=y.partEtags.concat(H)}else{y.partEtags=H}if(y.partEtags.length===y.partCount){w.completeMultipartCopy(C,D[x],y).then(function(){c.log(q,1,C);w.notifyProgress(C,y,E,z,true,A)})["catch"](function(I){c.log(q,0,C);w.notifyError(C,y,E,z,I,A)});w.recursivelyMultipartCopy(C,D,B,x+1,0,F,z)}else{w.notifyProgress(C,y,E,z,false,false);w.recursivelyMultipartCopy(C,D,B,x,E+1,F,z)}}})["catch"](function(G){c.log(l,0,C,{params:y,error:G});c.log(q,0,C);w.notifyError(C,y,E,z,G,A);w.recursivelyMultipartCopy(C,D,B,x+1,0,F,z)})}}])})();"use strict";(function(){angular.module("s3").controller("ObjectDetailsController",["$filter","$location","$q","$scope","$timeout","$translate","APIProxyService","AWSC","BulkOperationService","CachingService","ConsoleOperation","DownloadService","PathService","PermissionsUtilService","ObjectPropertiesService","OperationDispatcherService","S3Constants","SCLogService","UtilService",a]);function a(n,h,t,q,v,r,s,p,m,f,l,j,c,g,i,e,o,b,w){q.tabs=[{label:r.instant("details.tab.overview"),id:"overview"},{label:r.instant("details.tab.properties"),id:"properties"},{label:r.instant("details.tab.permissions"),id:"permissions"}];q.objectDetailError="";q.bucket=c.getCurrentBucket();q.key=c.getCurrentObject();if(q.key.lastIndexOf(o.DELIMITER)===q.key.length-1){h.path(""+o.DELIMITER+o.PATH_SEGMENTS.HOME)}q.obj=f.getCurrentObject();q.versionsDropdownSelectedObject={obj:_.cloneDeep(f.getCurrentObject())};if(q.versionsDropdownSelectedObject.obj){q.versionsDropdownSelectedObject.obj.Key=c.relativeToAbsoluteObjectPath(q.versionsDropdownSelectedObject.obj.Key)}q.options={};q.versionLabel=r.instant("versionsdropdown.label.latestVersion");q.selectedTab=h.search().tab||"overview";q.showReplication=false;q.showRestoration=false;q.showExpiry=false;q.showVersionsDropdown={show:false};q.showSuccessMessage=false;q.showVersionId=false;q.permissionObj={};p.Clog.setPageId(o.CLOG_OBJECT_DETAILS_PAGE_ID);q.copyFinished={flag:false};q.listVersions=function(x){x.stopPropagation();if(q.showVersionsDropdown.show){q.showVersionsDropdown.show=false}else{q.showVersionsDropdown.show=true;w.analyticsTrackClick(o.ANALYTICS.LATEST_VERSION,o.ANALYTICS.DETAILS)}};q.closeDownloadAsPanel=function(){q.downloadAsPanel=false};q.openDownloadAsPanel=function(){q.downloadAsPanel=true;w.analyticsTrackClick(o.ANALYTICS.DOWNLOAD_AS,o.ANALYTICS.DETAILS);q.downloadAsPanelGenerating=true;q.downloadPanelError=false;q.downloadPanel={};j.generatePresignedUrlForCurrentObject(q.versionsDropdownSelectedObject.obj,false).then(function x(z){q.downloadAsPanelGenerating=false;q.downloadPanel.url=z.data.presignedUrl},function y(z){q.downloadAsPanelGenerating=false;q.downloadPanelError=true})};q.downloadSelectedObject=function(){j.downloadCurrentSelection(q.versionsDropdownSelectedObject.obj,false)};q.openSelectedObject=function(){var x=q.versionsDropdownSelectedObject.obj.VersionId?q.versionsDropdownSelectedObject.obj.VersionId:null;j.openInBrowser(q.versionsDropdownSelectedObject.obj.Key,q.versionsDropdownSelectedObject.obj.Size,x,false)};q.makePublic=function(){q.isMakingPublic=true;var x=m.createBulkOperation(o.OPERATION_NAME.MAKE_PUBLIC,[q.obj],[],1,{numberOfKeysPerBulkOperation:1});x.totalSizeInBytes=q.obj.Size;e.addOperation(x);b.log("MakePublicRequestReceived",1,x);x.defer.promise.then(function(y){var z=Object.keys(y);if(z.length>0){q.objectDetailError=w.handleErrors(z[0]);b.log("MakePublicRequestComplete",0,x)}else{q.cachedValue=angular.copy(q.obj);q.cardOpen=false;q.showSuccessMessage=true;q.successMessageString=r.instant("objectdetails.successmessage");v(function(){return q.showSuccessMessage=false},o.SUCCESS_MESSAGE_TIMEOUT);b.log("MakePublicRequestComplete",1,x);k(x)}})["catch"](function(y){x.error=y;b.log("MakePublicRequestComplete",0,x);q.objectDetailError=w.handleErrors(y)})["finally"](function(){q.isMakingPublic=false})};q.permissionObj.grantees={};q.putAcl=function(x){var y=new l("putObjectAcl");var z=q.key;b.log("putObjectACLReceived",1,y,{bucketName:q.bucket,key:z});var A="";return s.getObjectAcl(y,q.bucket,z).then(function(C){var B=C.response.AccessControlPolicy;A+='<AccessControlPolicy xmlns="http://s3.amazonaws.com/doc/2006-03-01/"><Owner><ID>'+B.Owner.ID+"</ID>";A+="<DisplayName>"+B.Owner.DisplayName+"</DisplayName></Owner><AccessControlList>";x.forEach(function(D){D.Grantee.Type=D.Grantee.URI?"Group":D.Grantee.EmailAddress?"AmazonCustomerByEmail":"CanonicalUser";A+='<Grant><Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="'+D.Grantee.Type+'">';A+=D.Grantee.ID?"<ID>"+D.Grantee.ID+"</ID>":"";A+=D.Grantee.DisplayName?"<DisplayName>"+D.Grantee.DisplayName+"</DisplayName>":"";A+=D.Grantee.EmailAddress?"<EmailAddress>"+D.Grantee.EmailAddress+"</EmailAddress>":"";A+=D.Grantee.URI?"<URI>"+D.Grantee.URI+"</URI>":"";A+="</Grantee>";A+="<Permission>"+D.Permission+"</Permission></Grant>"});A+="</AccessControlList></AccessControlPolicy>";return s.putObjectAcl(y,q.bucket,z,A).then(function(E){var D=E.response;b.logRequestComplete("putObjectAcl",y);return D})["catch"](function(D){b.log("putObjectAcl",0,y,{bucketName:q.bucket,key:z,error:D});return t.reject(w.handleErrors(D))})})["catch"](function(B){return t.reject(w.handleErrors(B))})};q.getStorageClassTranslation=function(){if(q.obj){return w.getStorageClassTranslations()[q.obj.StorageClass]}return""};q.getEncryptionTranslation=function(){if(q.obj){if(q.obj.statusCodes){var x=q.obj.statusCodes[o.OPERATION_NAME.GET_OBJECT_METADATA];if(x){return x}}return w.getEncryptionTranslations()[q.obj.Encryption]}return""};q.getMetadata=function(z,A){q.obj.statusCodes={};var x=c.getCurrentObject();var y=new l(o.OPERATION_NAME.GET_METADATA);b.log("GetObjectMetadataReceived",1,y);s.getObjectMetadata(z,q.bucket,x,A).then(function(C){b.log(o.OPERATION_NAME.GET_OBJECT_METADATA,z,1,{bucketName:q.bucket,key:x});var E=C.headers();q.obj.Encryption=o.OBJECT_SSE.NONE;if(E){if(E[o.HEADERS.EXPIRES.toLowerCase()]){if(!q.obj.UserDefinedMetadata){q.obj.UserDefinedMetadata={}}q.obj.UserDefinedMetadata[o.HEADERS.EXPIRES]=E[o.HEADERS.EXPIRES.toLowerCase()]}if(E[o.HEADERS.X_AMZ_REPLICATION_STATUS]){q.showReplication=true;q.obj.ReplicationStatus=C.headers()[o.HEADERS.X_AMZ_REPLICATION_STATUS]}if(E[o.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]){q.obj.Encryption=E[o.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]}if(E[o.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID]){q.obj.KmsID=E[o.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID];q.options.kmsId=E[o.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION_KMS_ID]}if(E[o.HEADERS.X_AMZ_RESTORE]){q.restorationExpiry=undefined;var B=E[o.HEADERS.X_AMZ_RESTORE];if(B){var D=w.extractFromQuotes(B);if(D==="true"){q.showRestoration=true}else{if(D==="false"){q.showRestoration=false;q.restorationExpiry=n("date")(new Date(w.extractFromQuotes(B,1)),"medium")}}}}if(E[o.HEADERS.X_AMZ_EXPIRATION]){q.showExpiry=true;var F=E[o.HEADERS.X_AMZ_EXPIRATION];q.obj.ExpirationDate=w.extractFromQuotes(F,0);q.obj.ExpirationRule=w.extractFromQuotes(F,1)}}})["catch"](function(B){q.obj.Encryption=w.getErrorMessage(B);b.log(o.OPERATION_NAME.GET_OBJECT_METADATA,z,0,{bucketName:q.bucket,key:x});q.objectPropertiesError=w.handleErrors(B);q.obj.statusCodes[o.OPERATION_NAME.GET_OBJECT_METADATA]=w.getErrorMessage(B)});s.getBucketLocation(z,q.bucket,{}).then(function(B){q.obj.Link=c.getObjectLink(x,B.region)});i.listVersions(q.bucket,q.key,new l(o.OPERATION_NAME.LIST_VERSIONS)).then(function(B){q.showVersionId=B&&B[0]&&B[0].VersionId&&B[0].VersionId!=="null"});u(z)};q.actionButtonsDisabled=function(){if(q.obj){return q.obj.StorageClass===o.STORAGE_CLASSES.GLACIER&&!q.restorationExpiry||_.isEmpty(q.obj.ETag)}return true};q.copyPathToClipboard=function(){w.copyPathToClipboard(q.obj.Key,q.copyFinished)};function k(x){s.getObjectAcl(x,q.bucket,c.getCurrentObject()).then(function(z){var y=z.response.AccessControlPolicy.AccessControlList.Grant;b.log("getObjectACL",1,x,{bucketName:q.bucket,key:c.getCurrentObject()});if(y){if(Array.isArray(y)){y.forEach(function(A){g.updateGranteesHelperFunction(A,q.permissionObj.grantees)})}else{g.updateGranteesHelperFunction(y,q.permissionObj.grantees)}q.permissionObj.grantees=g.updateGrantees(q.permissionObj.grantees);q.permissionObj.aclGrants=Array.isArray(y)?y:[y]}})["catch"](function(y){b.log("getObjectACL",0,x,{bucketName:q.bucket,key:c.getCurrentObject()});q.aclError=w.handleErrors(y)})}function u(x){if(q.obj.StorageClass===o.STORAGE_CLASSES.GLACIER&&!q.restorationExpiry){q.warning=r.instant("objectdetail.glacierwarning")}else{q.warning="";k(x)}}function d(){var x=new l(o.OPERATION_NAME.GET_OBJECT_DETAILS);b.setEndpoint();if(!q.obj){(function(){var y={bucket:q.bucket,prefix:q.key,maxKeys:1,cacheAllowed:true};s.listObjects(x,y).then(function(z){q.obj=_.get(z,"response.ListBucketResult.Contents[0]");q.obj.versionLabel=r.instant("versionsdropdown.label.latestVersion");q.versionsDropdownSelectedObject.obj=_.cloneDeep(q.obj);p.Timer.customerReady();b.log(o.OPERATION_NAME.GET_OBJECT_DETAILS,1,x,y);if(q.obj){q.obj.ETag=q.obj&&q.obj.ETag.replace(/[\\"]+/g,"");if(q.obj.Key.lastIndexOf("/")!==-1){q.obj.Key=q.obj.Key.substring(q.obj.Key.lastIndexOf("/")+1)}q.getMetadata(x)}})["catch"](function(z){p.Timer.customerReady();q.objectDetailError=w.handleErrors(z);b.log(o.OPERATION_NAME.GET_OBJECT_DETAILS,0,x,z)})})()}else{b.log("GetObjectDetailsCacheHit",1,x,{bucket:q.bucket,key:q.obj.Key});q.obj.ETag=q.obj.ETag.replace(/[\\"]+/g,"");q.obj.versionLabel=r.instant("versionsdropdown.label.latestVersion");q.getMetadata(x)}}q.setTabParam=function(x){h.search("tab",x)};d()}})();"use strict";(function(){angular.module("s3").service("KeySelectionService",["PathService","UtilService","$location","$rootScope",function(e,b,h,a){function f(k){for(var j=0;j<k.length;j++){k[j].selected=false}}function d(i,j){if(i){f(i)}if(j){f(j)}}function g(j,k){if(k.length!==1){return false}var i=k[0];return decodeURI(j)===decodeURI(e.getAbsolutePathToObjectWithBucket(b.escapePath(i.Key)))}function c(i){var j={sizeDataMissing:false,totalObjs:i.objects.length,totalSize:0,totalFolders:i.folders.length};angular.forEach(i.objects,function(k){if(k.Size){j.totalSize+=k.Size}else{j.sizeDataMissing=true}});return j}return{isCurrentlySelectedObject:g,setSelectedFlagAsFalse:d,countCurrLevelFiles:c}}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("acl",[function(){return{restrict:"E",scope:{permissionObj:"=",putAcl:"=",error:"=",bucket:"=?",isBucketPermission:"=",shouldDisable:"=?"},templateUrl:"/s3/partials/acl.html",controller:"AclController"}}]);angular.module("s3").controller("AclController",["$scope","$translate","APIProxyService","BucketPropertiesService","ConsoleOperation","PathService","PermissionsUtilService","S3Constants","SCLogService","UtilService",a]);function a(m,n,o,h,j,c,f,k,b,u){var s;m.granteeList={};m.radioSelect={displayName:null};m.granteeList.inputItem="";m.granteeList.inputError="";m.predefinedGroups=[{value:"AllUsers",text:n.instant("permissions.acl.everyone"),Type:"Group",URI:"http://acs.amazonaws.com/groups/global/AllUsers"},{value:"AuthenticatedUsers",text:n.instant("permissions.acl.any"),Type:"Group",URI:"http://acs.amazonaws.com/groups/global/AuthenticatedUsers"},{value:"LogDelivery",text:n.instant("permissions.acl.log"),Type:"Group",URI:"http://acs.amazonaws.com/groups/s3/LogDelivery"}];m.granteeListPlaceholder=n.instant("permissions.granteelist.placeholder");m.isAddGranteeRowDisplayed=false;m.resource={type:m.isBucketPermission===true?"bucket":"object"};m.readHeader=n.instant(m.resource.type+".acl.read");m.readTooltip=n.instant(m.resource.type+".acl.readtooltip");m.writeHeader=n.instant(m.resource.type+".acl.write");m.writeTooltip=n.instant(m.resource.type+".acl.writetooltip");m.readACPHeader=n.instant(m.resource.type+".acl.readacp");m.readACPTooltip=n.instant(m.resource.type+".acl.readacptooltip");m.writeACPHeader=n.instant(m.resource.type+".acl.writeacp");m.writeACPTooltip=n.instant(m.resource.type+".acl.writeacptooltip");m.showAddGranteeRow=function(){m.isAddGranteeRowDisplayed=true;u.analyticsTrackClick(k.ANALYTICS.ADD_GRANTEE,k.ANALYTICS.DETAILS);m.selectedGrantee=undefined;m.onPanelClose()};var q=[m.predefinedGroups[0].text,m.predefinedGroups[1].text,m.predefinedGroups[2].text];m.addNewGranteeToACL=function(v){m.addingGrantee=true;var w=_.cloneDeep(m.permissionObj.aclGrants);v.inputItem=v.inputItem.trim();if(q.indexOf(v)===-1){if(u.validateEmail(v.inputItem)){v={EmailAddress:v.inputItem,grantPermissions:v.grantPermissions}}else{v={ID:v.inputItem,grantPermissions:v.grantPermissions}}}f.addNewPermissions(v.grantPermissions,v,w);m.putAcl(w).then(function(){m.granteeList.inputItem=null;m.granteeList.inputError=null;i(m.isBucketPermission===true)})["catch"](function(x){m.granteeList.inputError=x;m.addingGrantee=false})};m.getPublicPermissionDisplayName=function(v){if(k.PUBLIC_PERMISSIONS_LIST.indexOf(v)>-1){return e[v]}return v};var e=(s={},_defineProperty(s,k.PUBLIC_PERMISSIONS_LIST[0],_.find(k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.publicPermissions,{detail:{value:k.PUBLIC_PERMISSIONS_LIST[0]}}).detail.text),_defineProperty(s,k.PUBLIC_PERMISSIONS_LIST[1],_.find(k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.publicPermissions,{detail:{value:k.PUBLIC_PERMISSIONS_LIST[1]}}).detail.text),s);var p=_defineProperty({},k.SYSTEM_PERMISSIONS_LIST[0],n.instant("permissions.acl.log"));m.getSystemPermissionDisplayName=function(v){if(k.SYSTEM_PERMISSIONS_LIST.indexOf(v)>-1){return p[v]}return v};function l(v){h.getBucketGrantees(m.bucket,v).then(function(w){b.log("GetBucketPermissions",1,v,{bucketName:m.bucket});m.permissionObj.grantees=f.updateGrantees(w);h.getBucketACL(m.bucket,v).then(function(x){b.log("getBucketAcls",1,v,{bucketName:m.bucket});if(x){m.permissionObj.aclGrants=Array.isArray(x)?x:[x]}})["catch"](function(x){b.log("getBucketAcls",0,v,{bucketName:m.bucket});m.aclError=x})})["catch"](function(w){b.log("GetBucketPermissions",0,v,{bucketName:m.bucket});m.aclError=w})["finally"](function(){r()})}function g(w,v){if(_.some(m.predefinedGroups,function(x){return x.value===w})){if(_.indexOf(k.SYSTEM_PERMISSIONS_LIST,w)>-1){f.updateGranteesHelperFunction(v,m.permissionObj.grantees.system)}else{f.updateGranteesHelperFunction(v,m.permissionObj.grantees.group)}}else{f.updateGranteesHelperFunction(v,m.permissionObj.grantees.accounts)}}function t(v){o.getObjectAcl(v,m.bucket,c.getCurrentObject()).then(function(x){var w=x.response.AccessControlPolicy.AccessControlList.Grant;b.log("getObjectACL",1,v,{bucketName:m.bucket,key:c.getCurrentObject()});if(w){if(Array.isArray(w)){w.forEach(function(z){var A=f.extractGranteeKey(z);g(A,z)})}else{var y=f.extractGranteeKey(w);g(y,w)}m.permissionObj.aclGrants=Array.isArray(w)?w:[w]}})["catch"](function(w){b.log("getObjectACL",0,v,{bucketName:m.bucket,key:c.getCurrentObject()});m.aclError=u.handleErrors(w)})["finally"](function(){r()})}function i(w){if(w){var v=new j("BucketPermissions","getPermissions");l(v)}else{var v=new j("ObjectPermissions","getPermissions");t(v)}}m.updateGrantee=function(w){m.updatingGrantee=true;m.granteeList.inputError=null;var y=_.cloneDeep(m.permissionObj.aclGrants);var v=undefined,x=undefined,A=false;if(w.granteeDetails.DisplayName){x=false;v=w.granteeDetails.DisplayName}else{if(w.granteeDetails.URI){v=w.granteeDetails.URI.split("/")[5];if(_.indexOf(k.SYSTEM_PERMISSIONS_LIST,v)>-1){A=true}else{x=true}}else{x=false;v=w.granteeDetails.ID}}var z={allPermissionsRevoked:true,fullControlAdded:false};if(A){f.aclsUpdate(y,m.permissionObj.grantees.system,w.permissions,w.granteeDetails,v,z)}else{if(x){f.aclsUpdate(y,m.permissionObj.grantees.group,w.permissions,w.granteeDetails,v,z)}else{f.aclsUpdate(y,m.permissionObj.grantees.accounts,w.permissions,w.granteeDetails,v,z)}}m.putAcl(y).then(function(){if(!_.isEmpty(m.permissionObj)){m.permissionObj.aclGrants=y}if(z.allPermissionsRevoked===true){if(A){m.permissionObj.grantees.system[v]=_.clone(w.permissions)}else{if(x){m.permissionObj.grantees.group[v]=_.clone(w.permissions)}else{delete m.permissionObj.grantees.accounts[v]}}}else{if(A){m.permissionObj.grantees.system[v]=_.clone(w.permissions)}else{if(x){m.permissionObj.grantees.group[v]=_.clone(w.permissions)}else{m.permissionObj.grantees.accounts[v]=_.clone(w.permissions)}}}m.onPanelClose()})["catch"](function(B){m.granteeList.inputError=B})["finally"](function(){m.updatingGrantee=false;m.panelCancel()})};m.onPanelClose=function(){m.panelHide=true;m.radioSelect.displayName=null};m.panelCancel=function(){m.onPanelClose();m.selectedGrantee=undefined};m.getPublicPermissionsWarning=function(){var v=k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.publicPermissions[1].detail.value;var x=k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.publicPermissions[0].detail.value;var y=_.get(m,"selectedGrantee.displayedValue");if(y===v||y===x){var z=_.find(m.permissionObj.grantees.group[y],function(A){return A===true})!==undefined;if(z){return{body:n.instant(m.resource.type+".warningbody.granted."+y),header:n.instant(m.resource.type+".warningheader.granted."+y),isVisible:true}}var w=_.find(m.selectedGrantee.permissions,function(A){return A===true})!==undefined;if(w){return{body:n.instant(m.resource.type+".warningbody.granting."+y),header:n.instant(m.resource.type+".warningheader.granting."+y),isVisible:true}}}else{return{isVisible:false}}};m.hasGrant=function(v){return v.READ||v.READ_ACP||v.WRITE||v.WRITE_ACP};m.selectGrantee=function(v,x,w){m.isAddGranteeRowDisplayed=false;m.radioSelect.displayName=v;m.selectedGrantee={displayedValue:v,granteeDetails:d(v)};if(x){m.selectedGrantee.permissions=_.clone(m.permissionObj.grantees.group[v])}else{if(w){m.selectedGrantee.permissions=_.clone(m.permissionObj.grantees.system[v])}else{m.selectedGrantee.permissions=_.clone(m.permissionObj.grantees.accounts[v])}}m.panelOpen=true;m.panelHide=false};m.resetInputError=function(){if(!_.isEmpty(m.granteeList.inputError)){m.granteeList.inputError=null}};m.deleteAccountGrantee=function(){if(!m.disableDeleteButton()){m.selectedGrantee.permissions={READ:false,WRITE:false,READ_ACP:false,WRITE_ACP:false};m.updateGrantee(m.selectedGrantee)}};m.disableDeleteButton=function(){return m.shouldDisable||!(m.radioSelect&&!_.isEmpty(m.radioSelect.displayName)&&k.PUBLIC_PERMISSIONS_LIST.indexOf(m.radioSelect.displayName)===-1&&m.radioSelect.displayName!==k.LOG_DELIVERY_VALUE&&m.selectedGrantee&&m.selectedGrantee.displayedValue===m.radioSelect.displayName)};function d(x){for(var w in m.permissionObj.aclGrants){var v=m.permissionObj.aclGrants[w];if(v.Grantee.DisplayName===x||v.Grantee.ID===x||v.Grantee.URI&&v.Grantee.URI.split("/")[5]===x){return v.Grantee}}if(_.indexOf(k.SYSTEM_PERMISSIONS_LIST,x)>-1){return _.find(k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.systemPermissions,{detail:{value:x}}).detail}return _.find(k.BUCKET_PERMISSIONS.INITIALIZE_ACLS.publicPermissions,{detail:{value:x}}).detail}function r(){m.isAddGranteeRowDisplayed=false;m.granteeList.inputItem=null;m.granteeList.inputError=null;m.addingGrantee=false;m.granteeList.grantPermissions=null}m.save=function(){m.granteeList.inputError=null;m.addNewGranteeToACL(m.granteeList)};m.cancel=function(){m.granteeList.inputError=null;r()}}})();"use strict";(function(){angular.module("s3").service("UtilService",["$anchorScroll","$cookies","$document","$location","$q","$translate","$timeout","$window","AWSC","EZCRCService","FAC","Region","S3Constants","ReplicationConstants","PathService","CLOUD_SYSTEMS","AwsUrlsService",a]);function a(h,r,z,j,w,t,y,m,q,i,k,e,p,A,d,g,c){var n="aws-userInfo";var o="aws-creds";var x="s3console_crr_iam_template";var f="s3.amazonaws.com";var s=$("body");var b=300;this.createQueue=function(I){var C=[],G=0;if(Array.isArray(I)){C=I}function H(){if(G===C.length){return undefined}var J=C[G];G++;if(G>=(C.length-1)/2){C=C.slice(G);G=0}return J}function D(J){C.push(J)}function F(){return C.length-G}function E(){return C[G]}return{dequeue:H,enqueue:D,getLength:F,peek:E}};this.escapePath=function(G){var F=G.split(p.DELIMITER);var H=[];for(var E=0;E<F.length;E++){var D=encodeURIComponent(F[E]);var C=D.replace("*","%2A").replace("(","%28").replace(")","%29").replace("!","%21").replace("'","%27");H.push(C)}return H.join("/")};this.extractTopicName=function(C){return C.substring(C.lastIndexOf(":")+1)};this.extractQueueName=function(C){return C.substring(C.lastIndexOf("/")+1)};this.getIconClassFromFilename=function(C){if(C){var D=C.substr(C.lastIndexOf(".")+1);if(p.FILE_EXTENSIONS_ICON_MAP.hasOwnProperty(D)){return p.FILE_EXTENSIONS_ICON_MAP[D]}}return p.FILE_EXTENSIONS_ICON_MAP["default"]};this.getStorageClassTranslations=function(){return{STANDARD:t.instant("uploadmodal.label.standard"),"STANDARD-IA":t.instant("versionsdropdown.label.standard_ia"),STANDARD_IA:t.instant("versionsdropdown.label.standard_ia"),REDUCED_REDUNDANCY:t.instant("uploadmodal.label.reduced_redundancy"),GLACIER:t.instant("versionsdropdown.label.glacier")}};this.getEncryptionTranslations=function(){return{NONE:t.instant("sse.none"),AES256:t.instant("sse.aes256"),"aws:kms":t.instant("sse.aws.kms")}};this.transformListOfOptionsToDropdown=function(C){return _.map(C,function(D){return{text:D,value:D,disabled:false}})};this.getKmsKeyAlias=function(C){if(_.isArray(C.AliasList)&&C.AliasList.length>0){var E=C.AliasList[0].Alias;var D=E.split(p.OBJECT_SSE.KMS.ALIAS);if(D.length===2){return D[1]}}return C.KeyArn};this.getKMSAliasForArn=function(F,E){var C=undefined,G=undefined;if(_.isArray(E)){var D=F.split(p.OBJECT_SSE.KMS.KEY);if(D.length===2){C=D[1]}G=_.filter(E,function(H){return H.value===C&&H.text});if(G.length===1){return G[0].text}}return F};this.getStorageClassOptions=function(D){var E=this;var C=[];angular.forEach(D,function(F){var G=E.getStorageClassTranslations()[F];if(!G){G=F}C.push({value:F,text:G})});if(C.length>0){return C}return null};this.transformObjectToArray=function(D){if(!Array.isArray(D)){var C=D;D=[C]}return D};this.parseFunctionArn=function(E){var G={};var F=this.getLambdaARNPrefix();var D=E.substring(E.indexOf(F)+F.length+1);var C=D.split(":");G.region=C[0];G.accountNum=C[1];G.functionName=C[3];return G};this.getFACRegions=function(D,C){if(_.isEmpty(C)){_.forEach(D,function(E){if(p.FALLBACK_REGION_LIST[v()].indexOf(E.value)>-1){C.push(E)}})}};function v(){var C=e.DOMAINS.PUBLIC.NAME;var D=j.host();_.each(e.DOMAINS,function(F,E){if(_.contains(D,F.SUFFIX)||_.contains(D,F.GAMMA)){C=F.NAME}});return C}this.getCloudSystem=v;var u=this.getCloudSystem();this.getUserAccountId=function(){try{return JSON.parse(r.get(n)).arn.match(/[0-9]{12}/)[0]}catch(C){return null}};this.getUserNameARN=function(){try{return JSON.parse(r.get(n)).arn}catch(C){return null}};this.getCookie=function(C){var D="; "+document.cookie,E=D.split("; "+C+"=");if(E.length===2){return E.pop().split(";").shift()}return undefined};this.analyticsTrackClick=function(E,D){var C=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];C.s_fid=this.getCookie("s_fid");C["session-id"]=this.getCookie("session-id");q.Analytics.trackClick({id:E,context:D,metaData:C})};this.analyticsTrackView=function(E,D){var C=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];C.s_fid=this.getCookie("s_fid");C["session-id"]=this.getCookie("session-id");q.Analytics.trackView({id:E,context:D,metaData:C})};this.createOrUpdateRoleForReplication=function(F,H,D,J,G){var I=this.getUserAccountId();var K=w.defer();if(I===null){K.reject();return K.promise}var L={accountId:I,srcbucket:D,dstbucket:J};var E=this.getIamARNPrefix();var C=""+E+I+":";if(G){return i.createPolicyForServiceRole(F,H,f,x,2,C+"policy/service-role/"+H,L,this.getDefaultRegion()).then(function(){K.resolve();return K.promise})["catch"](function(M){var N=_.get(M,"response.Error.Code");if(N===A.ERROR_CODE.ENTITY_EXIST||N===A.ERROR_CODE.ACCESS_DENIED||N===A.ERROR_CODE.LIMIT_EXCEED){K.resolve()}else{K.reject(M)}return K.promise})}else{return i.zeroClickRoleCreation(F,H,f,x,2,C+"policy/service-role/"+H,L,this.getDefaultRegion()).then(function(M){K.resolve(C+"role/service-role/"+M.request.params.RoleName);return K.promise})["catch"](function(M){K.reject(M);return K.promise})}};this.createOrUpdateRoleForReplication_v1=function(F,H,D,J,G){var I=this.getUserAccountId();var K=w.defer();if(I===null){K.reject();return K.promise}var L={accountId:I,srcbucket:D,dstbucket:J};var E=this.getIamARNPrefix();var C=""+E+I+":";if(G){return i.createPolicyForServiceRole(F,H,f,x,2,C+"policy/service-role/"+H,L,this.getDefaultRegion()).then(function(){K.resolve();return K.promise})["catch"](function(M){var N=_.get(M,"response.Error.Code");if(N===p.REPLICATION.ERROR_CODE.ENTITY_EXIST||N===p.REPLICATION.ERROR_CODE.ACCESS_DENIED||N===p.REPLICATION.ERROR_CODE.LIMIT_EXCEED){K.resolve()}else{K.reject(M)}return K.promise})}else{return i.zeroClickRoleCreation(F,H,f,x,2,C+"policy/service-role/"+H,L,this.getDefaultRegion()).then(function(M){K.resolve(C+"role/service-role/"+M.request.params.RoleName);return K.promise})["catch"](function(M){K.reject(M);return K.promise})}};this.convertToArray=function(C){if(!Array.isArray(C)){var D=C;C=[];C.push(D)}return C};this.convertStringToBoolean=function(C){if(C==="true"){return true}else{if(C==="false"){return false}else{return undefined}}};this.isNumeric=function(C){return !isNaN(parseFloat(C))&&isFinite(C)};this.encodeXml=function(C){return C.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};this.scrollCardToView=function(D){var C=document.getElementById(D);C.scrollIntoView()};this.scrollCardToViewSmoothly=function(C){$("html, body").animate({scrollTop:_.isEmpty(C)?0:$(C).offset().top},b)};this.scrollTo=function(C){y(h,10,false,C)};var B=function B(D,C){if(_.isEmpty(D)){if(C.status&&Object.keys(p.STATUS_CODE_MAP).indexOf(C.status.toString())>-1){return p.STATUS_CODE_MAP[C.status.toString()]}else{return t.instant("utilities.unknown.error")}}return D};this.getErrorMessage=function(C){if(C){if(_.isString(C)){if(C==="Access Denied"||C==="AccessDenied"){return t.instant("resource.access.denied")}return C}else{if(C.data&&C.data.requestStatus&&C.data.requestStatus==="error"){if(C.data.errorCode.indexOf(p.HTTP_STATUS_CODES.ACCESS_DENIED.toString())>-1){return t.instant("resource.access.denied")}return C.data.errorCode.toString()}else{if(C.status){if(C.status===p.HTTP_STATUS_CODES.ACCESS_DENIED){return t.instant("resource.access.denied")}}}}}return undefined};this.handleErrors=function(C){if(!_.isEmpty(C)){if(_.isString(C)){if(C.toLowerCase()==="access denied"||C.toLowerCase()==="accessdenied"){return t.instant("resource.access.denied")}return C}if(_.isString(C.response)){return B(C.response,C)}if(C.response&&C.response.Error&&_.isString(C.response.Error.Message)){return B(C.response.Error.Message,C)}if(C.response&&_.isString(C.response.Message)){return B(C.response.Message,C)}if(C.Error&&C.Error.Message&&_.isString(C.Error.Message)){return B(C.Error.Message,C)}if(C.response&&C.response.message&&_.isString(C.response.message)){return B(C.response.message,C)}if(C.data&&C.data.requestStatus==="error"){if(C.data.errorCode&&C.data.errorCode.indexOf(p.HTTP_STATUS_CODES.ACCESS_DENIED.toString())>-1){return t.instant("resource.access.denied")}}if(_.isObject(C)&&_.keys(C).length>0){if(_.keys(C)[0].indexOf("Forbidden")>-1){return t.instant("resource.access.denied")}if(_.keys(C)[0].indexOf("Key")>-1){return _.keys(C)[0]}}}if(Array.isArray(C)&&C[0]===p.SESSION_TIMEOUT_MESSAGE){return this.handleSessionTimeout()}return t.instant("utilities.unknown.error")};this.isValidBucketName=function(E){var C=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];if(!E){C.push(t.instant("createbucketmodal.validation.invalid.error"));return false}var G="\0";var I="";for(var D=0;D<E.length;D++){var F=E.charAt(D);var H="";if(/[A-Z]/.test(F)){var J=t.instant("createbucketmodal.validation.uppercase.error");if(C.indexOf(J)===-1){C.push(J)}}if(F==="."){if(G==="\0"){H=t.instant("createbucketmodal.validation.start.error")}if(G==="."){H=t.instant("createbucketmodal.validation.periods.error")}if(G==="-"){H=t.instant("createbucketmodal.validation.dashperiod.error")}}else{if(F==="-"){if(G==="\0"){H=t.instant("createbucketmodal.validation.start.error")}if(G==="."){H=t.instant("createbucketmodal.validation.dashperiod.error")}}else{if(!/[a-z0-9]/.test(F)&&I.indexOf(F)===-1){if(!/[A-Z]/.test(F)){I+=F}if(G==="\0"){H=t.instant("createbucketmodal.validation.start.error")}}}}if(H&&C.indexOf(H)===-1){C.push(H)}G=F}if(G==="."||G==="-"){C.push(t.instant("createbucketmodal.validation.end.error"))}if(I.length>0){C.push(t.instant("createbucketmodal.validation.badchars.error")+" '"+I+"'")}if(E.length<3||E.length>63){C.push(t.instant("createbucketmodal.validation.length.error"))}if(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(E)){C.push(t.instant("createbucketmodal.validation.ipaddress.error"))}return C.length===0};this.bodyFreezeScroll=function(C,E){var G=undefined;if(C){G=s.width();s.addClass("noscroll");var D=s.innerWidth()-G;s.css("paddingRight",D);if(E){$(".storage-console-config-panel").css("marginRight",D)}}else{G=s.innerWidth();var F=G-s.innerWidth();s.css("paddingRight",F);if(E){$(".storage-console-config-panel").css("marginRight",F)}s.removeClass("noscroll")}};this.isIE=function(){var C=m.navigator.userAgent.toLowerCase();return C.indexOf("windows")!==-1||C.indexOf("msie")!==-1||C.indexOf("edge")!==-1};this.getRegionGroups=function(){var C={};angular.forEach(e.regionMapping,function(F){var D=F.value;var E=D.substr(0,2);if(C[E]){C[E].push(D)}else{C[E]=[D]}});return C};this.getRegionOrder=function(){var G=this.getDefaultRegion();try{G=e.getCurrentRegion()}catch(F){}var E=G.substr(0,2);var D=this.getRegionGroups();var C=[];C=_.union(C,D[E]);D=_.omit(D,E);angular.forEach(D,function(H){C=_.union(C,H)});return C};this.validateEmail=function(C){var D=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return D.test(C)};this.reduceObjectArrayToObject=function(C){var D={};C.forEach(function(F){var E=Object.keys(F);D[F[E[0]]]=F[E[1]]});return D};this.extractFromQuotes=function(E){var D=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var C=E;if(/"/.test(E)){C=E.match(/"(.*?)"/ig);C=C[D].substring(1,C[D].length-1)}return C};this.formatWithUnits=function(C){if(C<1024){return C+" B"}else{if(C<1024*1024){return Math.round(C/1024)+" KB"}else{if(C<1024*1024*1024){return(C/1024/1024).toFixed(1)+" MB"}else{if(C<1024*1024*1024*1024){return(C/1024/1024/1024).toFixed(2)+" GB"}else{if(C<1024*1024*1024*1024*1024){return(C/1024/1024/1024/1024).toFixed(2)+" TB"}else{return(C/1024/1024/1024/1024/1024).toFixed(2)+" PB"}}}}}};this.copyToClipboard=function(E){if(m.clipboardData&&m.clipboardData.setData){return m.clipboardData.setData("Text",E)}else{if(z[0].queryCommandSupported&&z[0].queryCommandSupported("copy")){var C=z[0].createElement("textarea");C.textContent=E;z[0].body.appendChild(C);C.select();try{return z[0].execCommand("copy")}catch(D){return false}finally{z[0].body.removeChild(C)}}}};this.getBucketARN=function(C){var D=this.getARNPrefix(p.AWS_SERVICE.S3);return""+D+C};this.getLambdaARNPrefix=function(){return this.getARNPrefix(p.AWS_SERVICE.LAMBDA)};this.getIamARNPrefix=function(){return this.getARNPrefix(p.AWS_SERVICE.IAM)};this.getSqsARNPrefix=function(){return this.getARNPrefix(p.AWS_SERVICE.SQS)};this.getSnsARNPrefix=function(){return this.getARNPrefix(p.AWS_SERVICE.SNS)};this.getARNPrefix=function(C){var E=e.DOMAINS[u].ARN;var D=p.ARN_SERVICE[C];return""+E+D};this.formatXml=function(C){var E="";var D=/(>)(<)(\/*)/g;C=C.replace(D,"$1\r\n$2$3");var F=0;C.split("\r\n").forEach(function(I){var G=0;if(I.match(/.+<\/\w[^>]*>$/)){G=0}else{if(I.match(/^<\/\w/)){if(F!==0){F-=1}}else{if(I.match(/^<\w[^>]*[^\/]>.*$/)){G=1}else{G=0}}}var J="";for(var H=0;H<F;H++){J+="  "}E+=J+I+"\r\n";F+=G});return E};this.checkValue=function(F,E){var D=this;var C=false;if(F){(function(){var G=D.transformObjectToArray(E);var H=D.transformObjectToArray(F);C=H.some(function(I){return G.some(function(J){return J===I})})})()}return C};this.copyPathToClipboard=function(D,E){var C=d.relativeToAbsoluteObjectPath(D);this.copyToClipboard(C);E.flag=true;y(function(){E.flag=false},1000)};this.validateBucketName=function(D,F,E){var C=[];if(this.isValidBucketName(D,C)){if(l(D,E)){F.length=0;F.push(t.instant("createbucketmodal.bucketname.exists.error"))}else{F.length=0}}else{F.length=0;C.forEach(function(G){F.push(G)})}};function l(C,D){return D.some(function(E){return E.Name===C})}this.handleSessionTimeout=function(){var C=false;if(!this.isIE()||this.isIE()&&this.getCookie(o)){C=m.confirm(t.instant("sessionauth.expired"))}if(C){m.location.reload()}else{return w.reject(p.SESSION_TIMEOUT_MESSAGE)}};this.getPricingUrl=function(){var C={};C[g.BJS]="https://console.amazonaws.cn/billing/content?document=pricingplan#glacier";return c.getMarketingUrl("glacier/pricing",C)};this.getDataRetrievalUrl=function(){return c.getMarketingUrl("glacier/faqs/#dataretrievals")};this.getDefaultRegion=function(){return p.DEFAULT_REGION[this.getCloudSystem()]};this.getAWSCMezzRegion=function(){if(z[0]&&z[0].head&&z[0].head.querySelector('[id="awsc-mezz-region"]')){return z[0].head.querySelector('[id="awsc-mezz-region"]').content}};this.CRRFACHandle=function(){var C=k.isFeatureEnabled(p.FAC.CRR);var E=k.isFeatureEnabled(p.FAC.CRR_V2);var D={v1:false,v2:false};if(!C){D.v1=false;D.v2=false}else{if(E){D.v1=false;D.v2=true}else{D.v1=true;D.v2=false}}return D}}})();"use strict";(function(){angular.module("s3").directive("stickyNav",function(){function b(d,e){if(d[0].firstElementChild){$(d[0].firstElementChild).css({position:"fixed",top:e})}}function a(d,e){if(d[0].firstElementChild){$(d[0].firstElementChild).css({position:"absolute",top:e})}}return{restrict:"A",link:function c(h,f,e){var k=e.stickyNav,i=parseInt(e.stickyNavPaddingTop,10),d=e.isSidePanel,j=e.panelNavToggle,g=e.panelNavRemove;$(window).on("scroll",function(){if($(window).scrollTop()>=i){d?b(f,j):f.addClass(k)}else{d?a(f,g):f.removeClass(k)}})}}})})();"use strict";(function(){angular.module("s3").directive("breadcrumbs",[function(){return{restrict:"E",templateUrl:"/s3/partials/breadcrumbs.html",scope:{},controller:"BreadcrumbsController"}}]);angular.module("s3").controller("BreadcrumbsController",["$routeParams","$scope","PathService","Region","S3Constants",a]);function a(f,b,d,e,c){b.currentRegion=e.getCurrentRegion();b.objects=d.getFolderList();b.objects.forEach(function(g){if(g.path){g.path="buckets"+g.path+"?region="+b.currentRegion+"&tab=overview";if(f[c.SHOW_DELETED_PARAM]){g.path=g.path+"&"+c.SHOW_DELETED_PARAM+"="+f[c.SHOW_DELETED_PARAM]}}});b.condenseBreadcrumbs=false;if(b.objects.length>5){b.condenseBreadcrumbs=true}}})();"use strict";(function(){angular.module("s3").directive("search",function(){return{restrict:"E",templateUrl:"/s3/partials/search.html",scope:{fetchOnePagePrefix:"&?",fetchOnePageTag:"&?",filters:"=?",markers:"=?",noBackendCalls:"=?",searchError:"=?",showTag:"=?",tagContinuationTokens:"=?",tagSearchSelected:"=?",tagQueryDeferred:"=?",empty:"=?"},controller:"SearchController"}});angular.module("s3").controller("SearchController",["$filter","$routeParams","$scope","$translate","FAC","focusOn","PathService","S3Constants",function(h,k,l,a,j,n,i,e){var m=new RegExp(/[^+ \- = . _ : /A-Za-z0-9 ]/g),d=new RegExp(/[^+ \- = . _ : , /A-Za-z0-9 ]/g),g=new RegExp(/,[^ ](?!\1)|,$/g);l.objectTaggingEnabled=(l.noBackendCalls||_.isUndefined(i.getCurrentAbsoluteFolderPath()))&&j.isFeatureEnabled(e.FAC.OBJECT_TAGGING);if(!l.noBackendCalls&&!j.isFeatureEnabled(e.FAC.TAG_QUERY)){l.objectTaggingEnabled=false}l.inputDropdownText=l.objectTaggingEnabled?a.instant("tagsearch.dropdowntext"):a.instant("prefixsearch.dropdowntext");l.getInputPlaceholder=function(){if(l.empty){return a.instant("prefixtagsearch.optional.placeholder")}if(l.noBackendCalls){return a.instant("prefixtagsearch.placeholder")}if(!l.objectTaggingEnabled){return a.instant("prefixsearch.placeholder")}else{if(l.filters&&l.filters.tagFilters.length>0){return a.instant("tagsearch.addfilter")}else{return a.instant("tagsearch.placeholder")}}};l.clearFilterInput=function(){l.filters.input=""};l.highlightRow=function(o){l.tagSearchSelected=o};l.filterKeyDown=function(o){l.dropdownOpen=true;if(o&&o.keyCode===e.KEY_CODES.ESC){l.clearFilterInput();b();l.prefixSearch()}if(o&&o.keyCode===e.KEY_CODES.ENTER){if(_.isEmpty(l.filters.input)&&l.noBackendCalls){return}if(l.showTag){l.tagSearch(true);l.closeDropdown()}else{if(l.tagSearchSelected){l.selectTag()}else{l.prefixSearch();l.closeDropdown();if(l.noBackendCalls){l.filters.input=""}}}}if(l.objectTaggingEnabled&&o&&o.keyCode===e.KEY_CODES.DOWN){o.preventDefault();l.tagSearchSelected=true}if(l.objectTaggingEnabled&&o&&o.keyCode===e.KEY_CODES.UP){o.preventDefault();l.tagSearchSelected=false}};l.shouldShowTag=function(){if(!l.filters||!l.filters.input||!l.objectTaggingEnabled){return false}var o=l.filters.input;if(o.search(/.+ \| /g)>-1){l.showTag=true;return true}else{l.showTag=false;return false}};l.selectTag=function(){l.searchError="";l.showTag=true;l.filters.input=l.filters.input+" | ";n("prefixSearchInput")};l.openDropdown=function(){l.dropdownOpen=true};l.closeDropdown=function(){l.dropdownOpen=false;l.tagSearchSelected=false};l.isSearchEmpty=function(){if(l.filters&&_.isEmpty(l.filters.input)){l.searchError="";l.tagSearchSelected=false;l.showTag=false;return true}else{return false}};l.removePrefixFilter=function(o){l.filters.input="";for(var p=0;p<l.filters.prefixFilters.length;p++){if(o===l.filters.prefixFilters[p]){l.filters.prefixFilters.splice(p,1)}}l.prefixSearch()};l.removeTagFilter=function(o){if(l.tagQueryDeferred){l.tagQueryDeferred.reject()}for(var p=0;p<l.filters.tagFilters.length;p++){if(o===l.filters.tagFilters[p]){l.filters.tagFilters.splice(p,1)}}if(l.filters.tagFilters.length>0){l.tagSearch(false)}else{if(!l.noBackendCalls){l.fetchOnePagePrefix({prefix:""})}}};l.prefixSearch=function(){l.searchError="";var q=l.filters.input.indexOf("/");if(l.noBackendCalls&&q===0){l.bucketName=k[e.PATH_SEGMENTS.BUCKET_NAME];l.prefixInfo=l.filters.input}else{l.bucketName="";l.prefixInfo=""}if(!l.noBackendCalls&&q!==-1){l.searchError=a.instant("prefixsearch.validation.error")}else{var p="";var o=l.filters.input;if(!l.noBackendCalls){l.filters.tagFilters=[];p=i.getCurrentAbsoluteFolderPath()||"";p=p.concat(o)}if(o!==""){l.filters.prefixFilters=[o];if(l.noBackendCalls){l.filters.input=""}l.closeDropdown()}else{l.filters.prefixFilters=[]}if(!l.noBackendCalls){if(l.tagQueryDeferred){l.tagQueryDeferred.reject()}l.markers=[];l.fetchOnePagePrefix({prefix:p})}}};l.tagSearch=function(o){l.tagContinuationTokens=[];l.searchError="";if(o){(function(){var q=l.filters.input,s=q.split(" | "),r=s[0],u=s[1],t=u.split(",");if(r.length>e.ENTITY_MAX_LENGTH.TAG_KEY){l.searchError=a.instant("tagKey.length.error")}else{if(!c(t)){l.searchError=a.instant("tagVal.length.error")}else{if(r.search(m)>-1){l.searchError=a.instant("tagKey.validation.error")}else{if(u.search(d)>-1||u.search(g)>-1){l.searchError=a.instant("tagVal.validation.error")}else{if(f(r,t)){l.searchError=a.instant("tagsearch.duplicate.error")}else{var p=true;l.filters.input="";if(!l.noBackendCalls){angular.forEach(l.filters.tagFilters,function(v){if(v.tagKey===r){v.tagVal+=", "+u;p=false}})}if(p){l.filters.tagFilters=l.filters.tagFilters.concat({tagKey:r,tagVal:u})}}}}}}})()}l.tagSearchSelected=false;l.showTag=false;if(!l.noBackendCalls){if(l.tagQueryDeferred){l.tagQueryDeferred.reject()}l.filters.prefixFilters=[];l.fetchOnePageTag()}};function c(p){var o=true;angular.forEach(p,function(q){if(q.length>e.ENTITY_MAX_LENGTH.TAG_VALUE){o=false}});return o}function f(o,p){var q=false;angular.forEach(l.filters.tagFilters,function(r){if(r.tagKey===o){angular.forEach(p,function(s){if(r.tagVal.indexOf(s)>-1){q=true}})}});return q}function b(){l.searchError="";l.tagSearchSelected=false;l.showTag=false;l.tagContinuationTokens=[];if(l.filters){l.filters.input="";l.filters.prefixFilters=[];l.filters.tagFilters=[]}else{l.filters={input:"",prefixFilters:[],tagFilters:[]}}}if(!l.noBackendCalls){b()}}])})();"use strict";(function(){angular.module("s3").directive("filedrop",["S3Constants","SCLogService",function(a,b){return{restrict:"A",link:function c(f,e,d){function g(k){for(var j in k){if(k[j].kind==="file"){return true}}return false}function h(){e.off("drop");e.off("dragdrop");e.off("dragover")}e.on("drop",function(i){i.stopPropagation();i.preventDefault();if(!i.originalEvent.dataTransfer||!g(i.originalEvent.dataTransfer.items)){return}f.$apply(function(){f.$emit("fileDropEvent",i.originalEvent.dataTransfer.items)})});e.on("dragdrop",function(i){i.stopPropagation();i.preventDefault()});e.on("dragover",function(i){i.stopPropagation();i.preventDefault()});f.$on("$destroy",h)}}}])})();"use strict";(function(){angular.module("s3").service("BucketPropertiesUtilService",["BucketPropertiesService","S3Constants","$filter","$q","$translate","UtilService","XMLParser",function(g,l,k,q,m,t,u){function h(v,x){if(v.BucketLoggingStatus&&v.BucketLoggingStatus.LoggingEnabled){var w=v.BucketLoggingStatus.LoggingEnabled;x.selectedValue=l.BUCKET_PROPERTIES.ENABLE;x.targetPrefix=_.isEmpty(w.TargetPrefix)?"":w.TargetPrefix;x.targetBucket=w.TargetBucket;if(w.TargetGrants){x.targetGrants=w.TargetGrants.Grant}else{x.targetGrants=[]}}else{x.selectedValue=l.BUCKET_PROPERTIES.DISABLE;x.targetPrefix="";x.targetBucket="";x.targetGrants=[]}}function r(z){var y="<RoutingRule>";if(z.Condition){y+="<Condition>";if(z.Condition.KeyPrefixEquals){if(_.isEmpty(z.Condition.KeyPrefixEquals)){y+="<KeyPrefixEquals/>"}else{var x=t.encodeXml(z.Condition.KeyPrefixEquals);y+="<KeyPrefixEquals>"+x+"</KeyPrefixEquals>"}}if(z.Condition.HttpErrorCodeReturnedEquals){if(_.isEmpty(z.Condition.HttpErrorCodeReturnedEquals)){y+="<HttpErrorCodeReturnedEquals/>"}else{var C=t.encodeXml(z.Condition.HttpErrorCodeReturnedEquals);y+="<HttpErrorCodeReturnedEquals>"+C+"</HttpErrorCodeReturnedEquals>"}}y+="</Condition>"}if(z.Redirect){y+="<Redirect>";if(z.Redirect.Protocol){var D=t.encodeXml(z.Redirect.Protocol);y+="<Protocol>"+D+"</Protocol>"}if(z.Redirect.HostName){var w=t.encodeXml(z.Redirect.HostName);y+="<HostName>"+w+"</HostName>"}if(z.Redirect.ReplaceKeyPrefixWith){if(_.isEmpty(z.Redirect.ReplaceKeyPrefixWith)){y+="<ReplaceKeyPrefixWith/>"}else{var A=t.encodeXml(z.Redirect.ReplaceKeyPrefixWith);y+="<ReplaceKeyPrefixWith>"+A+"</ReplaceKeyPrefixWith>"}}if(z.Redirect.ReplaceKeyWith){if(_.isEmpty(z.Redirect.ReplaceKeyWith)){y+="<ReplaceKeyWith/>"}else{var B=t.encodeXml(z.Redirect.ReplaceKeyWith);y+="<ReplaceKeyWith>"+B+"</ReplaceKeyWith>"}}if(z.Redirect.HttpRedirectCode){var v=t.encodeXml(z.Redirect.HttpRedirectCode);y+="<HttpRedirectCode>"+v+"</HttpRedirectCode>"}y+="</Redirect>"}y+="</RoutingRule>";y=y;return y}function p(v,z){if(v&&v.WebsiteConfiguration){var w=v.WebsiteConfiguration;if(w.RedirectAllRequestsTo){z.selectedValue=l.BUCKET_PROPERTIES.WEBSITE.REDIRECT_REQUEST;z.targetDomain=angular.copy(w.RedirectAllRequestsTo.HostName);z.redirectRequestProtocol=_.isEmpty(w.RedirectAllRequestsTo.Protocol)?"":w.RedirectAllRequestsTo.Protocol;z.websiteEnabledOption=m.instant("bucketproperties.website.footer.redirectallrequests");z.websiteEnabledContent=angular.copy(z.targetDomain);z.indexDocument="";z.errorDocument="";z.routingXML=""}else{if(w.IndexDocument){z.selectedValue=l.BUCKET_PROPERTIES.WEBSITE.USE_BUCKET;z.indexDocument=angular.copy(w.IndexDocument.Suffix);z.websiteEnabledOption=m.instant("bucketproperties.website.footer.buckethosting");z.websiteEnabledContent=angular.copy(z.indexDocument);if(w.ErrorDocument){z.errorDocument=angular.copy(w.ErrorDocument.Key)}if(w.RoutingRules){var C="<RoutingRules>";var B=t.transformObjectToArray(w.RoutingRules.RoutingRule);if(B.length){for(var y=0,A=B.length;y<A;y++){var x=B[y];C+=r(x)}}C+="</RoutingRules>";z.routingXML=t.formatXml(angular.copy(C));z.routingXMLToggle=true}else{z.routingXML=""}z.targetDomain="";z.redirectRequestProtocol=""}}}else{z.selectedValue=l.BUCKET_PROPERTIES.DISABLE;s(z)}}function c(v,x){if(v.Tagging.TagSet.Tag.length){for(var w=0;w<v.Tagging.TagSet.Tag.length;w++){x.push({Key:v.Tagging.TagSet.Tag[w].Key,Value:_.isEmpty(v.Tagging.TagSet.Tag[w].Value)?"":v.Tagging.TagSet.Tag[w].Value})}}else{x.push({Key:v.Tagging.TagSet.Tag.Key,Value:_.isEmpty(v.Tagging.TagSet.Tag.Value)?"":v.Tagging.TagSet.Tag.Value})}}function s(v){v.websiteEnabledOption="";v.websiteEnabledContent="";v.indexDocument="";v.errorDocument="";v.routingXML="";v.targetDomain="";v.redirectRequestProtocol=""}function f(v){var y=[{name:l.EVENTS.TOPIC,value:l.EVENTS.TOPICCONFIG,display:l.EVENTS.SNS,dropdown:"SNS topics"},{name:l.EVENTS.QUEUE,value:l.EVENTS.QUEUECONFIG,display:l.EVENTS.SQS,dropdown:"SQS queues"},{name:l.EVENTS.CLOUDFN,value:l.EVENTS.CLOUDCONFIG,display:l.EVENTS.LAMBDA,dropdown:"Lambda functions"}];var w={};var x=v.NotificationConfiguration;y.forEach(function(A){var z=[];var B=x[A.value];if(B){B=t.convertToArray(B);B.forEach(function(C){z.push(j(C,A))})}w[A.name]=z});return w}function j(w,y){var z={};z.id=w.Id;if(w.Filter&&w.Filter.S3Key&&w.Filter.S3Key.FilterRule){var v=t.convertToArray(w.Filter.S3Key.FilterRule);v.forEach(function(A){if(A.Name===l.EVENTS.PREFIX&&A.Value&&!_.isEmpty(A.Value)&&A.Value!==""){z.prefix=A.Value}if(A.Name===l.EVENTS.SUFFIX&&A.Value&&!_.isEmpty(A.Value)&&A.Value!==""){z.suffix=A.Value}})}z.arn=w[y.name];z.events=[];var x=t.convertToArray(w.Event);x.forEach(function(A){z.events.push(A)});z.type=y.display;return z}function o(B,x,A){var w=B.length;if(w===1){for(var z=0;z<x[0].length;z++){x[0][z].disabled=false}}else{if(w===2){for(var z=0;z<w;z++){for(var y=0;y<x[z].length;y++){x[z][y].disabled=false}}if(!_.isEmpty(B[0].action)){var C=A[B[0].action];for(var z=0;z<=C;z++){x[1][z].disabled=true}}if(!_.isEmpty(B[1].action)){var v=A[B[1].action];for(var z=v;z<x[0].length;z++){x[0][z].disabled=true}}}else{if(w===x.length){for(var z=0;z<w;z++){for(var y=0;y<w;y++){x[z][y].disabled=z!==y?true:false}}}}}}function a(v,x){if(x.length===l.LIFECYCLE.TOTAL_OPTIONS){return true}else{for(var w=0;w<x.length;w++){if(x[w].action===v){return true}}return false}}function b(w){if(w){var v=w.lastIndexOf(":");return w.substring(v+1)}return w}function n(y,z,v,C,A){v.rulesArray=[];var x=u.convertXmlStringToJson(y);if(x.ReplicationConfiguration&&x.ReplicationConfiguration.Rule){var B=x.ReplicationConfiguration.Rule;if(Array.isArray(B)){v.isEnabled=l.REPLICATION.DISABLED;v.destinationBucket=i(B[0].Destination.Bucket);v.replicationType="prefix";B.forEach(function(D){v.isEnabled=v.isEnabled===l.REPLICATION.ENABLED||D.Status===l.REPLICATION.ENABLED?l.REPLICATION.ENABLED:l.REPLICATION.DISABLED;e(D,v.rulesArray)})}else{v.isEnabled=B.Status;v.destinationBucket=i(B.Destination.Bucket);if(z===B.ID){v.replicationType="bucket";v.storageClass=B.Destination.StorageClass&&!_.isEmpty(B.Destination.StorageClass)?B.Destination.StorageClass:l.STORAGE_CLASSES.DEFAULT}else{v.replicationType="prefix";e(B,v.rulesArray)}}v.role=x.ReplicationConfiguration.Role;return g.getBucketLocation(v.destinationBucket).then(function(D){if(!A){v.resetDestinationBucket=true}v.destinationRegion=!_.isEmpty(C)?_.find(C,{value:D}):D})}else{v.role="";v.destinationBucket="";v.destinationRegion="";v.storageClass="";v.rulesArray=[];v.replicationType="";v.isEnabled=l.REPLICATION.DISABLED;v.response="";var w=q.defer();return w.promise}}function d(w,v){if(v.replicationType==="bucket"){v.rules=[{id:w,prefix:"",status:v.isEnabled}];if(v.storageClass!=="default"){v.rules[0].storageClass=v.storageClass}}else{v.rules=[];v.rulesArray.forEach(function(y){if(!y.markedForDelete){var x=_.clone(y);if(x.storageClass==="default"){delete x.storageClass}if(v.isEnabled===l.REPLICATION.DISABLED){x.status=l.REPLICATION.DISABLED}v.rules.push(x)}})}}function i(v){return v.substring(v.lastIndexOf(":")+1)}function e(v,w){w.push({id:v.ID,prefix:v.Prefix,status:v.Status,storageClass:v.Destination.StorageClass&&!_.isEmpty(v.Destination.StorageClass)?v.Destination.StorageClass:l.STORAGE_CLASSES.DEFAULT,markedForDelete:false})}return{clearAllWebsiteFields:s,populateLoggingFields:h,populateWebsiteFields:p,populateTagsFields:c,generateRoutingRuleXML:r,parseBucketNotificationConfig:f,updateLifecycleDropdown:o,isTransitionDisabled:a,stripBucketARN:b,populateReplicationObj:n,handleRules:d}}])})();"use strict";(function(){angular.module("s3").directive("actionDropdown",[function(){return{restrict:"E",scope:{text:"@",items:"=",bucketname:"=",isSingleObjectOnlySelected:"=",getSelectedFolders:"=",getSelectedObjects:"=",showDeleted:"=?",tagFilterLength:"=",disableTakeAction:"=?"},template:'<awsui-button-dropdown ng-click="takeAction()" item-click="triggerItem(event)" items="items" text="{{text}}"></awsui-button-dropdown>',controller:"ActionDropdownController"}}]);angular.module("s3").controller("ActionDropdownController",["$scope","CopyService","FAC",a]);function a(j,b,f){var i=["getinfo","download","rename","initiaterestore","dropdowndelete","cut","copy","changestorageclass","changeencryption","makeobjectpublic"],d=["download","rename","initiaterestore"],g=["getinfo","makeobjectpublic","initiaterestore","dropdowndelete"],e=["download","rename","initiaterestore"],c=["undodelete"];if(f.isFeatureEnabled("s3-ot")){i.push("addobjecttags");d.push("addobjecttags")}function h(t){var p=function p(v,u){_.forEach(v,function(w){t[w].disabled=u})};var n=j.getSelectedObjects(),m=j.getSelectedFolders(),o=_.isEmpty(n)&&_.isEmpty(m),k=b.getClipboardOperation()!==null,s=j.isSingleObjectOnlySelected(),q=m.length>=1,l=m.length===1&&n.length===0,r=m.length===0&&_.every(n,{StorageClass:"GLACIER"});t.paste.disabled=!k;if(o){p(i,true)}else{if(j.showDeleted){p(i,true);p(c,true);if(!q){p(c,false)}}else{if(r||s&&r){p($(i).not(g),true);p(g,false)}else{if(q){p(d,true);p($(i).not(d),false)}else{if(!s&&!l){p(e,true);p($(i).not(e),false)}else{if(j.tagFilterLength>0){p($(i).not(["initiaterestore","rename"]),false);p(["initiaterestore","rename"],true)}else{p($(i).not(["initiaterestore"]),false);p(["initiaterestore"],true)}}}}}}}j.takeAction=function(){if(j.items&&j.items[0].items&&!j.disableTakeAction){var k={getinfo:j.items[0].items[0],download:j.items[0].items[1],rename:j.items[1].items[0],dropdowndelete:j.items[1].items[1],undodelete:j.items[1].items[2],showdeleteobjs:j.items[1].items[3],cut:j.items[2].items[0],copy:j.items[2].items[1],paste:j.items[2].items[2],changestorageclass:j.items[3].items[0],initiaterestore:j.items[3].items[1],changeencryption:j.items[3].items[2],makeobjectpublic:j.items[3].items[3]};if(f.isFeatureEnabled("s3-ot")){k.addobjecttags=j.items[3].items[4]}h(k)}};j.triggerItem=function(m){var n=m.originalEvent.detail.id;function k(o){if(o.id===n){return o}if(o.items){return o.items.filter(k)[0]}}var l=j.items.map(k).filter(function(o){return o})[0];l.action()}}})();"use strict";(function(){angular.module("s3").service("CountService",["ConsoleOperation","KeySelectionService","PathService","S3Constants","SCLogService","S3CWSAPIService","$q",function(h,i,k,b,o,n,e){var f="generateCountInvoked";var m="generateCountBucket";var a="generateCountRequest";var g="CountCompleted";var d={generateCountForOperation:j,generateCountForFullPathFoldersWithContinuationTokens:c,countAllFiles:l};return d;function j(q){var p=e.defer();q.countResultEachFolder={};var v=Math.ceil(q.selectedFolders.length/b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API);var u=0;function t(x){d.generateCountForFullPathFoldersWithContinuationTokens(q,x,[]).then(function(z){u+=1;if(u===v){o.log(g,1,z);p.resolve(z)}else{var y=[];var B=z.selectedFolders.length<=(u+1)*b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API?z.selectedFolders.length:(u+1)*b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API;for(var A=u*b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API;A<B;A++){y.push(z.selectedFolders[A].Prefix)}t(y)}})["catch"](function(y){p.reject(y);o.log(g,0,q)})}var s=[];var w=q.selectedFolders.length<=b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API?q.selectedFolders.length:b.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API;for(var r=0;r<w;r++){s.push(q.selectedFolders[r].Prefix)}t(s);return p.promise}function c(p,s,t){var r=p.initialBucket;var u=p.initialPath;var q={};q.bucket=r;q.path=u;q.selectedFolders=s;o.log(f,1,p,q);if(s.length===0){o.log(m,1,p,q);s=[""]}return n.generateCount(r,s,t,p).then(function(v){if(v&&v.data&&v.data.statusPerKey){o.logRequestComplete(a,p);var x=[];var w=[];_.each(v.data.statusPerKey,function(z){if(z.result&&z.result.additionalInfoWhenSuccess){var y=z.result.additionalInfoWhenSuccess;if(p.countResultEachFolder[z.key]){p.countResultEachFolder[z.key].count+=y.count;p.countResultEachFolder[z.key].totalSize+=y.totalSize}else{p.countResultEachFolder[z.key]=y}p.keyCount+=y.count;p.totalSizeInBytes+=y.totalSize;if(y.continuationToken){x.push(y.continuationToken);w.push(z.key)}}});if(x.length>0){return e.resolve(c(p,w,x))}return e.resolve(p)}return e.reject(v)})["catch"](function(v){o.log(a,0,p,{bucketName:r,path:u,error:v});p.keyCount=-1;return e.reject(v)})}function l(t,p,q,s){s.flag=true;var r=i.countCurrLevelFiles(t);p.sizeDataMissing=r.sizeDataMissing;p.folders=r.totalFolders;p.currLevelObjs=r.totalObjs;p.objects=r.totalObjs;p.size=r.totalSize;q.totalSizeInBytes=r.totalSize;p.flag=true;if(t.folders&&!_.isEmpty(t.folders)){d.generateCountForOperation(q).then(function(){o.log("generateCountForOperation",1,q);p.objects+=q.keyCount;p.size=q.totalSizeInBytes;angular.forEach(q.countResultEachFolder,function(v,u){p.countResultEachFolder[u]=v})})["catch"](function(u){p.error=u;o.log("generateCountForOperation",0,q,{errorMessage:u})})["finally"](function(){s.flag=false})}else{s.flag=false}}}])})();"use strict";(function(){angular.module("s3").service("DownloadService",["ConsoleOperation","KeySelectionService","PathService","S3CWSAPIService","SCLogService","$q","$window",function(l,q,d,e,c,t,m){var h="objectDownload";var a="objDLPresignFetchStart";var i="fetchPresignedUrl";var n="DownloadSize";var f="Content-Disposition";var o="attachment";var r="inline";var g="GET";function s(B,v,D,x,w,A){var C={};C[f]=A?r:o;var z=w===null?{}:{versionId:w};return e.fetchPresignedUrl(v,B,g,C,z,null,null,x).then(function u(E){c.log(n,D,x);c.log(i,1,x,{key:B,bucket:v});return t.resolve(E)},function y(F){var E={};E.error=F;E.key=B;E.bucket=v;c.log(i,0,x,E);return t.reject(E)})}function b(z,y,x){var w=d.getCurrentBucket();var v=new l(h,a);return s(z,w,y,v,x).then(function u(A){m.location.href=A.data.presignedUrl;return t.resolve(A)})}function p(v){var x=arguments.length<=1||arguments[1]===undefined?true:arguments[1];if(v&&v.Key){var w=v.VersionId?v.VersionId:null;var y=_.cloneDeep(v.Key);if(x){y=d.relativeToAbsoluteObjectPath(y)}return b(y,v.Size,w)}var u=t.defer();u.reject(v);return u.promise}function j(w){var z=arguments.length<=1||arguments[1]===undefined?true:arguments[1];var y=d.getCurrentBucket();var v=new l(h,a);if(w&&w.Key){var x=w.VersionId?w.VersionId:null;var A=_.cloneDeep(w.Key);if(z){A=d.relativeToAbsoluteObjectPath(A)}return s(A,y,w.Size,v,x)}var u=t.defer();u.reject(w);return u.promise}function k(z,y){var x=arguments.length<=2||arguments[2]===undefined?null:arguments[2];var A=arguments.length<=3||arguments[3]===undefined?true:arguments[3];var w=d.getCurrentBucket();var v=new l(h,a);var B=_.cloneDeep(z);if(A){B=d.relativeToAbsoluteObjectPath(B)}s(B,w,y,v,x,true).then(function u(C){m.open(C.data.presignedUrl,"_blank")})}return{downloadCurrentSelection:p,generatePresignedUrlForCurrentObject:j,openInBrowser:k}}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("addEventsForm",function(){return{restrict:"E",scope:{isOpen:"=",selectedEvent:"=",updateEvents:"=",eventTypes:"=",currentConfig:"=",resourceTypes:"=",forCreateBucketModal:"=?",modalInfo:"=?",cardState:"=",currentEvents:"="},templateUrl:"/s3/partials/addeventsform.html",controller:"AddEventController"}});angular.module("s3").controller("AddEventController",["$filter","$scope","$translate","BucketPropertiesService","ConsoleOperation","LambdaService","PathService","APIProxyService","S3Constants","SCLogService","SNSService","SQSService","UtilService","XMLParser",function(l,n,o,h,i,q,d,p,m,c,v,s,t,u){var a;var j=(a={},_defineProperty(a,m.EVENTS.SNS,m.EVENTS.TOPIC),_defineProperty(a,m.EVENTS.SQS,m.EVENTS.QUEUE),_defineProperty(a,m.EVENTS.LAMBDA,m.EVENTS.CLOUDFN),a);var g={SNS:"sns",SQS:"sqs",LAMBDA:"lambda"};var b=function b(){n.showCustomArn=false;n.eventResources=[];n.eventsChecked={};n.eventTypes.forEach(function(x){n.eventsChecked[x.complexName]=false});n.resourceTypesDropdown=[];n.resourceTypes.forEach(function(x){n.resourceTypesDropdown.push({text:x.dropdown,value:x.display})});n.selectValue={value:""};n.bucket=d.getCurrentBucket();n.currentEventType=n.eventTypes[0];n.S3Constants=m;n.selectedEvent.events.forEach(function(x){n.eventsChecked[x]=true});n.cachedSelectedEvents=_.cloneDeep(n.selectedEvent);n.updateEventResources()};var r=function r(y){if(_.isEmpty(y.arn)&&n.selectValue&&!_.isEmpty(n.selectValue.value)&&n.selectValue.value.indexOf(n.selectedEvent.type.toLowerCase())>-1){y.arn=n.selectValue.value}if(_.isEmpty(y.arn)){return}var x=_.find(n.eventResources,function(z){return z.text===y.arn.substring(y.arn.lastIndexOf(":")+1)});if(x===undefined){n.selectValue.value=m.EVENTS.CUSTOM;n.showCustomArn=true}else{n.selectValue.value=x.value}};n.updateEventResources=function(){n.eventResources=[];if(n.forCreateBucketModal){return k(n.modalInfo.region)}else{return h.getBucketLocation(n.bucket).then(function(x){return k(x)})["catch"](function(x){n.cardState.errorMessage=x.response;n.cardState.showError=true})}};n.getCustomArnLabel=function(){var x=undefined;switch(n.selectedEvent.type){case m.EVENTS.SNS:x=o.instant("events.label.customsnsarn");n.customarn_placeholder=t.getARNPrefix(m.AWS_SERVICE.SNS)+m.EVENTS.CUSTOM_PLACEHOLDER.SNS;break;case m.EVENTS.SQS:x=o.instant("events.label.customsqsarn");n.customarn_placeholder=t.getARNPrefix(m.AWS_SERVICE.SQS)+m.EVENTS.CUSTOM_PLACEHOLDER.SQS;break;case m.EVENTS.LAMBDA:x=o.instant("events.label.customlambdaarn");n.customarn_placeholder=t.getARNPrefix(m.AWS_SERVICE.LAMBDA)+m.EVENTS.CUSTOM_PLACEHOLDER.LAMBDA;break}return x};function f(){if(n.cachedSelectedEvents&&n.cachedSelectedEvents.type&&n.selectedEvent.type!==n.cachedSelectedEvents.type){var x=_.findIndex(n.currentEvents[j[n.cachedSelectedEvents.type]],function(y){return y.id===n.cachedSelectedEvents.id});n.currentEvents[j[n.cachedSelectedEvents.type]].splice(x,1);n.currentEvents[j[n.selectedEvent.type]].push(n.selectedEvent);n.cachedSelectedEvents=_.cloneDeep(n.selectedEvent)}}function w(x){return n.selectedEvent.arn&&n.selectedEvent.arn.indexOf(x)===-1}function k(y){var x=new i("updateResource");n.updateCurrentEventType(n.selectedEvent.type);n.isLoadingResources=true;if(n.selectedEvent.type===m.EVENTS.SNS){return p.makeProxyRequest(v.listTopics,{region:y},m.PROXY_API_NAMES.SNS.LIST_TOPICS,x).then(function(z){var A=z.response.ListTopicsResponse.ListTopicsResult.Topics;if(A){A.forEach(function(B){n.eventResources.push({value:B.TopicArn,text:t.extractTopicName(B.TopicArn)})})}n.eventResources.push({value:m.EVENTS.CUSTOM,text:o.instant("events.option.customsnsarn")});n.isLoadingResources=false;if(w(g.SNS)){n.selectedEvent.arn=null}r(n.selectedEvent)})["catch"](function(z){n.cardState.listTopicError=t.handleErrors(z)})["finally"](function(){f()})}else{if(n.selectedEvent.type===m.EVENTS.SQS){return p.makeProxyRequest(s.listQueues,{region:y},m.PROXY_API_NAMES.SQS.LIST_QUEUES,x).then(function(A){var z=A.response.ListQueuesResponse.ListQueuesResult.queueUrls;if(z){z.forEach(function(B){n.eventResources.push({value:e(B),text:t.extractQueueName(B)})})}n.eventResources.push({value:m.EVENTS.CUSTOM,text:o.instant("events.option.customsqsarn")});n.isLoadingResources=false;if(w(g.SQS)){n.selectedEvent.arn=null}r(n.selectedEvent)})["catch"](function(z){n.cardState.listTopicError=t.handleErrors(z)})["finally"](function(){f()})}else{if(n.selectedEvent.type===m.EVENTS.LAMBDA){return p.makeProxyRequest(q.listFunctions,{region:y,params:{MaxItems:m.API_MAX_ITEMS.LAMBDA_LIST_FUNCTIONS}},m.PROXY_API_NAMES.LAMBDA.LIST_FUNCTIONS,x).then(function(A){var z=A.response.Functions;if(z){z.forEach(function(B){n.eventResources.push({value:B.FunctionArn,text:B.FunctionName})})}n.eventResources.push({value:m.EVENTS.CUSTOM,text:o.instant("events.option.customlambdaarn")});n.isLoadingResources=false;if(w(g.LAMBDA)){n.selectedEvent.arn=null}r(n.selectedEvent)})["catch"](function(z){n.cardState.listTopicError=t.handleErrors(z)})["finally"](function(){f()})}}}}function e(y){var B=t.getARNPrefix(m.AWS_SERVICE.SQS);var A=y.substring(y.indexOf(".")+1);var z=A.substring(0,A.indexOf("."));var x=A.substring(A.indexOf("/")).replaceAll("/",":");return B+z+x}n.updateCurrentEventType=function(x){switch(x){case m.EVENTS.SNS:n.currentEventType=n.eventTypes[0];break;case m.EVENTS.SQS:n.currentEventType=n.eventTypes[1];break;case m.EVENTS.LAMBDA:n.currentEventType=n.eventTypes[2];break}};n.selectChanged=function(){if(n.selectValue.value!==m.EVENTS.CUSTOM){n.selectedEvent.arn=n.selectValue.value}};n.handleCheckboxes=function(){n.selectedEvent.events=_.filter(_.keys(n.eventsChecked),function(x){return n.eventsChecked[x]})};b()}])})();"use strict";(function(){angular.module("s3").directive("events",[function(){return{restrict:"E",scope:{cardOpen:"=",forCreateBucketModal:"=?",createBucketObj:"=?",modalInfo:"=?",id:"@?"},templateUrl:"/s3/partials/events.html",controller:"EventsController"}}]);angular.module("s3").controller("EventsController",["$q","$scope","$timeout","$translate","AwsUrlsService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","FAC","LambdaService","PathService","Region","S3Constants","SCLogService","UtilService","XMLParser",a]);function a(y,u,z,w,d,m,i,o,n,x,f,g,r,e,A,B){var v,q,p,k;var j="provided already exists. Please provide a new statement id, or remove the existing statement";function h(){u.cardSummaryObj.isActive=u.eventsTable.length>0;if(u.cardSummaryObj.isActive>0){u.cardSummaryObj.activeSummary.text=u.eventsTable.length+w.instant("bucketproperties.events.activenotifications")}else{u.cardSummaryObj.inactiveSummary.text=u.eventsTable.length+w.instant("bucketproperties.events.activenotifications")}}function c(){u.cardState={errorMessage:"",headerTitle:w.instant("event.table.newevent"),isAdding:true,isSaving:false,radioValue:"",selectedEventObj:null,selectedEventTable:null,showError:false};u.cachedEventsSettings=null;u.eventTypes=[{simpleName:w.instant("events.eventTypes.objectlost"),complexName:r.BUCKET_EVENTS.RRS_OBJECT_LOST},{simpleName:w.instant("events.eventTypes.put"),complexName:r.BUCKET_EVENTS.PUT},{simpleName:w.instant("events.eventTypes.post"),complexName:r.BUCKET_EVENTS.POST},{simpleName:w.instant("events.eventTypes.copy"),complexName:r.BUCKET_EVENTS.COPY},{simpleName:w.instant("events.eventTypes.completeMultipartUpload"),complexName:r.BUCKET_EVENTS.COMPLETE_MULTIPART_UPLOAD},{simpleName:w.instant("events.eventTypes.delete"),complexName:r.BUCKET_EVENTS.DELETE},{simpleName:w.instant("events.eventTypes.deleteMarker"),complexName:r.BUCKET_EVENTS.DELETE_MARKER_CREATED},{simpleName:w.instant("events.eventTypes.objectCreate"),complexName:r.BUCKET_EVENTS.CREATE_OBJECT_ALL},{simpleName:w.instant("events.eventTypes.objectDelete"),complexName:r.BUCKET_EVENTS.DELETE_OBJECT_ALL}];if(!n.isFeatureEnabled(r.FAC.S3_RRS)){u.eventTypes=_.reject(u.eventTypes,function(E){return E.complexName===r.BUCKET_EVENTS.RRS_OBJECT_LOST})}u.eventsMap={};u.eventTypes.forEach(function(E){u.eventsMap[E.simpleName]=E.complexName;u.eventsMap[E.complexName]=E.simpleName});u.scrollCardId="#"+u.id;u.cardSummaryObj=_.cloneDeep(r.CARD_SUMMARY_INIT);v=new o("BucketNotification","getBucketNotification");q=new o("BucketNotification","putBucketNotification");p=f.getCurrentBucket();u.eventsTable=[];k=g.getCurrentRegion();var D={name:r.EVENTS.CLOUDFN,value:r.EVENTS.CLOUDCONFIG,display:r.EVENTS.LAMBDA,dropdown:w.instant("events.label.lambdafunction")};u.resourceTypes=[{name:r.EVENTS.TOPIC,value:r.EVENTS.TOPICCONFIG,display:r.EVENTS.SNS,dropdown:w.instant("events.label.snstopic")},{name:r.EVENTS.QUEUE,value:r.EVENTS.QUEUECONFIG,display:r.EVENTS.SQS,dropdown:w.instant("events.label.sqsqueue")},D];if(u.forCreateBucketModal){k=u.modalInfo.region;if(!u.isFeatureEnabled("s3-la-"+k)){u.resourceTypes.pop()}}else{m.getBucketLocation(p).then(function(E){k=E;if(!u.isFeatureEnabled("s3-la-"+k)){u.resourceTypes.pop()}})}if(u.forCreateBucketModal){u.$watch("cardOpen",function(F,E){z(function(){A.scrollCardToView(r.BUCKET_PROPERTIES.EVENTS.CREATE_BUCKET_CARD)},1)})}if(u.forCreateBucketModal){if(u.modalInfo.copySettingsSourceBucket){var C=B.convertXmlStringToJson(u.createBucketObj.response);u.currentEvents=i.parseBucketNotificationConfig(C);u.createBucketObj.currentEvents=u.currentEvents}else{if(u.createBucketObj.currentEvents){u.currentEvents=u.createBucketObj.currentEvents}else{u.currentEvents={Topic:[],Queue:[],CloudFunction:[]}}}u.updateTable()}else{u.cardSummaryObj.isLoading=true;u.updateEvents().then(function(){u.updateTable();h();u.cardSummaryObj.isLoading=false})}}u.updateEvents=function(){return m.getBucketNotification(p,v).then(function(E){var D=E.response;var C=B.convertXmlStringToJson(D);u.currentEvents=i.parseBucketNotificationConfig(C);u.cachedEventsSettings=_.cloneDeep(u.currentEvents)})["catch"](function(C){l(C)})};u.updateTable=function(){u.eventsTable=[];if(!u.currentEvents){return}u.resourceTypes.forEach(function(C){u.currentEvents[C.name].forEach(function(E){var D={id:E.id,type:E.type};D.events=_.map(E.events,function(F){return u.eventsMap[F]}).toString();D.filter=s(E.prefix,E.suffix);D.isEditing=false;u.eventsTable.push(D)})});u.cardState.isAdding=false};function s(C,D){if(C&&D){return C+", "+D}else{if(C){return C}else{if(D){return D}else{return""}}}}function t(C){return _.find(u.resourceTypes,function(D){return D.display===C.type})}u.selectEvent=function(D){u.closeAddEvents();var E=D;u.cardState.selectedEventTable=_.find(u.eventsTable,function(F){return F.id===E.id});var C=t(E);u.cardState.selectedEventObj=_.find(u.currentEvents[C.name],function(F){return F.id===E.id});u.cardState.radioValue=u.cardState.selectedEventTable.id};u.addEvent=function(){u.cardState.selectedEventObj={id:"",type:null,prefix:"",suffix:"",arn:"",events:[]};u.cardState.selectedEventTable={id:"",type:r.EVENTS.SNS,filter:"",events:[],isEditing:true};u.cardState.isAdding=true;u.cardState.radioValue="";u.cardState.headerTitle=w.instant("events.table.newevent");u.eventsTable.unshift(u.cardState.selectedEventTable)};u.closeCard=function(C){C.stopPropagation();u.cardOpen=false};u.closeAddEvents=function(){if(u.cardState.isAdding){var C=_.findIndex(u.eventsTable,function(D){return D===u.cardState.selectedEventTable});u.eventsTable.splice(C,1);u.cardState.isAdding=false}else{if(u.cardState.selectedEventTable&&u.cardState.selectedEventTable.isEditing){u.cardState.selectedEventTable.isEditing=false;u.updateTable()}}u.cardState.selectedEventTable=null;u.cardState.selectedEventObj=null;u.cardState.radioValue=""};u.deletePressed=function(){var D=t(u.cardState.selectedEventObj);var C=_.findIndex(u.currentEvents[D.name],function(E){return E.id===u.cardState.selectedEventObj.id});u.currentEvents[D.name].splice(C,1);u.cardState.selectedEventTable=null;u.cardState.selectedEventObj=null;u.cardState.radioValue="";u.updateTable()};u.editPressed=function(){u.cardState.headerTitle=u.cardState.selectedEventTable.id;u.cardState.selectedEventTable.isEditing=true;u.cardState.isAdding=false};u.cancelPressed=function(C){A.analyticsTrackClick(r.ANALYTICS.CANCEL_EVENTS,r.ANALYTICS.DETAILS);c();u.closeCard(C)};u.savePressed=function(D){A.analyticsTrackClick(r.ANALYTICS.SAVE_EVENTS,r.ANALYTICS.DETAILS);u.cardState.isSaving=true;if(u.cardState.selectedEventObj){var E=t(u.cardState.selectedEventObj);var C=_.findIndex(u.currentEvents[E.name],function(F){return F.id===u.cardState.selectedEventObj.id});if(C===-1){u.currentEvents[E.name].push(u.cardState.selectedEventObj)}else{u.currentEvents[E.name][C]=u.cardState.selectedEventObj}}if(u.forCreateBucketModal){u.createBucketObj.response=m.parseBucketNotificationObject(u.currentEvents);u.createBucketObj.currentEvents=u.currentEvents;if(u.cardState.selectedEventObj){u.cardState.selectedEventTable.isEditing=false;u.cardState.selectedEventTable=null;u.cardState.selectedEventObj=null;u.cardState.radioValue=""}u.closeCard(D);u.cardState.isSaving=false}else{(function(){var F=[];u.currentEvents.CloudFunction.forEach(function(H){if(_.isEmpty(u.cachedEventsSettings)||_.findIndex(u.cachedEventsSettings.CloudFunction,{id:H.id})===-1){var G=A.parseFunctionArn(H.arn);var J=A.getUserAccountId();if(J===null){e.log("LambdaAddPermission",0,q,{bucket:p,lambda:H.arn});l(w.instant("events.addpermissions.error"));return}var I={Action:"lambda:InvokeFunction",Principal:"s3.amazonaws.com",SourceAccount:J,SourceArn:A.getBucketARN(p),StatementId:J+"_event_permissions_for_"+H.id+"_from_"+p+"_for_"+G.functionName};F.push(x.addPermission({region:k,path:"/2015-03-31/functions/"+G.functionName+"/policy",content:JSON.stringify(I)}).then(function(){e.log("LambdaAddPermission",1,q,{bucket:p,lambda:H.arn})})["catch"](function(K){e.log("LambdaAddPermission",0,q,{bucket:p,lambda:H.arn});l(K)}))}});y.all(F).then(function(){b(D)})})()}};function b(C){m.putBucketNotification(p,q,u.currentEvents).then(function(){u.closeCard(C);if(u.cardState.selectedEventObj){u.cardState.selectedEventTable.isEditing=false}u.cardState.selectedEventTable=null;u.cardState.selectedEventObj=null;u.cardState.radioValue="";u.cardState.isSaving=false;u.cardState.showError=false;u.cardState.isAdding=false;u.updateEvents().then(function(){u.updateTable();h()})})["catch"](function(D){l(D)})}function l(C){var D=A.handleErrors(C);if(D.indexOf(j)>-1){return}u.cardState.showError=true;u.cardState.errorMessage=D;u.cardState.isSaving=false}u.isFeatureEnabled=function(C){return n.isFeatureEnabled(C)};u.docLink=d.getDocUrl(r.LEARN_MORE_LINKS.EVENTS);c()}})();"use strict";(function(){angular.module("s3").directive("modalPermissions",[function(){return{restrict:"E",scope:{publicPermissions:"=",userPermissions:"=",systemPermissions:"=?",showSystemPermissions:"@?",owner:"=",modalType:"="},templateUrl:"/s3/partials/modalpermissions.html",controller:"ModalPermissionsController"}}]);angular.module("s3").controller("ModalPermissionsController",["$filter","$scope","$translate","S3Constants",function(d,a,c,b){a.manageUserTitles=[{txt:c.instant("modal.manageusertitles.userid"),info:c.instant("modal.userid.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objects"),info:c.instant("modal.objects.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objectspermissions"),info:c.instant("modal.objectspermissions.tooltip"),pos:"left"}];a.publicpermissionsecTitles=[{txt:c.instant("modal.publicpermissionsectitles.group"),info:c.instant("modal.group.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objects"),info:c.instant("modal.objects.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objectspermissions"),info:c.instant("modal.objectspermissions.tooltip"),pos:"left"}];a.systempermissionsecTitles=[{txt:c.instant("modal.publicpermissionsectitles.group"),info:c.instant("modal.group.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objects"),info:c.instant("modal.objects.tooltip"),pos:"right"},{txt:c.instant("modal.manageusertitles.objectspermissions"),info:c.instant("modal.objectspermissions.tooltip"),pos:"left"}];a.addOwnerPermissions=function(){if(a.userPermissions[0].revokeAll){a.userPermissions[0].revokeAll=false}};a.makePublicOptions=[{text:c.instant(a.modalType+".permission.disablepublic"),value:false},{text:c.instant(a.modalType+".permission.enablepublic"),value:true}];a.logDeliveryOptions=[{text:c.instant(a.modalType+".permission.disablelogdelivery"),value:false},{text:c.instant(a.modalType+".permission.enablelogdelivery"),value:true}];a.selectedItems={logDelivery:a.logDeliveryOptions[0],makePublic:a.makePublicOptions[0]};a.makePublicWarningHeader=c.instant(a.modalType+".acl.makepublic.warning.header");a.makePublicWarningBody=c.instant(a.modalType+".acl.makepublic.warning.body");a.$watchCollection("selectedItems",function(e){a.publicPermissions[1].permissions.READ=_.get(e.makePublic,"value");if(a.systemPermissions){a.systemPermissions[0].permissions.READ=_.get(e.logDelivery,"value")}});a.MODAL_TYPES=b.MODAL_TYPE}])})();"use strict";(function(){angular.module("s3").directive("permissionsSubModal",function(){return{restrict:"E",scope:{isPublic:"=",aclModalTitles:"=",permissions:"="},templateUrl:"/s3/partials/permissionsSubModal.html",controller:"PermissionSubModalController"}});angular.module("s3").controller("PermissionSubModalController",["$scope",function(a){a.deleteUserAcl=function(b){a.permissions[b].revokeAll=true;angular.forEach(a.permissions[b].permissions,function(d,c){a.permissions[b].permissions[c]=false})}}])})();"use strict";(function(){angular.module("s3").service("PermissionsUtilService",["S3Constants",function(i){function b(o,n){angular.forEach(o,function(p){if(_.isArray(p)){angular.forEach(p,function(q){q.permissions=q.detail.value?_.clone(n[q.detail.value]):_.clone(n[q.detail.DisplayName])})}})}function e(n,p){var o=_.cloneDeep(n.aclGrants);o=!_.isEmpty(o)&&!Array.isArray(o)?[o]:_.isEmpty(o)?[]:o;o=!_.isEmpty(o)?m(o,n,p):a(p);return o}function a(p){var o=[],n=[];n=n.concat(p.userPermissions,p.publicPermissions);n=n.concat(p.systemPermissions);angular.forEach(n,function(q){k(q.permissions,q.detail,o)});return o}function l(o,n,p){p.forEach(function(q,r){if((q.Grantee.URI&&q.Grantee.URI.indexOf(o)!==-1||q.Grantee.DisplayName&&q.Grantee.DisplayName===o||q.Grantee.ID&&q.Grantee.ID===o)&&q.Permission===n){p.splice(r,1)}});return p}function g(p,s,q,o,n,r){if(_.values(q).indexOf(false)>-1&&_.values(s[n]).indexOf(false)===-1&&_.findIndex(p,{Permission:i.ACL_PERMISSIONS.FULL_CONTROL})>-1){l(n,i.ACL_PERMISSIONS.FULL_CONTROL,p);angular.forEach(q,function(u,t){if(u===true){h(o,t,p)}})}else{if(_.values(q).indexOf(false)===-1&&_.values(s[n]).indexOf(false)>-1){h(o,i.ACL_PERMISSIONS.FULL_CONTROL,p);angular.forEach(i.ACL_PERMISSIONS,function(u,t){if(t!==i.ACL_PERMISSIONS.FULL_CONTROL){l(n,u,p)}});r.fullControlAdded=true;r.allPermissionsRevoked=false}}if(!r.fullControlAdded){_.keys(q).forEach(function(t){if(q[t]!==s[n][t]){if(q[t]===false||q[t]===undefined&&s[n][t]===true){l(n,t,p)}else{if(q[t]===true){h(o,t,p);r.allPermissionsRevoked=false}}}else{if(s[n][t]===true){r.allPermissionsRevoked=false}}})}}function k(p,o,n){if(p&&Object.keys(p).length===4&&_.values(p).indexOf(false)===-1){h(o,i.ACL_PERMISSIONS.FULL_CONTROL,n)}else{if(p){h(o,p,n)}}}function m(o,n,q){var p={AllUsers:_.find(q.publicPermissions,{detail:{value:"AllUsers"}}),AuthenticatedUsers:_.find(q.publicPermissions,{detail:{value:"AuthenticatedUsers"}}),LogDelivery:_.find(q.systemPermissions,{detail:{value:"LogDelivery"}})};angular.forEach(q.userPermissions,function(r){var s=r.detail.DisplayName?r.detail.DisplayName:r.detail.ID;if(s){p[s]=r}});angular.forEach(p,function(s,r){if(!n.grantees[r]){k(s.permissions,s.detail,o)}else{if(!_.isEqual(s.permissions,n.grantees[r])){var t={allPermissionsRevoked:true,fullControlAdded:false};g(o,n.grantees,s.permissions,s.detail,r,t)}}});return o}function h(n,p,o){if(!Array.isArray(o)){var q=o;o=_.isEmpty(q)?[]:[q]}var r={Type:n.Type,DisplayName:n.DisplayName,EmailAddress:n.EmailAddress,ID:n.ID,URI:n.URI};if(_.isString(p)){o.push({Grantee:r,Permission:p})}else{if(p){_.forEach(p,function(t,s){if(t){o.push({Grantee:r,Permission:s})}})}}return o}function f(n){return n.Grantee.DisplayName?n.Grantee.DisplayName:n.Grantee.URI?n.Grantee.URI.split("/").pop():n.Grantee.ID}function c(n,o){var p=f(n);if(p){if(!o[p]){o[p]={READ:false,WRITE:false,READ_ACP:false,WRITE_ACP:false}}if(n.Permission==="FULL_CONTROL"){o[p]={READ:true,WRITE:true,READ_ACP:true,WRITE_ACP:true}}else{o[p][n.Permission]=true}}}function j(o,n){_.forEach(o,function(p){if(_.isEmpty(n[p])){n[p]={READ:false,WRITE:false,WRITE_ACP:false,READ_ACP:false}}})}function d(n){var o={group:{},accounts:{},system:{}};_.forEach(n,function(q,p){if(i.PUBLIC_PERMISSIONS_LIST.indexOf(p)>-1){o.group[p]=q}else{if(i.SYSTEM_PERMISSIONS_LIST.indexOf(p)>-1){o.system[p]=q}else{o.accounts[p]=q}}});j(i.PUBLIC_PERMISSIONS_LIST,o.group);j(i.SYSTEM_PERMISSIONS_LIST,o.system);return o}return{populateAclsFields:b,updateAcl:e,aclsUpdate:g,addNewPermissions:k,updateGranteesHelperFunction:c,updateGrantees:d,extractGranteeKey:f}}])})();"use strict";(function(){angular.module("s3").directive("objectProperties",[function(){return{restrict:"E",scope:{obj:"=",options:"="},templateUrl:"/s3/partials/object-details/objectproperties.html"}}])})();"use strict";(function(){angular.module("s3").directive("objectStorageClass",[function(){return{restrict:"E",scope:{obj:"=",id:"@?"},templateUrl:"/s3/partials/object-details/objectstorageclass.html",controller:"ObjectStorageClassController"}}]);angular.module("s3").controller("ObjectStorageClassController",["$scope","AwsUrlsService","BulkOperationService","OperationDispatcherService","S3Constants","SCLogService","UtilService",a]);function a(d,h,c,i,f,g,b){d.docLink=h.getDocUrl(f.LEARN_MORE_LINKS.STORAGE_CLASS);d.cachedValue=angular.copy(d.obj);d.cancel=function(j){b.analyticsTrackClick(f.ANALYTICS.CANCEL_OBJECT_STORAGE_CLASS,f.ANALYTICS.DETAILS);j.stopPropagation();d.storageClassError="";d.cardOpen=false;d.obj.StorageClass=d.cachedValue.StorageClass};d.getStorageClassTranslation=function(){return b.getStorageClassTranslations()[d.obj.StorageClass]};d.scrollCardId="#"+d.id;d.cardSummaryObj=_.cloneDeep(f.CARD_SUMMARY_INIT);e();function e(){var j=d.getStorageClassTranslation();d.cardSummaryObj.isActive=d.obj.StorageClass!==f.STORAGE_CLASSES.GLACIER;if(d.cardSummaryObj.isActive){d.cardSummaryObj.activeSummary.text=j}else{d.cardSummaryObj.inactiveSummary.text=j}}d.save=function(k){b.analyticsTrackClick(f.ANALYTICS.SAVE_OBJECT_STORAGE_CLASS,f.ANALYTICS.DETAILS);k.stopPropagation();d.storageClassError="";d.isSaving=true;var m=[d.obj];var l={targetStorageClass:d.obj.StorageClass,numberOfKeysPerBulkOperation:1};var j=c.createBulkOperation(f.OPERATION_NAME.CHANGE_STORAGE_CLASS,m,[],1,l);j.totalSizeInBytes=m[0].Size;i.addOperation(j);g.log("ChangeStorageClassReceived",1,j);j.defer.promise.then(function(n){var o=Object.keys(n);if(o.length>0){d.storageClassError=o[0];g.log("ChangeStorageClassComplete",0,j)}else{d.cachedValue.StorageClass=d.obj.StorageClass;d.cardOpen=false;g.log("ChangeStorageClassComplete",1,j)}})["catch"](function(n){g.log("ChangeStorageClassComplete",0,j);d.storageClassError=n})["finally"](function(){d.isSaving=false;e()})}}})();"use strict";(function(){angular.module("s3").directive("objectEncryption",[function(){return{restrict:"E",scope:{obj:"=",options:"=",id:"@?"},templateUrl:"/s3/partials/object-details/objectsse.html",controller:"ObjectSSEController"}}]);angular.module("s3").controller("ObjectSSEController",["$q","$scope","$translate","AwsUrlsService","APIProxyService","BulkOperationService","ConsoleOperation","OperationDispatcherService","PathService","S3Constants","SCLogService","UtilService",a]);function a(h,m,b,d,c,p,i,n,j,f,l,k){m.S3Constants=f;m.docLink=d.getDocUrl(f.LEARN_MORE_LINKS.ENCRYPTION);m.scrollCardId="#"+m.id;m.aws_kms=f.OBJECT_SSE.KMS_ENCRYPTION;m.custom_arn=f.OBJECT_SSE.CUSTOM_ARN;m.cachedValue=angular.copy(m.obj);m.model={};m.model.selectedOption=_.isEmpty(m.obj.Encryption)?undefined:m.obj.Encryption;m.cancel=function(q){k.analyticsTrackClick(f.ANALYTICS.CANCEL_OBJECT_SSE,f.ANALYTICS.DETAILS);q.stopPropagation();m.sseError="";m.cardOpen=false;e()};function e(){m.obj.Encryption=m.cachedValue.Encryption;m.model.selectedOption=m.obj.Encryption;if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION){m.options.kmsId=m.cachedValue.KmsID}else{m.options.kmsId=undefined}o()}var g=function g(){m.kmsKeys=[];var s=new i("GetKMSKeysForObjectSSE");var r={};var q=h.defer();c.getKmsKeys(s,j.getCurrentBucket(),r).then(function(u){var t=u.response.Keys;l.log("GetKMSKeys",1,s);angular.forEach(t,function(v,w){m.kmsKeys.push({value:v.KeyId,text:k.getKmsKeyAlias(v)})});m.kmsKeys.push({value:f.OBJECT_SSE.CUSTOM_ARN,text:b.instant("objectproperties.kms.customarn")});q.resolve()})["catch"](function(t){m.KMSServiceError=k.handleErrors(t);m.sseError=k.handleErrors(t);l.log("GetKMSKeys",0,s,t);q.reject(t)});return q.promise};m.updateKMSKey=function(q){if(q===f.OBJECT_SSE.KMS_ENCRYPTION){g()}else{if(!_.isEmpty(m.sseError)&&m.sseError===m.KMSServiceError){m.sseError=null}m.KMSServiceError=null}};m.save=function(r){k.analyticsTrackClick(f.ANALYTICS.SAVE_OBJECT_SSE,f.ANALYTICS.DETAILS);r.stopPropagation();if(m.isSaving||m.disableSave()){return}m.sseError="";m.isSaving=true;var t=[m.obj],u=undefined;if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION){if(m.options.kmsId.value===f.OBJECT_SSE.CUSTOM_ARN){u=m.options.kmsARN}else{u=m.options.kmsId.value}}var s={sseAlgo:m.model.selectedOption,numberOfKeysPerBulkOperation:1,sseKmsKeyId:u};var q=p.createBulkOperation(f.OPERATION_NAME.CHANGE_SSE,t,[],1,s);q.totalSizeInBytes=t[0].Size;n.addOperation(q);l.log("ChangeSSERequestReceived",1,q);q.defer.promise.then(function(v){var w=Object.keys(v);if(w.length>0){m.sseError=w[0];l.log("ChangeSSERequestComplete",0,q)}else{m.cachedValue.Encryption=m.model.selectedOption;m.obj.Encryption=m.model.selectedOption;m.cardOpen=false;if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION){if(m.options.kmsId.value===f.OBJECT_SSE.CUSTOM_ARN){m.options.kmsId.value=u;m.obj.KmsID=m.options.kmsARN}else{m.obj.KmsID=m.options.kmsId.text}m.cachedValue.KmsID=u}l.log("ChangeSSERequestComplete",1,q);if(m.model.selectedOption!==f.OBJECT_SSE.KMS_ENCRYPTION){m.obj.KmsID=undefined}o()}})["catch"](function(v){l.log("ChangeSSERequestComplete",0,q);m.sseError=k.handleErrors(v)})["finally"](function(){m.isSaving=false})};m.disableSave=function(){if(m.model.selectedOption===m.cachedValue.Encryption&&m.model.selectedOption!==f.OBJECT_SSE.KMS_ENCRYPTION){return true}if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION&&(!m.options.kmsId||m.options.kmsId.value===m.custom_arn&&!m.options.kmsARN)){return true}if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION&&m.cachedValue.KmsID&&(m.cachedValue.KmsID.indexOf(m.options.kmsId.value)>-1||m.options.kmsId===m.cachedValue.KmsID||m.options.kmsId.value===m.custom_arn&&m.options.kmsARN===m.cachedValue.KmsID)){return true}return false};if(m.model.selectedOption===f.OBJECT_SSE.KMS_ENCRYPTION){g().then(function(){m.options.kmsId=k.getKMSAliasForArn(m.options.kmsId,m.kmsKeys)})}m.cardSummaryObj=_.cloneDeep(f.CARD_SUMMARY_INIT);o();function o(){var q=m.model.selectedOption===b.instant("resource.access.denied");m.cardSummaryObj.isActive=!q&&m.model.selectedOption!==f.OBJECT_SSE.NONE;m.cardSummaryObj.inactiveSummary.text=q?b.instant("resource.access.denied"):k.getEncryptionTranslations()[m.model.selectedOption];m.cardSummaryObj.activeSummary.text=q?b.instant("resource.access.denied"):k.getEncryptionTranslations()[m.model.selectedOption]}}})();"use strict";(function(){angular.module("s3").directive("objectMetadata",[function(){return{restrict:"E",scope:{obj:"=",id:"@?"},templateUrl:"/s3/partials/object-details/objectmetadata.html",controller:"ObjectMetadataController"}}]);angular.module("s3").controller("ObjectMetadataController",["$scope","$translate","AwsUrlsService","BulkOperationService","ConsoleOperation","OperationDispatcherService","PathService","S3Constants","S3CWSAPIService","SCLogService","UtilService",a]);function a(t,u,b,q,p,h,e,s,f,d,y){t.scrollCardId="#"+t.id;t.docLink=b.getDocUrl(s.LEARN_MORE_LINKS.METADATA);t.newMetadataList=[];t.revokeAll=false;t.selectedRow={scopeIndex:null};t.cardSummaryObj=_.cloneDeep(s.CARD_SUMMARY_INIT);t.obj.UserDefinedMetadata={};t.addMetadata=function(A){t.newMetadataList.splice(0,0,{metadataKey:null,metadataValue:null});k("newMetadataList:0");A.scopeIndex="newMetadataList:0"};t.getMetadata=function(){var C=e.getCurrentBucket();var B=e.getCurrentObject();var A=new p(s.OPERATION_NAME.GET_METADATA);f.getMetadata(C,B,A).then(function(D){d.log("getObjectMetadataCWS",A,1,{bucket:C,key:B});var F=_.get(D,"data.metadata");if(F){t.obj.Metadata=F;var E=_.pick(t.obj.Metadata,function(H,G){return s.USER_DEFINED_METADATA.indexOf(G)>-1||G.indexOf(s.USER_DEFINED_METADATA_PREFIX)===0});t.obj.UserDefinedMetadata=_.merge(E,t.obj.UserDefinedMetadata);t.cachedConvertedValue=_.cloneDeep(t.userDefinedMetadata);t.cachedValue=_.cloneDeep(t.obj)}})["catch"](function(D){d.log("getObjectMetadataCWS",A,0,{bucket:C,key:B});t.objectPropertiesError=y.handleErrors(D)})["finally"](function(){g()})};t.getMetadata();t.predefinedMetadata=[{value:s.USER_DEFINED_METADATA[0],text:u.instant("objectdetail.metadata.cache-control")},{value:s.USER_DEFINED_METADATA[1],text:u.instant("objectdetail.metadata.content-disposition")},{value:s.USER_DEFINED_METADATA[2],text:u.instant("objectdetail.metadata.content-encoding")},{value:s.USER_DEFINED_METADATA[3],text:u.instant("objectdetail.metadata.content-language")},{value:s.USER_DEFINED_METADATA[4],text:u.instant("objectdetail.metadata.content-type"),dropDownValue:s.CONTENT_TYPE_VALUES},{value:s.USER_DEFINED_METADATA[5],text:u.instant("objectdetail.metadata.expires")},{value:s.USER_DEFINED_METADATA[6],text:u.instant("objectdetail.metadata.website-redirect-location")},{value:s.USER_DEFINED_METADATA_PREFIX,text:u.instant("objectdetail.metadata.x-amz-meta-"),displayTextField:true}];t.getObjectMetadataCount=function(){if(!t.obj||!t.obj.UserDefinedMetadata){return 0}t.userDefinedMetadata=r();return Object.keys(t.obj.UserDefinedMetadata).length};t.$watch("userDefinedMetadata",function(C,A){z(C,A,"userDefinedMetadata");t.validationError="";if(t.userDefinedMetadata){var B=o(t.userDefinedMetadata.concat(t.newMetadataList));if(!_.isEmpty(B)){t.validationError=B}}},true);t.$watch("newMetadataList",function(C,A){z(C,A,"newMetadataList");t.validationError="";if(t.newMetadataList){var B=o(t.newMetadataList.concat(t.userDefinedMetadata));if(!_.isEmpty(B)){t.validationError=B}}},true);t.getIndex=function(A){return _.findIndex(t.userDefinedMetadata,function(B){return _.isEqual(B,A)})};t.isDeleteAndEditDisabled=function(A){return A===undefined||t.revokeAll||A.scopeIndex===null||t.obj&&t.obj.StorageClass==="GLACIER"||A.scopeIndex&&A.scopeIndex.indexOf("newMetadataList")>-1};t.removeNewMetadata=function(C,D,E){D.stopPropagation();if(E&&E.scopeIndex){var F=E.scopeIndex.split(":"),B=F[0],A=parseInt(F[1]);if(B==="newMetadataList"&&A===C){E.scopeIndex=null}if(B==="newMetadataList"&&C<A){A-=1;E.scopeIndex=B+":"+A}}t.newMetadataList.splice(C,1)};t.switchSelectedRow=function(A){k(A.scopeIndex,false)};t.editMetadata=function(A){k(A.scopeIndex,true)};t.deleteMetadata=function(A){var B=A.scopeIndex.split(":");if(B[0]==="userDefinedMetadata"){t.userDefinedMetadata.splice(B[1],1)}A.scopeIndex=null;if(_.isEmpty(t.userDefinedMetadata)){t.revokeAll=true}};function g(){var B=t.getObjectMetadataCount();t.cardSummaryObj.isActive=B>0;if(B>0){t.cardSummaryObj.activeSummary.text=B+u.instant("objectdetail.metadata.keyvalue")}if(t.obj.statusCodes){var A=t.obj.statusCodes[s.OPERATION_NAME.GET_OBJECT_METADATA];if(A){t.cardSummaryObj.inactiveSummary.text=A;t.cardSummaryObj.activeSummary.text=A}}}t.cachedConvertedValue=_.cloneDeep(t.userDefinedMetadata);t.cachedValue=_.cloneDeep(t.obj);t.cancel=function(A){y.analyticsTrackClick(s.ANALYTICS.CANCEL_OBJECT_METADATA,s.ANALYTICS.DETAILS);A.stopPropagation();x();g()};t.save=function(D){y.analyticsTrackClick(s.ANALYTICS.SAVE_OBJECT_METADATA,s.ANALYTICS.DETAILS);D.stopPropagation();t.isSaving=true;t.metadataError="";t.validationError="";var A=t.userDefinedMetadata?t.userDefinedMetadata.concat(t.newMetadataList):t.newMetadataList;if(!v(A)){t.isSaving=false;return}var C=j(A);if(_.isEqual(C,t.obj.UserDefinedMetadata)){t.isSaving=true;x();return}var F=[t.obj];var E=n(t.obj.UserDefinedMetadata,C);var B=q.createBulkOperation(s.OPERATION_NAME.CHANGE_METADATA,F,[],1,E);B.totalSizeInBytes=F[0].Size;h.addOperation(B);d.log("ChangeMetadataRequestReceived",1,B);B.defer.promise.then(function(G){var H=Object.keys(G);if(H.length>0){t.metadataError=H[0];d.log("ChangeMetadataRequestComplete",0,B)}else{i(C,A);d.log("ChangeMetadataRequestComplete",1,B)}g()})["catch"](function(G){d.log("ChangeMetadataRequestComplete",0,B);t.metadataError=G})["finally"](function(){t.isSaving=false})};function r(){var A=[];_.forEach(t.obj.UserDefinedMetadata,function(D,C){var B=_.find(t.predefinedMetadata,{value:C})||{value:C,text:C};A.push({metadataKey:B,metadataValue:{text:D}})});return A}function z(E,D,C){if(!_.isEqual(E,D)&&t.selectedRow.scopeIndex){var F=t.selectedRow.scopeIndex.split(":"),B=F[0],A=F[1];if(B===C&&D[A]&&E[A]&&D[A].metadataKey&&E[A].metadataKey&&D[A].metadataKey.value!==E[A].metadataKey.value||B===C&&E[A].metadataKey===undefined){t[C][A].metadataValue=null}else{if(B===C&&E[A]&&D[A]&&E[A].metadataValue&&D[A].metadataValue&&!_.isEqual(E[A].metadataValue,D[A].metadataValue)&&E[A].metadataValue.text!==D[A].metadataValue.text){t[C][A].metadataValue.inputError=null}else{if(B===C&&E[A]&&D[A]&&E[A].metadataKey&&D[A].metadataKey&&!E[A].metadataKey.hasOwnProperty("inputValue")&&E[A].metadataKey.text&&D[A].metadataKey.text&&!_.isEqual(E[A].metadataKey,D[A].metadataKey)&&E[A].metadataKey.text!==D[A].metadataKey.text){t[C][A].metadataKey.error=null}else{if(B===C&&E[A]&&D[A]&&E[A].metadataKey&&D[A].metadataKey&&E[A].metadataKey.hasOwnProperty("inputValue")&&!_.isEqual(E[A].metadataKey,D[A].metadataKey)&&E[A].metadataKey.inputValue!==D[A].metadataKey.inputValue){t[C][A].metadataKey.error=null}}}}}}function k(B,D){var E=B.split(":"),A=E[0],C=parseInt(E[1]);if(A==="newMetadataList"){_.forEach(t.newMetadataList,function(G,F){G.isEditing=F===C});_.forEach(t.userDefinedMetadata,function(F){F.isEditing=false})}else{if(A==="userDefinedMetadata"){_.forEach(t.userDefinedMetadata,function(G,F){G.isEditing=F!==C?false:D});_.forEach(t.newMetadataList,function(F){F.isEditing=false})}}}function m(){_.forEach(t.newMetadataList,function(A){A.isEditing=false});_.forEach(t.userDefinedMetadata,function(A){A.isEditing=false})}function i(B,A){t.obj.UserDefinedMetadata=B;t.userDefinedMetadata=A;t.newMetadataList=[];t.cachedConvertedValue=_.cloneDeep(t.userDefinedMetadata);t.cachedValue.UserDefinedMetadata=_.cloneDeep(t.obj.UserDefinedMetadata);t.cachedValue.Metadata=_.cloneDeep(t.obj.Metadata);t.selectedRow={scopeIndex:null};m();t.cardOpen=false}function x(){t.metadataError="";t.validationError="";t.newMetadataList=[];t.userDefinedMetadata=_.cloneDeep(t.cachedConvertedValue);t.obj.UserDefinedMetadata=_.cloneDeep(t.cachedValue.UserDefinedMetadata);t.obj.Metadata=_.cloneDeep(t.cachedValue.Metadata);t.selectedRow={scopeIndex:null};m();t.cardOpen=false}function c(A){if(!(A.metadataKey&&A.metadataKey.error)){if(A.metadataKey.hasOwnProperty("inputValue")&&!_.startsWith(A.metadataKey.inputValue,s.USER_DEFINED_METADATA_PREFIX)){A.metadataKey.error=u.instant("metadatacard.startingwith")}else{A.metadataKey.error=""}}}function w(A){if(!(A.metadataKey&&A.metadataKey.error)){if(A.metadataKey&&!/^[\x20-\x7E]+$/.test(A.metadataKey.text)){A.metadataKey.error=u.instant("metadatacard.nonasc")}else{if(A.metadataKey.hasOwnProperty("inputValue")&&!/^[\x20-\x7E]+$/.test(A.metadataKey.inputValue)){A.metadataKey.error=u.instant("metadatacard.nonasc")}else{A.metadataKey.error=""}}}}function l(A){if(!(A.metadataValue&&A.metadataValue.inputError)){if(A.metadataValue&&!_.isEmpty(A.metadataValue.text)&&!/^[\x20-\x7E]+$/.test(A.metadataValue.text)){A.metadataValue.inputError=u.instant("metadatacard.nonasc")}else{A.metadataValue.inputError=""}}}function v(A){A.forEach(function(C){if(!C.metadataKey){C.metadataKey={error:u.instant("objectdetail.metadata.emptyvaluewarning")}}else{if(C.metadataKey.hasOwnProperty("inputValue")&&_.isEmpty(C.metadataKey.inputValue)){C.metadataKey.error=u.instant("objectdetail.metadata.emptyvaluewarning")}else{if(_.isEmpty(C.metadataKey.text)){C.metadataKey.error=u.instant("objectdetail.metadata.emptyvaluewarning")}else{C.metadataKey.error=""}}}if(!C.metadataValue||C.metadataValue&&_.isEmpty(C.metadataValue.text)){if(C.metadataValue){C.metadataValue.inputError=u.instant("objectdetail.metadata.emptyvaluewarning")}else{C.metadataValue={inputError:u.instant("objectdetail.metadata.emptyvaluewarning")}}}else{if(C.metadataKey&&C.metadataKey.value===s.USER_DEFINED_METADATA[6]){if(!_.startsWith(C.metadataValue.text,"/")&&!_.startsWith(C.metadataValue.text,"http://")&&!_.startsWith(C.metadataValue.text,"https://")){C.metadataValue.inputError=u.instant("objectdetail.metadata.websitevaluewarning")}else{C.metadataValue.inputError=""}}else{C.metadataValue.inputError=""}}c(C);w(C);l(C)});var B=o(A);if(!_.isEmpty(B)){t.validationError=B}return _.isEmpty(B)&&_.findIndex(A,function(C){return C.metadataValue.inputError&&C.metadataValue.inputError.length>0})===-1&&_.findIndex(A,function(C){return C.metadataKey.error&&C.metadataKey.error.length>0})===-1}function o(A){if(_.isEmpty(A)){return""}var C={};A.forEach(function(E){if(E&&E.metadataKey){var D=E.metadataKey.hasOwnProperty("inputValue")?E.metadataKey.inputValue:E.metadataKey.text;if(D){C[D]=C.hasOwnProperty(D)?C[D]+1:1}}});var B="";_.forEach(C,function(E,D){if(E>1){B+=D+", "}});return B.slice(0,B.lastIndexOf(","))}function j(B){var A={};_.forEach(B,function(D){var C=D.metadataKey.inputValue||D.metadataKey.value,E=D.metadataValue.text;A[C]=E});return A}function n(B,C){var A={addAndChangeMetadata:{},deleteMetadata:[],numberOfKeysPerBulkOperation:1};_.forEach(C,function(E,D){if(!B.hasOwnProperty(D)||B[D]!==E){A.addAndChangeMetadata[D]=E}});_.forEach(B,function(E,D){if(!C.hasOwnProperty(D)){A.deleteMetadata.push(D)}});return A}}})();"use strict";(function(){angular.module("s3").directive("objectTag",[function(){return{restrict:"E",scope:{obj:"=",id:"@?"},templateUrl:"/s3/partials/object-details/objecttag.html",controller:"ObjectTagController"}}]);angular.module("s3").controller("ObjectTagController",["$scope","$translate","APIProxyService","AwsUrlsService","ConsoleOperation","ObjectPropertiesService","PathService","S3Constants","SCLogService","UtilService","XMLParser",a]);function a(m,n,o,b,j,i,d,k,c,r,s){var h="getObjectTags";var q="getObjectVersionTags";var f="putObjectTags";var l="putObjectVersionTags";var p="getObjectTagsReceived";var g="putObjectTagsReceived";m.docLink=b.getDocUrl(k.LEARN_MORE_LINKS.OBJECT_TAGGING);m.scrollCardId="#"+m.id;m.tagError=false;m.tagErrorMessage="";m.cachedObjectTags={tags:[]};m.tagCount=0;m.maxAllowedTags=k.TAGGING.MAX_ALLOWED_TAGS;m.cardSummaryObj=_.cloneDeep(k.CARD_SUMMARY_INIT);m.cardSummaryObj.isActive=m.tagCount>0;m.cardSummaryObj.activeSummary.text=m.tagCount+n.instant("objectproperties.tags.keyvalue");m.cardSummaryObj.inactiveSummary.text="0"+n.instant("objectproperties.tags.keyvalue");m.cancelObjectTagging=function(t){r.analyticsTrackClick(k.ANALYTICS.CANCEL_OBJECT_TAGS,k.ANALYTICS.DETAILS);t.stopPropagation();m.obj.Tagging=angular.copy(m.cachedObjectTags.tags);m.tagError=false;m.tagErrorMessage="";m.cardOpen=false};m.removeTag=function(t){m.obj.Tagging.splice(t,1)};m.addTag=function(){if(!m.obj.Tagging){m.obj.Tagging=[]}if(m.obj.Tagging.length<k.TAGGING.MAX_ALLOWED_TAGS){m.obj.Tagging.push({Key:"",Value:""})}};m.$watch("obj.versionId",function(u,t){if(u!==t){m.getObjectTags()}});m.isAnyKeyEmpty=function(){return !_.isEmpty(m.obj.Tagging)&&_.some(m.obj.Tagging,function(t){return _.isEmpty(t.Key)})};function e(){m.cardSummaryObj.isActive=m.tagCount>0;if(m.cardSummaryObj.isActive){m.cardSummaryObj.activeSummary.text=m.tagCount+n.instant("objectproperties.tags.keyvalue")}}m.getObjectTags=function(){var t=new j(k.OPERATION_NAME.GET_OBJECT_TAGGING);var w=d.getCurrentObject();var v=d.getCurrentBucket();c.log(p,1,t,{objectName:w});m.obj.Tagging=[];var u=m.obj.versionId;o.getObjectTag(t,v,w,u).then(function(A){var x=A.response;if(!u){c.log(h,1,t,{objectName:w})}else{c.log(q,1,t,{objectName:w,versionId:u})}m.tagError=false;if(x){var y=s.convertXmlStringToJson(x);if(y.Tagging.TagSet.Tag){var z=[].concat(y.Tagging.TagSet.Tag);angular.forEach(z,function(B){if(_.isEmpty(B.Value)){B.Value=""}B.errorMessage=""});m.obj.Tagging=z;m.tagCount=z.length||0}else{m.tagCount=0}}m.cachedObjectTags.tags=angular.copy(m.obj.Tagging);e()})["catch"](function(x){if(x){if(x.status===k.HTTP_STATUS_CODES.NOT_FOUND){if(x.response.Error.Code===k.TAGGING.ERROR_CODES.NO_SUCH_TAG_SET){if(!u){c.log(h,0,t,{objectName:w,error:x})}else{c.log(q,0,t,{objectName:w,versionId:u,error:x})}m.tagCount=0;m.obj.Tagging=[]}}}m.cachedObjectTags.tags=angular.copy(m.obj.Tagging)})};m.getObjectTags();m.saveObjectTagging=function(v){r.analyticsTrackClick(k.ANALYTICS.SAVE_OBJECT_TAGS,k.ANALYTICS.DETAILS);v.stopPropagation();m.tagError=false;m.tagErrorMessage="";var u=m.obj.Tagging;var t=new j(k.OPERATION_NAME.PUT_OBJECT_TAGGING);var x=d.getCurrentObject();var w=m.obj.versionId;c.log(g,1,t,{objectName:x});if(u){angular.forEach(u,function(y){if(_.isEmpty(y.Key)){y.errorMessage=n.instant("objectproperties.tags.emptykeyname");m.tagError=true}else{y.errorMessage=""}})}if(!m.tagError){i.putObjectTagging(x,w,u,t).then(function(A){if(!w){c.log(f,1,t,{objectName:x})}else{c.log(l,1,t,{objectName:x,versionId:w})}var z=s.convertXmlStringToJson(A.request.contentString);var y;if(!_.isEmpty(z.Tagging.TagSet.Tag)){y=[].concat(z.Tagging.TagSet.Tag);angular.forEach(y,function(B){if(_.isEmpty(B.Value)){B.Value=""}})}m.obj.Tagging=_.isEmpty(y)?[]:[].concat(y);m.tagCount=m.obj.Tagging.length;m.cachedObjectTags.tags=angular.copy(m.obj.Tagging);m.cardOpen=false;e()})["catch"](function(y){if(!w){c.log(f,0,t,{objectName:x,error:y})}else{c.log(f,0,t,{objectName:x,error:y,versionId:w})}m.tagError=true;if(y){m.tagErrorMessage=r.handleErrors(y)}else{m.tagErrorMessage=n.instant("objectproperties.tags.genericerror")}})}}}})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("dialogModal",function(){return{restrict:"E",templateUrl:"/s3/partials/dialogmodal.html",scope:{isOpen:"=",closeCallback:"&?",headerTitle:"=",hasWarningMsg:"=?",countInfo:"=?",pasteInfo:"=?",sourceDstInfo:"=?"},transclude:{header:"?dialogModalHeader",content:"dialogModalContent",footer:"dialogModalFooter"},controller:"DialogModalController"}});angular.module("s3").controller("DialogModalController",["$scope","PathService","$filter","$translate","UtilService",function(d,e,g,f,c){var b;var a=(b={},_defineProperty(b,f.instant("confirmationmodal.delete.title"),"dialog-delete-image"),_defineProperty(b,f.instant("confirmationmodal.storageclass.title"),"dialog-storage-image"),_defineProperty(b,f.instant("confirmationmodal.public.title"),"dialog-public-image"),_defineProperty(b,f.instant("confirmationmodal.deletebucket.title"),"dialog-delete-image"),_defineProperty(b,f.instant("confirmationmodal.emptybucket.title"),"dialog-delete-image"),_defineProperty(b,f.instant("confirmationmodal.initiaterestore.title"),"dialog-public-image"),_defineProperty(b,f.instant("crr.warningmsg.title.notenabled"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.warningmsg.title.accessdenied"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.enablerule"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.disablerule"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.enableallrules"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.disableallrules"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.deleteallrules"),"crr-watermark-image"),_defineProperty(b,f.instant("crr.confirmationmodal.deleteruletitle"),"crr-watermark-image"),b);d.getClass=function(){return a[d.headerTitle]};d.closeModal=function(){d.isOpen.flag=false;d.closeCallback();c.bodyFreezeScroll(d.isOpen&&d.isOpen.flag)};d.dstFolderPath=e.getCurrentAbsoluteFolderPath()||e.getCurrentBucket()}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("confirmationDialogModal",function(){return{restrict:"E",scope:{isOpen:"=",operation:"=?",countInfo:"=?"},templateUrl:"/s3/partials/confirmationdialogmodal.html",controller:"ConfirmationDialogModalController"}});angular.module("s3").controller("ConfirmationDialogModalController",["$scope","$filter","$translate","BulkOperationService","OperationDispatcherService","S3Constants","CopyService","KeySelectionService","CountService","UtilService","SCLogService",function(p,m,q,k,e,o,i,n,f,r,b){var j;var d="ttlObj";var h="ttlSize";var l={STANDARD:q.instant("replication.storageclasses.standard"),STANDARD_IA:q.instant("replication.storageclasses.standardia")};var c=(j={},_defineProperty(j,o.OPERATION_NAME.DELETE_OBJECTS,{headTitle:q.instant("confirmationmodal.delete.title"),buttonName:q.instant("confirmationmodal.delete.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.delete.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.RESTORE_OBJECTS,{headTitle:q.instant("confirmationmodal.undodelete.text"),buttonName:q.instant("confirmationmodal.undodelete.text"),warningInfo:{flag:true,text:"confirmationmodal.undodelete.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.MAKE_PUBLIC,{headTitle:q.instant("confirmationmodal.public.title"),buttonName:q.instant("confirmationmodal.public.buttonname"),warningInfo:{flag:true,text:"object.warningbody.granting.AllUsers"}}),_defineProperty(j,o.OPERATION_NAME.CHANGE_STORAGE_CLASS,{headTitle:q.instant("confirmationmodal.storageclass.title"),buttonName:q.instant("confirmationmodal.storageclass.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.paste.warningtext",val:p.operation.panelSettingValues?l[p.operation.panelSettingValues.setting]:""}}),_defineProperty(j,o.OPERATION_NAME.CHANGE_SSE,{headTitle:q.instant("confirmationmodal.sse.title"),buttonName:q.instant("confirmationmodal.sse.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.sse.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.CUT,{headTitle:q.instant("confirmationmodal.cutpaste.title"),buttonName:q.instant("confirmationmodal.paste.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.paste.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.COPY,{headTitle:q.instant("confirmationmodal.copypaste.title"),buttonName:q.instant("confirmationmodal.paste.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.paste.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.INITIATE_RESTORE,{headTitle:q.instant("confirmationmodal.initiaterestore.title"),buttonName:q.instant("confirmationmodal.initiaterestore.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.initialrestore.warningtext"}}),_defineProperty(j,o.OPERATION_NAME.ADD_OBJECT_TAG,{headTitle:q.instant("confirmationmodal.addtags.title"),buttonName:q.instant("confirmationmodal.addtags.buttonname"),warningInfo:{flag:true,text:"confirmationmodal.addtags.warningtext",val:p.operation.panelSettingValues&&p.operation.panelSettingValues.values?p.operation.panelSettingValues.values.length:0}}),_defineProperty(j,o.OPERATION_NAME.GET_INFO,{headTitle:q.instant("confirmationmodal.getinfo.title"),buttonName:q.instant("confirmationmodal.getinfo.buttonname"),warningInfo:{flag:false}}),j);var a={flag:true,folders:0,objects:0,size:0,currLevelObjs:0,countResultEachFolder:{}};p.closeIconShow=false;p.selected={selectedItems:{currFolderPathPrefix:p.operation.initialPath,folders:p.operation.selectedFolders,objects:p.operation.selectedKeys}};if(!p.countInfo||!p.countInfo.countFinish){p.countInfo=_.cloneDeep(a);p.isCounting={flag:false};p.$watch(function(){return p.countInfo},function(t,s){if(t!==s){angular.forEach(p.selected.selectedItems.folders,function(u){var v=p.countInfo.countResultEachFolder&&p.countInfo.countResultEachFolder[u.Prefix];if(v){u.objsCount=p.countInfo.countResultEachFolder[u.Prefix].count;u.folderSize=p.countInfo.countResultEachFolder[u.Prefix].totalSize}})}},true);f.countAllFiles(p.selected.selectedItems,p.countInfo,p.operation,p.isCounting)}else{angular.forEach(p.selected.selectedItems.folders,function(s){var t=p.countInfo.countResultEachFolder&&p.countInfo.countResultEachFolder[s.Prefix];if(t){s.objsCount=p.countInfo.countResultEachFolder[s.Prefix].count;s.folderSize=p.countInfo.countResultEachFolder[s.Prefix].totalSize}})}p.modalInfo=c[p.operation.name];var g=p.operation.name===o.OPERATION_NAME.CUT||p.operation.name===o.OPERATION_NAME.COPY;p.sourceDstInfo={flag:g,source:p.operation.initialPath||p.operation.initialBucket};p.closeConfirmationModal=function(){p.isOpen.flag=false;p.isOpen.dialogOpen.flag=false;p.isOpen.sidePanelOpen=false;p.selected={selectedItems:{currFolderPathPrefix:"",folders:[],objects:[]}};p.countInfo=_.cloneDeep(a);p.countInfo.flag=false;p.modalInfo={headTitle:"",buttonName:"",warningInfo:{flag:false,text:""}};p.operation=null;p.panelSettingValues=null};p.operationFunc=function(){if(p.operation.name===o.OPERATION_NAME.CHANGE_STORAGE_CLASS){p.operation.additionalInfo={targetStorageClass:p.operation.panelSettingValues.setting,numberOfKeysPerBulkOperation:o.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}}else{if(p.operation.name===o.OPERATION_NAME.CHANGE_SSE){p.operation.additionalInfo={sseAlgo:p.operation.panelSettingValues.setting,numberOfKeysPerBulkOperation:o.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API};if(p.operation.additionalInfo.sseAlgo===o.OBJECT_SSE.KMS_ENCRYPTION){if(p.operation.panelSettingValues.kmsOption.kmsId.value===o.OBJECT_SSE.CUSTOM_ARN){p.operation.additionalInfo.sseKmsKeyId=p.operation.panelSettingValues.kmsOption.kmsARN}else{p.operation.additionalInfo.sseKmsKeyId=p.operation.panelSettingValues.kmsOption.kmsId.value}}}else{if(p.operation.name===o.OPERATION_NAME.INITIATE_RESTORE){p.operation.additionalInfo={expirationDays:p.operation.panelSettingValues.setting,numberOfKeysPerBulkOperation:o.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}}else{if(p.operation.name===o.OPERATION_NAME.ADD_OBJECT_TAG){p.operation.additionalInfo={tags:r.reduceObjectArrayToObject(p.operation.panelSettingValues.values),numberOfKeysPerBulkOperation:o.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API}}else{if(p.operation.name===o.OPERATION_NAME.GET_INFO){p.closeConfirmationModal();return}}}}}p.operation.totalObjectCount=p.countInfo.objects;b.log(p.operation.name.replace(/\s/g,"")+d,p.operation.totalObjectCount,p.operation);b.log(p.operation.name.replace(/\s/g,"")+h,p.countInfo.size,p.operation);g?i.startClipboardOperation():e.addOperation(p.operation);p.closeConfirmationModal()};p.save=function(s){s.stopPropagation();p.isOpen.dialogOpen.flag=true;p.isOpen.sidePanelOpen=false};p.cancel=function(s){s.stopPropagation();p.closeConfirmationModal()}}])})();"use strict";(function(){angular.module("s3").directive("fileListInModal",function(){return{restrict:"E",scope:{removeItemFromUpload:"&?",closeIconShow:"=?",forUploads:"=",selected:"="},templateUrl:"/s3/partials/fileslistinmodal.html",controller:"FileListInModalController"}});angular.module("s3").controller("FileListInModalController",["$scope","$filter","UtilService",function(b,c,a){b.$watchCollection("selected",function(){b.selectedItems=b.selected.selectedItems});b.closeIconFunc=function(d){if(b.forUploads&&b.removeItemFromUpload){b.removeItemFromUpload({item:d})}};b.getFileIconClass=function(d){return a.getIconClassFromFilename(d.Key)};b.haveSelectedItems=function(){return b.selectedItems&&b.selectedItems.folders&&!_.isEmpty(b.selectedItems.folders)||b.selectedItems&&b.selectedItems.objects&&!_.isEmpty(b.selectedItems.objects)}}])})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("bucketLifecycle",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/bucketlifecycle.html",controller:"BucketLifecycleController"}}]);angular.module("s3").controller("BucketLifecycleController",["$scope","$translate","BucketPropertiesService","BucketPropertiesUtilService","CachingService","ConsoleOperation","FAC","PathService","S3Constants","UtilService",a]);function a(s,t,k,e,i,q,m,c,r,y){var A;s.moreOptions=[{id:r.LIFECYCLE.CONFIRMATION_MODAL.ENABLE_POLICY,text:t.instant("bucketlifecycle.more.enablelifecycle"),action:function u(){s.showConfirmationModal(r.LIFECYCLE.CONFIRMATION_MODAL.ENABLE_POLICY)},disabled:true},{id:r.LIFECYCLE.CONFIRMATION_MODAL.DISABLE_POLICY,text:t.instant("bucketlifecycle.more.disablelifecycle"),action:function u(){s.showConfirmationModal(r.LIFECYCLE.CONFIRMATION_MODAL.DISABLE_POLICY)},disabled:true}];s.showConfirmationModal=function(B){if(s.lifecycle.ruleToBeEdited){s.lifecycle.selectedRule=s.lifecycle.ruleToBeEdited;s.lifecycle.selectedRuleIndex=s.lifecycle.editRuleIndex;s.warningMessage=s.warningList[B];s.actionType=B;s.headerTitle=s.confirmationModalHeadersList[B];o();s.isConfirmationModalOpen.flag=true}};s.warningList={enablePolicy:t.instant("lifecycleconfirmationmodal.warning.enablemessage"),disablePolicy:t.instant("lifecycleconfirmationmodal.warning.disablemessage"),deletePolicy:t.instant("lifecycleconfirmationmodal.warning.deletemessage")};s.confirmationModalHeadersList={enablePolicy:t.instant("bucketlifecycle.more.enablelifecycle"),disablePolicy:t.instant("bucketlifecycle.more.disablelifecycle"),deletePolicy:t.instant("bucketlifecycle.more.deletelifecycle")};s.isConfirmationModalOpen={flag:false};s.isLifecycleModalOpen={flag:false};s.isRefreshing=true;s.lifecycleError="";s.showLifecycleModalForEdit=function(){if(s.lifecycle.ruleToBeEdited){s.lifecycle.selectedRule=v(s.lifecycle.ruleToBeEdited);s.lifecycle.selectedRule.showCurrent=!_.isEmpty(s.lifecycle.selectedRule.currentRuleActions);s.lifecycle.selectedRule.showPrevious=!_.isEmpty(s.lifecycle.selectedRule.noncurrentRuleActions);s.lifecycle.selectedRule.indexVal=s.lifecycle.editRuleIndex;s.isLifecycleModalOpen.flag=true;o();s.forEdit=true}};function o(){y.analyticsTrackClick(r.ANALYTICS.LIFECYCLE_RULES_MODAL,r.ANALYTICS.DETAILS)}s.showLifecycleModalForCreate=function(){y.analyticsTrackClick(r.ANALYTICS.START_LIFECYCLE,r.ANALYTICS.LIFECYCLE_S3);y.analyticsTrackView(r.ANALYTICS.NAME_SCOPE_LIFECYCLE,r.ANALYTICS.LIFECYCLE_S3);p();s.forEdit=false;s.lifecycle.selectedRule={};s.lifecycle.selectedRule.ID="";s.lifecycle.selectedRule.Status=r.LIFECYCLE.ENABLED;s.lifecycle.selectedRule.Prefix="";s.lifecycle.selectedRule.applied=r.LIFECYCLE.WHOLE_BUCKET;s.lifecycle.selectedRule.tags=[];s.lifecycle.selectedRule.currentRuleActions=[];s.lifecycle.selectedRule.noncurrentRuleActions=[];s.lifecycle.selectedRule.summary={currentTransitionsList:["","",""],noncurrentTransitionsList:["","",""],rldm:false,amu:"",ID:"",prefix:""};s.lifecycle.selectedRule.amu={enabled:false,days:""};s.lifecycle.selectedRule.expiration={enabled:false,days:""};s.lifecycle.selectedRule.permanentlyDelete={enabled:false,days:""};s.lifecycle.selectedRule.showRldm=true;s.lifecycle.selectedRule.rldmValue=false;s.lifecycle.selectedRule.containsRldmAsFalse=false;s.lifecycle.selectedRule.removeExpire=false;s.lifecycle.selectedRule.expiration={enabled:false,days:""};s.lifecycle.selectedRule.showCurrent=false;s.lifecycle.selectedRule.showPrevious=false;s.lifecycle.selectedRule.currentRuleOptions=z(n);s.lifecycle.selectedRule.noncurrentRuleOptions=z(n);s.lifecycle.selectedRule.isAddCurrentTransitionDisabled=false;s.lifecycle.selectedRule.isAddPrevTransitionDisabled=false;s.lifecycle.selectedRule.isNextButtonDisabled=true;s.lifecycle.selectedRule.showStep3CurrentVersion=false;s.lifecycle.selectedRule.showStep3PreviousVersion=false;s.lifecycle.selectedRule.filterUsed=s.filterUsed;s.lifecycle.selectedRule.filters={input:"",prefixFilters:[],tagFilters:[]};s.lifecycle.selectedRule.prefixUsed=false;o();s.isLifecycleModalOpen.flag=true};function p(){if(s.lifecycleConfiguration&&s.lifecycleConfiguration.Rules){for(var B=0;B<s.lifecycleConfiguration.Rules.length;B++){s.lifecycle.listViewRules[B].selected=false}}}function h(C,B){s.moreOptions[0].disabled=C;s.moreOptions[1].disabled=B}function n(){var C=[{text:t.instant("lifecyclemodal.sia"),value:r.LIFECYCLE.SIA,disabled:false}];var B={text:t.instant("lifecyclemodal.glacier"),value:r.LIFECYCLE.GLACIER,disabled:false};if(s.glacierEnabled){C.push(B)}return C}function z(C){var D=[];for(var B=0;B<r.LIFECYCLE.TOTAL_OPTIONS;B++){D.push(C())}return D}function x(D,C){if(D.NoncurrentVersionTransition){var E=y.transformObjectToArray(D.NoncurrentVersionTransition);for(var B=0;B<E.length;B++){if(E[B].NoncurrentDays){C.noncurrentRuleActions.push({action:r.LIFECYCLE.RULE_ACTIONS_MAP[E[B].StorageClass],value:E[B].NoncurrentDays})}}}}function l(C,B){if(C.NoncurrentVersionExpiration){if(C.NoncurrentVersionExpiration.NoncurrentDays){B.permanentlyDelete={enabled:true,days:C.NoncurrentVersionExpiration.NoncurrentDays};B.showStep3PreviousVersion=true}}}function b(D,C){if(D.Transition){var E=y.transformObjectToArray(D.Transition);for(var B=0;B<E.length;B++){if(E[B].Days){C.currentRuleActions.push({action:r.LIFECYCLE.RULE_ACTIONS_MAP[E[B].StorageClass],value:E[B].Days})}}}}function d(C,B){if(C.Expiration){if(C.Expiration.Days){B.expiration={enabled:true,days:C.Expiration.Days};B.removeExpire=false;B.showRldm=false;B.showStep3CurrentVersion=true}else{if(C.Expiration.ExpiredObjectDeleteMarker){if(C.Expiration.ExpiredObjectDeleteMarker===r.LIFECYCLE.TRUE){B.removeExpire=true}else{B.containsRldmAsFalse=true}}}}}function w(C,B){B.amu={enabled:false,days:""};if(C.AbortIncompleteMultipartUpload){B.amu.enabled=true;B.amu.days=C.AbortIncompleteMultipartUpload.DaysAfterInitiation}}function v(F){var E=_.cloneDeep(F);var D={};D.ID=E.ID;D.Status=E.Status;D.tagSet=[];D.Prefix="";D.prefixUsed=true;D.filters={input:"",prefixFilters:[],tagFilters:[]};if(E.Prefix){D.filterUsed=false;D.Prefix=E.Prefix;D.filters.prefixFilters.push(D.Prefix)}else{if(E.Filter){D.filterUsed=true;if(E.Filter.Prefix){D.Prefix=E.Filter.Prefix;D.filters.prefixFilters.push(D.Prefix)}else{if(E.Filter.And&&E.Filter.And.Prefix){D.Prefix=E.Filter.And.Prefix;D.filters.prefixFilters.push(D.Prefix)}else{D.prefixUsed=false}}}}if(E.Filter){var B=[];if(!_.isEmpty(E.Filter.Tag)){B=y.transformObjectToArray(E.Filter.Tag)}else{if(E.Filter.And&&!_.isEmpty(E.Filter.And.Tag)){B=y.transformObjectToArray(E.Filter.And.Tag)}}for(var C=0;C<B.length;C++){D.filters.tagFilters.push({tagKey:B[C].Key,tagVal:B[C].Value})}}D.applied=!_.isEmpty(D.Prefix)?r.LIFECYCLE.PREFIX:r.LIFECYCLE.WHOLE_BUCKET;D.currentRuleActions=[];D.noncurrentRuleActions=[];D.expiration={enabled:false,days:""};D.permanentlyDelete={enabled:false,days:""};D.removeExpire=false;D.showCurrent=false;D.showPrevious=false;D.showRldm=true;b(E,D);d(E,D);x(E,D);l(E,D);w(E,D);D.currentRuleOptions=z(n);D.noncurrentRuleOptions=z(n);D.isAddCurrentTransitionDisabled=e.isTransitionDisabled(r.LIFECYCLE.GLACIER,D.currentRuleActions);e.updateLifecycleDropdown(D.currentRuleActions,D.currentRuleOptions,r.LIFECYCLE.CURRENT_RULE_OPTIONS_MAP);D.isAddPrevTransitionDisabled=e.isTransitionDisabled(r.LIFECYCLE.GLACIER,D.noncurrentRuleActions);e.updateLifecycleDropdown(D.noncurrentRuleActions,D.noncurrentRuleOptions,r.LIFECYCLE.NONCURRENT_RULE_OPTIONS_MAP);D.summary={currentTransitionsList:["","",""],noncurrentTransitionsList:["","",""],rldm:false,amu:"",ID:"",prefix:""};D.isNextButtonDisabled=false;return D}s.isEdit=true;s.isDelete=true;s.selectRule=function(C,B){s.lifecycle.selectedRule={};s.lifecycle.ruleToBeEdited=angular.copy(s.lifecycleConfiguration.Rules[B]);s.lifecycle.editRuleIndex=B;p();C.selected=true;if(!C.containsDate){s.isEdit=false}s.isDelete=false;if(C.Status===r.LIFECYCLE.ENABLED){h(true,false)}else{h(false,true)}};s.lifecycle={listViewRules:[],ruleToBeEdited:{}};s.lifecycleConfiguration={Rules:[]};s.bucketName=c.getCurrentBucket();var j=(A={},_defineProperty(A,r.LIFECYCLE.LIST_VIEW.STANDARD_IA,t.instant("lifecycle.listview.standia")),_defineProperty(A,r.LIFECYCLE.LIST_VIEW.GLACIER,t.instant("lifecycle.listview.glacier")),_defineProperty(A,r.LIFECYCLE.LIST_VIEW.PREFIX,t.instant("lifecycle.listview.prefix")),_defineProperty(A,r.LIFECYCLE.LIST_VIEW.WHOLE,t.instant("lifecycle.listview.whole")),_defineProperty(A,r.LIFECYCLE.EXPIRE,t.instant("lifecycle.expire")),A);function f(){s.lifecycle.listViewRules=[];s.filterUsed=false;var C=function C(E){var H={};var G=angular.copy(s.lifecycleConfiguration.Rules[E]);H.ID=G.ID;if(typeof G.Prefix!=="undefined"){H.Prefix=G.Prefix!==""?j[r.LIFECYCLE.LIST_VIEW.PREFIX]+" : "+G.Prefix:j[r.LIFECYCLE.LIST_VIEW.WHOLE]}else{if(G.Filter){s.filterUsed=true;if(G.Filter.Prefix){H.Prefix=j[r.LIFECYCLE.LIST_VIEW.PREFIX]+" : "+G.Filter.Prefix}else{if(G.Filter.And&&G.Filter.And.Prefix){H.Prefix=j[r.LIFECYCLE.LIST_VIEW.PREFIX]+" : "+G.Filter.And.Prefix}else{H.Prefix=t.instant("lifecycle.listview.whole")}}if(H.Prefix.length>r.LIFECYCLE.LIST_VIEW_MAX_LENGTH){H.Prefix=H.Prefix.substring(0,22);H.Prefix=H.Prefix+"... "}var L=[];if(G.Filter.Tag){L=y.transformObjectToArray(G.Filter.Tag)}else{if(G.Filter.And&&!_.isEmpty(G.Filter.And.Tag)){L=y.transformObjectToArray(G.Filter.And.Tag)}}if(!_.isEmpty(L)){(function(){var M=r.LIFECYCLE.TAGS;var O=r.LIFECYCLE.KEY_STRING;var P=r.LIFECYCLE.VALUE_STRING;var N=", "+M+" : ";angular.forEach(L,function(Q){N=N+" [ "+O+": "+Q.Key+" , "+P+" : "+Q.Value+" ]"});if(N.length>r.LIFECYCLE.LIST_VIEW_MAX_LENGTH){N=N.substring(0,22);N=N+"..."}H.Prefix=H.Prefix+" "+N})()}}}H.Status=G.Status;var F=[];if(G.Transition){var J=y.transformObjectToArray(G.Transition);for(var D=0;D<J.length;D++){if(J[D].Days){F.push(j[r.LIFECYCLE.LIST_VIEW[J[D].StorageClass]])}else{if(J[D].Date){F.push(j[r.LIFECYCLE.LIST_VIEW[J[D].StorageClass]]+" ("+t.instant("bucketlifecycle.date")+(" "+J[D].Date+")"));H.containsDate=true}}}}if(G.Expiration){if(G.Expiration.Days){F.push(j[r.LIFECYCLE.EXPIRE])}else{if(G.Expiration.Date){F.push(j[r.LIFECYCLE.EXPIRE]+" ("+t.instant("bucketlifecycle.date")+(" "+G.Expiration.Date+")"));H.containsDate=true}}}H.transitionsList="";for(var K=0;K<F.length;K++){H.transitionsList=H.transitionsList+" / "+F[K]}if(!_.isEmpty(H.transitionsList)){H.transitionsList=H.transitionsList.substring(3)}else{H.transitionsList="-"}F=[];H.prevActions="";if(G.NoncurrentVersionTransition){var I=y.transformObjectToArray(G.NoncurrentVersionTransition);angular.forEach(I,function(M){if(M.NoncurrentDays){F.push(j[r.LIFECYCLE.LIST_VIEW[M.StorageClass]])}})}if(G.NoncurrentVersionExpiration){F.push(r.LIFECYCLE.LIST_VIEW[r.LIFECYCLE.PERMANENTLY_DELETE])}angular.forEach(F,function(M){H.prevActions=H.prevActions+" / "+M});if(!_.isEmpty(H.prevActions)){H.prevActions=H.prevActions.substring(3)}else{H.prevActions="-"}if(H.transitionsList==="-"&&H.prevActions==="-"&&G.AbortIncompleteMultipartUpload){H.transitionsList=t.instant("lifecyclemodal.step3.imucleanup")}s.lifecycle.listViewRules.push(H)};for(var B=0;B<s.lifecycleConfiguration.Rules.length;B++){C(B)}}s.operation=new q(r.LIFECYCLE.BUCKET_LIFECYCLE);s.glacierEnabled=true;function g(){k.getBucketLocation(s.bucketName).then(function(B){if(!m.isFeatureEnabled("s3-gl-"+B)){s.glacierEnabled=false}})}s.initialize=function(){var B=new X2JS({stripWhitespaces:false});s.lifecycle.initialXML="";s.lifecycleConfiguration.Rules=[];s.isRefreshing=true;s.operation.step=r.LIFECYCLE.GET_BUCKET_LIFECYCLE;k.getBucketLifecycle(s.bucketName,s.operation).then(function(D){i.evictBucketProperty(s.bucketName,r.LIFECYCLE.NAME);var C=B.xml_str2json(D);if(C&&C.LifecycleConfiguration&&C.LifecycleConfiguration.Rule){s.lifecycleConfiguration.Rules=y.transformObjectToArray(C.LifecycleConfiguration.Rule);s.showEmptyScreen=s.lifecycleConfiguration.Rules.length===0;s.lifecycle.initialXML=D;f()}})["catch"](function(C){if(C!==r.LIFECYCLE.LIFECYCLE_DOES_NOT_EXIST_MESSAGE){s.lifecycleError=C}else{s.showEmptyScreen=true}})["finally"](function(){s.isRefreshing=false})};s.initialize();g()}})();"use strict";(function(){angular.module("s3").directive("lifecycleModal",[function(){return{restrict:"E",scope:{isOpen:"=",selectedRule:"=",initialResponse:"=",initialize:"=",isEditing:"=",initialXml:"=",operation:"=",disableEdit:"=",disableDelete:"=",ruleToBeEdited:"=",moreOptions:"="},templateUrl:"/s3/partials/lifecyclemodal.html",controller:"LifecycleModalController"}}]);angular.module("s3").controller("LifecycleModalController",["$scope","$timeout","$translate","BucketPropertiesService","BucketPropertiesUtilService","FAC","PathService","S3Constants","SCLogService","UtilService",a]);function a(t,z,u,o,g,p,f,s,e,A){t.STEP={NAME_AND_SCOPE:{name:"NAME_AND_SCOPE",value:u.instant("lifecyclemodal.label.nameandscope")},TRANSITION:{name:"TRANSITION",value:u.instant("lifecyclemodal.transitions")},EXPIRATION:{name:"EXPIRATION",value:u.instant("lifecyclemodal.expiration")},REVIEW:{name:"REVIEW",value:u.instant("lifecyclemodal.label.review")}};t.transitionNumber=[u.instant("bucketlifecycle.firsttransition"),u.instant("bucketlifecycle.secondtransition"),u.instant("bucketlifecycle.thirdtransition")];t.$watch("selectedRule",function(E,D){if(t.selectedRule&&t.selectedRule.filters&&t.selectedRule.filters.tagFilters.length>0){if(t.selectedRule.amu.enabled&&t.selectedRule.amu.days||t.selectedRule.removeExpire){t.clearLDMAMUWarning=true;t.selectedRule.amu.enabled=false;t.selectedRule.amu.days="";t.selectedRule.removeExpire=false}t.showV2FormatWarning=!t.selectedRule.filterUsed&&!_.isEmpty(t.initialResponse)}else{t.showV2FormatWarning=false;t.clearLDMAMUWarning=false}},true);t.isAddPrevTransitionDisabled=false;t.isAddCurrentTransitionDisabled=false;t.showOverlappingPrefixWarning=false;function c(){t.selectedRule.isAddCurrentTransitionDisabled=g.isTransitionDisabled(s.LIFECYCLE.GLACIER,t.selectedRule.currentRuleActions);g.updateLifecycleDropdown(t.selectedRule.currentRuleActions,t.selectedRule.currentRuleOptions,s.LIFECYCLE.CURRENT_RULE_OPTIONS_MAP)}function B(){t.selectedRule.isAddPrevTransitionDisabled=g.isTransitionDisabled(s.LIFECYCLE.GLACIER,t.selectedRule.noncurrentRuleActions);g.updateLifecycleDropdown(t.selectedRule.noncurrentRuleActions,t.selectedRule.noncurrentRuleOptions,s.LIFECYCLE.NONCURRENT_RULE_OPTIONS_MAP)}function n(E,D){if(E.action===s.LIFECYCLE.SIA){E.value=s.LIFECYCLE.RECOMMENDED_DAYS.SIA}else{if(E.action===s.LIFECYCLE.GLACIER){E.value=s.LIFECYCLE.RECOMMENDED_DAYS.GLACIER;if(D.length>1){E.value=(parseInt(D[D.length-2].value)+s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS.SIA).toString()}}}}function y(E,D){E.days=s.LIFECYCLE.RECOMMENDED_DAYS.EXPIRATION;if(D.length>0){E.days=(parseInt(D[D.length-1].value)+parseInt(E.days)).toString()}}t.selectNoncurrentRuleAction=function(E,D){if(D===t.selectedRule.noncurrentRuleActions.length-1){t.hasPrevError=false}t.notANumberErrorNoncurrent.SIA=false;t.notANumberErrorNoncurrent.Glacier=false;t.minimumDaysNoncurrent.SIA=false;t.minimumDaysNoncurrent.Glacier=false;B();if(t.selectedRule.noncurrentRuleActions[D].value===""){n(t.selectedRule.noncurrentRuleActions[D],t.selectedRule.noncurrentRuleActions)}t.validateDays(D,s.LIFECYCLE.NONCURRENT);t.updateNextButtonDisabled()};t.selectCurrentRuleAction=function(E,D){if(D===t.selectedRule.currentRuleActions.length-1){t.hasCurrentError=false}t.notANumberErrorCurrent.SIA=false;t.notANumberErrorCurrent.Glacier=false;t.minimumDaysCurrent.SIA=false;t.minimumDaysCurrent.Glacier=false;c();if(t.selectedRule.currentRuleActions[D].value===""){n(t.selectedRule.currentRuleActions[D],t.selectedRule.currentRuleActions)}t.validateDays(D,s.LIFECYCLE.CURRENT);t.updateNextButtonDisabled()};t.addCurrentRuleAction=function(){if(t.selectedRule.isAddCurrentTransitionDisabled){return}t.selectedRule.currentRuleActions.push({action:"",value:""});c();t.selectedRule.isAddCurrentTransitionDisabled=true;t.updateNextButtonDisabled()};t.removeCurrentRuleAction=function(D){if(t.selectedRule.currentRuleActions.length-1===D){t.hasCurrentError=false}var E=t.selectedRule.currentRuleActions[D].action;t.notANumberErrorCurrent[E]=false;t.minimumDaysCurrent[E]=false;t.highlightTextBoxErrorCurrent[D]=false;t.selectedRule.currentRuleActions.splice(D,1);c();q(t.selectedRule.currentRuleActions,s.LIFECYCLE.CURRENT);t.updateNextButtonDisabled();if(t.selectedRule.expiration.enabled){t.validateCurrentExpiration()}};t.addNoncurrentRuleAction=function(){if(t.selectedRule.isAddPrevTransitionDisabled){return}t.selectedRule.noncurrentRuleActions.push({action:"",value:""});B();t.selectedRule.isAddPrevTransitionDisabled=true;t.updateNextButtonDisabled()};t.removeNoncurrentRuleAction=function(E){if(t.selectedRule.noncurrentRuleActions.length-1===E){t.hasPrevError=false}var D=t.selectedRule.noncurrentRuleActions[E].action;t.notANumberErrorNoncurrent[D]=false;t.minimumDaysNoncurrent[D]=false;t.highlightTextBoxErrorNonCurrent[E]=false;t.selectedRule.noncurrentRuleActions.splice(E,1);B();q(t.selectedRule.noncurrentRuleActions,s.LIFECYCLE.NONCURRENT);t.updateNextButtonDisabled();if(t.selectedRule.permanentlyDelete.enabled){t.validateNoncurrentExpiration()}};t.state=t.STEP.NAME_AND_SCOPE;t.headerTitle=u.instant("lifecyclemodal.header.title");t.generateSummary=function(){if(t.state===t.STEP.NAME_AND_SCOPE){A.analyticsTrackClick(s.ANALYTICS.NAME_SCOPE_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3);A.analyticsTrackView(s.ANALYTICS.TRANSITION_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3);t.selectedRule.summary.ruleName=angular.copy(t.selectedRule.ID);if(t.showOldUI){t.selectedRule.summary.prefix=!_.isEmpty(t.selectedRule.Prefix)?angular.copy(t.selectedRule.Prefix):u.instant("lifecyclemodal.step1.wholebucket")}else{var J=t.selectedRule.filters&&!_.isEmpty(t.selectedRule.filters.prefixFilters)?angular.copy(t.selectedRule.filters.prefixFilters[0]):u.instant("lifecyclemodal.step1.wholebucket");var E=s.LIFECYCLE.TAGSET;E=E+" : ";for(var G=0;G<t.selectedRule.filters.tagFilters.length;G++){var I=s.LIFECYCLE.KEY;var P=s.LIFECYCLE.VALUE;var F="[ "+I+" "+t.selectedRule.filters.tagFilters[G].tagKey+" , "+P+" : "+t.selectedRule.filters.tagFilters[G].tagVal+" ]";E=E+" "+F}t.selectedRule.summary.prefix=""+J;if(!_.isEmpty(t.selectedRule.filters.tagFilters)){t.selectedRule.summary.prefix=J+" , "+E}}}else{if(t.state===t.STEP.TRANSITION){t.selectedRule.summary.currentTransitionsList=[];t.selectedRule.summary.noncurrentTransitionsList=[];var D=u.instant("lifecyclemodal.step3.afterdays");var M=u.instant("lifecyclemodal.days");for(var G=0;G<t.selectedRule.currentRuleActions.length;G++){var O=angular.copy(t.selectedRule.currentRuleActions[G].value);var N=s.LIFECYCLE.REVIEW_SECTION_TRANSITIONS[t.selectedRule.currentRuleActions[G].action];var H=N+" "+D+" "+O+" "+M;t.selectedRule.summary.currentTransitionsList.push(H)}for(var G=t.selectedRule.currentRuleActions.length;G<s.LIFECYCLE.TOTAL_OPTIONS;G++){t.selectedRule.summary.currentTransitionsList.push("")}for(var G=0;G<t.selectedRule.noncurrentRuleActions.length;G++){var K=angular.copy(t.selectedRule.noncurrentRuleActions[G].value);var N=s.LIFECYCLE.REVIEW_SECTION_TRANSITIONS[t.selectedRule.noncurrentRuleActions[G].action];var L=N+" "+D+" "+K+" "+M;t.selectedRule.summary.noncurrentTransitionsList.push(L)}for(var G=t.selectedRule.noncurrentRuleActions.length;G<s.LIFECYCLE.TOTAL_OPTIONS;G++){t.selectedRule.summary.noncurrentTransitionsList.push("")}t.selectedRule.summary.currentVersionHeader=_.some(t.selectedRule.summary.currentTransitionsList,function(Q){return Q!==""});t.selectedRule.summary.noncurrentVersionHeader=_.some(t.selectedRule.summary.noncurrentTransitionsList,function(Q){return Q!==""});A.analyticsTrackClick(s.ANALYTICS.TRANSITION_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3);A.analyticsTrackView(s.ANALYTICS.EXPIRATIONS_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3)}else{if(t.state===t.STEP.EXPIRATION){t.searchOverlappingPrefixes();if(t.selectedRule.amu&&t.selectedRule.amu.enabled&&t.selectedRule.amu.days!==""){t.selectedRule.summary.amu=angular.copy(t.selectedRule.amu.days)}else{t.selectedRule.summary.amu=""}if(t.selectedRule.removeExpire&&t.selectedRule.expiration&&!t.selectedRule.expiration.enabled){t.selectedRule.summary.rldm=true}else{t.selectedRule.summary.rldm=false}A.analyticsTrackClick(s.ANALYTICS.EXPIRATIONS_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3);A.analyticsTrackView(s.ANALYTICS.REVIEW_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3)}}}t.nextState();t.selectedRule.isNextButtonDisabled=true;t.updateNextButtonDisabled()};t.searchOverlappingPrefixes=function(){t.showOverlappingPrefixWarning=false;t.overlappingRule="";for(var E=0;E<t.initialResponse.length;E++){if(t.isEditing&&E===t.selectedRule.indexVal){continue}var F="";var D="";if(t.showOldUI){D=t.selectedRule.Prefix}else{D=!_.isEmpty(t.selectedRule.filters.prefixFilters)?t.selectedRule.filters.prefixFilters[0]:""}var G=t.initialResponse[E];if(G.Prefix){F=G.Prefix}else{if(G.Filter){if(G.Filter.Prefix){F=G.Filter.Prefix}else{if(G.Filter.And&&G.Filter.And.Prefix){F=G.Filter.And.Prefix}}}}if(_.startsWith(D,F)||_.startsWith(F,D)){t.showOverlappingPrefixWarning=true;if(!t.selectedRule.filterUsed){t.showOverlappingNewFormatWarning=true}t.overlappingRule=G.ID;break}}};function v(G,J,H){var F={};F.LifecycleConfiguration={};F.LifecycleConfiguration.Rule=G;delete G._xmlns;var E=t.initialXml;var D=J.json2xml_str(F);var I=t.isEditing?J.json2xml_str(t.initialResponse[t.selectedRule.indexVal]):"";o.putBucketLifecycle(f.getCurrentBucket(),E,D,I,H,t.operation).then(function(){t.lifecycleError=undefined;t.disableEdit=true;t.disableDelete=true;t.ruleToBeEdited=undefined;t.moreOptions[0].disabled=true;t.moreOptions[1].disabled=true;t.initialize();t.closeLifecycleModal()})["catch"](function(K){t.lifecycleError=K})}t.detectStateChange=function(){t.operation.step=s.LIFECYCLE.GET_BUCKET_LIFECYCLE;o.getBucketLifecycle(f.getCurrentBucket(),t.operation).then(function(D){if(D!==t.initialXml){t.showContinue=true;t.stateChangeWarning=u.instant("lifecyclemodal.step3.statechange")}else{t.showContinue=false;t.stateChangeWarning=undefined;t.saveLifecycle()}})["catch"](function(D){if(D===s.LIFECYCLE.LIFECYCLE_DOES_NOT_EXIST_MESSAGE){if(t.initialXml!==""){t.showContinue=true;t.stateChangeWarning=u.instant("lifecyclemodal.step3.statechange")}else{t.showContinue=false;t.stateChangeWarning=undefined;t.saveLifecycle()}}else{t.lifecycleError=D}})};function b(E,D){return Object.keys(E).some(function(F){return F!==s.LIFECYCLE.PREFIX_PROPERTY&&!_.isEqual(E[F],D[F])})}t.saveLifecycle=function(){var E={};var F=false;A.analyticsTrackClick(s.ANALYTICS.END_LIFECYCLE,s.ANALYTICS.LIFECYCLE_S3,{s_fid:A.getCookie("s_fid"),"session-id":A.getCookie("session-id")});t.operation.step=s.LIFECYCLE.ENABLED_LIFECYCLE_RULE_ACTIONS;var N=angular.copy(t.selectedRule);E.ID=N.ID;if(!t.selectedRule.filterUsed&&_.isEmpty(t.selectedRule.filters.tagFilters)&&!t.showOverlappingPrefixWarning){if(t.showOldUI){E.Prefix=N.applied===s.LIFECYCLE.PREFIX?N.Prefix:""}else{if(!_.isEmpty(t.initialResponse)){E.Prefix=_.isEmpty(N.filters.prefixFilters)?"":N.filters.prefixFilters[0]}else{E.Filter={};E.Filter.Prefix=_.isEmpty(N.filters.prefixFilters)?"":N.filters.prefixFilters[0];F=true}}}else{if(!_.isEmpty(N.filters.tagFilters)){if(N.filters.tagFilters.length===1&&!N.prefixUsed&&(t.showOldUI&&_.isEmpty(N.Prefix)||!t.showOldUI&&_.isEmpty(N.filters.prefixFilters))){E.Filter={};E.Filter.Tag=[];E.Filter.Tag.push({Key:N.filters.tagFilters[0].tagKey,Value:N.filters.tagFilters[0].tagVal})}else{E.Filter={};E.Filter.And={};if(t.showOldUI){E.Filter.And.Prefix=N.applied===s.LIFECYCLE.PREFIX?N.Prefix:""}else{E.Filter.And.Prefix=_.isEmpty(N.filters.prefixFilters)?"":N.filters.prefixFilters[0]}E.Filter.And.Tag=[];for(var G=0;G<N.filters.tagFilters.length;G++){E.Filter.And.Tag.push({Key:N.filters.tagFilters[G].tagKey,Value:N.filters.tagFilters[G].tagVal})}}}else{E.Filter={};if(t.showOldUI){E.Filter.Prefix=N.applied===s.LIFECYCLE.PREFIX?N.Prefix:""}else{E.Filter.Prefix=_.isEmpty(N.filters.prefixFilters)?"":N.filters.prefixFilters[0]}}if(!t.selectedRule.filterUsed){F=true}}E.Status=N.Status;E.Transition=[];for(var G=0;G<N.currentRuleActions.length;G++){if(N.currentRuleActions[G].action===s.LIFECYCLE.SIA){var J={};J.StorageClass=s.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS;J.Days=N.currentRuleActions[G].value;E.Transition.push(J);e.log("LifecycleCurrentSIARule",1,t.operation)}else{if(N.currentRuleActions[G].action===s.LIFECYCLE.GLACIER){var M={};M.StorageClass=s.STORAGE_CLASSES.GLACIER;M.Days=N.currentRuleActions[G].value;E.Transition.push(M);e.log("LifecycleCurrentGlacierRule",1,t.operation)}}}if(E.Transition.length===0){delete E.Transition}E.NoncurrentVersionTransition=[];for(var G=0;G<N.noncurrentRuleActions.length;G++){if(N.noncurrentRuleActions[G].action===s.LIFECYCLE.SIA){var D={};D.StorageClass=s.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS;D.NoncurrentDays=N.noncurrentRuleActions[G].value;E.NoncurrentVersionTransition.push(D);e.log("LifecycleNoncurrentSIARule",1,t.operation)}else{if(N.noncurrentRuleActions[G].action===s.LIFECYCLE.GLACIER){var I={};I.StorageClass=s.STORAGE_CLASSES.GLACIER;I.NoncurrentDays=N.noncurrentRuleActions[G].value;E.NoncurrentVersionTransition.push(I);e.log("LifecycleNoncurrentGlacierRule",1,t.operation)}}}if(E.NoncurrentVersionTransition.length===0){delete E.NoncurrentVersionTransition}if(N.expiration&&N.expiration.enabled&&N.expiration.days!==""){E.Expiration={};E.Expiration.Days=N.expiration.days;e.log("LifecycleExpirationRule",1,t.operation)}if(N.permanentlyDelete&&N.permanentlyDelete.enabled&&N.permanentlyDelete.days!==""){E.NoncurrentVersionExpiration={};E.NoncurrentVersionExpiration.NoncurrentDays=N.permanentlyDelete.days;e.log("LifecycleNoncurrentExpirationRule",1,t.operation)}if(N.removeExpire){if(!(E.Expiration&&E.Expiration.Days)){E.Expiration={};E.Expiration.ExpiredObjectDeleteMarker=s.LIFECYCLE.TRUE;e.log("LifecycleExpiredLDMTrueRule",1,t.operation)}}if(N.amu&&N.amu.enabled&&N.amu.days!==""){E.AbortIncompleteMultipartUpload={};E.AbortIncompleteMultipartUpload.DaysAfterInitiation=N.amu.days;e.log("LifecycleAbortIncompleteUploadRule",1,t.operation)}if(N.containsRldmAsFalse){if(!E.Expiration){E.Expiration={};E.Expiration.ExpiredObjectDeleteMarker=s.LIFECYCLE.FALSE;e.log("LifecycleExpiredLDMFalseRule",1,t.operation)}}var H=angular.copy(t.initialResponse);if(F){for(var G=0;G<H.length;G++){if(typeof H[G].Prefix!=="undefined"){H[G].Filter={};H[G].Filter.Prefix=angular.copy(H[G].Prefix);delete H[G].Prefix}}}var K=new X2JS({stripWhitespaces:false});var L=false;if(t.isEditing){H[N.indexVal]=E;if(!t.selectedRule.filterUsed){for(var G=0;G<t.initialResponse.length;G++){if(G!==N.indexVal){if(b(t.initialResponse[G],H[G])){e.log(s.METRIC_NAME.LIFECYCLE_RULE_MISMATCH,1,t.operation,{initialRule:t.initialResponse[G],finalRule:H[G]});L=true;break}}}}else{for(var G=0;G<t.initialResponse.length;G++){if(G!==N.indexVal&&!_.isEqual(t.initialResponse[G],H[G])){e.log(s.METRIC_NAME.LIFECYCLE_RULE_MISMATCH,1,t.operation,{initialRule:t.initialResponse[G],finalRule:H[G]});L=true;break}}}if(!L){e.log("LifecycleRuleVerification",1,t.operation,{initialResponse:t.initialResponse,finalResponse:H});t.operation.step=s.LIFECYCLE.EDIT_BUCKET_LIFECYCLE;v(H,K,E)}else{e.log("LifecycleRuleVerification",0,t.operation,{initialResponse:t.initialResponse,finalResponse:H})}}else{for(var G=0;G<t.initialResponse.length;G++){if(b(t.initialResponse[G],H[G])){e.log(s.METRIC_NAME.LIFECYCLE_RULE_MISMATCH,1,t.operation,{initialRule:t.initialResponse[G],finalRule:H[G]});L=true;break}}t.operation.step=s.LIFECYCLE.CREATE_BUCKET_LIFECYCLE;H.push(E);if(!L){e.log("LifecycleRuleVerification",1,t.operation,{initialResponse:t.initialResponse,finalResponse:H});v(H,K,E)}else{e.log("LifecycleRuleVerification",0,t.operation,{initialResponse:t.initialResponse,finalResponse:H})}}};function m(){t.notANumberErrorCurrent={};t.notANumberErrorCurrent.SIA=false;t.notANumberErrorCurrent.Glacier=false;t.notANumberErrorCurrent.Expire=false;t.minimumDaysCurrent={};t.minimumDaysCurrent.SIA=false;t.minimumDaysCurrent.Glacier=false;t.minimumDaysCurrent.Expire=false;t.greaterThanCurrentError={};t.greaterThanCurrentError.GlacierGreaterThanSIA=false;t.greaterThanCurrentError.DeleteGreaterThanSIA=false;t.greaterThanCurrentError.DeleteGreaterThanGlacier=false;t.highlightTextBoxErrorCurrent=[false,false,false];t.notANumberErrorNoncurrent={};t.notANumberErrorNoncurrent.SIA=false;t.notANumberErrorNoncurrent.Glacier=false;t.notANumberErrorNoncurrent.PermanentlyDelete=false;t.minimumDaysNoncurrent={};t.minimumDaysNoncurrent.SIA=false;t.minimumDaysNoncurrent.Glacier=false;t.minimumDaysNoncurrent.PermanentlyDelete=false;t.greaterThanNonCurrentError={};t.greaterThanNonCurrentError.GlacierGreaterThanSIA=false;t.greaterThanNonCurrentError.DeleteGreaterThanSIA=false;t.greaterThanNonCurrentError.DeleteGreaterThanGlacier=false;t.highlightTextBoxErrorNonCurrent=[false,false,false];t.currentGlacierGreaterThanSIAValue="";t.expireGreaterThanSIAValue="";t.expireGreaterThanGlacierValue="";t.noncurrentGlacierGreaterThanSIAValue="";t.permanentlyDeleteGreaterThanSIAValue="";t.permanentlyDeleteGreaterThanGlacierValue="";t.tag={error:""};t.tagSearchSelected=false;t.showTag=false;t.markers=[];t.tagContinuationTokens=[];t.higherNumberErrorCurrent={};t.higherNumberErrorCurrent.SIA=false;t.higherNumberErrorCurrent.Glacier=false;t.higherNumberErrorCurrent.Expire=false;t.higherNumberErrorNoncurrent={};t.higherNumberErrorNoncurrent.SIA=false;t.higherNumberErrorNoncurrent.Glacier=false;t.higherNumberErrorNoncurrent.PermanentlyDelete=false}t.showStep2CurrentVersionChange=function(){if(!t.selectedRule.showCurrent){var D=t.selectedRule.currentRuleActions.length;for(var E=0;E<D;E++){t.removeCurrentRuleAction(0)}}if(t.selectedRule.expiration.enabled){t.validateCurrentExpiration()}};t.showStep2PreviousVersionChange=function(){if(!t.selectedRule.showPrevious){var D=t.selectedRule.noncurrentRuleActions.length;for(var E=0;E<D;E++){t.removeNoncurrentRuleAction(0)}}if(t.selectedRule.permanentlyDelete.enabled){t.validateNoncurrentExpiration()}};t.showStep3CurrentVersionChange=function(){if(!t.selectedRule.showStep3CurrentVersion){t.selectedRule.expiration.enabled=false;t.selectedRule.expiration.days="";t.selectedRule.showRldm=true;t.notANumberErrorCurrent[s.LIFECYCLE.EXPIRE]=false;t.minimumDaysCurrent[s.LIFECYCLE.EXPIRE]=false;t.higherNumberErrorCurrent.Expire=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;t.updateNextButtonDisabled()}else{if(!t.selectedRule.expiration.enabled){t.selectedRule.expiration.enabled=true;t.selectedRule.showRldm=false;t.selectedRule.removeExpire=false;z(function(){return $("#expiration-days input").focus()});if(t.selectedRule.expiration.days===""){y(t.selectedRule.expiration,t.selectedRule.currentRuleActions)}t.updateNextButtonDisabled()}}};t.showStep3PreviousVersionChange=function(){if(!t.selectedRule.showStep3PreviousVersion){t.selectedRule.permanentlyDelete.enabled=false;t.selectedRule.permanentlyDelete.days="";t.notANumberErrorNoncurrent[s.LIFECYCLE.PERMANENTLY_DELETE]=false;t.minimumDaysNoncurrent[s.LIFECYCLE.PERMANENTLY_DELETE]=false;t.higherNumberErrorNoncurrent.PermanentlyDelete=false;t.greaterThanNonCurrentError[s.LIFECYCLE.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanNonCurrentError[s.LIFECYCLE.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;t.updateNextButtonDisabled()}else{if(!t.selectedRule.permanentlyDelete.enabled){t.selectedRule.permanentlyDelete.enabled=true;z(function(){return $("#permanently-delete-days input").focus()});if(t.selectedRule.permanentlyDelete.days===""){y(t.selectedRule.permanentlyDelete,t.selectedRule.noncurrentRuleActions)}t.updateNextButtonDisabled()}}};function l(){t.notANumberAmuError=false;t.minimumDaysAmuError=false;t.higherNumberErrorAmu=false;t.hasCurrentError=false;t.hasPrevError=false}function k(){m();l()}function r(K,I,H,F,D,G){var E=K.length;if(E>=1){if(K[0].action===s.LIFECYCLE.SIA){if(E===2&&K[1].action===s.LIFECYCLE.GLACIER){if(K[1].value-K[0].value<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS.SIA){H[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER_GREATER_THAN_SIA]=true;F[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]=true;var J=parseInt(K[0].value)+30;if(G===s.LIFECYCLE.CURRENT){t.currentGlacierGreaterThanSIAValue=J}else{t.noncurrentGlacierGreaterThanSIAValue=J}return}else{if(K[0].value<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS.SIA){D[s.LIFECYCLE.SIA]=true;F[s.LIFECYCLE.RULE_ACTION_ERRORS.SIA]=true;return}else{H[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER_GREATER_THAN_SIA]=false;F[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]=false}}}}if(I!==""&&I-K[E-1].value<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS.Delete){var J=parseInt(K[E-1].value)+1;if(K[E-1].action===s.LIFECYCLE.SIA){H[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_SIA]=true;F[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true;if(G===s.LIFECYCLE.CURRENT){t.expireGreaterThanSIAValue=J}else{t.permanentlyDeleteGreaterThanSIAValue=J}return}else{if(K[E-1].action===s.LIFECYCLE.GLACIER){H[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=true;F[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true;if(G===s.LIFECYCLE.CURRENT){t.expireGreaterThanGlacierValue=J}else{t.permanentlyDeleteGreaterThanGlacierValue=J}return}}}else{H[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;F[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false}}}t.validateDays=function(G,F){if(F===s.LIFECYCLE.CURRENT){var D=t.selectedRule.currentRuleActions[G].action;t.notANumberErrorCurrent.SIA=false;t.notANumberErrorCurrent.Glacier=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.SIA]=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;t.minimumDaysCurrent.SIA=false;t.minimumDaysCurrent.Glacier=false;t.higherNumberErrorCurrent.SIA=false;t.higherNumberErrorCurrent.Glacier=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER_GREATER_THAN_SIA]=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;if(t.selectedRule.currentRuleActions.length>0&&t.selectedRule.currentRuleActions[G].action!==""){if(isNaN(t.selectedRule.currentRuleActions[G].value)||t.selectedRule.currentRuleActions[G].value%1!==0||t.selectedRule.currentRuleActions[G].value.indexOf(s.LIFECYCLE.EXPONENTIAL)!==-1){t.notANumberErrorCurrent[D]=true;t.highlightTextBoxErrorCurrent[G]=true}else{if(t.selectedRule.currentRuleActions[G].value>s.LIFECYCLE.MAX_DAYS_ALLOWED){t.higherNumberErrorCurrent[D]=true;t.highlightTextBoxErrorCurrent[G]=true}else{if(t.selectedRule.currentRuleActions[G].value<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS[t.selectedRule.currentRuleActions[G].action]){t.minimumDaysCurrent[D]=true;t.highlightTextBoxErrorCurrent[G]=true}else{r(t.selectedRule.currentRuleActions,t.selectedRule.expiration.days,t.greaterThanCurrentError,t.highlightTextBoxErrorCurrent,t.minimumDaysCurrent,s.LIFECYCLE.CURRENT)}}}}t.updateNextButtonDisabled();return w(s.LIFECYCLE.CURRENT)}else{var E=t.selectedRule.noncurrentRuleActions[G].action;t.notANumberErrorNoncurrent.SIA=false;t.notANumberErrorNoncurrent.Glacier=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.SIA]=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;t.minimumDaysNoncurrent.SIA=false;t.minimumDaysNoncurrent.Glacier=false;t.higherNumberErrorNoncurrent.SIA=false;t.higherNumberErrorNoncurrent.Glacier=false;t.greaterThanNonCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER_GREATER_THAN_SIA]=false;t.greaterThanNonCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanNonCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;if(t.selectedRule.noncurrentRuleActions.length>0&&t.selectedRule.noncurrentRuleActions[G].action!==""){if(isNaN(t.selectedRule.noncurrentRuleActions[G].value)||t.selectedRule.noncurrentRuleActions[G].value%1!==0||t.selectedRule.noncurrentRuleActions[G].value.indexOf(s.LIFECYCLE.EXPONENTIAL)!==-1){t.notANumberErrorNoncurrent[E]=true;t.highlightTextBoxErrorNonCurrent[G]=true}else{if(t.selectedRule.noncurrentRuleActions[G].value>s.LIFECYCLE.MAX_DAYS_ALLOWED){t.higherNumberErrorNoncurrent[E]=true;t.highlightTextBoxErrorNonCurrent[G]=true}else{if(t.selectedRule.noncurrentRuleActions[G].value<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS[t.selectedRule.noncurrentRuleActions[G].action]){t.minimumDaysNoncurrent[E]=true;t.highlightTextBoxErrorNonCurrent[G]=true}else{r(t.selectedRule.noncurrentRuleActions,t.selectedRule.permanentlyDelete.days,t.greaterThanNonCurrentError,t.highlightTextBoxErrorNonCurrent,t.minimumDaysNoncurrent,s.LIFECYCLE.NONCURRENT)}}}}t.updateNextButtonDisabled();return w(s.LIFECYCLE.NONCURRENT)}};t.validateCurrentExpiration=function(){t.notANumberErrorCurrent.Expire=false;t.minimumDaysCurrent.Expire=false;t.greaterThanCurrentError.DeleteGreaterThanSIA=false;t.greaterThanCurrentError.DeleteGreaterThanGlacier=false;t.higherNumberErrorCurrent.Expire=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;if(isNaN(t.selectedRule.expiration.days)||t.selectedRule.expiration.days%1!==0||t.selectedRule.expiration.days.indexOf(s.LIFECYCLE.EXPONENTIAL)!==-1){t.notANumberErrorCurrent.Expire=true;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{if(t.selectedRule.expiration.days>s.LIFECYCLE.MAX_DAYS_ALLOWED){t.higherNumberErrorCurrent.Expire=true;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{if(t.selectedRule.expiration.days<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS[s.LIFECYCLE.EXPIRE]){t.minimumDaysCurrent.Expire=true;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{r(t.selectedRule.currentRuleActions,t.selectedRule.expiration.days,t.greaterThanCurrentError,t.highlightTextBoxErrorCurrent,t.minimumDaysCurrent,s.LIFECYCLE.CURRENT)}}}t.updateNextButtonDisabled()};t.validateNoncurrentExpiration=function(){t.notANumberErrorNoncurrent.PermanentlyDelete=false;t.minimumDaysNoncurrent.PermanentlyDelete=false;t.greaterThanNonCurrentError.DeleteGreaterThanSIA=false;t.greaterThanNonCurrentError.DeleteGreaterThanGlacier=false;t.higherNumberErrorNoncurrent.PermanentlyDelete=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false;if(isNaN(t.selectedRule.permanentlyDelete.days)||t.selectedRule.permanentlyDelete.days%1!==0||t.selectedRule.permanentlyDelete.days.indexOf(s.LIFECYCLE.EXPONENTIAL)!==-1){t.notANumberErrorNoncurrent.PermanentlyDelete=true;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{if(t.selectedRule.permanentlyDelete.days>s.LIFECYCLE.MAX_DAYS_ALLOWED){t.higherNumberErrorNoncurrent.PermanentlyDelete=true;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{if(t.selectedRule.permanentlyDelete.days<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS[s.LIFECYCLE.PERMANENTLY_DELETE]){t.minimumDaysNoncurrent.PermanentlyDelete=true;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=true}else{r(t.selectedRule.noncurrentRuleActions,t.selectedRule.permanentlyDelete.days,t.greaterThanNonCurrentError,t.highlightTextBoxErrorNonCurrent,t.minimumDaysNoncurrent,s.LIFECYCLE.NONCURRENT)}}}t.updateNextButtonDisabled()};function w(D){if(D===s.LIFECYCLE.CURRENT){return t.minimumDaysCurrent.SIA||t.minimumDaysCurrent.Glacier||t.minimumDaysCurrent.Expire||t.higherNumberErrorCurrent.Expire||t.greaterThanCurrentError.GlacierGreaterThanSIA||t.greaterThanCurrentError.DeleteGreaterThanSIA||t.greaterThanCurrentError.DeleteGreaterThanGlacier||_.indexOf(t.highlightTextBoxErrorCurrent,true)!==-1}else{return t.minimumDaysNoncurrent.SIA||t.minimumDaysNoncurrent.Glacier||t.minimumDaysNoncurrent.PermanentlyDelete||t.higherNumberErrorNoncurrent.PermanentlyDelete||t.greaterThanNonCurrentError.GlacierGreaterThanSIA||t.greaterThanNonCurrentError.DeleteGreaterThanSIA||t.greaterThanNonCurrentError.DeleteGreaterThanGlacier||_.indexOf(t.highlightTextBoxErrorNonCurrent,true)!==-1}}function h(){return _.some(t.selectedRule.currentRuleActions,function(D){return D.action===""||D.value===""})}function d(){return _.some(t.selectedRule.noncurrentRuleActions,function(D){return D.action===""||D.value===""})}function x(){return t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.SIA]||t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]||t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.SIA]||t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.GLACIER]}function j(){return t.selectedRule.expiration.enabled&&t.selectedRule.expiration.days===""||t.selectedRule.permanentlyDelete.enabled&&t.selectedRule.permanentlyDelete.days===""||t.selectedRule.amu.enabled&&t.selectedRule.amu.days===""||t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]||t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]||t.amuError}function C(){if(t.state.name===t.STEP.TRANSITION.name){t.selectedRule.isNextButtonDisabled=h()||d()||x()}else{if(t.state.name===t.STEP.EXPIRATION.name){t.selectedRule.isNextButtonDisabled=j()||_.isEmpty(t.selectedRule.currentRuleActions)&&_.isEmpty(t.selectedRule.noncurrentRuleActions)&&!t.selectedRule.expiration.enabled&&!t.selectedRule.amu.enabled&&!t.selectedRule.permanentlyDelete.enabled&&!t.selectedRule.removeExpire}}}t.updateNextButtonDisabled=function(){t.selectedRule.isNextButtonDisabled=false;z(C,1)};function q(F,E){for(var D=0;D<F.length;D++){if(t.validateDays(D,E)){break}}}t.validateAmuDays=function(){if(isNaN(t.selectedRule.amu.days)){t.amuError=true;t.notANumberAmuError=true}else{if(t.selectedRule.amu.days<s.LIFECYCLE.LIFECYCLE_RULE_ACTION_MIN_DAYS.AMU){t.amuError=true;t.minimumDaysAmuError=true}else{if(t.selectedRule.amu.days>s.LIFECYCLE.MAX_DAYS_ALLOWED){t.amuError=true;t.higherNumberErrorAmu=true}else{t.notANumberAmuError=false;t.minimumDaysAmuError=false;t.higherNumberErrorAmu=false;t.amuError=false}}}t.updateNextButtonDisabled()};t.selectCurrentExpiration=function(){if(t.selectedRule.expiration.enabled){t.selectedRule.removeExpire=false;t.selectedRule.showRldm=false;if(t.selectedRule.expiration.days===""){y(t.selectedRule.expiration,t.selectedRule.currentRuleActions)}}else{t.selectedRule.expiration.days="";t.selectedRule.showRldm=true;t.notANumberErrorCurrent[s.LIFECYCLE.EXPIRE]=false;t.minimumDaysCurrent[s.LIFECYCLE.EXPIRE]=false;t.higherNumberErrorCurrent.Expire=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanCurrentError[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;t.highlightTextBoxErrorCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false}t.updateNextButtonDisabled()};t.selectNoncurrentExpiration=function(){if(!t.selectedRule.permanentlyDelete.enabled){t.selectedRule.permanentlyDelete.days="";t.notANumberErrorNoncurrent[s.LIFECYCLE.PERMANENTLY_DELETE]=false;t.minimumDaysNoncurrent[s.LIFECYCLE.PERMANENTLY_DELETE]=false;t.higherNumberErrorNoncurrent.PermanentlyDelete=false;t.greaterThanNonCurrentError[s.LIFECYCLE.DELETE_RULE_ACTION_GREATER_THAN_SIA]=false;t.greaterThanNonCurrentError[s.LIFECYCLE.DELETE_RULE_ACTION_GREATER_THAN_GLACIER]=false;t.highlightTextBoxErrorNonCurrent[s.LIFECYCLE.RULE_ACTION_ERRORS.DELETE_RULE_ACTION]=false}else{if(t.selectedRule.permanentlyDelete.days===""){y(t.selectedRule.permanentlyDelete,t.selectedRule.noncurrentRuleActions)}}t.updateNextButtonDisabled()};t.selectAmuAction=function(){if(!t.selectedRule.amu.enabled){t.selectedRule.amu.days="";t.notANumberAmuError=false;t.minimumDaysAmuError=false;t.higherNumberErrorAmu=false}else{if(_.isEmpty(t.selectedRule.amu.days)){t.selectedRule.amu.days=s.LIFECYCLE.AMU_DEFAULT_DAYS}}t.updateNextButtonDisabled()};function i(){t.showOldUI=!p.isFeatureEnabled("s3-ot")}k();i();t.goToPreviousStep=function(){t.lifecycleError=undefined;t.previousState();t.updateNextButtonDisabled()};t.closeLifecycleModal=function(){k();t.isOpen.flag=false;t.state=t.STEP.NAME_AND_SCOPE;t.selectedRule=undefined;t.lifecycleError=undefined;t.showContinue=false;t.showOverlappingPrefixWarning=false;t.showOverlappingNewFormatWarning=false;t.showV2FormatWarning=false;t.overlappingRule="";t.stateChangeWarning=undefined;t.currentGlacierGreaterThanSIAValue="";t.expireGreaterThanSIAValue="";t.expireGreaterThanGlacierValue="";t.noncurrentGlacierGreaterThanSIAValue="";t.permanentlyDeleteGreaterThanSIAValue="";t.permanentlyDeleteGreaterThanGlacierValue="";t.clearLDMAMUWarning=false}}})();"use strict";(function(){angular.module("s3").directive("lifecycleConfirmationModal",function(){return{restrict:"E",scope:{isOpen:"=",warningMessage:"=",initialResponse:"=",initialize:"=",initialXml:"=",selectedRule:"=",selectedRuleIndex:"=",actionType:"=",headerTitle:"=",listRules:"=",ruleToBeEdited:"=",disableEdit:"=",disableDelete:"=",moreOptions:"=",operation:"="},templateUrl:"/s3/partials/lifecycleconfirmationmodal.html",controller:"LifecycleConfirmationModalController"}});angular.module("s3").controller("LifecycleConfirmationModalController",["$scope","$filter","$translate","BucketPropertiesService","PathService","ConsoleOperation","S3Constants","SCLogService",function(k,h,b,d,i,g,e,j){k.closeConfirmationModal=function(){k.isOpen.flag=false;k.showContinue=false;k.stateChangeWarning=undefined;k.selectedRuleIndex=undefined;k.selectedRule=undefined;k.lifecycleError=undefined};function m(){k.lifecycleError=undefined;k.showContinue=false;k.stateChangeWarning=undefined;k.saveLifecycle()}function c(){k.showContinue=true;k.stateChangeWarning=b.instant("lifecyclemodal.step3.statechange")}k.detectStateChange=function(){k.operation.step=e.LIFECYCLE.GET_BUCKET_LIFECYCLE;d.getBucketLifecycle(i.getCurrentBucket(),k.operation).then(function(n){if(n===k.initialXml){m()}else{c()}})["catch"](function(n){if(n===e.LIFECYCLE.LIFECYCLE_DOES_NOT_EXIST_MESSAGE){if(k.initialXml===""){m()}else{c()}}else{k.lifecycleError=n}})};function a(){k.lifecycleError=undefined;k.ruleToBeEdited=undefined;k.disableEdit=true;k.disableDelete=true;k.moreOptions[0].disabled=true;k.moreOptions[1].disabled=true;k.initialize();k.closeConfirmationModal()}function l(n){for(var o=0;o<k.initialResponse.length;o++){if(o!==k.selectedRuleIndex&&!_.isEqual(k.initialResponse[o],n[o])){j.log(e.METRIC_NAME.LIFECYCLE_RULE_MISMATCH,1,k.operation,{initialRule:k.initialResponse[o],finalRule:n[o]});return true}}return false}function f(o){var n=k.initialResponse.length;for(var p=0,q=0;p<n;p++,q++){if(p===k.selectedRuleIndex){q++}if(q<n&&!_.isEqual(k.initialResponse[q],o[p])){j.log(e.METRIC_NAME.LIFECYCLE_RULE_MISMATCH,1,k.operation,{initialRule:k.initialResponse[q],finalRule:o[p]});return true}}return false}k.saveLifecycle=function(){var q=angular.copy(k.initialResponse);var v=angular.copy(k.selectedRule);var t=false;if(k.actionType===e.LIFECYCLE.CONFIRMATION_MODAL.ENABLE_POLICY){k.operation.step=e.LIFECYCLE.ENABLE_LIFECYCLE_POLICY;v.Status=e.LIFECYCLE.ENABLED;q[k.selectedRuleIndex]=v;t=l(q)}else{if(k.actionType===e.LIFECYCLE.CONFIRMATION_MODAL.DISABLE_POLICY){k.operation.step=e.LIFECYCLE.DISABLE_LIFECYCLE_POLICY;v.Status=e.LIFECYCLE.DISABLED;q[k.selectedRuleIndex]=v;t=l(q)}else{if(k.actionType===e.LIFECYCLE.CONFIRMATION_MODAL.DELETE_POLICY){k.operation.step=e.LIFECYCLE.DELETE_LIFECYCLE_POLICY;q.splice(k.selectedRuleIndex,1);t=f(q)}}}if(!t){j.log("LifecycleRuleVerification",1,k.operation,{initialResponse:k.initialResponse,finalResponse:q});var s=new X2JS({stripWhitespaces:false});var u="";var o=s.json2xml_str(k.initialResponse[k.selectedRule.indexVal]);var p=k.actionType===e.LIFECYCLE.CONFIRMATION_MODAL.DELETE_POLICY?"":s.json2xml_str(v);var r=k.initialXml;if(q.length>0){var n={};n.LifecycleConfiguration={};n.LifecycleConfiguration.Rule=q;delete q._xmlns;u=s.json2xml_str(n);d.putBucketLifecycle(i.getCurrentBucket(),r,u,o,p,k.operation).then(function(){a()})["catch"](function(w){k.lifecycleError=w})}else{d.deleteBucketLifecycle(i.getCurrentBucket(),r,u,o,p,k.operation).then(function(){k.listRules=[];k.initialResponse=[];k.ruleToBeEdited=undefined;k.lifecycleError=undefined;k.disableEdit=true;k.disableDelete=true;k.moreOptions[0].disabled=true;k.moreOptions[1].disabled=true;k.initialize();k.closeConfirmationModal()})["catch"](function(w){k.lifecycleError=w})}}else{j.log("LifecycleRuleVerification",0,k.operation,{initialResponse:k.initialResponse,finalResponse:q})}}}])})();"use strict";(function(){angular.module("s3").directive("scroll",["$timeout",function(c){var a=30;function b(e){if(Math.ceil($(window).scrollTop()+$(window).height())+a>=$(document).height()){$(e[0]).addClass("progressbarbottom")}else{$(e[0]).removeClass("progressbarbottom")}}return{restrict:"A",link:function d(g,f,e){g.$watch(function(){return e.totalOperation},function(i,h){if(i!==h){c(b(f),1)}},true);$(window).resize(function(){b(f)});$(window).scroll(function(){b(f)})}}}])})();"use strict";(function(){angular.module("s3").directive("bucketConfirmationModal",function(){return{restrict:"E",scope:{isOpen:"=",warningMessage:"=",headerTitle:"=",operation:"=",isDelete:"=?"},templateUrl:"/s3/partials/bucketconfirmationmodal.html",controller:"BucketConfirmationModalController"}});angular.module("s3").controller("BucketConfirmationModalController",["$scope","$filter","BucketPropertiesService","OperationDispatcherService","S3Constants",function(b,e,d,f,c){b.confirmationModal={bucketName:undefined};function a(){b.isDelete=false;b.showIncorrectBucketError=false;b.confirmationModal={bucketName:undefined};b.isOpen.flag=false}b.closeConfirmationModal=function(){a()};b.compareBucketNames=function(g){if(g&&g.keyCode===c.KEY_CODES.ENTER){b.showIncorrectBucketError=_.trim(b.confirmationModal.bucketName)!==b.operation.initialBucket?true:false}};b.saveOperation=function(){d.getBucketVersioning(b.operation.initialBucket,b.operation).then(function(g){b.operation.additionalInfo={numberOfKeysPerBulkOperation:c.BULK_OPERATION_KEYS_PER_REQUEST.S3_API,versioning:g};if(_.trim(b.confirmationModal.bucketName)===b.operation.initialBucket){f.addOperation(b.operation);a()}else{b.showIncorrectBucketError=true}})["catch"](function(g){b.errorMessage=g})}}])})();"use strict";(function(){angular.module("s3").directive("emptyState",[function(){return{restrict:"E",scope:{type:"=",openModal:"=",oneIntroImage:"=?"},templateUrl:"/s3/partials/emptystate.html",controller:"EmptyStateController"}}]);angular.module("s3").controller("EmptyStateController",["$scope","AwsUrlsService","S3Constants",function(a,c,b){a.getLearnMoreLink=function(d){return c.getDocUrl(b.LEARN_MORE_LINKS[a.type][d])}}])})();"use strict";(function(){angular.module("s3").directive("updateObject",function(){return{restrict:"E",scope:{showOperation:"=",fetchObjects:"=",currentMarker:"@?",defaultValue:"@?",operation:"=",defaultPlaceholder:"@?",resetSelection:"="},templateUrl:"/s3/partials/updateobject.html",controller:"UpdateObjectController"}});angular.module("s3").controller("UpdateObjectController",["$filter","$scope","$translate","S3Constants","ConsoleOperation","APIProxyService","SCLogService","CopyService",function(k,m,b,h,j,d,l,c){m.updateObject={errorMessage:undefined,name:m.defaultValue||""};m.previousName=m.defaultValue;var g=m.operation.name;m.triggerAction=function(n){n.stopPropagation();switch(g){case"CreateFolder":i();break;case"Rename":f();break}};m.resetOperationState=function(n,o){m.fetchObjects(false,false);if(n){n.stopPropagation()}m.showOperation=false;switch(g){case"CreateFolder":a();break;case"Rename":e();m.resetSelection();break}m.operation=null};m.triggerKeyboardEvt=function(n){if(n&&n.keyCode===h.KEY_CODES.ENTER){m.triggerAction(n)}};function i(){var n=m.operation;var r="createFolder";var q=n.initialBucket;var o=n.initialPath;var p=_.get(m.updateObject,"name");if(p.indexOf(h.DELIMITER)!==-1){m.updateObject.errorMessage=b.instant("createfolder.input.errormessage.includesSlash")}else{if(p===""){a()}else{l.log("checkFolderExists",1,n);d.getObjectMetadata(n,q,""+o+p+"/").then(function(){m.updateObject.errorMessage=b.instant("createfolder.input.errormessage.exists",{name:p})})["catch"](function(s){if(s.status===h.HTTP_STATUS_CODES.NOT_FOUND){var t={};t[h.HEADERS.X_AMZ_SERVER_SIDE_ENCRYPTION]=h.OBJECT_SSE.AES256;t[h.HEADERS.CONTENT_TYPE]=h.DIRECTORY_CONTENT_TYPE;d.putObject(m.operation,q,o,p,t).then(function(){l.log(r,1,n,{name:p});m.resetOperationState()},function(u){l.log(r,0,n,u);m.updateObject.errorMessage=b.instant("createfolder.input.errormessage.generic",{name:p})})}else{l.log(r,0,n,s);m.updateObject.errorMessage=b.instant("createfolder.input.errormessage.generic",{name:p})}})}}}function a(){m.updateObject.name=m.defaultValue||"";m.updateObject.errorMessage=""}function f(){var n="renameObject";var o=m.operation,q=false,p=m.updateObject.name;if(p!==""){if(!o.selectedFolders||o.selectedFolders&&o.selectedFolders.length===0){if(p.indexOf(h.DELIMITER)!==-1){m.updateObject.errorMessage=b.instant("renameobject.input.errormessage.includesSlash")}else{c.startClipboardOperation(true,{name:p});o.defer.promise.then(function(){l.log(n,1,o,{name:p,isFolder:q});m.resetOperationState()},function(){l.log(n,0,o,{name:p,isFolder:q});m.updateObject.errorMessage=b.instant("renameobject.input.errormessage.generic",{name:p})})}}}}function e(){m.updateObject.errorMessage=""}}])})();"use strict";(function(){angular.module("s3").directive("storageManagement",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/storagemanagement.html",controller:"StorageManagementController"}}]);angular.module("s3").controller("StorageManagementController",["$scope","S3Constants","UtilService",function(b,c,a){b.S3Constants=c;b.viewId=c.MANAGEMENT.VIEWS.LIFECYCLE;b.showView=function(d){b.viewId=d};b.viewEnabled=function(d){return b.viewId===d};b.displayCRRV2=a.CRRFACHandle().v2}])})();"use strict";(function(){angular.module("s3").controller("StorageMetricsController",["$anchorScroll","$routeParams","$scope","$translate","AwsUrlsService","Region","S3Constants","StorageMonitoringService","UtilService",function(l,j,p,q,a,d,o,c,v){p.deepLinks=[];var b=60;var n=60*b;var k={MINUTE:b,QUARTER_HOUR:15*b,HALF_HOUR:30*b,HOUR:60*b,QUARTER_DAY:6*n,HALF_DAY:12*n,DAY:24*n};var u=n*1000;var h={H1:u,H3:3*u,H12:12*u,H24:24*u,D3:3*24*u,W1:7*24*u,W2:7*2*24*u};var r={H1:q.instant("management.metrics.period.minute.one"),H3:q.instant("management.metrics.period.hour.quarter"),H12:q.instant("management.metrics.period.hour.half"),H24:q.instant("management.metrics.period.hour.one"),D3:q.instant("management.metrics.period.day.quarter"),W1:q.instant("management.metrics.period.day.half"),W2:q.instant("management.metrics.period.day.one"),Count:q.instant("management.metrics.unit.count"),Bytes:q.instant("management.metrics.unit.bytes"),Milliseconds:q.instant("management.metrics.unit.milliseconds")};var t={H1:k.MINUTE,H3:k.QUARTER_HOUR,H12:k.HALF_HOUR,H24:k.HOUR,D3:k.QUARTER_DAY,W1:k.HALF_DAY,W2:k.DAY};var m={H1:"1H",H3:"3H",H12:"12H",H24:"1D",D3:"3D",W1:"7D",W2:"14D"};p.statistic=p.statistic?p.statistic:"Average";p.timestamp=p.timestamp?p.timestamp:"Timestamp";function f(w){var x="";angular.forEach(w,function(A){var y=A.Name;var z=A.Value;x+="~'"+y+"~'"+z});return x}function e(w){var x="";angular.forEach(w,function(z,y){x+=z.Name;if(y!==w.length-1){x+=","}});return x}function s(w,B,y){var A=g();var x="#"+A+":graph=~(view~'timeSeries~stacked~false~start~'-P<start>~end~'P0D~region~'<region>~metrics~(~(~'AWS*2fS3~'<metric-name>";var z=a.getConsoleServiceUrl("cloudwatch",w.region,"")+x;var D="~(period~<period>~stat~'<statistic>))));namespace=<namespace>;dimensions=";D+=e(w.Dimensions);var E=z+f(w.Dimensions)+D;var C=E.replace(new RegExp("<region>","g"),w.region);C=C.replace("<metric-name>",w.MetricName).replace("<namespace>",w.Namespace).replace("<period>",B).replace("<start>",m[y]).replace("<statistic>",w.statistic);return C}function g(){var w=v.getCloudSystem();var x=w===d.DOMAINS.ISO.NAME||w===d.DOMAINS.GOV.NAME?"metrics":"metricsV2";return x}p.getAllMetricData=function(w){var x=h[w];var y=t[w];p.deepLinks=[];angular.forEach(p.metricList,function(z){p.deepLinks.push(s(z,y,w));c.requestMetricStatistics(z,x,z.statistic,y).then(function(A){z.error="";z.chartId=z.MetricName;z.heading=z.MetricName;z.chartId="s3_"+z.chartId;if(z.statistics&&z.statistics.Datapoints&&z.statistics.Datapoints.length>0){z.heading+=" ("+i(z,w)+")"}angular.forEach(z.Dimensions,function(B){z.chartId+="_"+B.Value.replaceAll(".","_")})})["catch"](function(A){z.error=q.instant("management.metrics.data.error",{name:z.MetricName,message:v.handleErrors(A)})})})};function i(y,z){var w=y.statistics.Datapoints[0];var x="";switch(w.Unit){case o.METRICS.UNIT.COUNT:case o.METRICS.UNIT.BYTES:x+=r[w.Unit]+" / "+r[z];break;case o.METRICS.UNIT.MILLIS:x+=r[o.METRICS.UNIT.MILLIS];break;default:x+=w.Unit.toLowerCase()}return x}p.getChartLabels=function(w){var x=[];angular.forEach(w.Dimensions,function(y){if(y.Name!=="BucketName"){x.push(y.Value)}});return x};p.$watch("zoom",function(x,w){if(x!==w){p.getAllMetricData(x)}});p.$watch("metricList",function(x,w){if(x!==w){p.getAllMetricData(p.zoom)}});p.getAllMetricData(p.zoom)}]);angular.module("s3").directive("metricsMonitoring",[function(){return{scope:{metricList:"=",zoom:"=",statistic:"=?",timestamp:"=?"},templateUrl:"/s3/partials/storagemetrics.html",controller:"StorageMetricsController"}}])})();"use strict";(function(){angular.module("s3").service("StorageMonitoringService",["$q","$routeParams","CloudWatchService","BucketPropertiesService","S3Constants","SCLogService",function(a,f,e,d,b,c){this.requestMetricsList=function(i){var j=f[b.PATH_SEGMENTS.BUCKET_NAME];var h=[];return d.getBucketLocation(j).then(function(k){angular.forEach(i,function(n,m){var o={Namespace:"AWS/S3","Dimensions.member.1.Name":"BucketName","Dimensions.member.1.Value":j,"Dimensions.member.2.Name":n.Name};if(n.Value){o["Dimensions.member.2.Value"]=n.Value}var l=e.listMetrics({region:k,params:o});l.then(function(p){var q=p.response.ListMetricsResponse.ListMetricsResult.Metrics;angular.forEach(q,function(r){r.region=k});c.log("ListMetrics",1);return q})["catch"](function(p){c.log("ListMetrics",0,{err:p});return a.reject(p)});h.push(l)});return a.all(h).then(function(l){var m=[];angular.forEach(l,function(n){var o=n.response.ListMetricsResponse.ListMetricsResult.Metrics;m=m.concat(o)});return m})["catch"](function(l){return a.reject(l)})})};this.requestMetricStatistics=function(k,h,j,o){var i=new Date();var l=new Date(i-h);var n={MetricName:k.MetricName,Namespace:k.Namespace,StartTime:l.toISOString(),EndTime:i.toISOString(),Period:o,"Statistics.member.1":j};var m=g(k.Dimensions);n=_.extend(n,m);return e.getMetricStatistics({region:k.region,params:n}).then(function(p){k.statistics=p.response.GetMetricStatisticsResponse.GetMetricStatisticsResult;k.period=o;k.endTime=i.getTime();k.startTime=l.getTime();c.log("GetMetricStatistics",1);return k})["catch"](function(p){c.log("GetMetricStatistics",0,p);return a.reject(p)})};function g(h){var i={};h.forEach(function(k,j){i["Dimensions.member."+(j+1)+".Name"]=k.Name;i["Dimensions.member."+(j+1)+".Value"]=k.Value});return i}}])})();"use strict";(function(){angular.module("s3").directive("cloudwatchMetrics",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/cloudwatch.html",controller:"CloudwatchMetricsController"}}]);angular.module("s3").controller("CloudwatchMetricsController",["$anchorScroll","$route","$routeParams","$scope","$translate","APIProxyService","AwsUrlsService","ConsoleOperation","PathService","S3Constants","SCLogService","StorageMonitoringService","UtilService","XMLParser",function(m,s,k,v,x,y,b,t,e,u,d,g,D,E){var j="Prefix",f="Tag";var z=u.MANAGEMENT.ACTION;var B="EntireBucket";var A=new t(u.OPERATION_NAME.METRICS_GET_CONFIG);v.bucketName=k[u.PATH_SEGMENTS.BUCKET_NAME];v.metricsLoading=true;v.metrics={};v.timestamp="Timestamp";v.xScaleBy=1000;v.selectedTimeFrame="W2";v.selectedMetricGroup="";v.selectedMetricType=u.METRICS.TYPE.STORAGE;v.selectedMetricLink="";v.S3Constants=u;v.error="";m.yOffset=100;v.bucketRegion=e.getCurrentBucket();v.validFilter=false;v.filterList=[];v.bucketFilterList=[];v.models={filterName:null,filterValue:null,filterError:null,savingFilter:false,applyingConfig:false,showAddFilter:false,editFilter:false,configLoading:true,toggleMetricsConfig:false,searchText:"",bucketChecked:true,allFilters:false,updatedOn:null,addInfoMessage:false,deleteFilter:false};v.filters={input:"",prefixFilters:[],tagFilters:[]};v.metricTypes={storage:{id:u.METRICS.TYPE.STORAGE,group:x.instant("management.metric.type.storage"),title:x.instant("management.metric.type.title.storage"),disable:true,checked:true,state:true,info:x.instant("management.metrics.cost.free"),dimension:"StorageType",metrics:[{name:"BucketSizeBytes",display:x.instant("management.metric.type.display.storage.size"),selected:true,statistic:"Average"},{name:"NumberOfObjects",display:x.instant("management.metric.type.display.storage.count"),selected:true,statistic:"Average"}]},requests:{id:u.METRICS.TYPE.REQUESTS,group:x.instant("management.metric.type.requests"),title:x.instant("management.metric.type.title.requests"),disable:false,checked:false,state:false,info:x.instant("management.metrics.cost.paid"),dimension:"FilterId",metrics:[{name:"GetRequests",display:"GET",selected:true,statistic:"Sum"},{name:"PutRequests",display:"PUT",selected:true,statistic:"Sum"},{name:"ListRequests",display:"LIST",selected:true,statistic:"Sum"},{name:"AllRequests",display:"ALL",selected:true,statistic:"Sum"},{name:"PostRequests",display:"POST",selected:true,statistic:"Sum"},{name:"DeleteRequests",display:"DELETE",selected:true,statistic:"Sum"},{name:"HeadRequests",display:"HEAD",selected:true,statistic:"Sum"},{name:"4xxErrors",display:x.instant("management.metric.type.display.requests.errors4xx"),selected:true,statistic:"Sum"},{name:"5xxErrors",display:x.instant("management.metric.type.display.requests.errors5xx"),selected:true,statistic:"Sum"}]},data:{id:u.METRICS.TYPE.DATA,group:x.instant("management.metric.type.data"),title:x.instant("management.metric.type.title.data"),disable:false,checked:false,state:false,info:x.instant("management.metrics.cost.paid"),dimension:"FilterId",metrics:[{name:"TotalRequestLatency",display:x.instant("management.metric.type.display.data.total"),selected:true,statistic:"Average"},{name:"FirstByteLatency",display:x.instant("management.metric.type.display.data.first"),selected:true,statistic:"Average"},{name:"BytesDownloaded",display:x.instant("management.metric.type.display.data.uploaded"),selected:true,statistic:"Sum"},{name:"BytesUploaded",display:x.instant("management.metric.type.display.data.downloaded"),selected:true,statistic:"Sum"}]}};v.checkAllPaidMetrics=function(H){angular.forEach(v.metricTypes,function(I){if(H.id!==u.METRICS.TYPE.STORAGE&&I.id!==u.METRICS.TYPE.STORAGE&&H.id!==I.id){I.checked=H.checked}})};v.viewAllFilters=function(){angular.forEach(v.filterList,function(H){H.checked=v.models.allFilters});v.getCloudwatchMetrics()};v.filterKeyDown=function(H){if(H&&H.keyCode===u.KEY_CODES.ESC){$(".input-field").blur();v.models.searchText=""}};function l(){var H={prefixes:[],tags:[]};angular.forEach(v.filters.prefixFilters,function(I){H.prefixes.push({Prefix:I})});angular.forEach(v.filters.tagFilters,function(I){H.tags.push({Tag:{Key:I.tagKey,Value:I.tagVal}})});return H}v.getGroupTitle=function(H){return v.metricTypes[H].group};v.getLearnMoreLink=function(H){return b.getDocUrl(u.LEARN_MORE_LINKS["storage-management"][H])};function C(I){var H=I.Filter;if(H){if(!H.And){if(H.Prefix){v.filters.prefixFilters.push(H.Prefix)}else{if(H.Tag){v.filters.tagFilters.push({tagKey:H.Tag.Key,tagVal:H.Tag.Value})}}}else{angular.forEach(H.And,function(K,J){if(J===j){v.filters.prefixFilters.push(K)}if(J===f){K=[].concat(K);angular.forEach(K,function(L){v.filters.tagFilters.push({tagKey:L.Key,tagVal:L.Value})})}})}}}v.configureMetrics=function(){if(v.models.toggleMetricsConfig){v.cancelMetricsConfig()}else{v.models.toggleMetricsConfig=!v.models.toggleMetricsConfig}};v.addFilter=function(H){if(!v.models.showAddFilter){v.models.filterNameError="";v.models.filterValueError="";if(H){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.EDIT_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);v.models.filterName=H.Id;v.models.editFilter=true;C(H)}else{D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.ADD_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);v.models.filterName="";v.models.filterValue=""}v.models.showAddFilter=true}};v.validateFilter=function(J){var I=true;if(!J){J=l()}v.models.filterNameError="";v.models.filterValueError="";if(!v.models.filterName){return false}else{v.models.filterName=v.models.filterName.trim()}if(!u.MANAGEMENT.FILTER_NAME_REGEX.test(v.models.filterName)){v.models.filterNameError=x.instant("management.config.filtername.error.format");I=false}if(v.filters.input){v.models.filterValueError=x.instant("management.config.filtervalue.error.format",{text:v.filters.input});I=false}if(!v.models.editFilter){var H=_.filter(v.filterList,function(K){return K.Id===v.models.filterName});if(H.length>0){v.models.filterNameError=x.instant("management.metrics.side.filter.error.dup");I=false}}return I};v.cancelFilter=function(){if(!v.models.editFilter){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.CANCEL_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT)}v.models.showAddFilter=false;v.models.editFilter=false;v.models.filterError=false;h()};v.refresh=function(){v.getCloudwatchMetrics()};v.goToChart=function(H){v.selectedMetricLink=H;m(H)};v.setMetricGroup=function(H){v.selectedMetricGroup=H};v.setTimeRange=function(H){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.METRICS.PERIOD[H],u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);v.selectedTimeFrame=H};v.setSelectedMetricType=function(H){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.METRICS.TYPE[H],u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);v.selectedMetricType=H;v.getCloudwatchMetrics()};v.filterChanged=function(H,I){if(I){I.stopPropagation()}H.checked=!H.checked;if(!H.checked){v.models.allFilters=false}v.getCloudwatchMetrics()};function G(){var H=v.metricTypes[v.selectedMetricType].dimension;var I=[];if(v.selectedMetricType===u.METRICS.TYPE.STORAGE){I.push({Name:H,Value:null})}else{if(v.models.bucketChecked){angular.forEach(v.bucketFilterList,function(J){I.push({Name:H,Value:J.Id})})}angular.forEach(v.filterList,function(J){if(J.checked){I.push({Name:H,Value:J.Id})}})}return I}v.getCloudwatchMetrics=function(){var H=G();v.info="";v.error="";if(H.length>0){g.requestMetricsList(H).then(function(I){v.metrics[v.selectedMetricType]=c(I);if(I.length===0){v.info=x.instant("management.metrics.notavailable",{type:v.metricTypes[v.selectedMetricType].group})}else{v.info="";v.error=""}})["catch"](function(I){v.error=x.instant("management.metrics.error",{message:D.handleErrors(I)})})["finally"](function(){v.metricsLoading=false;v.models.updatedOn=x.instant("management.metrics.updatedon",{time:new Date().toLocaleString()})})}else{if(v.models.bucketChecked&&!v.metricTypes.requests.state){v.info=x.instant("management.metrics.not.enabled")}else{v.info=x.instant("management.metrics.not.selected")}v.metrics[v.selectedMetricType]=c([]);v.metricsLoading=false;v.models.updatedOn=x.instant("management.metrics.updatedon",{time:new Date().toLocaleString()})}};function c(I){var J=[];var K=v.metricTypes[v.selectedMetricType];var H=_.groupBy(I,function(L){return L.MetricName});v.metricsWithStats=[];angular.forEach(K.metrics,function(L){if(H[L.name]){J=J.concat(H[L.name]);v.metricsWithStats.push({display:L.display,ref:H[L.name][0]});angular.forEach(H[L.name],function(M){M.statistic=L.statistic})}});return J}function o(H){v.models[H]=true;h();v.bucketFilterList=[];v.filterList=[];F(H)}function F(H){var I=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var J={};if(I){angular.extend(J,{params:{"continuation-token":I}})}y.getBucketProperty(A,v.bucketName,"metrics",J,false).then(function(P){var K=P.response;d.log("getBucketMetrics",1,A);var O=E.convertXmlStringToJson(K);var L=O.ListMetricsConfigurationsResult;var N=L.MetricsConfiguration;var M=[];if(N){M=D.transformObjectToArray(N)}v.bucketFilterList=v.bucketFilterList.concat(_.filter(M,function(Q){return Q.Id===B}));v.filterList=v.filterList.concat(_.filter(M,function(Q){if(Q.Id!==B||Q.Id===B&&Q.Filter){Q.checked=v.models.allFilters;return true}return false}));if(L.IsTruncated==="true"){F(H,L.NextContinuationToken)}else{n();v.getCloudwatchMetrics();w(H)}})["catch"](function(K){d.log("getBucketMetrics",0,A);w(H);p(H,K)})}function n(){v.models.editFilter=false;v.metricTypes.requests.checked=v.bucketFilterList.length>0;v.metricTypes.requests.state=v.metricTypes.requests.checked;v.metricTypes.data.checked=v.metricTypes.requests.checked;v.metricTypes.data.state=v.metricTypes.data.checked}function h(){v.models.filterName="";v.filters.input="";v.filters.tagFilters=[];v.filters.prefixFilters=[]}function w(H){v.models[H]=false;if(H===z.SAVING_FILTER||H===z.DELETE_FILTER){v.models.showAddFilter=false;v.models.filterError=""}if(H===z.APPLYING_CONFIG){v.models.toggleMetricsConfig=false}v.filters.input="";v.filters.tagFilters=[];v.filters.prefixFilters=[]}v.deleteFilter=function(){if(!v.models.deleteFilter||!v.models.savingFilter){var H={params:{id:v.models.filterName}};i(H,z.DELETE_FILTER)}};v.applyMetricsConfig=function(){if(v.metricTypes.requests.checked){var J={params:{id:B}};var I={},H=undefined;I.MetricsConfiguration={};I.MetricsConfiguration.Id=B;H=E.jsonToXml(I);r(H,J,z.APPLYING_CONFIG)}else{angular.forEach(v.bucketFilterList,function(K){var L={params:{id:K.Id}};i(L,z.APPLYING_CONFIG)})}};v.cancelMetricsConfig=function(){v.metricTypes.requests.checked=v.metricTypes.requests.state;v.metricTypes.data.checked=v.metricTypes.requests.state;v.models.toggleMetricsConfig=false};v.saveFilter=function(){if(!v.models.savingFilter&&!v.models.deleteFilter){var H=l();v.models.filterError="";if(v.validateFilter(H)){(function(){var K={params:{id:v.models.filterName}};var J={},I=undefined;J.MetricsConfiguration={};J.MetricsConfiguration.Id=v.models.filterName;if(H.tags.length+H.prefixes.length){J.MetricsConfiguration.Filter={};if(H.tags.length>1||H.tags.length+H.prefixes.length>1){J.MetricsConfiguration.Filter.And={};if(H.tags.length>0){J.MetricsConfiguration.Filter.And.Tag=[];angular.forEach(H.tags,function(M){var L=M.Tag;return J.MetricsConfiguration.Filter.And.Tag.push(L)})}if(H.prefixes.length>0){J.MetricsConfiguration.Filter.And.Prefix=[];angular.forEach(H.prefixes,function(M){var L=M.Prefix;return J.MetricsConfiguration.Filter.And.Prefix.push(L)})}}else{if(H.prefixes.length>0){J.MetricsConfiguration.Filter=H.prefixes[0]}if(H.tags.length>0){J.MetricsConfiguration.Filter.Tag=H.tags[0].Tag}}}I=E.jsonToXml(J);r(I,K,z.SAVING_FILTER)})()}}};function r(K,J,H){var I=new t(u.OPERATION_NAME.METRICS_PUT_CONFIG);v.models[H]=true;K=q(K);if(H===z.SAVING_FILTER){v.filterError=""}D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.SAVE_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);y.putBucketProperty(I,v.bucketName,"metrics",K,J).then(function(M){var L=M.response;d.log("putBucketMetrics",1,I);o(H);v.models.addInfoMessage=true})["catch"](function(L){d.log("putBucketMetrics",0,I);p(H,L);v.models[H]=false})}function i(J,H){var I=new t(u.OPERATION_NAME.METRICS_DELETE_CONFIG);if(H===z.SAVING_FILTER||H===z.DELETE_FILTER){v.models.filterError=""}D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.DELETE_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT);v.models[H]=true;y.deleteBucketProperty(I,v.bucketName,"metrics",J).then(function(L){var K=L.response;d.log("deleteBucketMetrics",1,I);o(H)})["catch"](function(K){d.log("deleteBucketMetrics",0,I);p(H,K);v.models[H]=false})}function p(H,I){if(H===z.SAVING_FILTER){v.models.filterError=D.handleErrors(I)}else{v.error=D.handleErrors(I)}}function q(H){return H.replace("<MetricsConfiguration>",'<MetricsConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">')}v.cloudwatchLinkClicked=function(){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.METRICS.CLOUDWATCH_LINK,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT)};v.searchClicked=function(){D.analyticsTrackClick(u.ANALYTICS.MANAGEMENT.SEARCH_CONFIG,u.ANALYTICS.MANAGEMENT.METRICS.CONTEXT)};function a(){o(z.CONFIG_LOADING)}a()}])})();"use strict";(function(){angular.module("s3").directive("bucketReports",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/bucketreports.html",controller:"ReportsController"}}]);angular.module("s3").controller("ReportsController",["$filter","$q","$scope","$timeout","$translate","APIProxyService","AwsUrlsService","BucketPolicyService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","FAC","PathService","Region","S3Constants","SCLogService","UtilService","XMLParser",function(B,a,j,w,q,E,t,d,A,x,c,L,y,m,K,f,n,C){var I,G;var i=K.BUCKET_PROPERTIES;var F=K.ENTRY_STATE;var v=K.LEARN_MORE_LINKS;j.finishedLoading=false;j.selectingBucket={selected:false};j.exampleEmptyReport=h();j.flags={displayDelayWarning:false};j.policyStatus={policyMessage:"",policyHeader:"",policyType:"info",policyDefinition:""};var z="-";function e(){G=y.getCurrentBucket();I=new c("GetBuckets");j.showAdvancedSettingsDropdown=true;j.rowBeingEdited=null;j.headerTitle=q.instant("report.label.new");j.isAdding=false;j.isSaving=false;j.radioValue={value:0};j.selectedRowIndex=-1;j.selectedRow=null;j.showError=false;j.isEditingRow=false;j.regions=m.regionMapping;j.reportsTable=[];if(!j.bucketList){j.bucketList=[]}j.configPattern=new RegExp("^[a-zA-Z0-9-_.]+$");j.freqTypes=[{value:i.REPORTS.FREQUENCY.DAILY,text:q.instant("report.freq.daily")},{value:i.REPORTS.FREQUENCY.WEEKLY,text:q.instant("report.freq.weekly")}];j.versionTypes=[{value:i.REPORTS.VERSIONING.ALL,text:q.instant("report.versions.all")},{value:i.REPORTS.VERSIONING.CURRENT,text:q.instant("report.versions.current")}];l()}j.getLearnMoreLink=function(N){return t.getDocUrl(v["storage-management"][N])};j.toggleAdvancedSettingsDropdown=function(){j.showAdvancedSettingsDropdown=!j.showAdvancedSettingsDropdown};function h(){return{name:"",type:i.REPORTS.TYPE.OBJECT,filter:"",bucket:"",prefix:"",freq:i.REPORTS.FREQUENCY.DAILY,versioning:i.REPORTS.VERSIONING.CURRENT,status:i.REPLICATION.DISABLED,isEditing:true,state:F.CREATE,optional:M(),accountId:null,bucketError:false,nameError:false}}function u(P){var O=h();O.name=P.Id;O.freq=P.Schedule.Frequency.toUpperCase();O.bucket=x.stripBucketARN(P.Destination.S3BucketDestination.Bucket);if(P.Filter){O.filter=P.Filter.Prefix}if(P.Destination.S3BucketDestination.Prefix){O.prefix=P.Destination.S3BucketDestination.Prefix}if(P.Destination.S3BucketDestination.AccountId){O.accountId=P.Destination.S3BucketDestination.AccountId}O.isEditing=false;if(P.OptionalFields&&P.OptionalFields.Field){var N=[].concat(P.OptionalFields.Field);N.forEach(function(Q){O.optional[Q]=true})}if(P.IncludedObjectVersions===i.REPORTS.VERSIONING.CURRENT){O.versioning=P.IncludedObjectVersions}else{O.versioning=i.REPORTS.VERSIONING.ALL}return O}function J(P){var N=P.InventoryConfiguration;if(N){var O=[].concat(N);O.forEach(function(Q){j.reportsTable.push(u(Q))})}}function l(O){var N=new c("getObjectInventory");f.log("getObjectInventoryReceived",1,N);var P={path:G};if(O){P.params={"continuation-token":O}}E.getObjectInventory(N,G,P).then(function(S){var R=S.response;f.logRequestComplete("getObjectInventory",N);if(R){var U=C.convertXmlStringToJson(R);J(U.ListInventoryConfigurationsResult);var Q=U.ListInventoryConfigurationsResult.IsTruncated==="true";if(Q){var T=U.ListInventoryConfigurationsResult.NextContinuationToken;l(T)}else{if(j.reportsTable.length>0){j.radioValue.value=0;j.selectedRowIndex=0}j.finishedLoading=true}}})["catch"](function(Q){if(Q){r(Q)}})["finally"](function(){j.finishedLoading=true})}j.validatePrefix=function(){var N=j.rowBeingEdited;j.filterInfo="";j.prefixInfo="";if(N.filter&&N.filter.indexOf(K.DELIMITER)===0){j.filterInfo=N.filter;j.bucketName=G}if(N.prefix&&N.prefix.indexOf(K.DELIMITER)===0){j.prefixInfo=N.prefix;j.bucketNamePre=N.bucket}};j.validateName=function(O){var N=_.countBy(j.reportsTable,function(P){return P.name===O.name?"dups":"unique"});O.invalidNameMessage="";if(N.dups>1){O.invalidNameMessage=q.instant("report.name.error.duplicate")}else{if(O.name.length<1||O.name.length>64){O.invalidNameMessage=q.instant("report.name.error.length")}else{if(!j.configPattern.test(O.name)){O.invalidNameMessage=q.instant("report.name.error.characters")}}}if(O.invalidNameMessage){O.nameError=true}else{O.nameError=false}};j.validateForm=function(N){j.validateName(N);if(N.bucket){N.bucketError=false}else{N.bucketError=true}N.hasErrors=N.nameError||N.bucketError;return !N.hasErrors};j.selectRow=function(N){if(j.isEditingRow){j.radioValue.value=j.selectedRowIndex}else{if(j.completeEdit()){j.selectedRowIndex=N;j.radioValue.value=N}}j.flags.displayDelayWarning=false};j.closeAddReport=function(N){s();if(N){if(j.rowBeingEdited.state===F.CREATE){j.rowBeingEdited.state=F.ADDED}}j.isExpanded=false;j.rowBeingEdited=null};j.deletePressed=function(){if(j.radioValue.value.length===0){return}var O=j.reportsTable[j.selectedRowIndex];var N=_.findIndex(j.reportsTable,function(P){return P.name===O.name});if(N!==-1&&k(j.reportsTable[N])){j.reportsTable.splice(N,1);j.radioValue.value="";j.selectedRowIndex=-1}n.analyticsTrackClick(K.ANALYTICS.MANAGEMENT.DELETE_CONFIG,K.ANALYTICS.MANAGEMENT.INVENTORY.CONTEXT);j.flags.displayDelayWarning=false;j.resetPolicyStatus()};j.cancelPressed=function(N){N.stopPropagation();n.analyticsTrackClick(K.ANALYTICS.MANAGEMENT.CANCEL_CONFIG,K.ANALYTICS.MANAGEMENT.INVENTORY.CONTEXT);p(j.reportsTable[j.selectedRowIndex]);if(j.isAdding){j.selectedRowIndex--;j.isAdding=false;j.reportsTable.shift()}else{j.reportsTable[j.selectedRowIndex]=j.tempRow;j.tempRow=null}j.radioValue.value=j.selectedRowIndex;j.completeEdit(false);j.isEditingRow=false;j.rowBeingEdited.isEditing=false;j.showAdvancedSettingsDropdown=false;j.closeAddReport(false);j.radioValue.value=j.selectedRowIndex};j.successAddHandler=function(){if(j.isAdding){j.selectedRowIndex=0;j.radioValue.value=j.selectedRowIndex;j.isAdding=false}};j.successSaveHandler=function(){j.isEditingRow=false;j.showAdvancedSettingsDropdown=false};j.savePressed=function(N){N.stopPropagation();j.isSaving=true;n.analyticsTrackClick(K.ANALYTICS.MANAGEMENT.SAVE_CONFIG,K.ANALYTICS.MANAGEMENT.INVENTORY.CONTEXT);var P=null;if(j.isAdding){P=j.reportsTable[0]}else{P=j.reportsTable[j.selectedRowIndex]}j.validateForm(P);if(P.hasErrors||P.bucketUnknown){j.isSaving=false;return}var O=false;if(j.isAdding){O=true}j.saveReport(P,O);j.radioValue.value=j.selectedRowIndex};function k(N){var O=new c("deleteObjectInventoryConfig");E.deleteObjectInventoryConfig(O,G,{path:G,params:{id:N.name}}).then(function(P){f.logRequestComplete("deleteObjectInventoryConfig",O);j.isEditingRow=false;j.showAdvancedSettingsDropdown=false})["catch"](function(P){r(P);f.log("deleteObjectInventoryConfig",0,O,{objectName:N,error:P});return false});return true}function o(N){if(N.length===0){return}else{if(N.length===1){return N.charAt(0).toUpperCase()}else{return N.charAt(0).toUpperCase()+N.substr(1).toLowerCase()}}}function b(O){var N={};N.Format=i.REPORTS.FORMAT.CSV;if(O.accountId){N.AccountId=O.accountId}N.Bucket=n.getBucketARN(O.bucket);if(O.prefix.length>0){N.Prefix=O.prefix}return{S3BucketDestination:N}}function g(O){var N=O.optional;var P=[];if(N.Size){P.push("Size")}if(N.LastModifiedDate){P.push("LastModifiedDate")}if(N.StorageClass){P.push("StorageClass")}if(N.ETag){P.push("ETag")}if(N.ReplicationStatus){P.push("ReplicationStatus")}if(N.IsMultipartUploaded){P.push("IsMultipartUploaded")}return P}function D(O){var N={};N.Id=O.name;N.IsEnabled="true";if(O.filter.length>0){N.Filter={Prefix:O.filter}}N.Destination=b(O);N.Schedule={Frequency:o(O.freq)};N.IncludedObjectVersions=O.versioning;N.OptionalFields={Field:g(O)};return N}function H(N){return'<?xml version="1.0" encoding="UTF-8"?><InventoryConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">'+N+"</InventoryConfiguration>"}j.saveReport=function(N,Q){var O=new c("putObjectInventoryConfig");var R=D(N);var P=H(C.jsonToXml(R));f.log("putObjectInventoryConfigReceived",1,O);E.putObjectInventoryConfig(O,G,{path:G,params:{id:N.name},content:P}).then(function(S){f.logRequestComplete("putObjectInventoryConfig",O);j.isSaving=false;j.rowBeingEdited.isEditing=false;if(!Q&&N.name!==j.tempRow.name){k(j.tempRow)}else{j.successAddHandler();j.closeAddReport(true);j.successSaveHandler()}j.flags.displayDelayWarning=true;d.createBucketPolicy(G,N.bucket,j.policyStatus);return true})["catch"](function(S){f.log("putObjectInventoryConfig",0,O,{objectName:N,error:S});r(S);return false});return true};function r(N){j.showError=true;j.errorMessage=n.handleErrors(N);j.isSaving=false}function s(){j.showError=false}j.completeEdit=function(N){var O=j.rowBeingEdited;if(!O){return true}else{p(O);if(O.name!==""&&!O.invalidNameMessage&&O.bucket!==""){return true}else{if(O.state===F.CREATE&&O.name===""&&O.bucket===""&&O.filter===""&&O.prefix===""){return true}else{if(N&&O.state===F.CREATE){return false}if(O.name===""){O.nameError=true}if(O.bucket===""){O.bucketError=true}return false}}}};function p(N){if(N){N.nameError=false;N.bucketError=false}}function M(){return{Size:null,LastModifiedDate:null,StorageClass:null,ETag:null,ReplicationStatus:null,IsMultipartUploaded:null}}j.addRow=function(O){O.stopPropagation();if(j.completeEdit()){n.analyticsTrackClick(K.ANALYTICS.MANAGEMENT.ADD_CONFIG,K.ANALYTICS.MANAGEMENT.INVENTORY.CONTEXT);j.isAdding=true;j.isExpanded=true;var N=h();j.reportsTable.unshift(N);j.rowBeingEdited=N;j.selectedRowIndex++;j.radioValue.value=false;j.isEditingRow=true;j.showAdvancedSettingsDropdown=true;j.prefixInfo="";j.filterInfo="";j.resetPolicyStatus()}j.flags.displayDelayWarning=false};j.editRow=function(O){O.stopPropagation();j.showAdvancedSettingsDropdown=true;var N=j.selectedRowIndex;var P=j.reportsTable[N];n.analyticsTrackClick(K.ANALYTICS.MANAGEMENT.EDIT_CONFIG,K.ANALYTICS.MANAGEMENT.INVENTORY.CONTEXT);if(P){j.tempRow=JSON.parse(JSON.stringify(P))}if(j.completeEdit()){P.isEditing=true;j.rowBeingEdited=j.reportsTable[j.selectedRowIndex];j.isEditingRow=true}j.flags.displayDelayWarning=false;j.radioValue.value=false;j.resetPolicyStatus()};j.getPrefixValue=function(N){if(N.length===0){return z}else{return N}};j.getTranslationValue=function(N){switch(N){case i.REPORTS.TYPE.OBJECT:return q.instant("report.type.object");case i.REPORTS.FREQUENCY.DAILY:return q.instant("report.freq.daily");case i.REPORTS.FREQUENCY.WEEKLY:return q.instant("report.freq.weekly")}};j.getFilterValue=function(N){return N||q.instant("report.filter.bucket")};j.resetDelayWarning=function(){j.flags.displayDelayWarning=false};j.resetPolicyStatus=function(){j.policyStatus.policyMessage="";j.policyStatus.policyHeader="";j.policyDefinition="";j.policyType="info"};e()}])})();"use strict";(function(){angular.module("s3").service("AnalyticsDataProcessor",["$q","APIProxyService","BucketPropertiesService","ConsoleOperation","S3Constants","SCLogService","UtilService",a]);function a(y,u,j,r,s,b,z){var l=new r(s.OPERATION_NAME.ANALYTICS_GET_DATA);var n=0;var d=3;var v=4;var q=5;var o=6;var k=7;var i=8;var A=9;var e=10;var t=11;var c=12;var m=",";var g="ALL";var B={getSharedDataFilePath:x,retrieveData:h};return B;function x(E,I,F){var H=z.getUserAccountId();if(!H){return null}var G=s.S3_SHARED_DATA.OBJECT_TEMPLATE.replace("<account-id>",H).replace("<bucket-name>",E).replace("<config-id>",I);var D=s.S3_SHARED_DATA.BUCKET_TEMPLATE.replace("<region>",F);var C={data:G,bucket:D,full:D+"/"+G};return C}function h(C,D){return j.getBucketLocation(C).then(function(G){var F=x(C,D,G);if(!F){return y.reject(s.ANALYTICS.ERROR.USER_INFO_MISSING)}var H=F.data;var E=F.bucket;return u.getObject(l,E,H).then(function(I){b.log("getAnalyticsData",1,l);return f(I)})["catch"](function(I){b.log("getAnalyticsData",0,l);return y.reject(I)})})}function p(F){var D=1024*1024;var E={objectCount:isNaN(parseFloat(F[q]))?0:parseFloat(F[q]),dataUploaded:isNaN(parseFloat(F[o]))?0:parseFloat(F[o])*D,storage:isNaN(parseFloat(F[k]))?0:parseFloat(F[k])*D,dataRetrieved:isNaN(parseFloat(F[i]))?0:parseFloat(F[i])*D,getRequestCount:isNaN(parseFloat(F[A]))?0:parseFloat(F[A]),CRR:isNaN(parseFloat(F[e]))?0:parseFloat(F[e]),objectAge:F[v],storageClass:F[d]};if(F[v]===g){E.recommendedAgeTransition=F[c];if(E.recommendedAgeTransition&&E.recommendedAgeTransition!=="-1"){var C=parseInt(E.recommendedAgeTransition);if(C>=0&&C<=29){E.recommendation="30"}else{E.recommendation=C.toString()}}E.ageTransition=F[t];if(E.storage===0){E.percentage=0}else{E.percentage=E.dataRetrieved/E.storage*100}}E.timestamp=new Date(F[n]).getTime();return E}function w(E){var F={};var H={};var G={};var I=[];var D=0;angular.forEach(E,function(N,L){var P=N.split(m);if(N){var K=P[n].trim();var J=F[K];if(!(K in F)){F[K]=D;I.push({date:K,stats:[],timestamp:new Date(K).getTime()});J=D;D+=1}var O=p(P);var M=P[d].toUpperCase();if(!H[M]){H[M]=M}I[J].stats.push(O);if(P[v]===g){if(!G[M]){G[M]=[]}G[M].push({date:K,row:O,timestamp:O.timestamp,percentage:O.percentage})}}});I.sort(function(K,J){return K.timestamp-J.timestamp});angular.forEach(G,function(K,J){K.sort(function(M,L){return M.timestamp-L.timestamp})});var C={all:G,rows:I,classes:H};return C}function f(D){var C=D.split("\n");if(C.length===0||C.length===1&&_.isEmpty(C[0])){return null}C.shift();return w(C)}}})();"use strict";(function(){angular.module("s3").directive("barChartCard",[function(){return{restrict:"E",controller:"BarChartController",scope:{width:"=?",height:"=?",chartTitle:"=",data:"=",labels:"=?",colors:"=?",maxValue:"=?",footer:"=?"},link:function a(b){b.$watch("data",function(c){if(c){b.generateChart()}})},templateUrl:"/s3/partials/barchartcard.html"}}]);angular.module("s3").controller("BarChartController",["$scope","$window","$element","UtilService",function(g,a,h,d){var i=a.d3;g.width=g.width||270;g.height=g.height||205;var c=g.maxValue;var e=0.94;g.generateChart=function(){var p=10;var o,j=25,s=j*g.data.length;f();var l=[];for(var m=0;m<g.data.length;m++){var n=m%g.colors.bars.length;var k=g.colors.bars[n];l.push({id:m,color:k,value:g.data[m]})}if(i.select(h[0].children[0].children[1])){i.select(h[0].children[0].children[1]).select("svg").remove()}o=i.select(h[0].children[0].children[1]).append("svg").attr("class","chart").attr("width",g.width*e).attr("height",s);var r=i.scale.linear().domain([0,c]).range([0,g.width*e]);var q=i.scale.ordinal().domain(l.map(function(t){return t.id})).rangeBands([0,s]);o.selectAll("rect").data(l).enter().append("svg:rect").attr("y",function(t){return q(t.id)}).attr("width",function(t){return r(t.value)}).attr("height",j-p).attr("fill",function(t){return t.color});o.selectAll("text").data(l).enter().append("svg:text").attr("x",function(t){return r(t.value)}).attr("y",function(t){return q(t.id)+q.rangeBand()/2}).attr("dx",3).attr("text-anchor","start").text(function(t){return d.formatWithUnits(t.value)}).attr("fill",function(t){return t.color})};function b(){if(!c){c=i.max(g.data)}if(!g.units){g.units=""}if(!g.colors){if(!g.colors.bars){g.colors.bars=["blue"]}if(!g.colors.row){g.colors.row="green"}}if(!g.row){g.row={};if(!g.row.color){g.row.color="blue"}}c/=0.75}function f(){c=g.maxValue;c/=0.75}b()}])})();"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var c=0,b=Array(a.length);c<a.length;c++){b[c]=a[c]}return b}else{return Array.from(a)}}(function(){angular.module("s3").directive("objectFrequencyAnalytics",[function(){return{restrict:"E",scope:{data:"=",storageClass:"="},controller:"ObjectFrequencyAnalyticsController",templateUrl:"/s3/partials/objectfrequencyanalytics.html",link:function a(b){b.$watch("storageClass.value",function(d,c){if(d!==c){b.processData()}})}}}]);angular.module("s3").controller("ObjectFrequencyAnalyticsController",["$scope","$translate","APIProxyService","ConsoleOperation","AnalyticsDataProcessor","S3Constants","UtilService",function(q,r,s,l,f,p,x){var e=[["0-29","000-029","000-014","015-029"],["30-44","030-044"],["45-59","045-059"],["60-74","75-89","060-074","075-089"],["90-179","090-179","090-119","120-149","150-179"],["180-364","365+","365-729","730+"]];var g={};var k=p.ANALYTICS.STORAGE_CLASS.STANDARD;q.objectTypes=[];var u="#7394CB";var d="#9066A7";q.barColors=[u,d];q.frequentColor="green";q.infrequentColor="orange";q.emptyColor="gray";var b=r.instant("storageanalysis.footer.text.frequent");var t=r.instant("storageanalysis.footer.text.infrequent");var i=r.instant("storageanalysis.footer.text.move");var m=r.instant("storageanalysis.footer.text.empty");q.width=310;q.height=210;q.labels=[r.instant("storageanalysis.label.storage"),r.instant("storageanalysis.label.dataRetrieved")];function a(){if(q.data){c();q.titles=[];q.titles.push(r.instant("storageanalysis.title.30"));q.titles.push(r.instant("storageanalysis.title.45"));q.titles.push(r.instant("storageanalysis.title.60"));q.titles.push(r.instant("storageanalysis.title.90"));q.titles.push(r.instant("storageanalysis.title.180"));q.titles.push(r.instant("storageanalysis.title.180plus"));v()}}function v(){if(q.data&&q.data.rows){q.objectTypes=x.getStorageClassOptions(q.data.classes);q.daysAnalyzed=q.data.rows.length;q.processData()}}q.processData=function(){n();o()};function c(){angular.forEach(e,function(z,A){angular.forEach(z,function(B){g[B]=A})})}function y(z){var A=parseInt(z,10);if(isNaN(A)){throw"Passed in date range is not a number"}if(A===-1){return -1}else{if(A<30){return 0}else{if(A<45){return 1}else{if(A<60){return 2}else{if(A<90){return 3}else{if(A<180){return 4}else{return 5}}}}}}}function h(){var A=[];for(var z=0;z<e.length;z++){A.push(0)}return A}function w(B,z,A){angular.forEach(B.stats,function(D){var E=D.storageClass.toUpperCase()===q.storageClass.value;var F=D.objectAge in g;if(E&&F){var C=g[D.objectAge];z[C]+=D[A]}})}function j(A,z){angular.forEach(A,function(C,B){A[B]*=z})}function o(){var z,A;var B=q.data.rows;var D=h();var C=h();angular.forEach(B,function(E){w(E,D,"storage");w(E,C,"dataRetrieved")});j(D,1/B.length);j(C,1/B.length);q.storage=D;q.dataRetrieved=C;q.maxValue=Math.max((z=Math).max.apply(z,_toConsumableArray(q.storage)),(A=Math).max.apply(A,_toConsumableArray(q.dataRetrieved)))}function n(){var C=q.data.all[q.storageClass.value];q.frequencyTypes=[];if(C.length>0){var D=C[C.length-1].row;var A="";if(D.recommendedAgeTransition.length>0){A=y(D.recommendedAgeTransition)}for(var B=0;B<e.length;B++){if(q.storageClass.value!==k){q.frequencyTypes.push({title:"",text:"",color:q.emptyColor});continue}var F=b;var z=q.frequentColor;var E="";if(A===""){F=m;z=q.emptyColor}else{if(B>=A&&A>=0){F=t;E=i;z=q.infrequentColor}}q.frequencyTypes.push({title:F,text:E,color:z})}}}a()}])})();"use strict";(function(){angular.module("s3").directive("analytics",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/analytics.html",controller:"AnalyticsController"}}]);angular.module("s3").controller("AnalyticsController",["$anchorScroll","$route","$routeParams","$scope","$translate","AnalyticsDataProcessor","APIProxyService","AwsUrlsService","BucketPolicyService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","FAC","PathService","QuicksightService","S3Constants","SCLogService","StorageMonitoringService","UtilService","XMLParser",function(F,x,U,n,z,X,P,C,e,J,G,d,W,H,r,V,h,D,w,M){var q="Prefix",p="Tag";var B=V.MANAGEMENT.ACTION;var N=V.ANALYTICS.STORAGE_CLASS;var y=3600*1000*24;var i=new d(V.OPERATION_NAME.ANALYTICS_GET_CONFIG);var I=new d(V.OPERATION_NAME.ANALYTICS_GET_DATA);n.bucketName=H.getCurrentBucket();n.allData={};n.metrics={};n.selectedMetricType=V.METRICS.TYPE.STORAGE;n.S3Constants=V;n.selectedFilter=null;n.selectedFilterTmp=null;n.quicksightLink=null;n.validFilter=false;n.filterList=[];n.stdSize=z.instant("storage.size.zero.default");n.stdRet=z.instant("storage.size.zero.default");n.stdiaSize=z.instant("storage.size.zero.default");n.stdiaRet=z.instant("storage.size.zero.default");n.stdDate="";n.stdiaDate="";n.startedOn=L(new Date());n.updatedOn=L(new Date());n.recommendation=null;n.numDays=0;n.selectedStorageClass={value:N.STANDARD};n.percentageGraphId="percentageGraphId";n.percentageGraphHeading="";n.percentageXMin=new Date().getTime()-y;n.percentageXMax=new Date().getTime();n.percentageGraphXValue="timestamp";n.percentageGraphYValue="percentage";n.storageAreaChartId="storageVsDataTransferId";n.xmin=null;n.xmax=null;n.graphData={area:[],percentage:[]};n.storageOptions=null;n.exportFilterInfo={bucket:{},prefix:""};n.policyStatus={policyMessage:"",policyHeader:"",policyType:"info",policyDefinition:""};n.models={filterName:null,filterValue:null,filterError:null,savingFilter:false,applyingConfig:false,showAddFilter:false,editFilter:false,configLoading:true,toggleAnalyticsConfig:false,searchText:"",bucketChecked:false,allFilters:false,updatedOn:null,analyzingData:false,dataLoading:true,error:"",deleteFilter:false};n.filters={input:"",prefixFilters:[],tagFilters:[]};n.metricTypes={storage:{id:V.METRICS.TYPE.STORAGE,group:z.instant("management.analytics.type.analysis"),title:z.instant("management.analytics.type.analysis"),disable:false,checked:false,state:false,recommendation:-1,info:z.instant("management.metrics.cost.paid"),dimension:"StorageType",metrics:[{name:"BucketSizeBytes",display:z.instant("management.metric.type.display.storage.size"),selected:true},{name:"NumberOfObjects",display:z.instant("management.metric.type.display.storage.count"),selected:true}]}};n.filterKeyDown=function(Y){if(Y&&Y.keyCode===V.KEY_CODES.ESC){$(".input-field").blur();n.models.searchText=""}};function K(){var Y={prefixes:[],tags:[]};angular.forEach(n.filters.prefixFilters,function(Z){Y.prefixes.push({Prefix:Z})});angular.forEach(n.filters.tagFilters,function(Z){Y.tags.push({Tag:{Key:Z.tagKey,Value:Z.tagVal}})});return Y}n.getGroupTitle=function(Y){return n.metricTypes[Y].group};function v(Z){var Y="";if(Z){if(!Z.And){if(Z.Prefix){Y+=Z.Prefix}else{if(Z.Tag){Y+=Z.Tag.Key+" | "+Z.Tag.Value}}}else{angular.forEach(Z.And,function(ab,aa){if(aa===q){Y+=ab+" | "}if(aa===p){ab=[].concat(ab);angular.forEach(ab,function(ad,ac){Y+=ad.Key+"="+ad.Value;if(ac!==ab.length-1){Y+=" | "}})}});Y=Y.replace(/\|$/,"")}}else{Y=" "}return Y}n.addFilter=function(Y){if(!n.models.showAddFilter){b();n.models.filterNameError="";n.models.filterValueError="";if(Y){w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.EDIT_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT);n.models.editFilter=true;E(Y);n.selectedFilterTmp=Y}else{w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.ADD_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT);n.models.filterName="";n.models.filterValue=""}n.models.showAddFilter=true;n.resetPolicyStatus()}};n.validateFilter=function(){var Z=true;n.models.filterNameError="";n.models.filterValueError="";if(!n.models.filterName){return false}else{n.models.filterName=n.models.filterName.trim()}if(!V.MANAGEMENT.FILTER_NAME_REGEX.test(n.models.filterName)){n.models.filterNameError=z.instant("management.config.filtername.error.format");Z=false}if(n.filters.input){n.models.filterValueError=z.instant("management.config.filtervalue.error.format",{text:n.filters.input});Z=false}if(!n.models.editFilter){var Y=_.filter(n.filterList,function(aa){return aa.Id===n.models.filterName});if(Y.length>0){n.models.filterNameError=z.instant("management.metrics.side.filter.error.dup");Z=false}}return Z};n.cancelFilter=function(){if(!n.models.editFilter){w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.CANCEL_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT)}n.models.showAddFilter=false;n.models.editFilter=false;n.models.filterError=false;n.selectedFilterTmp=null};n.filterChanged=function(Y,Z){if(n.selectedFilter===Y){return}if(Z){Z.stopPropagation()}if(Y){s();if(n.selectedFilter){n.selectedFilter.checked=false;n.selectedFilter=Y;n.selectedFilter.checked=true}else{n.selectedFilter=Y;n.selectedFilter.checked=true}n.getHeatData()}};n.getLearnMoreLink=function(Y){return C.getDocUrl(V.LEARN_MORE_LINKS["storage-management"][Y])};function s(){n.cancelFilter();n.cancelMetricsConfig();n.allData.data={};n.graphData.area=[];n.graphData.percentage=[];n.stdSize=z.instant("storage.size.zero.default");n.stdRet=z.instant("storage.size.zero.default");n.stdiaSize=z.instant("storage.size.zero.default");n.stdiaRet=z.instant("storage.size.zero.default");n.stdDate="";n.stdiaDate="";n.startedOn=L(new Date());n.updatedOn=L(new Date());n.numDays=0;n.recommendation=null;n.selectedStorageClass={value:N.STANDARD};n.percentageGraphId="percentageGraphId";n.percentageGraphHeading="";n.percentageXMin=new Date().getTime()-y;n.percentageXMax=new Date().getTime();n.percentageGraphXValue="timestamp";n.percentageGraphYValue="percentage";n.storageOptions=null;n.xmax=new Date().getTime();n.xmin=n.xmax-30*y}n.setSelectedMetricType=function(Y){n.selectedMetricType=Y};function m(Y){n.models[Y]=true;b();n.startedOn=L(new Date());n.updatedOn=L(new Date());n.filterList=[];if(Y===B.DELETE_FILTER){if(n.selectedFilterTmp===n.selectedFilter){n.selectedFilterTmp=null;n.selectedFilter=null}else{n.selectedFilterTmp=null}}return J.getBucketLocation(n.bucketName).then(function(Z){n.bucketRegion=Z;Q(Y)})["catch"](function(Z){k(Y);R(Y,Z)})}function Q(Y){var Z=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var aa={};if(Z){angular.extend(aa,{params:{"continuation-token":Z}})}P.getBucketProperty(i,n.bucketName,"analytics",aa,false).then(function(af){var ab=af.response;h.log(V.OPERATION_NAME.ANALYTICS_GET_CONFIG,1,i);var ac=M.convertXmlStringToJson(ab);var ae=ac.ListBucketAnalyticsConfigurationsResult;var ad=[];if(ae&&ae.AnalyticsConfiguration){ad=w.transformObjectToArray(ae.AnalyticsConfiguration)}angular.forEach(ad,function(ag){if(n.selectedFilterTmp&&n.selectedFilterTmp.Id===ag.Id){n.selectedFilterTmp=ag;ag.checked=true}else{ag.checked=false}if(n.selectedFilter&&n.selectedFilter.Id===ag.Id){n.selectedFilter=ag;ag.checked=true}ag.filterText=v(ag.Filter)});n.filterList=n.filterList.concat(ad);if(ae.IsTruncated==="true"){Q(Y,ae.NextContinuationToken)}else{u();k(Y)}})["catch"](function(ab){h.log(V.OPERATION_NAME.ANALYTICS_GET_CONFIG,0,i);k(Y);R(Y,ab)})}function u(){if(!n.selectedFilter&&!n.selectedFilterTmp){if(n.filterList.length>0){n.filterList[0].checked=true;n.selectedFilterTmp=n.filterList[0]}}else{if(n.selectedFilter===n.selectedFilterTmp){n.selectedFilter=null}}n.models.editFilter=false;n.filterChanged(n.selectedFilterTmp)}function E(aa){var Y=n.exportFilterInfo;if(aa.StorageClassAnalysis&&aa.StorageClassAnalysis.DataExport&&aa.StorageClassAnalysis.DataExport.Destination&&aa.StorageClassAnalysis.DataExport.Destination.S3BucketDestination){var Z=aa.StorageClassAnalysis.DataExport.Destination.S3BucketDestination;if(Z.Prefix){Y.prefix=Z.Prefix}if(Z.BucketAccountId){Y.bucket.accountId=Z.BucketAccountId}if(Z.Bucket){Y.bucket.bucket=G.stripBucketARN(Z.Bucket)}}n.models.filterName=aa.Id;n.models.filterValue=aa.filterText}function b(){n.models.filterName="";n.filters.input="";n.filters.tagFilters=[];n.filters.prefixFilters=[];n.exportFilterInfo={bucket:{},prefix:""}}function k(Y){n.models[Y]=false;if(Y===B.SAVING_FILTER||Y===B.DELETE_FILTER){n.models.showAddFilter=false;n.models.filterError=""}if(Y===B.APPLYING_CONFIG){n.models.toggleAnalyticsConfig=false}n.filters.tagFilters=[];n.filters.prefixFilters=[]}n.deleteFilter=function(){if(!n.models.deleteFilter&&!n.models.savingFilter){var Y={params:{id:n.models.filterName}};t(Y,B.DELETE_FILTER)}};n.cancelMetricsConfig=function(){n.metricTypes.storage.checked=n.metricTypes.storage.state;n.models.toggleAnalyticsConfig=false};n.getHeatData=function(){n.quicksightLink="";if(n.selectedFilter){n.models[B.DATA_LOADING]=true;var Y=n.selectedFilter.Id;X.retrieveData(n.bucketName,Y).then(function(Z){h.log(V.OPERATION_NAME.ANALYTICS_GET_DATA,1,I);l(Z);a()})["catch"](function(Z){h.log(V.OPERATION_NAME.ANALYTICS_GET_DATA,0,I);if(Z===V.ANALYTICS.ERROR.USER_INFO_MISSING){n.models.error=z.instant("management.analytics.data.error.userinfo.missing")}})["finally"](function(Z){n.models[B.DATA_LOADING]=false})}else{n.models[B.DATA_LOADING]=false}};function o(){if(n.allData.data.classes){var Y=_.filter(n.allData.data.classes,function(Z){return Z===N.STANDARD});if(Y.length>0){n.selectedStorageClass.value=N.STANDARD}else{n.selectedStorageClass.value=n.allData.data.classes[0]}}else{n.selectedStorageClass.value=N.STANDARD}}function l(aa){if(aa){n.allData.data=aa;o()}if(!n.allData.data.all||!n.allData.data.rows){return}var Y=n.allData.data.all[N.STANDARD];if(Y&&Y.length>0){var Z=Y[Y.length-1];if(Z.row.recommendation>=0){n.recommendation=Z.row.recommendation;n.selectedFilter.recommendation=n.recommendation}}if(n.allData.data.rows.length>0){n.numDays=A(n.allData.data.rows[0].date);n.startedOn=L(n.allData.data.rows[0].date);n.updatedOn=L(n.allData.data.rows[n.allData.data.rows.length-1].date)}S();T();c()}function T(){if(n.allData.data&&n.allData.data.all[n.selectedStorageClass.value]){var ac=n.allData.data.all[n.selectedStorageClass.value];var Y=[];var ab=ac.length;if(ab>30){var aa=ab-31;for(var Z=ab-1;Z>aa;Z--){Y.push(ac[Z])}ac=Y;n.xmax=Y[0].timestamp;n.xmin=Y[Y.length-1].timestamp}else{if(ab>0){n.xmax=ac[ab-1].timestamp;n.xmin=ac[0].timestamp}else{n.xmax=new Date().getTime();n.xmin=n.xmax-30*y}}n.graphData.area=ac}else{n.graphData.area=[]}}n.$watch("selectedStorageClass.value",function(Z,Y){if(Z!==Y){n.setSelectedStorageClass()}});n.setSelectedStorageClass=function(){w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.ANALYTICS.CHANGE_STORAGE_CLASS,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT);l()};function S(){n.storageOptions=w.getStorageClassOptions(n.allData.data.classes)}function c(){var ac=n.allData.data.all[n.selectedStorageClass.value];n.percentageGraphId="percentageGraphId";n.percentageGraphHeading="%";n.percentageXMin=new Date().getTime()-30*y;n.percentageXMax=new Date().getTime();if(ac){var Y=[];var ab=ac.length;if(ab>30){var aa=ac.length-31;for(var Z=ab-1;Z>aa;Z--){Y.push(ac[Z])}ac=Y}n.graphData.percentage=ac}else{n.graphData.percentage=[]}}function A(Z){var aa=24*60*60*1000;var ab=new Date(Z);var Y=new Date();return Math.round(Math.abs((Y.getTime()-ab.getTime())/aa))}function L(aa){var Y=new Date(aa);var ac=Y.getUTCMonth()+1;var Z=Y.getUTCDate();var ab=Y.getUTCFullYear();return ac+"/"+Z+"/"+ab}n.saveFilter=function(){var Z=n.exportFilterInfo;if(!n.models.deleteFilter&&!n.models.savingFilter&&!(!Z.bucket.bucket&&Z.prefix)){var Y=K();n.models.filterError="";if(n.validateFilter(Y)){(function(){var ac={params:{id:n.models.filterName}};var ab={},aa=undefined;ab.AnalyticsConfiguration={};ab.AnalyticsConfiguration.Id=n.models.filterName;if(n.models.editFilter){ab.AnalyticsConfiguration.Filter=n.selectedFilter.Filter}else{if(Y.tags.length+Y.prefixes.length>0){ab.AnalyticsConfiguration.Filter={};if(Y.tags.length>1||Y.tags.length+Y.prefixes.length>1){ab.AnalyticsConfiguration.Filter.And={};if(Y.tags.length>0){ab.AnalyticsConfiguration.Filter.And.Tag=[];angular.forEach(Y.tags,function(ae){var ad=ae.Tag;return ab.AnalyticsConfiguration.Filter.And.Tag.push(ad)})}if(Y.prefixes.length>0){ab.AnalyticsConfiguration.Filter.And.Prefix=[];angular.forEach(Y.prefixes,function(ae){var ad=ae.Prefix;return ab.AnalyticsConfiguration.Filter.And.Prefix.push(ad)})}}else{if(Y.prefixes.length>0){ab.AnalyticsConfiguration.Filter=Y.prefixes[0]}if(Y.tags.length>0){ab.AnalyticsConfiguration.Filter.Tag=Y.tags[0].Tag}}}}j(ab);aa=M.jsonToXml(ab);g(aa,ac,B.SAVING_FILTER)})()}}};n.getClassNameTranslation=function(Y){var Z=w.getStorageClassTranslations()[Y];if(!Z){Z=Y.charAt(0)+Y.substring(1).toLowerCase()}return Z};n.getMostRecentTotalSize=function(Y){return w.formatWithUnits(Y[Y.length-1].row.storage)};n.getMostRecentDate=function(Y){return L(Y[Y.length-1].date)};n.getMostRecentDataRetrieved=function(Y){return w.formatWithUnits(Y[Y.length-1].row.dataRetrieved)};function g(ab,aa,Y){var Z=new d(V.OPERATION_NAME.ANALYTICS_PUT_CONFIG);n.models[Y]=true;ab=O(ab);if(Y===B.SAVING_FILTER){n.filterError=""}P.putBucketProperty(Z,n.bucketName,"analytics",ab,aa).then(function(ad){var ac=ad.response;h.log(V.OPERATION_NAME.ANALYTICS_PUT_CONFIG,1,Z);w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.SAVE_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT);m(Y)})["catch"](function(ac){h.log(V.OPERATION_NAME.ANALYTICS_PUT_CONFIG,0,Z);R(Y,ac);n.models[Y]=false})}function t(aa,Y){var Z=new d(V.OPERATION_NAME.ANALYTICS_DELETE_CONFIG);if(Y===B.SAVING_FILTER||Y===B.DELETE_FILTER){n.models.filterError=""}w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.DELETE_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT);n.models[Y]=true;P.deleteBucketProperty(Z,n.bucketName,"analytics",aa).then(function(ac){var ab=ac.response;h.log(V.OPERATION_NAME.ANALYTICS_DELETE_CONFIG,1,Z);if(n.selectedFilterTmp===n.selectedFilter){n.selectedFilterTmp=null;n.selectedFilter=null}else{n.selectedFilterTmp=null}m(Y)})["catch"](function(ab){h.log(V.OPERATION_NAME.ANALYTICS_DELETE_CONFIG,0,Z);R(Y,ab);n.models[Y]=false})}function R(Y,Z){if(Y===B.SAVING_FILTER||Y===B.DELETE_FILTER){n.models.filterError=w.handleErrors(Z)}else{n.models.error=w.handleErrors(Z)}}function j(aa){aa.AnalyticsConfiguration.StorageClassAnalysis="";var Z=n.exportFilterInfo;if(Z.bucket.bucket){var Y=Z.bucket.bucket;aa.AnalyticsConfiguration.StorageClassAnalysis={};aa.AnalyticsConfiguration.StorageClassAnalysis.DataExport={OutputSchemaVersion:"V_1",Destination:{S3BucketDestination:{Format:"CSV",Bucket:w.getBucketARN(Y)}}};if(Z.prefix){aa.AnalyticsConfiguration.StorageClassAnalysis.DataExport.Destination.S3BucketDestination.Prefix=Z.prefix}if(Z.bucket.accountId){aa.AnalyticsConfiguration.StorageClassAnalysis.DataExport.Destination.S3BucketDestination.BucketAccountId=Z.bucket.accountId}e.createBucketPolicy(n.bucketName,Y,n.policyStatus)}}function O(Y){return Y.replace("<AnalyticsConfiguration>",'<?xml version="1.0" encoding="UTF-8"?> <AnalyticsConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">')}n.resetPolicyStatus=function(){n.policyStatus.policyMessage="";n.policyStatus.policyHeader="";n.policyDefinition="";n.policyType="info"};function a(){if(W.isFeatureEnabled(V.FAC.QUICKSIGHT_LINK)){n.quicksightLink=r.generateQuicksightLink(n.bucketName,n.selectedFilter,n.bucketRegion)}}n.quicksightLinkClicked=function(){w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.ANALYTICS.QUICKSIGHT_LINK,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT)};n.searchClicked=function(){w.analyticsTrackClick(V.ANALYTICS.MANAGEMENT.SEARCH_CONFIG,V.ANALYTICS.MANAGEMENT.ANALYTICS.CONTEXT)};function f(){m(B.CONFIG_LOADING)}f()}])})();"use strict";(function(){angular.module("s3").directive("analyticsExport",[function(){return{restrict:"E",controller:"AnalyticsExportController",scope:{data:"=",saving:"=",editFilter:"="},templateUrl:"/s3/partials/analysisexport.html"}}]);angular.module("s3").controller("AnalyticsExportController",["$scope","AwsUrlsService","BucketPropertiesService","FACService","PathService","S3Constants","UtilService",function(b,e,d,g,f,c,a){g.isBucketFeatureEnabled(c.FAC.QUICKSIGHT).then(function(h){b.showQuicksight=h});b.getLearnMoreLink=function(h){return e.getDocUrl(c.LEARN_MORE_LINKS["storage-management"][h])};b.getQuicksightLink=function(){return c.LEARN_MORE_LINKS["storage-management"]["quicksight"]};b.validatePrefix=function(){if(b.data.prefix&&b.data.prefix.indexOf(c.DELIMITER)===0&&b.data.bucket.bucket){b.prefixInfo=b.data.prefix}else{b.prefixInfo=""}}}])})();"use strict";(function(){angular.module("s3").directive("analyticsAreaChart",[function(){return{restrict:"E",scope:{data:"=",width:"=?",height:"=?",bcolor:"=?",tcolor:"=?",chartId:"=",xmin:"=?",xmax:"=?"},controller:"AnalyticsAreaChartController",templateUrl:"/s3/partials/analytics-area-chart.html",link:function a(b){b.$watch("data",function(c){if(c){b.draw()}})}}}]);angular.module("s3").controller("AnalyticsAreaChartController",["$scope","$translate","$window",function(a,c,e){a.labels=[c.instant("storageanalysis.label.storage"),c.instant("storageanalysis.label.dataRetrieved")];var b=e.d3;a.draw=function(){var l=a.data;var j=b.time.format("%m/%d");var s=9;var k={top:10,right:20,bottom:30,left:80},g=(a.width||960)-k.left-k.right,t=(a.height||500)-k.top-k.bottom;l.sort(function(w,v){return b.ascending(w.timestamp,v.timestamp)});var r=b.time.scale().range([0,g]);var p=b.scale.linear().range([t,0]);var h=b.svg.axis().scale(r).orient("bottom").ticks(5).tickFormat(j);var f=b.svg.axis().scale(p).orient("left").ticks(s).tickFormat(d);var u=b.svg.area().x(function(v){return r(v.timestamp)}).y0(t).y1(function(v){return p(v.row.storage)});var i=b.svg.area().x(function(v){return r(v.timestamp)}).y0(t).y1(function(v){return p(v.row.storage+v.row.dataRetrieved)});b.select("#"+a.chartId).selectAll("svg").remove();var m=b.select("#"+a.chartId).append("svg").attr("width",g+k.left+k.right).attr("height",t+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")");if(a.xmin&&a.xmax){r.domain([a.xmin,a.xmax]).nice()}else{r.domain(b.extent(l,function(v){return v.timestamp})).nice()}if(l.length>0){var n=b.extent(l,function(v){return v.row.storage+v.row.dataRetrieved});var o=n[1];var q=o*0.3;if(q===0){if(o!==0){q=o*0.1}else{q=1;s=2;f.ticks(s)}}o+=q;p.domain([0,o]);p.nice([0,o])}else{p.domain([0,5]);p.nice([0,5])}m.append("path").datum(l).attr("class","data-fill").attr("d",i);m.append("path").datum(l).attr("class","storage-fill").attr("d",u);m.append("g").attr("class","x axis").attr("transform","translate(0,"+t+")").call(h);m.append("g").attr("class","y axis").call(f)};var d=function d(g){var f=b.format(".1f");if(g<1024){return f(g)}else{if(g<1024*1024){return f(g/1024)+" KB"}else{if(g<1024*1024*1024){return f(g/1024/1024)+" MB"}else{if(g<1024*1024*1024*1024){return f(g/1024/1024/1024)+" GB"}else{if(g<1024*1024*1024*1024*1024){return f(g/1024/1024/1024/1024)+" TB"}else{return f(g/1024/1024/1024/1024/1024)+" PB"}}}}}}}])})();"use strict";(function(){angular.module("s3").directive("targetmbox",["TargetMediatorScripts",function(a){return{restrict:"E",templateUrl:"/s3/partials/targetmbox.html",scope:{},controller:"TargetMboxController",link:function b(e,d,c){e.$watch(function(){return $(d).find(".js-mbox").css("visibility")},function(f){if(f==="visible"){a.setMBoxContent()}})}}}]);angular.module("s3").controller("TargetMboxController",["$scope","TargetMediatorScripts","InvokeTargetMediator",function(d,b,c){d.scriptsInvoked=c.getScriptCount();if(d.scriptsInvoked>0){var a=b.getMBoxContent();d.mBoxContent=a!==undefined?a:"";d.showDefault=false}else{d.showDefault=true}}]).filter("trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}])})();"use strict";(function(){angular.module("s3").factory("TargetMediatorScripts",["$document","$window","S3Constants",function(e,a,f){function i(j){var k=j!==undefined?j.toLowerCase():"en";return f.TARGET_MEDIATOR.LANGUAGE_MAP[k]||"en"}function g(){return{pageLanguage:i($('meta[property="requestLocale"]').attr("content")),supportedLanguages:f.TARGET_MEDIATOR.SUPPORTED_LANGUAGES,isLoadedAtPageEnd:true}}function b(){var m=document.createElement("noscript");m.innerHTML="<style>.js-mbox { visibility: visible; }</style>";document.body.appendChild(m);var l="var AWS = {};";l+="AWS.TargetMediator = ";l+=JSON.stringify(g())+";";var k=document.createElement("script");k.innerHTML=l;document.body.appendChild(k);var j=document.createElement("script");j.type="text/javascript";j.defer=true;j.src="/s3/lib/target/aws-target-mediator.js";document.body.appendChild(j)}var c;function h(){var j=$("targetmbox").find(".js-mbox");if(j.length){c=j.get(0).innerHTML}else{c=""}}function d(){return c}return{addScripts:b,getLanguage:i,getMediatorObject:g,getMBoxContent:d,setMBoxContent:h}}]);angular.module("s3").factory("InvokeTargetMediator",["$document","TargetMediatorScripts",function(c,b){angular.injector(["ng","s3"]).invoke(function(){b.addScripts()});function a(){var d=$('script[src="/s3/lib/target/aws-target-mediator.js"]');return c.find(d).length}return{getScriptCount:a}}])})();"use strict";(function(){angular.module("s3").directive("bucketAccelerate",[function(){return{restrict:"E",scope:{cardOpen:"=",id:"@?"},templateUrl:"/s3/partials/bucketaccelerate.html",controller:"BucketAccelerateController"}}]);angular.module("s3").controller("BucketAccelerateController",["$scope","$timeout","$translate","AwsUrlsService","BucketPropertiesService","ConsoleOperation","PathService","S3Constants","UtilService",a]);function a(k,c,b,d,e,h,i,g,j){k.accelerateStates={enabled:"Enabled",suspended:"Suspended"};k.accelerate={};k.accelerate.selectedValue=k.accelerateStates.suspended;k.learnMoreLink=d.getDocUrl(g.LEARN_MORE_LINKS.ACCELERATE);k.accelerate.endpoint=""+i.getCurrentBucket()+g.ACCELERATE.ENDPOINT.PUBLIC;k.scrollCardId="#"+k.id;k.cardSummaryObj=_.cloneDeep(g.CARD_SUMMARY_INIT);k.cardSummaryObj.activeSummary.text=b.instant("bucketproperty.acceleration.endpoint");k.cardSummaryObj.inactiveSummary.text=b.instant("bucketproperty.suspended");m();function m(){if(k.accelerate.selectedValue===k.accelerateStates.enabled){k.cardSummaryObj.isActive=true;k.cardSummaryObj.isMultiValue=true;k.cardSummaryObj.activeSummary.value=k.accelerate.endpoint}else{k.cardSummaryObj.isActive=false;k.cardSummaryObj.isMultiValue=false}}function l(){var o=i.getCurrentBucket();var n=new h(g.ANALYTICS.GET_BUCKET_ACCELERATE);k.cardSummaryObj.isLoading=true;k.error=undefined;e.getBucketLocation(o).then(function(p){k.comparisonEndpoint=g.ACCELERATE.COMPARISON_ENDPOINT+"region="+p+"&origBucketName="+o});e.getBucketAccelerate(o,n).then(function(p){if(p===k.accelerateStates.enabled){k.accelerate.selectedValue=k.accelerateStates.enabled}})["catch"](function(p){k.error=j.handleErrors(p)})["finally"](function(){k.cachedAccelerate=angular.copy(k.accelerate);m();k.cardSummaryObj.isLoading=false})}k.cancelBucketAccelerate=function(n){j.analyticsTrackClick(g.ANALYTICS.CANCEL_ACCELERATE,g.ANALYTICS.DETAILS);n.stopPropagation();k.accelerate=angular.copy(k.cachedAccelerate);k.cardSummaryObj.isActive=k.accelerate.selectedValue===k.accelerateStates.enabled;k.error=undefined;k.cardOpen=false};k.saveBucketAccelerate=function(n){j.analyticsTrackClick(g.ANALYTICS.SAVE_ACCELERATE,g.ANALYTICS.DETAILS);n.stopPropagation();k.error=undefined;k.saving=true;e.putBucketAccelerate(i.getCurrentBucket(),new h(g.ANALYTICS.PUT_BUCKET_ACCELERATE),k.accelerate.selectedValue).then(function(){k.cachedAccelerate.selectedValue=angular.copy(k.accelerate.selectedValue);k.cardOpen=false})["catch"](function(o){k.error=o})["finally"](function(){k.saving=false;m()})};function f(){l()}f()}})();"use strict";(function(){angular.module("s3").service("FACService",["BucketPropertiesService","FAC","PathService",a]);function a(c,b,d){this.isBucketFeatureEnabled=function(e){return c.getBucketLocation(d.getCurrentBucket()).then(function(f){return b.isFeatureEnabled(e+"-"+f)})}}})();"use strict";(function(){angular.module("s3").directive("hint",[function(){return{restrict:"E",templateUrl:"/s3/partials/hint.html",scope:{},controller:"HintController"}}]);angular.module("s3").controller("HintController",["$scope","$interval","$location","$translate","$window","$cookies","ConsoleOperation","Region","S3Constants","SCLogService","UtilService",function(n,h,g,a,d,f,i,o,e,m,k){n.goToOldConsole=function(){var p=new i(e.OPERATION_NAME.SWITCH_BACK_TO_OLD_CONSOLE);m.log(e.OPERATION_NAME.SWITCH_BACK_TO_OLD_CONSOLE,1,p);var q={path:e.OPT_OUT_COOKIE.PATH};if(g.host().indexOf("s3.")!==0){f.put(e.OPT_OUT_COOKIE.COOKIE_KEY,e.OPT_OUT_COOKIE.VALUE[k.getCloudSystem()],q);d.location.reload()}else{d.location.href=d.location.href.replace("s3.","")+"&switchingBackToOldConsole=true"}};n.goToVideo=function(){d.open(e.YOUTUBE_VIDEO_LINK,"_blank")};n.showVideo=function(){var p=o.getCurrentRegion();return e.FALLBACK_REGION_LIST.CN.indexOf(p)===-1&&e.FALLBACK_REGION_LIST.ISO.indexOf(p)===-1};var c=8;var b=10000;var l=0;n.hintMessage=a.instant("hint.message."+l);var j=function j(){l=(l+1)%c;n.hintMessage=a.instant("hint.message."+l)};h(j,b)}])})();angular.module("s3").run(["$templateCache",function(a){a.put("/s3/partials/acl.html",'<awsui-radio-group class="permission-radio-group" ng-model="radioSelect.displayName">\n    <div class="manage-grantee-title" translate="permissions.owner"></div>\n    <table class="table">\n        <thead class="table-header">\n        <tr>\n            <th class="grantee-radio"></th>\n            <th class="grantee-header">\n                {{\'permissions.acl.grantee\' | translate}}\n                <awsui-tooltip text="{{ \'permissions.acl.granteeTooltip\' | translate }}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{readHeader}}\n                <awsui-tooltip text="{{readTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header" ng-if="isBucketPermission">{{writeHeader}}\n                <awsui-tooltip text="{{writeTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{readACPHeader}}\n                <awsui-tooltip text="{{readACPTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{writeACPHeader}}\n                <awsui-tooltip text="{{writeACPTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n        </tr>\n        </thead>\n        <tbody class="table-body">\n        <tr ng-repeat="(name, permissions) in permissionObj.grantees.accounts" ng-if="$first" class="grantee-row" ng-click="selectGrantee(name, false, false)" ng-class="{\'grantee-selected\': name === selectedGrantee.displayedValue, \'row-hover\' : hoverUser }" ng-mouseenter="hoverUser = true" ng-mouseleave="hoverUser = false">\n            <td ng-click="selectGrantee(name, false, false)">\n                <awsui-radio-button value="{{name}}">\n            <td>{{name}}</td>\n            <td>\n                <span ng-if="permissions.READ" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.READ">-</span>\n            </td>\n            <td ng-if="isBucketPermission">\n                <span ng-if="permissions.WRITE" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.WRITE">-</span>\n            </td>\n            <td>\n                <span ng-if="permissions.READ_ACP" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.READ_ACP">-</span>\n            </td>\n            <td>\n                <span ng-if="permissions.WRITE_ACP" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.WRITE_ACP">-</span>\n            </td>\n            </awsui-radio-button>\n            </td>\n        </tr>\n        <tr>\n            <storage-console-config-panel ng-class="{\'side-config-panel acl-side-panel\': panelOpen, \'hide-config-panel acl-side-panel\': panelHide}" panel-open="panelOpen">\n                <header>\n                    <div class="truncate side-panel-header bucket-config-panel-header-image">{{ selectedGrantee.displayedValue }}</div>\n                    <span class="panel-close-icon" ng-click="panelCancel()"></span>\n                    \n                </header>\n                <content>\n                    <div class="permissions-side-panel-content">\n                        <p class="subheader" translate="{{resource.type}}.acl.objectaccess"></p>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ">{{ readHeader }}</awsui-checkbox>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-if="isBucketPermission" ng-model="selectedGrantee.permissions.WRITE">{{ writeHeader }}</awsui-checkbox>\n                        <p class="subheader padding-top-30" translate="{{resource.type}}.acl.permissionsaccess"></p>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ_ACP">{{ readACPHeader }}</awsui-checkbox>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.WRITE_ACP">{{ writeACPHeader }}</awsui-checkbox>\n                    </div>\n                </content>\n                <footer>\n                    <awsui-button variant="primary" text="{{ \'permissions.button.save\' | translate}}" class="awsui-util-f-r primary-button" click="updateGrantee(selectedGrantee)" loading="updatingGrantee"></awsui-button>\n                    <awsui-button variant="normal" text="{{ \'permissions.button.cancel\' | translate}}" class="awsui-util-f-r normal-button" click="panelCancel()"></awsui-button>\n                </footer>\n            </storage-console-config-panel>\n        </tr>\n        </tbody>\n    </table>\n    <div class="manage-grantee-title" translate="permissions.manageusers"></div>\n    <div class="acl-add-new">\n         <awsui-button variant="primary" data-disabled="shouldDisable" text="{{\'permissions.button.addgrantee\'  | translate}}" icon="plus" click="showAddGranteeRow()"></awsui-button>\n         <awsui-button data-disabled="disableDeleteButton() " text="{{\'permissions.button.deletegrantee\'  | translate}}" click="deleteAccountGrantee()"></awsui-button>\n     </div>\n    <table class="table">\n        <thead class="table-header">\n        <tr>\n            <th class="grantee-radio"></th>\n            <th class="grantee-header">\n                {{\'permissions.acl.grantee\' | translate}}\n                <awsui-tooltip text="{{ \'permissions.acl.granteeTooltip\' | translate }}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{readHeader}}\n                <awsui-tooltip text="{{readTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header" ng-if="isBucketPermission">{{writeHeader}}\n                <awsui-tooltip text="{{writeTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{readACPHeader}}\n                <awsui-tooltip text="{{readACPTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n            <th class="grantee-header"> {{writeACPHeader}}\n                <awsui-tooltip text="{{writeACPTooltip}}" position="right" size="small" initialized="true">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n            </th>\n        </tr>\n        </thead>\n        <tbody class="table-body">\n        <tr ng-if="isAddGranteeRowDisplayed">\n            <td></td>\n            <td class="add-grantee-options">\n                <awsui-control-group validation-message="{{ granteeList.inputError }}">\n                    <awsui-textfield class="grantee-list" placeholder="{{ \'permissions.addnewgratee.placeholder\' | translate }}" ng-change="resetInputError()" ng-model="granteeList.inputItem"></awsui-textfield>\n                </awsui-control-group>\n\n                <awsui-button id="save-grantee" variant="primary" text="{{ \'permissions.button.save\' | translate }}" class="awsui-util normal-button add-grantee-buttons" data-disabled="!granteeList.inputItem  || (!granteeList.grantPermissions.READ && !granteeList.grantPermissions.WRITE && !granteeList.grantPermissions.READ_ACP && !granteeList.grantPermissions.WRITE_ACP) || granteeList.inputError" click="save()" loading="addingGrantee">\n                </awsui-button>\n                <awsui-button id="cancel-grantee" variant="normal" text="{{ \'permissions.button.cancel\' | translate }}" class="awsui-util normal-button add-grantee-buttons" click="cancel()">\n                </awsui-button>\n            </td>\n            <td class="grantee-checkboxes">\n                <awsui-checkbox class="awsui awsui-checkbox" disabled="!granteeList.inputItem || granteeList.inputError" ng-model="granteeList.grantPermissions.READ">{{ \'bucketproperty.yes\' | translate }}</awsui-checkbox>\n            </td>\n            <td class="grantee-checkboxes" ng-if="isBucketPermission">\n                <awsui-checkbox class="awsui awsui-checkbox" disabled="!granteeList.inputItem || granteeList.inputError" ng-model="granteeList.grantPermissions.WRITE">{{ \'bucketproperty.yes\' | translate }}</awsui-checkbox>\n            </td>\n            <td class="grantee-checkboxes">\n                <awsui-checkbox class="awsui awsui-checkbox" disabled="!granteeList.inputItem || granteeList.inputError" ng-model="granteeList.grantPermissions.READ_ACP">{{ \'bucketproperty.yes\' | translate }}</awsui-checkbox>\n            </td>\n            <td class="grantee-checkboxes">\n                <awsui-checkbox class="awsui awsui-checkbox" disabled="!granteeList.inputItem || granteeList.inputError" ng-model="granteeList.grantPermissions.WRITE_ACP">{{ \'bucketproperty.yes\' | translate }}</awsui-checkbox>\n            </td>\n        </tr>\n        <tr ng-repeat="(name, permissions) in permissionObj.grantees.accounts" ng-if="!$first" class="grantee-row" ng-click="selectGrantee(name, false, false)" ng-class="{\'grantee-selected\': name === selectedGrantee.displayedValue, \'row-hover\' : hoverUser }" ng-mouseenter="hoverUser = true" ng-mouseleave="hoverUser = false">\n            <td ng-click="selectGrantee(name, false, false)">\n                <awsui-radio-button value="{{name}}">\n            <td>{{name}}</td>\n            <td>\n                <span ng-if="permissions.READ" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.READ">-</span>\n            </td>\n            <td ng-if="isBucketPermission">\n                <span ng-if="permissions.WRITE" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.WRITE">-</span>\n            </td>\n            <td>\n                <span ng-if="permissions.READ_ACP" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.READ_ACP">-</span>\n            </td>\n            <td>\n                <span ng-if="permissions.WRITE_ACP" translate="bucketproperty.yes"></span>\n                <span ng-if="!permissions.WRITE_ACP">-</span>\n            </td>\n            </awsui-radio-button>\n            </td>\n        </tr>\n        <tr>\n            <storage-console-config-panel ng-class="{\'side-config-panel acl-side-panel\': panelOpen, \'hide-config-panel acl-side-panel\': panelHide}" panel-open="panelOpen">\n                <header>\n                    <div class="truncate side-panel-header bucket-config-panel-header-image">{{ selectedGrantee.displayedValue }}</div>\n                    <span class="panel-close-icon" ng-click="panelCancel()"></span>\n                    \n                </header>\n                <content>\n                    <div class="permissions-side-panel-content">\n                        <p class="subheader" translate="{{resource.type}}.acl.objectaccess"></p>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ">{{ readHeader }}</awsui-checkbox>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-if="isBucketPermission" ng-model="selectedGrantee.permissions.WRITE">{{ writeHeader }}</awsui-checkbox>\n                        <p class="subheader padding-top-30" translate="{{resource.type}}.acl.permissionsaccess"></p>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ_ACP">{{ readACPHeader }}</awsui-checkbox>\n                        <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.WRITE_ACP">{{ writeACPHeader }}</awsui-checkbox>\n                    </div>\n                </content>\n                <footer>\n                    <awsui-button variant="primary" text="{{ \'permissions.button.save\' | translate}}" class="awsui-util-f-r primary-button" click="updateGrantee(selectedGrantee)" loading="updatingGrantee"></awsui-button>\n                    <awsui-button variant="normal" text="{{ \'permissions.button.cancel\' | translate}}" class="awsui-util-f-r normal-button" click="panelCancel()"></awsui-button>\n                </footer>\n            </storage-console-config-panel>\n        </tr>\n        </tbody>\n    </table>\n<div class="manage-public-permission-title" translate="permissions.managepublicpermissions"> </div>\n<table class="table">\n     <thead class="table-header">\n     <tr>\n         <th class="grantee-radio"></th>\n         <th class="grantee-header">\n             {{\'permissions.acl.group\' | translate}}\n             <awsui-tooltip text="{{ \'permissions.acl.groupTooltip\' | translate }}" position="right" size="small" initialized="true">\n                 <i class="awsui-icon alert-info-circle"></i>\n             </awsui-tooltip>\n         </th>\n         <th class="grantee-header"> {{readHeader}}\n             <awsui-tooltip text="{{readTooltip}}" position="right" size="small" initialized="true">\n                 <i class="awsui-icon alert-info-circle"></i>\n             </awsui-tooltip>\n         </th>\n         <th class="grantee-header" ng-if="isBucketPermission">{{writeHeader}}\n             <awsui-tooltip text="{{writeTooltip}}" position="right" size="small" initialized="true">\n                 <i class="awsui-icon alert-info-circle"></i>\n             </awsui-tooltip>\n         </th>\n         <th class="grantee-header"> {{readACPHeader}}\n             <awsui-tooltip text="{{readACPTooltip}}" position="right" size="small" initialized="true">\n                 <i class="awsui-icon alert-info-circle"></i>\n             </awsui-tooltip>\n         </th>\n         <th class="grantee-header"> {{writeACPHeader}}\n             <awsui-tooltip text="{{writeACPTooltip}}" position="right" size="small" initialized="true">\n                 <i class="awsui-icon alert-info-circle"></i>\n             </awsui-tooltip>\n         </th>\n     </tr>\n     </thead>\n     <tbody class="table-body">\n     \n     <tr ng-repeat="(name, permissions) in permissionObj.grantees.group" ng-click="selectGrantee(name, true, false)" class="grantee-row" ng-class="{\'grantee-selected\': name === selectedGrantee.displayedValue, \'row-hover\': hoverGroup}" ng-mouseenter="hoverGroup = true" ng-mouseleave="hoverGroup = false" ng-if="name === \'AllUsers\' || hasGrant(permissions)">\n         <td ng-click="selectGrantee(name, true, false)">\n             <awsui-radio-button value="{{name}}">\n         <td>{{ getPublicPermissionDisplayName(name)}}</td>\n         <td>\n             <span ng-if="permissions.READ" translate="bucketproperty.yes"></span>\n             <span ng-if="!permissions.READ">-</span>\n         </td>\n         <td ng-if="isBucketPermission">\n             <span ng-if="permissions.WRITE" translate="bucketproperty.yes"></span>\n             <span ng-if="!permissions.WRITE">-</span>\n         </td>\n         <td>\n             <span ng-if="permissions.READ_ACP" translate="bucketproperty.yes"></span>\n             <span ng-if="!permissions.READ_ACP">-</span>\n         </td>\n         <td>\n             <span ng-if="permissions.WRITE_ACP" translate="bucketproperty.yes"></span>\n             <span ng-if="!permissions.WRITE_ACP">-</span>\n         </td>\n         </awsui-radio-button>\n         </td>\n     </tr>\n     <tr>\n         <storage-console-config-panel ng-class="{\'side-config-panel acl-side-panel\': panelOpen, \'hide-config-panel acl-side-panel\': panelHide}" panel-open="panelOpen">\n             <header>\n                 <div class="truncate side-panel-header bucket-config-panel-header-image">{{ getPublicPermissionDisplayName(selectedGrantee.displayedValue) }}</div>\n                 <span class="panel-close-icon" ng-click="panelCancel()"></span>\n                 \n             </header>\n             <content>\n                 <div class="permissions-side-panel-content">\n                     <p class="subheader" translate="permissions.acl.objectaccess"></p>\n                     <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ">{{ readHeader }}</awsui-checkbox>\n                     <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.WRITE">{{ writeHeader }}</awsui-checkbox>\n                     <p class="subheader padding-top-30" translate="permissions.acl.permissionsaccess"></p>\n                     <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ_ACP">{{ readACPHeader }}</awsui-checkbox>\n                     <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.WRITE_ACP">{{ writeACPHeader }}</awsui-checkbox>\n                 </div>\n             </content>\n             <footer>\n                 <awsui-button variant="primary" text="{{ \'permissions.button.save\' | translate}}" class="awsui-util-f-r primary-button" click="updateGrantee(selectedGrantee)" loading="updatingGrantee"></awsui-button>\n                 <awsui-button variant="normal" text="{{ \'permissions.button.cancel\' | translate}}" class="awsui-util-f-r normal-button" click="panelCancel()"></awsui-button>\n             </footer>\n         </storage-console-config-panel>\n     </tr>\n     </tbody>\n </table>\n<div class="manage-public-permission-title" translate="permissions.managesystempermissions"> </div>\n<table id="system-permissions-table" class="table">\n    <thead class="table-header">\n    <tr>\n        <th class="grantee-radio"></th>\n        <th class="grantee-header">\n            {{\'permissions.acl.group\' | translate}}\n            <awsui-tooltip text="{{ \'permissions.acl.groupTooltip\' | translate }}" position="right" size="small" initialized="true">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </th>\n        <th class="grantee-header"> {{readHeader}}\n            <awsui-tooltip text="{{readTooltip}}" position="right" size="small" initialized="true">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </th>\n        <th class="grantee-header" ng-if="isBucketPermission">{{writeHeader}}\n            <awsui-tooltip text="{{writeTooltip}}" position="right" size="small" initialized="true">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </th>\n        <th class="grantee-header"> {{readACPHeader}}\n            <awsui-tooltip text="{{readACPTooltip}}" position="right" size="small" initialized="true">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </th>\n        <th class="grantee-header"> {{writeACPHeader}}\n            <awsui-tooltip text="{{writeACPTooltip}}" position="right" size="small" initialized="true">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </th>\n    </tr>\n    </thead>\n    <tbody class="table-body">\n    <tr ng-repeat="(name, permissions) in permissionObj.grantees.system" ng-click="selectGrantee(name, false, true)" class="grantee-row" ng-class="{\'grantee-selected\': name === selectedGrantee.displayedValue, \'row-hover\': hoverGroup}" ng-mouseenter="hoverGroup = true" ng-mouseleave="hoverGroup = false">\n        <td ng-click="selectGrantee(name, false, true)">\n            <awsui-radio-button value="{{name}}">\n        <td> {{ getSystemPermissionDisplayName(name)}} </td>\n        <td>\n            <span ng-if="permissions.READ" translate="bucketproperty.yes"></span>\n            <span ng-if="!permissions.READ">-</span>\n        </td>\n        <td ng-if="isBucketPermission">\n            <span ng-if="permissions.WRITE" translate="bucketproperty.yes"></span>\n            <span ng-if="!permissions.WRITE">-</span>\n        </td>\n        <td>\n            <span ng-if="permissions.READ_ACP" translate="bucketproperty.yes"></span>\n            <span ng-if="!permissions.READ_ACP">-</span>\n        </td>\n        <td>\n            <span ng-if="permissions.WRITE_ACP" translate="bucketproperty.yes"></span>\n            <span ng-if="!permissions.WRITE_ACP">-</span>\n        </td>\n        </awsui-radio-button>\n        </td>\n    </tr>\n    <tr>\n        <storage-console-config-panel id="system-permissions-side-panel" ng-class="{\'side-config-panel acl-side-panel\': panelOpen, \'hide-config-panel acl-side-panel\': panelHide}" panel-open="panelOpen">\n            <header>\n                <div class="truncate side-panel-header bucket-config-panel-header-image">{{ getPublicPermissionDisplayName(selectedGrantee.displayedValue) }}</div>\n                <span class="panel-close-icon" ng-click="panelCancel()"></span>\n                \n            </header>\n            <content>\n                <div class="permissions-side-panel-content">\n                    <awsui-alert visible="getPublicPermissionsWarning().isVisible" class="block small-top-margin" type="warning" dismissible="false" header="{{ getPublicPermissionsWarning().header }}">\n                        {{ getPublicPermissionsWarning().body }}\n                    </awsui-alert>\n                    <p class="subheader" translate="{{resource.type}}.acl.objectaccess"></p>\n                    <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ">{{ readHeader }}</awsui-checkbox>\n                    <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-if="isBucketPermission" ng-model="selectedGrantee.permissions.WRITE">{{ writeHeader }}</awsui-checkbox>\n                    <p class="subheader padding-top-30" translate="{{resource.type}}.acl.permissionsaccess"></p>\n                    <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.READ_ACP">{{ readACPHeader }}</awsui-checkbox>\n                    <awsui-checkbox class="awsui awsui-checkbox panel-checkbox" ng-model="selectedGrantee.permissions.WRITE_ACP">{{ writeACPHeader }}</awsui-checkbox>\n                </div>\n            </content>\n            <footer>\n                <awsui-button id="save-system-permissions" variant="primary" text="{{ \'permissions.button.save\' | translate}}" class="awsui-util-f-r primary-button" click="updateGrantee(selectedGrantee)" loading="updatingGrantee"></awsui-button>\n                <awsui-button id="cancel-system-permissions" variant="normal" text="{{ \'permissions.button.cancel\' | translate}}" class="awsui-util-f-r normal-button" click="panelCancel()"></awsui-button>\n            </footer>\n        </storage-console-config-panel>\n    </tr>\n    </tbody>\n</table>\n</awsui-radio-group>');a.put("/s3/partials/addeventsform.html",'<div class="add-events-body">\n        <translate class="events-label-header">events.label.name</translate>\n        <awsui-tooltip text="{{ \'events.tooltip.name\' | translate }}" position="right" size="small" initialized="true">\n            <i class="awsui-icon alert-info-circle"></i>\n        </awsui-tooltip>\n        <awsui-control-group class="label-text">\n            <awsui-textfield class="input-text" placeholder="{{\'events.placeholder.name\' | translate}}" ng-model="selectedEvent.id" change="cachedSelectedEvents.id=selectedEvent.id"></awsui-textfield>\n        </awsui-control-group>\n        <translate class="events-label-header">events.label.events</translate>\n        <awsui-tooltip text="{{ \'events.tooltip.events\' | translate }}" position="right" size="small" initialized="true">\n            <i class="awsui-icon alert-info-circle"></i>\n        </awsui-tooltip>\n        <awsui-control-group class="checkboxes">\n            <awsui-checkbox ng-repeat="eventType in eventTypes" ng-model="eventsChecked[eventType.complexName]" change="handleCheckboxes()">{{ eventType.simpleName }}\n            </awsui-checkbox>\n        </awsui-control-group>\n        <translate class="events-label-header">events.label.prefix</translate>\n        <awsui-tooltip text="{{ \'events.tooltip.prefix\' | translate }}" position="right" size="small" initialized="true">\n            <i class="awsui-icon alert-info-circle"></i>\n        </awsui-tooltip>\n        <awsui-control-group class="label-text">\n            <awsui-textfield class="input-text" placeholder="{{\'events.placeholder.prefix\' | translate}}" ng-model="selectedEvent.prefix"></awsui-textfield>\n        </awsui-control-group>\n        <translate class="events-label-header">events.label.suffix</translate>\n        <awsui-tooltip text="{{ \'events.tooltip.suffix\' | translate }}" position="right" size="small" initialized="true">\n            <i class="awsui-icon alert-info-circle"></i>\n        </awsui-tooltip>\n        <awsui-control-group class="label-text">\n            <awsui-textfield class="input-text" placeholder="{{\'events.placeholder.suffix\' | translate}}" ng-model="selectedEvent.suffix"></awsui-textfield>\n        </awsui-control-group>\n        <translate class="events-label-header">events.label.sendto</translate>\n        <awsui-tooltip text="{{ \'events.tooltip.sendto\' | translate }}" position="right" size="small" initialized="true">\n            <i class="awsui-icon alert-info-circle"></i>\n        </awsui-tooltip>\n        <awsui-control-group class="label-text" validation-message="{{cardState.listTopicError}}">\n            <awsui-select placeholder="{{ \'addeventmodal.sendtoplaceholder\' | translate }}" items="resourceTypesDropdown" ng-model="selectedEvent.type" change="updateEventResources()"></awsui-select>\n        </awsui-control-group>\n        <awsui-control-group class="label-text" label="{{ selectedEvent.type }}">\n            <awsui-select id="event-resources" items="eventResources" disabled="isLoadingResources || !selectedEvent.type" ng-model="selectValue.value" change="selectChanged()"></awsui-select>\n        </awsui-control-group>\n\n        <awsui-control-group class="label-text" label="{{getCustomArnLabel()}}" ng-if="selectValue.value === S3Constants.EVENTS.CUSTOM">\n            <awsui-textfield class="input-text" placeholder="{{customarn_placeholder}}" ng-model="selectedEvent.arn"></awsui-textfield>\n        </awsui-control-group>\n    </div>');a.put("/s3/partials/analysisexport.html",'<div class="analysis-export-form">\n    <awsui-expandable-section class="export-form-dropdown" header="{{\'management.analytics.export.title\' | translate}}" expanded="editFilter">\n        <div class="export-form-hr"></div>\n        <div class="dropdown-text section">\n            <div class="export-form-labels" translate="report.label.bucket"></div>\n            <bucket-selector class="export-form-bucket" ng-class="{ \'bucket-missing\': data.prefix && !data.bucket.bucket}" selected-report="data.bucket" show-bucket-name-only="true" choose-accounts="true" same-region="true" editable="true" disabled="saving"></bucket-selector>\n            <div class="export-form-labels" translate="report.label.prefix"></div>\n            <awsui-textfield class="export-form-prefix" placeholder="{{ \'management.analytics.export.prefix.placeholder\' | translate}}" ng-keyup="validatePrefix()" data-disabled="saving || !data.bucket.bucket" ng-model="data.prefix"></awsui-textfield>\n\n            <div class="search-prefix-info" ng-if="prefixInfo" translate="" translate-values="{ bucket1 : data.bucket.bucket + \'/\' + prefixInfo, bucket2: data.bucket.bucket + prefixInfo }">prefixsearch.validation.slash.start.warning</div>\n\n            <div class="export-quicksight" translate="management.analytics.quicksight.export" translate-values="{quicksightLink : getQuicksightLink()}" ng-if="showQuicksight">\n            </div>\n        </div>\n    </awsui-expandable-section>\n</div>');a.put("/s3/partials/analytics-area-chart.html",'<div id="{{ chartId }}"></div>');a.put("/s3/partials/analytics.html",'<table class="metrics-content-table">\n\n    <tr>\n        <td class="metrics-content-cell management-side-panel-color">\n            <div class="select-metrics-side-panel">\n                <span class="awsui-icon awsui-spinner awsui-spinner-large config-spinner" ng-if="models.configLoading"></span>\n                <table border="0px" class="select-metrics-table" ng-if="!models.configLoading">\n                    <tr>\n                        <td>\n                            <span class="metrics-header">{{ \'management.view.analytics\' | translate }}</span>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <table class="search-box prefix-search-box">\n                                <tbody>\n                                <tr>\n                                    <td class="search-icon"><i class="awsui-icon search"></i></td>\n                                    <td><input type="text" class="input-field ng-pristine ng-valid ng-empty ng-touched" ng-model="models.searchText" ng-keydown="filterKeyDown($event)" ng-click="searchClicked()" placeholder="{{ \'management.search.placeholder\' | translate }}"></td>\n                                </tr>\n                                </tbody>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="filter-header">\n                            <table class="filters-table-header">\n                                <tr>\n                                    <td>\n                                        <div class="filter-title-analytics" translate="management.metrics.side.filter.header" translate-values="{count: filterList.length}"></div>\n                                    </td>\n                                    <td>\n                                        <div class="filter-add" ng-click="addFilter()">\n                                            <div class="awsui-icon awsui-icon-link plus">\n                                                {{\'management.metrics.side.filter.add\'|translate}}\n                                            </div>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    <tr ng-if="models.showAddFilter">\n                        <td class="bucket-dropdown-config dark">\n                            <table>\n                                <tr>\n                                    <td class="filter-title-cell">\n                                        <div class="filter-add-title">\n                                            {{ models.editFilter ? \'management.metrics.side.filter.dropdown.edit\' :\n                                            \'management.metrics.side.filter.dropdown.add\' | translate}}\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>\n                                        <div class="new-filter-params">\n                                            <div class="new-filter-text">\n                                                {{ \'management.metrics.side.filter.name.title\' | translate }}\n                                            </div>\n                                            <div class="new-filter-input">\n                                                <awsui-control-group validation-message="{{models.filterNameError}}">\n                                                    <awsui-textfield placeholder="{{ \'management.metrics.side.filter.name.placeholder\' | translate}}" ng-keyup="validateFilter()" data-disabled="models.editFilter || models.savingFilter" ng-model="models.filterName"></awsui-textfield>\n                                                </awsui-control-group>\n                                            </div>\n\n                                            <div class="new-filter-text">\n                                                {{ \'management.metrics.side.filter.prefix.optional.title\' | translate }}\n                                            </div>\n                                            <div class="new-filter-input" ng-class="{\'new-filter-input-search\' : models.filterValue || (filters.tagFilters.length + filters.prefixFilters.length) > 0 }">\n                                                <awsui-textarea ng-if="models.editFilter" placeholder="{{ \'management.metrics.side.filter.prefix.placeholder\' | translate}}" ng-keyup="validateFilter()" data-disabled="true" rows="1" ng-model="models.filterValue"></awsui-textarea>\n                                                <search empty="true" filters="filters" no-backend-calls="true" ng-if="!models.editFilter" search-error="models.filterValueError"></search>\n                                            </div>\n\n                                            <div>\n                                                <analytics-export data="exportFilterInfo" saving="models.savingFilter" edit-filter="models.editFilter">\n                                                </analytics-export>\n                                            </div>\n\n                                            <div class="select-analytics-buttons">\n                                                <table>\n                                                    <tr>\n                                                        <td colspan="2">\n                                                            <div class="filter-delete">\n                                                                <awsui-button data-disabled="models.deleteFilter || models.savingFilter" variant="link" ng-click="deleteFilter()" loading="models.deleteFilter" ng-if="models.editFilter" text="{{ \'management.metrics.action.delete\' | translate }}">\n                                                                </awsui-button>\n                                                            </div>\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td class="analytics-button-spacing">\n                                                            <awsui-button variant="primary" text="{{ \'button.save\'   | translate}}" data-disabled="models.savingFilter || models.deleteFilter\n                                                                          || (!models.filterName || models.filterNameError)\n                                                                          || (exportFilterInfo.prefix.length > 0 && !exportFilterInfo.bucket.bucket)" class="normal-button" loading="models.savingFilter" ng-click="saveFilter()"></awsui-button>\n                                                        </td>\n                                                        <td>\n                                                            <awsui-button variant="normal" text="{{ \'button.cancel\' | translate}}" class="normal-button" data-disabled="models.savingFilter || models.deleteFilter" click="cancelFilter()"></awsui-button>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                                <div class="filter-error">\n                                                    <awsui-alert type="error" header="{{\'error.header\'|translate}}" ng-if="models.filterError">{{models.filterError}}\n                                                    </awsui-alert>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    <tr ng-if="!models.showAddFilter && filterList.length > 0" class="filter-header">\n                        <td>\n                            <table class="filters-table">\n                                <tr ng-repeat="row in filterList | filter:models.searchText " ng-class="{\'row-selected\' : row.checked, \'row-hover\': hoverRule && !row.checked}" ng-click="filterChanged(row, $event)" ng-mouseenter="hoverRule = true" ng-mouseleave="hoverRule = false">\n                                    <td>\n                                        <div class="row-checkbox">\n                                            <span class="orange-lightbulb lightbulb-icon" ng-if="!row.recommendation"></span>\n                                            <span class="lightbulb-icon" ng-class="{\'enabled-lightbulb-blue-image\' : !row.checked,\n                                                            \'enabled-lightbulb-white-image\':row.checked}" ng-if="row.recommendation"></span>\n                                        </div>\n                                    </td>\n                                    <td class="filter-name-row">\n                                        <div>\n                                            {{row.Id}}\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <span class="awsui-icon awsui-icon-link pencil buckets-cog" ng-class="{\'awsui-icon-light\': row.checked}" ng-click="addFilter(row)"></span>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr ng-if="!models.showAddFilter && filterList.length === 0">\n                        <td>\n                            <div class="side-panel-metrics-help">\n\n                                <span> {{ \'storageanalysis.empty.additionalInformation\' | translate }}{{ \'management.metrics.cost.paid\' | translate}} </span> <br>\n\n                                <a href="{{ getLearnMoreLink(\'analytics-storage-class\') }}" target="_blank" class="ng-binding" translate="">learn.more</a>\n                                <br>\n                                <br>\n                                <awsui-button data-disabled="false" loading="false" icon="plus" variant="primary" ng-click="addFilter()">\n                                    {{ \'management.metrics.side.filter.add\' | translate }}\n                                </awsui-button>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n        </td>\n        <td class="metrics-content-cell">\n\n            <div class="analytics-content">\n                <div>\n                    <div class="si-top-right-header analytics-padding">\n                        <div class="title labels">\n                            {{ getGroupTitle(S3Constants.METRICS.TYPE.STORAGE) }}\n                        </div>\n                        <div ng-if="quicksightLink">\n                            <a href="{{quicksightLink}}" id="quicksightLink" target="_blank" class="quicksight awsui-icon external-link awsui-icon-light" ng-click="quicksightLinkClicked()" translate="">management.analytics.link.quicksight</a>\n                        </div>\n                    </div>\n\n                    <div class="empty-storage-class-analysis" ng-if="!models.configLoading && !models.savingFilter && !models.deleteFilter && filterList.length === 0">\n                        <span class="no-storage-class-analysis storage-class-analysis-icon"></span>\n                        <div class="empty-header" translate="">storageanalysis.empty.header</div>\n                        <div class="empty-additional-information" translate="">\n                            storageanalysis.empty.additionalInformation\n                        </div>\n                        <table class="empty-buttons">\n                            <tbody>\n                            <tr>\n                                <td>\n                                    <awsui-button variant="link" text="{{ \'storageanalysis.empty.addfilter\' | translate }}" ng-click="addFilter()"></awsui-button>\n                                </td>\n                            </tr>\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <div class="storage-management-error-box">\n                        <awsui-alert type="error" header="{{\'error.header\'|translate}}" ng-if="models.error">{{models.error}}\n                        </awsui-alert>\n                    </div>\n\n                    <div class="storage-management-error-box" ng-if="policyStatus.policyMessage">\n\n                        <awsui-alert id="inventory-policy-message" dismiss="resetPolicyStatus()" type="{{policyStatus.policyType}}" dismissible="true" visible="policyStatus.policyMessage" header="{{policyStatus.policyHeader}}">\n                            <div>{{policyStatus.policyMessage}}\n                                <span>\n                                            <a href="{{getLearnMoreLink(\'analytics-storage-class\')}}" target="_blank" translate="">learn.more</a>\n                                        </span>\n                            </div>\n                            <div class="policy-definition" ng-if="policyStatus.policyDefinition">\n                                <pre>{{policyStatus.policyDefinition}}</pre>\n                            </div>\n                        </awsui-alert>\n                    </div>\n\n                    <div ng-if="!models.configLoading && !models.savingFilter && !models.deleteFilter && filterList.length > 0">\n                        <div class="metrics-loading" ng-if="models.dataLoading">\n                            <span class="awsui-icon awsui-spinner awsui-spinner-large"></span>\n                        </div>\n\n                        <div class="analyzing-data" ng-if="!models.dataLoading && !recommendation">\n                            <div class="info-box">\n                                <table class="info-table">\n                                    <tr>\n                                        <td><span class="info-icon orange-lightbulb lightbulb-icon"></span></td>\n                                        <td class="info-text-cell">\n                                            <div class="info-text" translate="management.analytics.analyzing.title"></div>\n                                            <div class="info-text" translate="management.analytics.analyzing.date" translate-values="{ date: startedOn }" ng-if="allData.data && allData.data.rows && allData.data.rows.length > 0"></div>\n\n                                        </td>\n                                        <td>\n                                            <div class="info-desc" translate="management.analytics.analyzing.desc"></div>\n                                        </td>\n                                    </tr>\n                                </table>\n                            </div>\n\n                            <div class="analyzing-data-no-data" ng-if="!allData.data.rows || allData.data.rows.length == 0 ">\n                                <span class="no-graph-image no-graph-image-class"></span>\n                                <div class="no-data-available" translate="">management.analytics.data.not.available</div>\n                            </div>\n\n                        </div>\n\n                        <div class="analytics-data-analysis" ng-if="!models.dataLoading && allData.data && allData.data.rows && allData.data.rows.length > 0 ">\n                            <div class="info-box" ng-if="recommendation">\n                                <table class="info-table">\n                                    <tr>\n                                        <td><span class="info-icon enabled-lightbulb-blue-image lightbulb-icon lightbulb-adj"></span></td>\n                                        <td class="info-text-cell">\n                                            <div class="info-text" translate="management.analytics.data.info.recommendation.title"></div>\n                                            <div class="info-text" translate="management.analytics.data.info.updated.date" translate-values="{ date: updatedOn }"></div>\n                                        </td>\n                                        <td>\n                                            <div class="info-desc" translate="management.analytics.data.info.recommendation.desc" translate-values="{ range: numDays, rec: recommendation }"></div>\n                                        </td>\n                                    </tr>\n                                </table>\n                            </div>\n\n                            <div class="info-box-storage" ng-repeat="(key, value) in allData.data.all">\n                                <table class="info-table-storage">\n                                    <tr>\n                                        <td class="info-cell-type" translate="{{getClassNameTranslation(key)}}"></td>\n                                        <td class="info-cell-size">\n                                            <div class="info-type" translate="management.analytics.data.size"></div>\n                                            <div class="info-date" translate="management.analytics.data.date" translate-values="{date: getMostRecentDate(value)}"></div>\n                                            <div class="info-gb">{{getMostRecentTotalSize(value)}}</div>\n                                        </td>\n                                        <td class="info-cell-size">\n                                            <div class="info-type" translate="management.analytics.data.retrieved"></div>\n                                            <div class="info-date" translate="management.analytics.data.for" translate-values="{date: getMostRecentDate(value)}"></div>\n                                            <div class="info-gb">{{getMostRecentDataRetrieved(value)}}</div>\n                                        </td>\n                                    </tr>\n                                </table>\n                            </div>\n\n                            <div class="info-question">\n                                <span class="info-icon enabled-lightbulb-blue-image lightbulb-icon-question"></span>\n                                <div class="info-question-text" translate="management.analytics.data.info.retrieved.question">\n                                </div>\n                                <div class="info-storage-select" ng-if="storageOptions">\n                                    <awsui-select items="storageOptions" ng-model="selectedStorageClass.value" ng-change="setSelectedStorageClass()"></awsui-select>\n                                </div>\n                                <div class="info-legend-group">\n                                    <div class="info-legend">\n                                        <div class="info-color-box storage-back"></div>\n                                        <span class="storage-color" translate="storageanalysis.label.storage"></span>\n                                    </div>\n                                    <div class="info-legend">\n                                        <div class="info-color-box data-back"></div>\n                                        <span class="data-color" translate="storageanalysis.label.dataRetrieved"></span>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="info-area-chart">\n                                <analytics-area-chart chart-id="storageAreaChartId" data="graphData.area" height="360" xmin="xmin" xmax="xmax"></analytics-area-chart>\n                            </div>\n\n                            <div class="info-question">\n                                <span class="info-icon enabled-lightbulb-blue-image lightbulb-icon-question"></span>\n                                <div class="info-question-text" translate="management.analytics.data.info.percentage.question">\n                                </div>\n\n                                <div class="info-per-legend">\n                                    <div class="info-dotted-line"></div>\n                                    <div class="info-per-text" translate="management.analytics.data.info.retrieved.label"></div>\n                                </div>\n                            </div>\n\n                            <div class="info-percentage-graph">\n                                <storage-console-line-chart chartid="percentageGraphId" data="graphData.percentage" heading="percentageGraphHeading" isxdate="true" xticks="8" xid="percentageGraphXValue" yid="percentageGraphYValue" xmin="xmin" xmax="xmax" totalwidth="940" totalheight="300" dotted="\'3px\'" color="\'#9066A7\'" pattern="\'3, 3\'" template-url="partials/storageConsoleLineChartAnalytics.html">\n                                </storage-console-line-chart>\n                                <hr class="hr-props">\n                            </div>\n\n                            <div class="info-age-tiers">\n                                <object-frequency-analytics data="allData.data" storage-class="selectedStorageClass"></object-frequency-analytics>\n                            </div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n\n        </td>\n    </tr>\n</table>');a.put("/s3/partials/barchartcard.html",'<div class="bar-chart-card" ng-style="{width: width + \'px\', height: height + \'px\'}">\n    <div class="card-header-text">{{chartTitle}}</div>\n\n    <div id="chart"></div>\n    <hr ng-style="{\'background-color\': colors.row || \'gray\'}" class="line">\n    <div id="footer-layout">\n        <table>\n            <tr ng-if="footer.title">\n                <td class="footer-title">\n                    {{footer.title}}\n                </td>\n            </tr>\n            <tr ng-if="footer.text">\n                <td class="footer-text">\n                    {{footer.text}}\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>');a.put("/s3/partials/breadcrumbs.html",'<div class="breadcrumbs-container">\n    <awsui-breadcrumb-group class="breadcrumbs" ng-if="!condenseBreadcrumbs">\n        <span class="s3-logo-icon logo"></span>\n        <awsui-breadcrumb-item text="{{ \'breadcrumbs.amazons3\' | translate }}" href="/s3/home?region={{currentRegion}}"></awsui-breadcrumb-item>\n        <awsui-breadcrumb-item ng-repeat="object in objects" text="{{object.name}}" href="{{object.path}}"></awsui-breadcrumb-item>\n    </awsui-breadcrumb-group>\n    <awsui-breadcrumb-group class="breadcrumbs" ng-if="condenseBreadcrumbs">\n        <awsui-breadcrumb-item text="{{ \'breadcrumbs.amazons3\' | translate }}" href="/s3/buckets?region={{currentRegion}}"></awsui-breadcrumb-item>\n        <awsui-breadcrumb-item text="...." href=""></awsui-breadcrumb-item>\n        <awsui-breadcrumb-item text="{{objects[objects.length-2].name}}" href="{{objects[objects.length-2].path}}"></awsui-breadcrumb-item>\n        <awsui-breadcrumb-item text="{{objects[objects.length-1].name}}" href="{{objects[objects.length-1].path}}"></awsui-breadcrumb-item>\n    </awsui-breadcrumb-group>\n</div>');a.put("/s3/partials/bucket-replication/bucketreplication.html",'<div ng-if="isLoadingReplication" class="replication-loading"><span class="awsui-spinner awsui-spinner-large"></span></div>\n<div ng-if="!isLoadingReplication" class="replication-page">\n    <awsui-alert type="error" visible="replicationObj.errorMessage">\n        {{replicationObj.errorMessage}}\n    </awsui-alert>\n    <replication-modal ng-if="globalConfigInfo && globalConfigInfo.flag" modal-info="globalConfigInfo" replication-obj="replicationObj" selected-rule="selectedRule"></replication-modal>\n    <div class="action-strip">\n        <awsui-tooltip id="replication-table-disableadd-tooltip" ng-if="checkPrefix()" text="{{\'crr.prefixtooltip\' | translate}}" position="bottom">\n            <awsui-button id="add-rule" class="action-button-spacing" text="{{\'bucketreplication.addnew\' | translate}}" data-disabled="true" icon="plus" ng-click="showReplicationModal(true, checkPrefix(), false)" variant="primary"></awsui-button>\n        </awsui-tooltip>\n        <awsui-button id="add-rule" ng-if="!checkPrefix()" class="action-button-spacing" text="{{\'bucketreplication.addnew\' | translate}}" icon="plus" ng-click="showReplicationModal(true, checkPrefix(), false)" variant="primary"></awsui-button>\n        <awsui-button id="edit-rule" class="action-button-spacing" text="{{ \'bucketreplication.edit\' | translate }}" data-disabled="!selectedRule.flag" ng-click="showReplicationModal(false, false, false)"></awsui-button>\n        <awsui-button id="delete-rule" class="action-button-spacing" text="{{ \'bucketreplication.delete\' | translate }}" data-disabled="!selectedRule.flag" click="deleteRule()"></awsui-button>\n        <action-dropdown class="bucket-more-dropdown" text="{{ \'bucketlifecycle.label.more\' | translate }}" ng-click="triggerMoreDropdown(); $event.stopPropagation();" items="moreOptions" disable-take-action="true"></action-dropdown>\n    </div>\n    <empty-state ng-if="!(replicationObj.ruleSettings.Rule && replicationObj.ruleSettings.Rule.length > 0)" open-modal="showReplicationModal" type="\'replication\'" one-intro-image="oneIntroImage"></empty-state>\n    <awsui-radio-group class="permission-radio-group" ng-model="selectedRule.ruleObj.ID">\n        <table class="table table-condense crr-rule-table" ng-if="replicationObj.ruleSettings.Rule && replicationObj.ruleSettings.Rule.length > 0">\n            <thead class="table-header">\n            <tr>\n                <th></th>\n                <th>\n                    {{\'bucketreplication.source\' | translate}}\n                    <awsui-tooltip text="{{ \'crr.tooltips.crrsource\' | translate }}" position="right" size="small" initialized="true">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </th>\n                <th>\n                    {{\'bucketreplication.status\' | translate}}\n                    <awsui-tooltip text="{{ \'crr.tooltips.rulestatus\'| translate }}" position="right" size="small" initialized="true">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </th>\n                <th>\n                    {{\'bucketreplication.storageclass\' | translate}}\n                    <awsui-tooltip text="{{ \'crr.tooltips.rulestorageclass\'| translate }}" position="right" size="small" initialized="true">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </th>\n            </tr>\n            </thead>\n            <tbody class="table-body">\n            <tr ng-repeat="rule in replicationObj.ruleSettings.Rule" class="grantee-row" ng-click="selectRule(rule); $event.stopPropagation();" ng-class="{\'row-selected\' : selectedRule.flag && selectedRule.ruleObj.ID===rule.ID, \'row-hover\': hoverReplicationRule && !(selectedRule.flag && selectedRule.ruleObj.ID===rule.ID)}" ng-mouseenter="hoverReplicationRule = true" ng-mouseleave="hoverReplicationRule = false">\n                <td ng-click="selectRule(rule); $event.stopPropagation();">\n                    <awsui-radio-button value="{{rule.ID}}">\n                <td class="crr-table-scope-column" ng-if="rule.isEntireBucket === \'true\'"><span translate="bucketreplication.entirebucket"></span></td>\n                <td class="crr-table-scope-column" ng-if="rule.isEntireBucket === \'false\'"><span translate="bucketreplication.prefix" translate-values="{ prefix: \'{{rule.Prefix}}\' }"></span></td>\n                <td class="crr-table-status-column" ng-if="rule.Status === REPLICATION.ENABLED " translate="replicationmodal.sourcestep.enabled"></td>\n                <td class="crr-table-status-column" ng-if="rule.Status === REPLICATION.DISABLED " translate="replicationmodal.sourcestep.disabled"></td>\n                <td class="crr-table-storageclass-column"> {{ rule.Destination.StorageClass.text }} </td>\n                </awsui-radio-button>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    </awsui-radio-group>\n    <replication-modal ng-if="replicationModalInfo && replicationModalInfo.isOpen.flag" modal-info="replicationModalInfo" replication-obj="replicationObj" selected-rule="selectedRule"></replication-modal>\n    <dialog-modal class="rule-confirmation-modal" is-open="confirmationModalObj.isOpen" close-callback="closeConfirmationModal" header-title="confirmationModalObj.title">\n        <dialog-modal-content>\n            <awsui-alert type="warning"> {{ confirmationModalObj.contentText }} </awsui-alert>\n        </dialog-modal-content>\n        <dialog-modal-footer>\n            <awsui-button id="crr-confirmation-cancel" text="{{ \'bucketreplication.cancel\' | translate }}" variant="normal" click="closeConfirmationModal()"></awsui-button>\n            <awsui-button id="crr-confirmation-save" click="saveConfirmation()" variant="primary" text="{{ \'bucketreplication.confirm\' | translate }}" loading="isConfirming" class="awsui-util-f-r primary-button">\n            </awsui-button>\n        </dialog-modal-footer>\n    </dialog-modal>\n</div>');a.put("/s3/partials/bucket-replication/crr-errormodal.html",'<dialog-modal class="replication-confirmation-modal" is-open="modalOpen" close-callback="closeErrorModal" header-title="errorModal.title">\n    <dialog-modal-content>\n        <awsui-alert header="{{errorModal.header}}" type="warning" visible="bucketSelectorObj.destinationBucket.versioningEnabled === false">\n            {{errorModal.contentText}}\n        </awsui-alert>\n        <awsui-button ng-if="bucketSelectorObj.destinationBucket.versioningEnabled === false" variant="primary" text="{{ \'crr.errormodal.enableversioning\' | translate }}" class="primary-button" click="enableDestinationVersioning()" loading="isEnablingVersioning.flag"></awsui-button>\n        <awsui-alert header="{{\'crr.warningmsg.content.cannotenableversioning\' | translate}}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.enabledVersioningError"><span translate="crr.warningmsg.detail.cannotenableversioning"></span></awsui-alert>\n        <awsui-alert header="{{\'crr.warningmsg.content.bucketnotexist\' | translate}}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.bucketNotExistError"></awsui-alert>\n        <awsui-alert header="{{\'crr.warningmsg.content.sameregion\' | translate }}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.generalErrors"></awsui-alert>\n        <div ng-if="bucketSelectorObj.destinationBucket.Errors.enabledVersioningError || bucketSelectorObj.destinationBucket.Errors.getVersioningError">\n            <span class="text-color-light" translate="crr.confirmationmodal.bucketpolicytitle"></span>\n            <div class="copy-message">\n                <awsui-button text="{{ \'crr.globalconfig.copypolicy\' | translate }}" variant="link" class="dark crr-copy-button" ng-click="copyPolicyToClipboard(bucket.name, copyFinished, true, true)"></awsui-button>\n                <span class="copied-msg" ng-class="{ \'fade-in\' : copyFinished.flag === true, \'fade-out\' : copyFinished.flag === false, \'hide-msg\' : copyFinished.flag === null}" translate="copytoclipboard.path"></span>\n            </div>\n            <div class="crr-modal-editor" ui-ace="{ useWrapMode : true, showGutter: true, mode: \'json\', firstLineNumber: 1, onLoad: policyEditorLoaded}" class="code" readonly="true"></div>\n        </div>\n    </dialog-modal-content>\n    <dialog-modal-footer>\n        <awsui-button click="closeErrorModal()" variant="normal" text="{{ \'crr.errormodal.close\' | translate }}" class="awsui-util-f-r primary-button">\n        </awsui-button>\n    </dialog-modal-footer>\n</dialog-modal>');a.put("/s3/partials/bucket-replication/crr-globalsettings.html",'<div ng-if="modalInfo.isEditing" class="global-settings-background"></div>\n<div class="global-settings wrapper">\n    <table class="global-setting-table">\n        <thead>\n        <th>\n            <p class="section-title" translate="crr.globalconfig.source.title"></p>\n            <div class="divider"></div>\n        </th>\n        <th>\n            <p class="section-title" translate="crr.globalconfig.destination.title"></p>\n            <div class="divider"></div>\n        </th>\n        <th>\n            <p class="section-title" translate="crr.globalconfig.permissions.title"></p>\n            <div class="divider"></div>\n        </th>\n        </thead>\n        <tbody>\n        <tr class="global-setting-title">\n            <td translate="crr.globalconfig.sourcescope">\n            </td>\n            <td translate="crr.globalconfig.dstbucket">\n            </td>\n            <td translate="crr.globalconfig.iamroletitle">\n            </td>\n        </tr>\n        <tr>\n            <td class="value-display bold-text" ng-if="!modalInfo.isEditing">\n                <div id="crr-global-display-entirebucket" ng-if="modalInfo.prefixOrWholeBucket.value === modalInfo.ENTIRE_BUCKET" translate="crr.globalconfig.source.entirebucket"></div>\n                <div id="crr-global-display-prefix" ng-if="modalInfo.prefixOrWholeBucket.value === modalInfo.PREFIX" translate="crr.globalconfig.source.prefix"></div>\n            </td>\n            <td class="value-display" ng-if="modalInfo.isEditing">\n                <div><dropdown id="crr-global-changescope-dropdown" items="modalInfo.prefixOrWholeBucketOptions" selected-item="modalInfo.prefixOrWholeBucket" placeholder="{{ \'createbucketmodal.placeholder.region\' | translate }}"></dropdown></div>\n            </td>\n            <td id="crr-global-display-destBucket" class="value-display bold-text" ng-if="!modalInfo.isEditing">\n                {{replicationObj.globalSettings.destinationBucket.name}}\n            </td>\n            <td class="value-display" ng-if="modalInfo.isEditing">\n                <div>\n                    <bucket-selector class="replication-modal-bucketselector" show-bucket-name-only="true" choose-accounts="true" editable="true" bucket-replication="bucketSelectorObj"></bucket-selector>\n                    <div class="createbucketbodycontent" ng-if="bucketSelectorObj.destinationBucket.createNewDestBucket">\n                        <div class="name-title">\n                            <span translate="createbucketmodal.label.name"></span>\n                            <awsui-tooltip text="{{\'createbucketmodal.bucketname.tooltip\' | translate}}" position="bottom" size="small">\n                                <i class="awsui-icon alert-info-circle info-circle"></i>\n                            </awsui-tooltip>\n                        </div>\n                        <div class="bucketname-and-region">\n                            <awsui-control-group>\n                        <span dom-region="validationMessage" ng-if="bucketSelectorObj.destinationBucket.bucketNameValidationErrors.length > 0">\n                            <label ng-repeat="message in bucketSelectorObj.destinationBucket.bucketNameValidationErrors">{{message}}</label><br>\n                        </span>\n                                <span dom-region="control">\n                            <awsui-textfield class="create-bucket-modal-input" autocomplete="true" ng-keyup="validateBucketName()" placeholder="{{\'createbucketmodal.placeholder.name\' | translate}}" ng-model="bucketSelectorObj.destinationBucket.name">\n                            </awsui-textfield>\n                        </span>\n                            </awsui-control-group>\n                        </div>\n                        <div class="region-title">\n                            <span translate="createbucketmodal.label.region"></span>\n                        </div>\n                        <dropdown items="modalInfo.regions" selected-item="bucketSelectorObj.destinationBucket.region" placeholder="{{ \'createbucketmodal.placeholder.region\' | translate }}" filter="true"></dropdown>\n                    </div>\n                </div>\n            </td>\n            <td id="crr-global-display-iamrole" class="value-display bold-text" ng-if="!modalInfo.isEditing">\n                {{replicationObj.globalSettings.Role.text}}\n            </td>\n            <td class="value-display" ng-if="modalInfo.isEditing">\n                <div>\n                    <dropdown id="crr-global-iamrole-selector" items="modalInfo.iamRoles" selected-item="tmpReplicationObj.Role" placeholder="{{ \'createbucketmodal.placeholder.region\' | translate }}" filter="true"></dropdown>\n                </div>\n            </td>\n        </tr>\n        <tr class="global-setting-title" ng-class="{ \'global-title-editing\': modalInfo.isEditing }">\n            <td translate="crr.globalconfig.sourceregion"></td>\n            <td><span ng-if="!modalInfo.isEditing" translate="crr.globalconfig.sourceregion"></span></td>\n            <td translate="crr.globalconfig.bucketpolicytitle"></td>\n        </tr>\n        <tr>\n            <td class="value-display bold-text">{{replicationObj.globalSettings.sourceBucket.region}}</td>\n            <td class="value-display bold-text"><span ng-if="!modalInfo.isEditing">{{replicationObj.globalSettings.destinationBucket.region}}</span></td>\n            <td class="value-display bold-text">\n                <div class="global-config-copybutton">\n                    <awsui-button variant="link" text="{{ \'crr.globalconfig.copypolicy\' | translate }}" ng-click="copyPolicyToClipboard(tmpReplicationObj.Destination.Bucket.name, copyFinished, true, true)"></awsui-button>\n                    <span class="copied-msg" ng-class="{ \'fade-in\' : copyFinished.flag === true, \'fade-out\' : copyFinished.flag === false, \'hide-msg\' : copyFinished.flag === null}" translate="copytoclipboard.path"></span>\n                </div>\n            </td>\n        </tr>\n        <tr>\n            <td></td>\n            <td class="error-display">\n                <table class="global-config-warning" ng-if="bucketSelectorObj.destinationBucket.versioningEnabled === false && !bucketSelectorObj.destinationBucket.Errors.getVersioningError && !bucketSelectorObj.destinationBucket.Errors.enabledVersioningError " ng-click="showGlobalConfigErrorModal(\'disabled\')">\n                    <tr>\n                        <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                        <td class="warning-text" translate="crr.warningmsg.content.notenabled"></td>\n                    </tr>\n                </table>\n                <table class="global-config-warning" ng-if="bucketSelectorObj.destinationBucket.Errors.getVersioningError" ng-click="showGlobalConfigErrorModal(\'getFailure\')">\n                    <tr>\n                        <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                        <td class="warning-text" translate="crr.warningmsg.content.cannotdetectversioning"></td>\n                    </tr>\n                </table>\n                <table class="global-config-warning" ng-if="bucketSelectorObj.destinationBucket.Errors.enabledVersioningError" ng-click="showGlobalConfigErrorModal(\'saveFailure\')">\n                    <tr>\n                        <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                        <td class="warning-text" translate="crr.warningmsg.content.cannotenableversioning"></td>\n                    </tr>\n                </table>\n                <table class="global-config-warning non-clickable" ng-if="bucketSelectorObj.destinationBucket.Errors.bucketNotExistError">\n                    <tr>\n                        <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                        <td class="warning-text" translate="crr.warningmsg.content.bucketnotexist"></td>\n                    </tr>\n                </table>\n                <table class="global-config-warning non-clickable" ng-if="bucketSelectorObj.destinationBucket.Errors.generalErrors">\n                    <tr>\n                        <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                        <td class="warning-text">{{bucketSelectorObj.destinationBucket.Errors.generalErrors}}</td>\n                    </tr>\n                </table>\n            </td>\n            <td class="error-display">\n                <div ng-if="modalInfo.modalError.listRoleError" class="alert-exclamation-triangle awsui-icon awsui-icon-big global-config-errors">\n                    {{modalInfo.modalError.listRoleError}}\n                </div>\n            </td>\n        </tr>\n        </tbody>\n    </table>\n    <div class="config-sections global-config-buttons">\n        <div class="global-setting-buttons">\n            <div class="config-buttons">\n                <awsui-button id="crr-global-enable-editing-button" ng-if="!modalInfo.isEditing" variant="link" ng-click="enableEditGlobalConfig()">\n                    <span translate="crr.globalconfig.editglobalsettings"></span>\n                </awsui-button>\n                <awsui-button id="crr-global-cancel" ng-if="modalInfo.isEditing" text="{{ \'crr.globalsettings.cancel\' | translate }}" variant="normal" click="cancelModifyGlobalConfig()"></awsui-button>\n                <awsui-button ng-if="modalInfo.isEditing" click="savePressed()" variant="primary" text="{{ \'crr.globalsettings.save\' | translate }}" loading="isSaving.flag" class="primary-button" id="crr-global-save">\n                </awsui-button>\n            </div>\n            <table class="global-config-errors" ng-if="modalInfo.modalError.saveError">\n                <tr>\n                    <td class="alert-exclamation-triangle awsui-icon awsui-icon-big warning-icon"></td>\n                    <td class="warning-text">{{modalInfo.modalError.saveError}}</td>\n                </tr>\n            </table>\n        </div>\n    </div>\n</div>\n<crr-error-modal ng-if="errorModal.isOpen.flag" bucket-selector-obj="bucketSelectorObj" modal-open="errorModal.isOpen" bucket="tmpReplicationObj.Destination.Bucket" error-type="errorType" copy-policy-to-clipboard="copyPolicyToClipboard">\n</crr-error-modal>');a.put("/s3/partials/bucket-replication/replicationmodal.html",'<crr-global-settings ng-if="modalInfo.flag" bucket-selector-obj="bucketSelectorObj" replication-obj="replicationObj" tmp-replication-obj="tmpReplicationObj" modal-info="modalInfo" selected-rule="selectedRule"></crr-global-settings>\n<modal class="replication-modal" is-open="modalInfo.isOpen" steps="STEP" state="state" close-callback="closeReplicationModal" header-title="headerTitle" next-state="nextState" previous-state="previousState" set-state="setState">\n    <modal-content>\n        <div class="replication-modal-content">\n            <div class="body-content" ng-if="state === STEP.SOURCE">\n                <div ng-if="!modalState.showSourceVersioningWarning">\n                    <p class="subheader" translate="replicationmodal.label.source"></p>\n                    <div class="modal-content-divider"></div>\n                    <div class="upper-section">\n                        <awsui-radio-group ng-model="tmpReplicationObj.isEntireBucket">\n                            <awsui-tooltip class="replication-modal-disabledradio-tooltip" ng-if="replicationObj.ruleSettings.Rule && (!replicationObj.globalSettings.isEntireBucket && !modalInfo.isOverride || modalInfo.isOverride && modalInfo.prefixOrWholeBucket.value === modalInfo.PREFIX)" text="{{\'crr.prefixtooltip\' | translate}}" position="bottom">\n                                <awsui-radio-button value="true" disabled="true" id="crr-modal-disabled-entirebucket-button">\n                                    <span translate="replicationmodal.sourcestep.entirebucketradiobutton.disabled" translate-values="{ sourceBucket: replicationObj.globalSettings.sourceBucket.name }"></span>\n                                </awsui-radio-button>\n                            </awsui-tooltip>\n                            <awsui-radio-button id="entirebucket-radiobtn" ng-if="!replicationObj.ruleSettings.Rule || !(!replicationObj.globalSettings.isEntireBucket && !modalInfo.isOverride || modalInfo.isOverride && modalInfo.prefixOrWholeBucket.value === modalInfo.PREFIX)" value="true" disabled="false">\n                                <span translate="replicationmodal.sourcestep.entirebucketradiobutton.enabled" translate-values="{ sourceBucket: replicationObj.globalSettings.sourceBucket.name }"></span>\n                            </awsui-radio-button>\n                            <awsui-tooltip class="replication-modal-disabledradio-tooltip" id="crr-modal-disabled-prefix-tooltip" ng-if="replicationObj.ruleSettings.Rule && (replicationObj.globalSettings.isEntireBucket && !modalInfo.isOverride || modalInfo.isOverride && modalInfo.prefixOrWholeBucket.value === modalInfo.ENTIRE_BUCKET)" text="{{\'crr.prefixtooltip\' | translate}}" position="bottom">\n                                <awsui-radio-button value="false" disabled="true"><span class="text-disabled" translate="replicationmodal.sourcestep.prefixinbucket"></span></awsui-radio-button>\n                            </awsui-tooltip>\n                            <awsui-radio-button id="prefix-radiobtn" ng-if="!replicationObj.ruleSettings.Rule || !(replicationObj.globalSettings.isEntireBucket && !modalInfo.isOverride || modalInfo.isOverride && modalInfo.prefixOrWholeBucket.value === modalInfo.ENTIRE_BUCKET)" value="false" disabled="false"><span translate="replicationmodal.sourcestep.prefixinbucket"></span></awsui-radio-button>\n                            <awsui-control-group validation-message="{{ modalInfo.modalError.inputPrefixError }}">\n                                <awsui-textfield ng-if="tmpReplicationObj.isEntireBucket === \'false\'" class="replication-modal-input" ng-keydown="resetInputPrefixError()" ng-keyup="checkInputPrefix(tmpReplicationObj.Prefix)" placeholder="{{\'replicationmodal.placeholder.prefix\' | translate}}" ng-model="tmpReplicationObj.Prefix"></awsui-textfield>\n                            </awsui-control-group>\n                        </awsui-radio-group>\n                    </div>\n                    <p class="subheader" translate="replicationmodal.sourcestep.rulestatus"></p>\n                    <div class="modal-content-divider"></div>\n                    <awsui-radio-group ng-model="tmpReplicationObj.Status">\n                        <awsui-radio-button id="crr-status-enabled" value="Enabled" label="{{\'replicationmodal.sourcestep.enabled\' | translate}}"></awsui-radio-button>\n                        <awsui-radio-button id="crr-status-disabled" value="Disabled" label="{{\'replicationmodal.sourcestep.disabled\' | translate}}"></awsui-radio-button>\n                    </awsui-radio-group>\n\n                </div>\n                <div ng-if="modalState.showSourceVersioningWarning">\n                    <awsui-alert header="{{ \'crr.warningmsg.content.notenabled\' | translate}}" type="warning" visible="modalInfo.modalError.sourceVersioning === null">\n                        <span translate="crr.warningmsg.detail.notenabled "></span>\n                    </awsui-alert>\n                    <awsui-button id="crr-modal-enablesourceversioning-button" variant="primary" text="{{ \'replicationmodal.destinationstep.enableversioningbutton\' | translate }}" class="primary-button" click="enableSourceVersioning()" loading="isEnablingSourceVersioning"></awsui-button>\n                    <awsui-alert header="{{\'error.header\' | translate}}" type="error" visible="modalInfo.modalError.sourceVersioning !== null">{{modalInfo.modalError.sourceVersioning}}</awsui-alert>\n                </div>\n            </div>\n            <div class="body-content" ng-if="state === STEP.DESTINATION">\n                <div class="upper-section">\n                    <p class="subheader" translate="replicationmodal.destinationstep.bucket"></p>\n                    <awsui-button ng-if="modalInfo.showChangeDestinationBtn" variant="link" class="dark change-bucket-button" ng-click="hideChangeDestinationBtn()" text="{{ \'replicationmodal.destinationstep.changebutton\' | translate}}"></awsui-button>\n                    <div class="modal-content-divider"></div>\n                    <div class="upper-section" ng-if="modalInfo.showChangeDestinationBtn">\n                        <div class="truncate"><span class="text-color-light">{{ tmpReplicationObj.Destination.Bucket.name}}</span></div>\n                    </div>\n                    <div ng-if="!modalInfo.showChangeDestinationBtn">\n                        <bucket-selector class="replication-modal-bucketselector" id="crr-modal-dstbucket-selector" show-bucket-name-only="true" choose-accounts="true" editable="true" bucket-replication="bucketSelectorObj" is-open="selectingBucket.selected">\n                        </bucket-selector>\n                        <awsui-alert type="warning" visible="showOverrideDestWarning"><span translate="replicationmodal.destinationstep.overridemsg"></span></awsui-alert>\n                        <awsui-alert header="{{ \'crr.warningmsg.content.notenabled\' | translate }}" type="warning" visible="bucketSelectorObj.destinationBucket.versioningEnabled === false"><span translate="crr.warningmsg.detail.notenabled"></span></awsui-alert>\n                        <awsui-alert header="{{ \'crr.warningmsg.content.cannotdetectversioning\' | translate }}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.getVersioningError"><span translate="crr.warningmsg.detail.cannotdetectversioning"></span></awsui-alert>\n                        <awsui-button ng-if="bucketSelectorObj.destinationBucket.versioningEnabled === false" id="crr-modal-enable-dstbucketversioning-button" variant="primary" text="{{\'replicationmodal.destinationstep.enableversioningbutton\' | translate}}" class="primary-button" click="enableDestinationVersioning()" loading="isEnablingDestinationVersioning.flag"></awsui-button>\n                        <awsui-alert header="{{\'crr.warningmsg.content.cannotenableversioning\' | translate}}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.enabledVersioningError"><span translate="crr.warningmsg.detail.cannotenableversioning"></span></awsui-alert>\n                        <awsui-alert header="{{ \'crr.warningmsg.content.bucketnotexsit\' | translate}}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.bucketNotExistError"><span translate="crr.warningmsg.content.bucketnotexist"></span></awsui-alert>\n                        <awsui-alert header="{{ \'crr.warningmsg.content.sameregion\' | translate }}" type="warning" visible="bucketSelectorObj.destinationBucket.Errors.generalErrors">{{bucketSelectorObj.destinationBucket.Errors.generalErrors}}</awsui-alert>\n                    </div>\n                    <div class="createbucketbodycontent" ng-if="bucketSelectorObj.destinationBucket.createNewDestBucket">\n                        <p class="label" translate="createbucketmodal.label.name"></p>\n                        <awsui-tooltip text="{{\'createbucketmodal.bucketname.tooltip\' | translate}}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle info-circle"></i>\n                        </awsui-tooltip>\n                        <div class="bucketname-and-region"><awsui-control-group>\n                            <span dom-region="validationMessage" ng-if="bucketSelectorObj.destinationBucket.bucketNameValidationErrors.length > 0">\n                                <label ng-repeat="message in bucketSelectorObj.destinationBucket.bucketNameValidationErrors">{{message}}</label><br>\n                            </span>\n                                <span dom-region="control">\n                                <awsui-textfield id="bucket-name" class="create-bucket-modal-input" ng-keyup="validateBucketName()" placeholder="{{\'createbucketmodal.placeholder.name\' | translate}}" ng-model="bucketSelectorObj.destinationBucket.name"></awsui-textfield>\n                            </span></awsui-control-group>\n                        </div>\n                        <p class="label" translate="createbucketmodal.label.region"></p>\n                        <dropdown items="modalInfo.regions" class="crr-modal-region-dropdown" selected-item="bucketSelectorObj.destinationBucket.region" placeholder="{{ \'createbucketmodal.placeholder.region\' | translate }}" filter="true"></dropdown>\n                    </div>\n                </div>\n                <div>\n                    <p class="subheader" translate="replicationmodal.destinationstep.options"></p>\n                    <div class="modal-content-divider"></div>\n                    <awsui-checkbox id="crr-modal-changestorageclass" ng-model="tmpReplicationObj.Destination.changeDefaultStorageClass" checked="tmpReplicationObj.Destination.changeDefaultStorageClass" ng-change="resetStorageClassValue()">\n                        <span translate="replicationmodal.destinationstep.storageclasstext"></span>\n                    </awsui-checkbox>\n                    <awsui-select id="crr-modal-storageclass-selector" ng-if="tmpReplicationObj.Destination.changeDefaultStorageClass" placeholder="{{ \'replication.placeholder.storageclass\' | translate }}" ng-model="tmpReplicationObj.Destination.StorageClass.value" ng-change="updateStorageClassText(tmpReplicationObj.Destination.StorageClass.value)" items="storageClasses"></awsui-select>\n                </div>\n            </div>\n            <div class="body-content" ng-if="state === STEP.PERMISSIONS">\n                <div class="upper-section">\n                    <p class="subheader" translate="replicationmodal.permissionstep.selectrole"></p>\n                    <awsui-button ng-if="modalInfo.showChangeRoleBtn" variant="link" class="dark change-role-button" ng-click="hideChangeRoleBtn()" text="{{\'replicationmodal.permissionstep.changebutton\' | translate}}"></awsui-button>\n                    <div class="modal-content-divider"></div>\n                    <div class="upper-section" ng-if="modalInfo.showChangeRoleBtn">\n                        <div class="truncate"><span class="text-color-light">{{tmpReplicationObj.Role.text}}</span></div>\n                    </div>\n                    <div ng-if="!modalInfo.showChangeRoleBtn">\n                        <dropdown class="iamrole-dropdown" items="modalInfo.iamRoles" selected-item="tmpReplicationObj.Role" placeholder="{{ \'replicationmodal.permissionstep.roleplaceholder\' | translate }}" filter="true"></dropdown>\n                        <awsui-alert type="warning" visible="showOverrideDestWarning"><span translate="replicationmodal.permissionstep.overriderolewarning"></span></awsui-alert>\n                    </div>\n                    <awsui-alert type="error" visible="modalInfo.modalError.listRoleError">\n                        {{modalInfo.modalError.listRoleError}}\n                    </awsui-alert>\n                </div>\n                <div ng-if="showBucketPolicyTemplate">\n                    <p class="subheader" translate="replicationmodal.permissionstep.bucketpolicyheader"></p>\n                    <div class="modal-content-divider"></div>\n                    <p translate="replicationmodal.permissionstep.bucketpolicytext"></p>\n                    <span class="text-color-light" translate="replicationmodal.permissionstep.bucketpolicyheader"></span>\n                    <div class="copy-message">\n                        <awsui-button text="{{ \'crr.globalconfig.copypolicy\' | translate }}" variant="link" class="dark crr-copy-button" ng-click="copyPolicyToClipboard(tmpReplicationObj.Destination.Bucket.name, copyFinished); $event.stopPropagation();"></awsui-button>\n                        <span class="copied-msg" ng-class="{ \'fade-in\' : copyFinished.flag === true, \'fade-out\' : copyFinished.flag === false, \'hide-msg\' : copyFinished.flag === null}" translate="replicataionmodal.copiedtoclipboard"></span>\n                    </div>\n                    <div class="crr-modal-editor" ui-ace="{ useWrapMode : true, showGutter: true, mode: \'json\', firstLineNumber: 1, onLoad: policyEditorLoaded}" class="code" readonly="true"></div>\n                </div>\n            </div>\n            <div class="body-content" ng-if="state === STEP.REVIEW">\n                <table class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="replicationmodal.reviewstep.sourcetitle"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" ng-click="setState(STEP.SOURCE)"></awsui-button></td>\n                    </tr>\n                </table>\n                <table class="crr-modal-review-table">\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.sourcepart.bucket"></td>\n                        <td id="crr-modal-review-sourcebucket" class="review-value">{{ replicationObj.globalSettings.sourceBucket.name}}</td>\n                    </tr>\n                    <tr>\n                        <td class="review-title"></td>\n                        <td class="review-value">\n                            <span ng-if="tmpReplicationObj.isEntireBucket===\'true\'" translate="replicationmodal.reviewstep.entirebucket"></span>\n                            <span ng-if="tmpReplicationObj.isEntireBucket === \'false\'" translate="replicationmodal.reviewstep.prefix" translate-values="{prefix: tmpReplicationObj.Prefix}"></span>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.sourcepart.region"></td>\n                        <td class="review-value">{{ replicationObj.globalSettings.sourceBucket.region}}</td>\n                    </tr>\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.status"></td>\n                        <td ng-if="tmpReplicationObj.Status === REPLICATION.ENABLED" class="review-value" translate="{{\'replicationmodal.sourcestep.enabled\' | translate}}"></td>\n                        <td ng-if="tmpReplicationObj.Status === REPLICATION.DISABLED" class="review-value" translate="{{\'replicationmodal.sourcestep.disabled\' | translate}}"></td>\n                    </tr>\n                </table>\n                <table class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="replicationmodal.reviewstep.destinationtitle"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" ng-click="setState(STEP.DESTINATION)"></awsui-button></td>\n                    </tr>\n                </table>\n                <table class="crr-modal-review-table">\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.destpart.bucket"></td>\n                        <td id="crr-modal-review-dstbucket" class="review-value">{{ tmpReplicationObj.Destination.Bucket.name }}</td>\n                    </tr>\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.destpart.region"></td>\n                        <td class="review-value">{{ tmpReplicationObj.Destination.Bucket.region }}</td>\n                    </tr>\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.destpart.storageclass"></td>\n                        <td id="crr-modal-review-dststorageclass" class="review-value">{{tmpReplicationObj.Destination.StorageClass.text}}</td>\n                    </tr>\n                </table>\n                <table class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="replicationmodal.reviewstep.permissionstitle"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" ng-click="setState(STEP.PERMISSIONS)"></awsui-button></td>\n                    </tr>\n                </table>\n                <table class="crr-modal-review-table crr-modal-review-iamrole-table">\n                    <tr>\n                        <td class="review-title" translate="replicationmodal.reviewstep.iamrole"></td>\n                        <td id="crr-modal-review-iamrole" class="review-value">{{tmpReplicationObj.Role.text}}</td>\n                    </tr>\n                </table>\n                <div class="review-policy" ng-if="showBucketPolicyTemplate">\n                    <div class="copy-message">\n                        <awsui-button text="{{ \'crr.globalconfig.copypolicy\' | translate }}" variant="link" class="dark crr-copy-button" ng-click="copyPolicyToClipboard(tmpReplicationObj.Destination.Bucket.name, copyFinished)"></awsui-button>\n                        <span class="copied-msg" ng-class="{ \'fade-in\' : copyFinished.flag === true, \'fade-out\' : copyFinished.flag === false, \'hide-msg\' : copyFinished.flag === null}" translate="copytoclipboard.path"></span>\n                    </div>\n                    <awsui-expandable-section id="expand-bucket-policy" class="dark" header="Bucket Policy" ng-click="scrollIntoView(\'expand-bucket-policy\')">\n                        <div class="crr-modal-editor" ui-ace="{ useWrapMode : true, showGutter: true, mode: \'json\', firstLineNumber: 1, onLoad: policyEditorLoaded}" class="code" readonly="true"></div>\n                    </awsui-expandable-section>\n                </div>\n                <awsui-alert visible="modalInfo.modalError.saveError" class="block small-top-margin crr-save-error" type="error" dismissible="false" header="{{ \'error.header\' | translate }}"> {{ modalInfo.modalError.saveError }}\n                </awsui-alert>\n            </div>\n        </div>\n    </modal-content>\n    <modal-footer>\n        <div class="replication-modal-footer" transclude-name="footer">\n            <awsui-button id="next-step" ng-if="state !== STEP.REVIEW" data-disabled="!modalState.showNext || tmpReplicationObj.isEntireBucket===null || state === STEP.SOURCE && tmpReplicationObj.isEntireBucket===\'false\' && (!tmpReplicationObj.Prefix\n                          || modalInfo.modalError.inputPrefixError) || state === STEP.DESTINATION && ( bucketSelectorObj.destinationBucket.Errors.bucketNotExistError || bucketSelectorObj.destinationBucket.Errors.generalErrors || bucketSelectorObj.destinationBucket.createNewDestBucket && bucketSelectorObj.destinationBucket.bucketNameValidationErrors.length > 0 || !bucketSelectorObj.destinationBucket.name\n                          || bucketSelectorObj.destinationBucket.createNewDestBucket && !bucketSelectorObj.destinationBucket.region\n                          || !tmpReplicationObj.Destination.StorageClass.value && tmpReplicationObj.Destination.changeDefaultStorageClass\n                          || bucketSelectorObj.destinationBucket.versioningEnabled === false && !bucketSelectorObj.destinationBucket.Errors.getVersioningError && !bucketSelectorObj.destinationBucket.Errors.enabledVersioningError)\n                          || state === STEP.PERMISSIONS && !tmpReplicationObj.Role.text" variant="primary" text="{{ \'replicationmodal.reviewstep.next\' | translate }}" class="awsui-util-f-r primary-button" click="nextCRRStep()">\n            </awsui-button>\n            <awsui-button id="save-rule" ng-if="state === STEP.REVIEW" click="savePressed()" loading="isSaving.flag" variant="primary" text="{{ \'replicationmodal.reviewstep.save\' | translate }}" class="awsui-util-f-r primary-button">\n            </awsui-button>\n            <awsui-button id="cancel-rule" text="{{ \'replicationmodal.reviewstep.cancel\' | translate }}" variant="normal" ng-if="state === STEP.SOURCE" class="awsui-util-f-r" click="closeReplicationModal()">\n            </awsui-button>\n            <awsui-button id="previous-step" text="{{ \'replicationmodal.reviewstep.previous\' | translate }}" variant="normal" ng-if="state !== STEP.SOURCE" data-disabled="isSaving.flag" class="awsui-util-f-r" click="previousState(); copyFinished.flag=null">\n            </awsui-button>\n        </div>\n    </modal-footer>\n</modal>');a.put("/s3/partials/bucketaccelerate.html",'<card card-id="scrollCardId" card-summary-obj="cardSummaryObj" is-open="cardOpen" ng-class="{ \'card-disable-bolt-water-mark\': !cardOpen, \'card-enable-bolt-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.label.accelerate"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelBucketAccelerate($event)"></div>\n    </card-header>\n    <card-content>\n        <p ng-if="!cardOpen" class="bucketproperties-summary" translate="bucketproperties.summary.accelerate"></p>\n        <p class="accelerate-endpoint" ng-if="cardOpen" translate="bucketproperties.acceleration.endpoint" translate-values="{ endpoint: \'{{accelerate.endpoint}}\' }"></p>\n        <p class="accelerate-description" ng-if="cardOpen" translate="bucketproperties.description.accelerate"></p>\n        <a class="accelerate-compare" ng-if="cardOpen" target="_blank" href="{{comparisonEndpoint}}" translate="bucketproperties.compare.accelerate"></a>\n        <div ng-if="cardOpen" class="padding-bottom-20"></div>\n        <div class="awsui-container" ng-if="cardOpen">\n            <awsui-radio-group ng-model="accelerate.selectedValue">\n                <div class="awsui-row card-content-row">\n                    \n                    <awsui-radio-button class="enableAccelerate" value="Enabled" ng-model="accelerate.selectedValue" label="{{ \'bucketproperty.enabled\' | translate }}"></awsui-radio-button>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-button class="suspendAccelerate" value="Suspended" ng-model="accelerate.selectedValue" label="{{ \'bucketproperty.suspended\' | translate }}">\n                    </awsui-radio-button>\n                </div>\n            </awsui-radio-group>\n        </div>\n        <awsui-alert type="error" class="error-alert" ng-if="error && cardOpen"> {{ error }}</awsui-alert>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{learnMoreLink}}" translate="">learn.more</a>\n        <div ng-if="cardOpen" class="padding-bottom-20"></div>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="cancel-bucket-accelerate" ng-click="cancelBucketAccelerate($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-accelerate" ng-click="saveBucketAccelerate($event)" text="{{ \'button.save\' | translate }}" variant="primary" loading="saving"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/bucketconfirmationmodal.html",'<div class="confirmation-modal">\n    <dialog-modal class="bucket-confirmation-modal" is-open="isOpen" close-callback="closeConfirmationModal()" header-title="headerTitle">\n        <dialog-modal-content>\n            <awsui-alert class="confirmation-warning" visible="!showContinue" type="warning"> {{ warningMessage }} </awsui-alert>\n            <p class="label"> {{ \'confirmationmodal.typebucketname\' | translate }} </p>\n            <awsui-textfield ng-keydown="compareBucketNames($event)" class="bucket-name" ng-model="confirmationModal.bucketName"></awsui-textfield>\n            <awsui-alert class="confirmation-warning" type="warning" dismissable="true" ng-if="isDelete">\n                {{ \'confirmationmodal.uniquebucketwarning\' | translate }}\n            </awsui-alert>\n            <awsui-alert class="confirmation-warning" type="error" dismissible="false" visible="showIncorrectBucketError">\n                {{ \'confirmationmodal.incorrectbucketerror\' | translate }}\n            </awsui-alert>\n        </dialog-modal-content>\n        <dialog-modal-footer>\n            <awsui-button id="cancel" text="{{ \'createbucketmodal.footer.cancel\' | translate }}" variant="normal" click="closeConfirmationModal()"></awsui-button>\n            <awsui-button id="save" click="saveOperation()" variant="primary" text="{{ \'confirmationmodal.footer.confirm\' | translate }}" class="awsui-util-f-r primary-button">\n            </awsui-button>\n        </dialog-modal-footer>\n    </dialog-modal>\n</div>');a.put("/s3/partials/bucketdetails.html",'<div class="header-section watermark-wrapper">\n    <div class="watermark-bucket watermark"></div>\n    <breadcrumbs class="listobjects-breadcrumbs"></breadcrumbs>\n</div>\n<awsui-tabs class="bucket-tabs bucket-details-tabs" tabs="tabs" ng-model="selectedTab" ng-switch="selectedTab" ng-click="setTabParam(selectedTab)">\n    <div ng-switch-default="">\n        <ng-include src="\'/s3/partials/objects.html\'"></ng-include>\n    </div>\n    <div ng-switch-when="properties">\n        <ng-include src="\'/s3/partials/bucketproperties.html\'"></ng-include>\n    </div>\n    <div ng-switch-when="permissions">\n        <bucketpermissions></bucketpermissions>\n    </div>\n    <div ng-switch-when="management" fac-id="s3-si">\n        <storage-management></storage-management>\n    </div>\n</awsui-tabs>\n<div operation-manager="" selected-tab="selectedTab"></div>');a.put("/s3/partials/bucketlifecycle.html",'<div>\n    <awsui-alert header="{{\'error.header\'|translate}}" type="error" ng-if="lifecycleError"> {{ lifecycleError }}</awsui-alert>\n    <div class="action-strip">\n        <awsui-button id="add-rule" class="action-button-spacing" text="{{\'bucketlifecycle.label.addlifecyclepolicy\' | translate}}" icon="plus" click="showLifecycleModalForCreate()" variant="primary"></awsui-button>\n        <awsui-button id="edit-rule" class="action-button-spacing" text="{{ \'bucketlifecycle.label.edit\' | translate }}" data-disabled="isEdit" click="showLifecycleModalForEdit()"></awsui-button>\n        <awsui-button id="delete-rule" class="action-button-spacing" text="{{ \'bucketlifecycle.label.delete\' | translate }}" data-disabled="isDelete" click="showConfirmationModal(\'deletePolicy\')"></awsui-button>\n        <action-dropdown class="bucket-more-dropdown" text="{{ \'bucketlifecycle.label.more\' | translate }}" items="moreOptions"></action-dropdown>\n        <awsui-button class="lifecycle-refresh-icon" id="refresh-button" icon="refresh" variant="standalone-icon" loading="isRefreshing" click="initialize()"></awsui-button>\n    </div>\n    <empty-state ng-if="showEmptyScreen" open-modal="showLifecycleModalForCreate" type="\'lifecycle\'"></empty-state>\n    <div ng-if="!showEmptyScreen" class="columbia-table">\n        <table class="table table-condensed">\n            <thead>\n            <tr class="black-header">\n                <th></th>\n                <th><a translate="bucketlifecycle.policy"></a></th>\n                <th><a translate="bucketlifecycle.applied"></a></th>\n                <th><a translate="bucketlifecycle.currentversiontransition"></a></th>\n                <th><a translate="bucketlifecycle.previousversionaction"></a></th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-class="{\'row-selected\' : rule.selected, \'row-hover\': hoverRule && !rule.selected}" ng-mouseenter="hoverRule = true" ng-mouseleave="hoverRule = false" ng-repeat="rule in lifecycle.listViewRules" ng-click="selectRule(rule, $index); $event.stopPropagation();">\n                <td><span class="lifecycle-rule-status enabled-icon" ng-if="rule.Status === \'Enabled\'"></span>\n                    <span class="lifecycle-rule-status disabled-icon" ng-if="rule.Status === \'Disabled\'"></span>\n                </td>\n                <td> {{ rule.ID }} </td>\n                <td> {{ rule.Prefix }} </td>\n                <td> {{ rule.transitionsList }} </td>\n                <td> {{ rule.prevActions }} </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n    <lifecycle-modal is-open="isLifecycleModalOpen" selected-rule="lifecycle.selectedRule" rule-to-be-edited="lifecycle.ruleToBeEdited" disable-edit="isEdit" disable-delete="isDelete" is-editing="forEdit" initial-response="lifecycleConfiguration.Rules" initialize="initialize" initial-xml="lifecycle.initialXML" more-options="moreOptions" operation="operation"></lifecycle-modal>\n    <lifecycle-confirmation-modal selected-rule="lifecycle.selectedRule" rule-to-be-edited="lifecycle.ruleToBeEdited" disable-edit="isEdit" disable-delete="isDelete" list-rules="lifecycle.listViewRules" header-title="headerTitle" is-open="isConfirmationModalOpen" action-type="actionType" warning-message="warningMessage" initial-xml="lifecycle.initialXML" selected-rule-index="lifecycle.selectedRuleIndex" initial-response="lifecycleConfiguration.Rules" operation="operation" initialize="initialize" more-options="moreOptions"></lifecycle-confirmation-modal>\n</div>');a.put("/s3/partials/bucketlogging.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-logging-water-mark\': !cardOpen, \'card-enable-logging-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.logging.label.logging"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelBucketLogging($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="bucketproperties.logging.summary"></p>\n        <div class="awsui-container" ng-if="cardOpen">\n            <div class="awsui-row card-content-row">\n                <awsui-radio-group ng-model="logging.selectedValue">\n                    <awsui-radio-button value="enable" ng-model="logging.selectedValue" label="{{ \'bucketproperties.logging.label.enablelogging\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n            </div>\n            <div ng-if="logging.selectedValue === \'enable\'">\n                <div class="awsui-row card-content-row">\n                    <label class="target-value" translate="bucketproperties.logging.label.targetbucket"></label>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-select class="logging-select target-value" items="logging.targetBucketOptions" placeholder="{{ \'bucketproperties.logging.placeholder.selectbucket\' | translate }}" ng-model="logging.targetBucket"></awsui-select>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <label class="target-value" translate="bucketproperties.logging.label.targetprefix"></label>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <input type="text" class="properties-placeholder" ng-model="logging.targetPrefix" placeholder="{{ \'bucketproperties.logging.placeholder.entertargetprefix\' | translate }}">\n                    <awsui-tooltip text="{{\'bucketproperties.logging.targetprefix.tooltip\' | translate}}" position="top" size="small">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </div>\n            </div>\n            <div class="awsui-row card-content-row">\n                <awsui-radio-group ng-model="logging.selectedValue">\n                    <awsui-radio-button value="disable" ng-model="logging.selectedValue" label="{{ \'bucketproperties.logging.label.disablelogging\' | translate }}">\n                    </awsui-radio-button>\n                </awsui-radio-group>\n            </div>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert type="error" class="error-alert" readonly="readonly" ng-if="loggingError && cardOpen">{{loggingErrorMessage}}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div id="logging-properties-buttons" ng-if="cardOpen" class="bucket-properties-buttons">\n            <awsui-button id="cancel-bucket-logging" ng-click="cancelBucketLogging($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-logging" ng-click="saveBucketLogging($event)" text="{{ \'button.save\' | translate }}" variant="primary" loading="saving"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/bucketpermissions.html",'<div>\n    <div class="permissions-header">\n        <awsui-button-group class="si-category-buttons">\n            <awsui-tooltip id="acl-button-tooltip" text="{{\'permissions.types.tooltip.acl\'|translate}}" position="top">\n                <awsui-button id="permission-acl-button" class="permission-action-button" text="{{ \'permissions.types.acl\' | translate }}" ng-click="showView(S3Constants.BUCKET_PERMISSION_TYPE.ACL)" variant="{{ permissions.selectedItem.value === S3Constants.BUCKET_PERMISSION_TYPE.ACL ? \'primary\' : \'\' }}"></awsui-button>\n            </awsui-tooltip>\n            <awsui-tooltip text="{{\'permissions.types.tooltip.policy\'|translate}}" position="top">\n                <awsui-button id="permission-policy-button" class="permission-action-button" text="{{ \'permissions.types.policy\' | translate }}" variant="{{ permissions.selectedItem.value === S3Constants.BUCKET_PERMISSION_TYPE.POLICY ? \'primary\' : \'\' }}" ng-click="showView(S3Constants.BUCKET_PERMISSION_TYPE.POLICY)"></awsui-button>\n            </awsui-tooltip>\n            <awsui-tooltip text="{{\'permissions.types.tooltip.cors\'|translate}}" position="top">\n                <awsui-button id="permission-cors-button" class="permission-action-button" text="{{ \'permissions.types.cors\' | translate }}" variant="{{ permissions.selectedItem.value === S3Constants.BUCKET_PERMISSION_TYPE.CORS ? \'primary\' : \'\' }}" ng-click="showView(S3Constants.BUCKET_PERMISSION_TYPE.CORS)"></awsui-button>\n            </awsui-tooltip>\n        </awsui-button-group>\n    </div>\n    <div class="permissions-container" ng-switch="permissions.selectedItem.value">\n        <awsui-alert visible="error" class="block permissions-error small-top-margin" type="error" dismissible="false" header="{{ \'permissions.error.header\' | translate }}"> {{ error }}\n        </awsui-alert>\n        <table class="editor-header">\n            <tr>\n                <td ng-switch-when="policy">\n                    <div class="description-container">\n                        <span class="ace-editor-title">{{ \'permissions.policy.header\' | translate}} </span>\n                        <span translate="permissions.label.bucketarn"></span>\n                        <span>{{bucketARN}}</span>\n                        <div class="ace-editor-description" translate="permissions.policy.description"></div>\n                    </div>\n                </td>\n                <td ng-switch-when="cors" class="permissions-editor">\n                    <div class="description-container">\n                        <span class="ace-editor-title">{{ \'permissions.cors.header\' | translate}} </span>\n                        <span translate="permissions.label.bucketarn"></span>\n                        <span> {{ bucketARN }}</span>\n                        <div class="ace-editor-description" translate="permissions.cors.description"></div>\n                    </div>\n                </td>\n                <td class="editor-buttons" ng-if="permissions.selectedItem.value===\'policy\' || permissions.selectedItem.value===\'cors\'">\n                    <awsui-button id="delete" variant="normal" text="{{ \'permissions.button.delete\' | translate }}" class="awsui-util normal-button" click="deletePermission()" loading="isDeleting" data-disabled="isSaving || isDeleting || (permissions.selectedItem.value===\'policy\' && !policy|| permissions.selectedItem.value===\'cors\' && !cors)">\n                    </awsui-button>\n                    <awsui-button id="cancel" variant="normal" text="{{ \'permissions.button.cancel\' | translate }}" class="awsui-util normal-button" click="cancel()" data-disabled="isSaving || isDeleting || (permissions.selectedItem.value===\'policy\' && !policyChanged || permissions.selectedItem.value===\'cors\' && !corsChanged)">\n                    </awsui-button>\n                    <awsui-button id="save-code" variant="primary" text="{{ \'permissions.button.save\' | translate }}" class="awsui-util normal-button" click="save()" loading="isSaving" data-disabled="disableSave()">\n                    </awsui-button>\n                </td>\n            </tr>\n        </table>\n\n        <div ng-if="permissions.selectedItem.value===\'policy\'" class="permissions-editor">\n            <div ng-if="gettingPolicy" class="editor-spinner-container">\n                <span class="awsui-spinner awsui-spinner-large"></span>\n            </div>\n            <div id="policy-editor" ui-ace="{ useWrapMode : true, showGutter: true, mode: \'json\', firstLineNumber: 1, onLoad: policyEditorLoaded, onChange: policyEditorChanged }" class="code" ng-if="!gettingPolicy">\n            </div>\n            <table class="editor-docs-button">\n                <tr>\n                    <td>\n                        <awsui-button id="documentation" variant="link" text="{{ \'permissions.button.documentation\' | translate }}" class="awsui-util link-button" target="_blank" href="{{policyDocLink}}">\n                        </awsui-button>\n                    </td>\n                    <td>\n                        <awsui-button id="policy-generator" variant="link" text="{{ \'permissions.button.policygenerator\' | translate }}" class="awsui-util link-button" target="_blank" href="{{policyGenLink}}">\n                        </awsui-button>\n                    </td>\n                </tr>\n            </table>\n        </div>\n        <div ng-if="permissions.selectedItem.value===\'cors\'" class="permissions-editor">\n            <div ng-if="gettingCors" class="editor-spinner-container">\n                <span class="awsui-spinner awsui-spinner-large"></span>\n            </div>\n            <div id="cors-editor" ui-ace="{ useWrapMode : true, showGutter: true, mode: \'xml\', firstLineNumber: 1, onLoad: corsEditorLoaded, onChange: corsEditorChanged }" class="code" ng-if="!gettingCors"></div>\n            <div class="editor-docs-button">\n                <awsui-button id="cors-documentation" variant="link" text="{{ \'permissions.button.documentation\' | translate }}" class="awsui-util link-button" target="_blank" href="{{corsDocLink}}">\n                </awsui-button>\n            </div>\n        </div>\n        <div ng-switch-default="">\n            <acl permission-obj="permissionObj" put-acl="putAcl" error="error" bucket="bucket" is-bucket-permission="true"></acl>\n        </div>\n    </div>\n</div>');a.put("/s3/partials/bucketproperties.html",'<div class="card-enabled-icon"></div>\n<div class="awsui-grid">\n    <div class="awsui-container properties-cards">\n        <hr class="properties-headers-line-space">\n        <div class="wrapper awsui-row">\n            <bucket-versioning id="bucket-versioning-card" card-open="toggleVersioning" versioning="versioning"></bucket-versioning>\n            <bucket-logging id="bucket-logging-card" card-open="toggleLogging" logging="logging"></bucket-logging>\n            <bucket-website id="bucket-website-card" card-open="toggleWebsite" website="website"></bucket-website>\n        </div>\n        <hr class="properties-headers-line-space">\n        <div class="properties-headers">\n            <h1 translate="bucketproperties.title.advancedsettings"></h1>\n        </div>\n        <div class="wrapper awsui-row">\n            <bucket-tagging id="bucket-tagging-card" card-open="toggleTagging" bucket-tags="bucketTags.tagSet"></bucket-tagging>\n            <bucket-replication-v1 id="bucket-crr-card" ng-if="displayCRRV1" card-open="toggleCRR" versioning-status="versioning.selectedValue"></bucket-replication-v1>\n            <bucket-accelerate id="bucket-accelerate-card" fac-id="s3-x-acceleration" card-open="toggleAccelerate"></bucket-accelerate>\n            <events id="bucket-events-card" card-open="toggleEvents"></events>\n            <bucket-requester-pays id="bucket-requesterpays-card" card-open="toggleRequesterPays"></bucket-requester-pays>\n        </div>\n    </div>\n</div>');a.put("/s3/partials/bucketreports.html",'<div class="inventory-reports">\n    <div ng-if="!finishedLoading && !showError" class="awsui-spinner awsui-spinner-large" style="margin: 10% 50%">\n    </div>\n    <div ng-if="showError && reportsTable.length === 0">\n        <awsui-alert type="error" visible="showError">{{ errorMessage }}</awsui-alert>\n    </div>\n    <div class="empty-object-inventory" ng-if="reportsTable.length === 0 && finishedLoading && !showError">\n        <span class="no-reports-enabled" translate="">report.emptymessage</span>\n        <div class="no-inventory-reports-icon"><img src="/s3/img/no-inventory-reports.png"></div>\n        <div class="inventory-header" translate="">report.inventory</div>\n        <div class="inventory-additional-information" translate="">report.additionalInformation</div>\n        <awsui-button id="add-new-report" variant="link" icon="plus" text="{{ \'report.button.add\' | translate }}" click="addRow($event)"></awsui-button>\n    </div>\n    <div ng-if="reportsTable.length > 0 && finishedLoading">\n        <awsui-button id="create-new-report" disabled="isAdding || isEditingRow" variant="primary" icon="plus" text="{{ \'report.button.add\' | translate }}" click="addRow($event)"></awsui-button>\n        <awsui-button id="edit-report" disabled="reportsTable.length === 0 || isAdding || isEditingRow || selectedRowIndex < 0" variant="normal" text="{{ \'report.button.edit\' | translate }}" click="editRow($event)">\n        </awsui-button>\n        <awsui-button id="delete-report" disabled="reportsTable.length === 0 || isAdding || isEditingRow || selectedRowIndex < 0" variant="normal" text="{{ \'events.button.delete\' | translate }}" click="deletePressed()" loading="isDeleting">\n        </awsui-button>\n\n        <div class="events-table">\n            <div class="events-table">\n                <awsui-radio-group ng-model="radioValue.value">\n                    <table class="table table-condense reports-table">\n                        <thead>\n                        <tr>\n                            <td class="report-radio"></td>\n                            <td translate="">report.label.name</td>\n                            <td translate="">report.label.filter</td>\n                            <td>\n                                {{\'report.label.bucket\' | translate}}\n                                <awsui-tooltip text="{{ \'report.bucketPolicy.tooltip\' | translate }}" position="right" size="small">\n                                    <i class="awsui-icon alert-info-circle"></i>\n                                </awsui-tooltip>\n                            </td>\n                            <td translate="">report.label.prefix</td>\n                            <td translate="">report.label.freq</td>\n                        </tr>\n                        </thead>\n                        <tbody>\n                            <tr ng-if="flags.displayDelayWarning">\n                                <td colspan="6">\n                                    <awsui-alert id="inventory-delay-alert" dismissible="true" ng-click="resetDelayWarning()" visible="flags.displayDelayWarning" header="{{\'report.warning.header\' | translate}}">\n                                        <span translate="">report.warning.text</span>\n                                    </awsui-alert>\n                                </td>\n                            </tr>\n                            <tr ng-if="policyStatus.policyMessage">\n                                <td colspan="6">\n                                    <awsui-alert id="inventory-policy-message" dismiss="resetPolicyStatus()" type="{{policyStatus.policyType}}" dismissible="true" visible="policyStatus.policyMessage" header="{{policyStatus.policyHeader}}">\n                                        <div>{{policyStatus.policyMessage}}\n                                            <span>\n                                                <a href="{{getLearnMoreLink(\'configure-inventory\')}}" target="_blank" translate="">learn.more</a>\n                                            </span>\n                                        </div>\n                                        <div class="policy-definition" ng-if="policyStatus.policyDefinition">\n                                            <pre>{{policyStatus.policyDefinition}}</pre>\n                                        </div>\n                                    </awsui-alert>\n                                </td>\n                            </tr>\n                            <tr ng-if="row.isEditing" ng-repeat-start="row in reportsTable" class="no-top-border">\n                                <td></td>\n                                <td class="report-input input-td">\n                                    <awsui-control-group class="label-text" validation-message="{{row.invalidNameMessage}}">\n\n                                        <awsui-textfield id="report-input" ng-class="{\'inventory-input-text\' : !row.nameError, \'verification-error\': row.nameError}" placeholder="{{\'report.placeholder.name\' | translate}}" ng-keyup="validateName(row)" ng-model="row.name"></awsui-textfield>\n                                    </awsui-control-group>\n                                </td>\n\n                                <td class="input-td">\n                                    <awsui-control-group class="label-text">\n                                        <span dom-region="validationMessage" ng-if="filterInfo">\n                                            <span translate="" translate-values="{ bucket1 : bucketName + \'/\' + filterInfo, bucket2: bucketName + filterInfo }">prefixsearch.validation.slash.start.warning</span>\n                                        </span>\n                                        <span dom-region="control">\n                                            <awsui-textfield class="inventory-input-text" placeholder="{{\'report.placeholder.filter\' | translate}}" ng-keyup="validatePrefix()" ng-model="row.filter"></awsui-textfield>\n                                        </span>\n                                    </awsui-control-group>\n                                </td>\n                                <td class="input-td">\n                                    <awsui-control-group id="bucket-options-dropdown" class="label-text" validation-message="{{row.bucketUnknown}}">\n                                        <bucket-selector class="bucket-selector-object-inventory" selected-report="row" show-bucket-name-only="true" choose-accounts="true" editable="true" same-region="true" is-open="selectingBucket.selected">\n                                    </bucket-selector></awsui-control-group>\n                                </td>\n                                <td class="input-td">\n                                    <awsui-control-group class="label-text">\n                                        <span dom-region="validationMessage" ng-if="prefixInfo">\n                                            <span translate="" translate-values="{ bucket1 : bucketNamePre + \'/\' + prefixInfo, bucket2: bucketNamePre + prefixInfo }">prefixsearch.validation.slash.start.warning</span>\n                                        </span>\n                                        <span dom-region="control">\n                                            <awsui-textfield class="inventory-input-text" placeholder="{{\'report.placeholder.prefix\' | translate}}" ng-keyup="validatePrefix()" ng-model="row.prefix" data-disabled="!row.bucket"></awsui-textfield>\n                                         </span>\n                                    </awsui-control-group>\n                                </td>\n                                <td class="frequency-input input-td">\n                                    <awsui-control-group class="label-text">\n                                        <awsui-select items="freqTypes" class="select-type-dropdown" ng-model="row.freq" ng-click="$event.stopPropagation()"></awsui-select>\n                                    </awsui-control-group>\n                                </td>\n                            </tr>\n                            <tr ng-if="row.isEditing" class="no-top-border">\n                                <td></td>\n                                <td colspan="5" ng-if="!showAdvancedSettingsDropdown"><awsui-button icon="plus" text="{{ \'bucketproperties.title.advancedsettings\' | translate }}" variant="link" ng-click="toggleAdvancedSettingsDropdown()"></awsui-button></td>\n                                <td colspan="5" ng-if="showAdvancedSettingsDropdown"><awsui-button text="- {{ \'bucketproperties.title.advancedsettings\' | translate }}" variant="link" ng-click="toggleAdvancedSettingsDropdown()"></awsui-button>\n                                    <table>\n                                        <tbody>\n                                        <tr>\n                                            <th class="advanced-header">\n                                                <div class="advanced-header-label" translate="">report.label.versions</div>\n                                            </th>\n                                            <td>\n                                                <awsui-control-group class="label-text">\n                                                    <awsui-select items="versionTypes" class="select-type-dropdown" ng-model="row.versioning" ng-click="$event.stopPropagation()"></awsui-select>\n                                                </awsui-control-group>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <th class="advanced-header">\n                                                <div class="advanced-header-label" translate="">report.label.optional</div>\n                                            </th>\n                                            <td class="inventory-optional-fields">\n                                                <awsui-control-group class="label-text">\n                                                    <awsui-checkbox id="report-size" ng-model="row.optional.Size" checked="row.optional.Size">{{\'report.optional.size\' | translate}}</awsui-checkbox>\n                                                    <awsui-checkbox id="last-modified-date" ng-model="row.optional.LastModifiedDate" checked="row.optional.LastModifiedDate">{{\'report.optional.modified\' | translate}}</awsui-checkbox>\n                                                    <awsui-checkbox id="storage-class" ng-model="row.optional.StorageClass" checked="row.optional.StorageClass">{{\'report.optional.storageclass\' | translate}}</awsui-checkbox>\n                                                    <awsui-checkbox id="etag" ng-model="row.optional.ETag" checked="row.optional.ETag">{{\'report.optional.ETag\' | translate}}</awsui-checkbox>\n                                                    <awsui-checkbox id="multi-part" ng-model="row.optional.IsMultipartUploaded" checked="row.optional.IsMultipartUploaded">{{\'report.optional.multipart\' | translate}}</awsui-checkbox>\n                                                    <awsui-checkbox id="replication-status" ng-model="row.optional.ReplicationStatus" checked="row.optional.ReplicationStatus">{{\'report.optional.replicationstatus\' | translate}}</awsui-checkbox>\n                                                </awsui-control-group>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </table>\n                                </td>\n                                <td colspan="4"></td>\n                            </tr>\n                            <tr ng-if="row.isEditing" class="bucket-properties-buttons no-top-border">\n                                <td></td>\n                                <td colspan="5" class="save-cancel-row">\n                                    <awsui-button id="cancel-report" text="{{ \'events.button.cancel\' | translate }}" variant="normal" ng-click="!isSaving && cancelPressed($event)" data-disabled="isSaving" class="cancel-button"></awsui-button>\n                                    <awsui-button id="save-report" text="{{ \'events.button.save\' | translate }}" variant="primary" data-disabled="row.nameError || !row.bucket || row.bucketError || selectingBucket.selected || row.bucketUnknown" ng-click="savePressed($event)" loading="isSaving"></awsui-button>\n                                </td>\n                            </tr>\n                            <tr ng-if="row.isEditing && showError">\n                                <td colspan="6">\n                                    <awsui-alert type="error" visible="showError">{{ errorMessage }}</awsui-alert>\n                                </td>\n                            </tr>\n                            <tr ng-class="{\'row-hover\': hoverRule && ($index !== selectedRowIndex), \'row-selected\': $index === selectedRowIndex}" ng-mouseenter="hoverRule = true" ng-mouseleave="hoverRule = false" ng-if="!row.isEditing" ng-click="selectRow($index)" class="inventory-row" ng-repeat-end="">\n                                <td class="report-radio">\n                                    <awsui-radio-button value="{{$index}}" disabled="isEditingRow">\n                                <td ng-if="!row.isEditing" class="report-row">{{ row.name }}</td>\n                                <td ng-if="!row.isEditing" class="report-row">{{ getFilterValue(row.filter) }}</td>\n                                <td class="awsui-icon bucket report-row" ng-class="{\'awsui-icon-light\': $index === selectedRowIndex}" ng-if="!row.isEditing" class="report-row">{{ row.bucket }}</td>\n                                <td ng-if="!row.isEditing" class="report-row">{{ getPrefixValue(row.prefix) }}</td>\n                                <td ng-if="!row.isEditing">{{ getTranslationValue(row.freq) }}</td>\n                                </awsui-radio-button>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </awsui-radio-group>\n            </div>\n        </div>\n    </div>\n</div>');a.put("/s3/partials/bucketrequesterpays.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-requesterpays-water-mark\': !cardOpen, \'card-enable-requesterpays-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.requesterpays.label.requesterpays"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelBucketRequesterPays($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="bucketproperties.requesterpays.summary"></p>\n        <div class="awsui-container" ng-if="cardOpen">\n            <awsui-radio-group ng-model="requesterPays.selectedValue">\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-button class="enableRequesterPays" value="Requester" ng-model="requesterPays.selectedValue" label="{{ \'bucketproperties.requesterpays.label.enablerequesterpays\' | translate }}"></awsui-radio-button>\n                    <p class="requesterpays-description" translate="bucketproperties.requesterpays.description.enablerequesterpays"></p>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-button class="disableRequesterPays" value="BucketOwner" ng-model="requesterPays.selectedValue" label="{{ \'bucketproperties.requesterpays.label.disablerequesterpays\' | translate }}">\n                    </awsui-radio-button>\n                    <p class="requesterpays-description" translate="bucketproperties.requesterpays.description.disablerequesterpays"></p>\n                </div>\n            </awsui-radio-group>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert type="error" class="error-alert" ng-if="error && cardOpen"> {{ error }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="cancel-bucket-requesterpays" ng-click="cancelBucketRequesterPays($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-requesterpays" ng-click="saveBucketRequesterPays($event)" text="{{ \'button.save\' | translate }}" variant="primary" loading="saving"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/buckets.html",'<div class="bucket-list">\n    <awsui-alert class="notification dark" type="info" ng-if="notificationShow">\n        <targetmbox></targetmbox>\n        <div class="notificationdoc awsui-util-f-r"><a href="{{docLink}}" target="_blank" class="awsui-icon awsui-icon-link-light" translate="notification.doc"></a></div>\n    </awsui-alert>\n    <div class="buckets-header">\n        <div class="breadcrumbs">\n            <span class="s3-logo-icon logo"></span>\n            <span translate="">lamb.label.allbuckets</span>\n        </div>\n        <div>\n            <hint></hint>\n        </div>\n    </div>\n    <div ng-class="{ \'bucket-nav-wrapper\': bucketList.length > 0, \'bucket-nav-wrapper-empty\': bucketList.length === 0 }">\n        <div class="action-strip" sticky-nav="fix-to-top" sticky-nav-padding-top="140">\n            <table ng-if="bucketList.length > 0" id="search-box" class="search-box">\n                <tr>\n                    <td class="search-icon"><i class="awsui-icon search"></i></td>\n                    <td><input type="text" class="input-field" ng-model="tableFiltering.filterText" ng-keydown="filterKeyDown($event)" placeholder="{{ \'bucketselector.inputfield.placeholder\' | translate }}"></td>\n                </tr>\n            </table>\n            <awsui-button class="bucket-action-strip-button action-button-spacing" icon="plus" text="{{ \'bucketactionstrip.createbucket\' | translate }}" variant="primary" click="showCreateBucketModal()" data-disabled="!isFeatureEnabled(\'s3-cb\')"></awsui-button>\n            <awsui-button class="bucket-action-strip-button action-button-spacing" text="{{ \'bucketactionstrip.deletebucket\' | translate }}" variant="normal" click="deleteBucket()" data-disabled="selectedBucket === undefined || !isFeatureEnabled(\'s3-db\')"></awsui-button>\n            <awsui-button class="bucket-action-strip-button action-button-spacing" text="{{ \'bucketactionstrip.emptybucket\' | translate }}" variant="normal" click="emptyBucket()" data-disabled="selectedBucket === undefined || !isFeatureEnabled(\'s3-eb\')"></awsui-button>\n            <awsui-button class="refresh-button" icon="refresh" variant="standalone-icon" loading="isRefreshing" click="reloadBuckets()"></awsui-button>\n            <div class="num-regions">\n                <label class="counter-literal" ng-class="{\'counter-text\': numRegions === 0}">{{ numRegions || \'-\'}}</label>\n                <label class="counter-literal counter-text" translate="">lamb.label.regions</label>\n            </div>\n            <div class="num-buckets">\n                <label class="counter-literal" ng-class="{\'counter-text\': numRegions === 0}">{{ (bucketList | filter:tableFiltering.filterText).length || \'-\'}}</label>\n                <label class="counter-literal counter-text" translate="">lamb.label.buckets</label>\n            </div>\n        </div>\n    </div>\n    <awsui-alert class="lamb-error" type="error" header="{{\'error.header\'|translate}}" visible="error">{{error}}</awsui-alert>\n    <div class="columbia-table bucket-table" sticky-nav-padding-top="80">\n        <empty-state ng-if="bucketList.length === 0" open-modal="showCreateBucketModal" type="\'bucket\'"></empty-state>\n        <table ng-if="bucketList.length > 0" class="table table-condensed fix-width-table">\n            <thead>\n            <tr>\n                <th ng-click="setSortOrder(\'Name\')">\n                    <a translate="lamb.column.name"></a>\n                    <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'Name\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'Name\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'Name\'}"></span>\n                </th>\n                <th ng-click="setSortOrder(\'Location\')">\n                    <a translate="lamb.column.region"></a>\n                    <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'Location\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'Location\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'Location\'}"></span>\n                </th>\n                <th ng-click="setSortOrder(\'CreationDate\')">\n                    <a translate="lamb.column.creationdate"></a>\n                    <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'CreationDate\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'CreationDate\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'CreationDate\'}"></span>\n                </th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr class="unselectable" unselectable="on" onselectstart="return false" ng-show="!isLoadingPage" ng-repeat="bucket in bucketList | filter:tableFiltering.filterText| orderBy:sortColumnName:reverseSortOrder" ng-click="openConfigPanel(bucket)" class="bucket-row" ng-class="{\'row-selected\': bucket.Name===selectedBucket.Name, \'row-hover\' : hoverBucketRow && bucket.Name!==selectedBucket.Name}" ng-mouseenter="hoverBucketRow = true" ng-mouseleave="hoverBucketRow = false">\n                \n                <td class="awsui-icon bucket truncate" ng-class="{\'awsui-icon-light\': bucket.Name===selectedBucket.Name}"><a class="list-view-item-name" href="" ng-click="selectBucket(bucket.Name)">{{bucket.Name}}</a></td>\n                <td>{{bucket.Location}}</td>\n                <td>{{bucket.CreationDate | date:"medium" }}</td>\n            </tr>\n            <tr>\n                <storage-console-config-panel ng-mouseenter="hoverSidePanelAction(true)" ng-mouseleave="hoverSidePanelAction(false)" class="bucket-side-panel" ng-class="{\'side-config-panel bucket-side-panel\': panelOpen, \'hide-config-panel bucket-side-panel\': panelHide}" panel-open="panelOpen">\n                    <header>\n                        <div class="bucket-side-panel-header">\n                            <div class="truncate side-panel-header-name">{{ selectedBucket.Name }}</div>\n                            <span class="panel-close-icon" ng-click="closePanel()"></span>\n                        </div>\n                        <awsui-button size="small" text="{{ \'bucketproperties.sideconfigpanel.copyarn\' | translate }}" click="copyARNToClipboard($event)"></awsui-button>\n                    </header>\n                    <content>\n                        <ul class="bucket-panel-config-lists" ng-repeat="(configTitle, configContent) in configData" ng-click="moveToBucketTab(configTitle)">\n                            <li>\n                                <div class="subtitle" translate="bucketproperties.{{configTitle}}"></div>\n                                <ul class="bucket-config-panel-content">\n                                    <li ng-repeat="(configKey, configValue) in configContent">\n                                        <div class="truncate config-panel-content-left" translate="bucketproperties.sideconfigpanel.{{configKey}}"></div>\n                                        <div class="truncate config-panel-content-right">{{configValue}}</div>\n                                    </li>\n                                </ul>\n                            </li>\n                        </ul>\n                    </content>\n                </storage-console-config-panel>\n            </tr>\n            </tbody>\n        </table>\n        <div ng-if="isLoadingPage" class="loading-spinner">\n            <span class="awsui-spinner awsui-spinner-large"></span>\n        </div>\n    </div>\n    <div ng-if="!isLoadingPage" operation-manager=""></div>\n    <create-bucket-modal is-open="isCreateBucketModalOpen" bucket-list="bucketList" regions="regions" num-regions="numRegions" load-buckets="loadBuckets"></create-bucket-modal>\n    <bucket-confirmation-modal header-title="bucketConfirmationDetails.headerTitle" is-open="isConfirmationModalOpen" warning-message="bucketConfirmationDetails.warningMessage" operation="bucketConfirmationDetails.operation" is-delete="bucketConfirmationDetails.isDelete">\n    </bucket-confirmation-modal>\n</div>');a.put("/s3/partials/bucketselector.html",'<div id="bucket-selector" class="bucket-selector" clickoutside="" on-click-outside="closeDropDown">\n    <table id="current-displayed-table" class="awsui-select-target current-displayed bucket-not-selected" ng-class="{\'with-bucket-name\' : !showBucketNameOnly, \'deselect\' : enableDeselect && copySettingsSourceBucket && copySettingsSourceBucket.Name, \'bucket-selected\' : !bucketReplication && !selectedReport && copySettingsSourceBucket || (bucketReplication || selectedReport ) && copySettingsSourceBucket && copySettingsSourceBucket.Name, \'bucket-not-selected-card\' : editable && !selectedReport.bucketError, \'bucket-not-selected-card-error\' : editable && selectedReport.bucketError}" ng-click="toggleDropDown()">\n        <tr class="current-displayed-row">\n            <td ng-if="!bucketReplication && copySettingsSourceBucket.Name && !showBucketNameOnly" class="awsui-icon bucket bucket-icon"></td>\n            <td class="current-displayed-item">\n                <div class="current-displayed-item truncate" ng-class="{\'bucket-name-display\' : !showBucketNameOnly }">{{ copySettingsSourceBucket.Name || (bucketList.length === 0 &&\n                    emptyText) || getBucketPlaceHolder() }}</div>\n                <table id="selected-bucket" ng-if="copySettingsSourceBucket && !showBucketNameOnly" class="current-displayed-summary">\n                    <tr>\n                        <td class="current-displayed-summary-item"><span translate="bucketselector.summary.label.region"></span><span> {{copySettingsSourceBucket.Location}}</span></td>\n                        <td class="current-displayed-summary-item" ng-if="copySettingsSourceBucket.granteeCount">{{copySettingsSourceBucket.granteeCount}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                        <td class="current-displayed-summary-item" ng-if="copySettingsSourceBucket.propertyCount">{{copySettingsSourceBucket.propertyCount}} <span translate="bucketselector.summary.label.properties"></span></td>\n                    </tr>\n                </table>\n            </td>\n            <td ng-if="!copySettingsSourceBucket" class="bucket-count">\n                <div ng-if="!showBucketNameOnly">\n                    <span translate="bucketselector.label.buckets" translate-values="{ bucketCount: bucketList.length || 0 }"></span>\n                </div>\n            </td>\n            <td ng-if="enableDeselect && copySettingsSourceBucket && copySettingsSourceBucket.Name" ng-click="deselectBucket()">\n                <div class="bucketdeselect bucketselector-cancel-icon"></div>\n            </td>\n        </tr>\n    </table>\n\n    <div class="list-items" ng-if="isOpen" ng-class="{\'list-items-normal\' : !chooseAccounts, \'list-items-choose\': chooseAccounts}">\n        <div ng-if="chooseAccounts">\n            <awsui-radio-group ng-model="account.outside">\n                <table class="choose-accounts-table">\n                    <tbody>\n                        <tr>\n                            <td class="choose-account-button">\n                                <awsui-radio-button value="false">\n                                    <span class="choose-accounts-text">\n                                        {{\'bucketselector.inputfield.currentAccount\' | translate}}\n                                    </span>\n                                </awsui-radio-button>\n                            </td>\n                            <td class="choose-account-button">\n                                <awsui-radio-button value="true" id="cross-account-radiobutton">\n                                    <span class="choose-accounts-text">\n                                        {{\'bucketselector.inputfield.anotherAccount\' | translate}}\n                                    </span>\n                                </awsui-radio-button>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </awsui-radio-group>\n        </div>\n        <table ng-if="!chooseAccounts || account.outside === \'false\'" id="search-box" class="search-box">\n            <tr>\n                <td>\n                    <input id="bucket-name-search-box" type="text" class="input-field" ng-model="tableFiltering.filter[filterColumn]" ng-keydown="filterKeyDown($event)" placeholder="{{ getSearchPlaceHolder() }}"></td>\n                <td><i class="awsui-icon search"></i></td>\n            </tr>\n        </table>\n        <div ng-if="chooseAccounts && account.outside === \'true\'">\n            <table class="choose-bucket-other-account-table">\n                <tbody>\n                    <tr ng-if="!bucketReplication">\n                        <td><span class="enter-another-bucket">{{\'bucketselector.inputfield.label.account\' | translate}}</span></td>\n                    </tr>\n                    <tr ng-if="!bucketReplication">\n                        <td>\n                            <div class="input-text-field">\n                                <awsui-textfield class="test-css" ng-model="tmpValues.accountId" placeholder="{{\'bucketselector.inputfield.enterId.placeholder\' | translate}}"></awsui-textfield>\n\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td><span class="enter-another-bucket">{{\'bucketselector.inputfield.label.bucket\' | translate}}</span></td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <div class="input-text-field bucket-name-field">\n                                <awsui-control-group validation-message="{{tmpValues.regionError}}">\n                                    <awsui-textfield class="test-css" ng-model="tmpValues.bucket" placeholder="{{\'bucketselector.inputfield.bucketName.placeholder\' | translate}}">\n                                    </awsui-textfield>\n                                </awsui-control-group>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <awsui-button class="another-account-save" text="{{ \'events.button.save\' | translate }}" variant="normal" ng-click="!tmpValues.bucket || savePressed($event)" disabled="!tmpValues.bucket" loading="savingBucket"></awsui-button>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        <div class="bucketselector-divider" ng-if="bucketReplication &&  account.outside === \'false\' && chooseAccounts"></div>\n        <div ng-if="(!chooseAccounts || account.outside === \'false\') && bucketReplication" class="item create-new-item" ng-click="createNewBucket()" translate="bucketselector.createnew">\n        </div>\n        <div ng-if="isLoadingBuckets &&  account.outside === \'false\' && chooseAccounts" class="awsui-spinner awsui-spinner-bigger awsui-spinner-light bucketselector-spinner"></div>\n        <span ng-if="isLoadingBuckets &&  account.outside === \'false\' && chooseAccounts" class="loading-bucket-text" translate="bucketselector.loadingbucket"></span>\n        <div ng-if="!chooseAccounts || account.outside === \'false\'" class="item" ng-repeat="bucket in bucketList | filter:tableFiltering.filter" ng-click="selectBucket(bucket)">\n            <table>\n                <tr>\n                    <td class="arrow" ng-click="toggleBucket($event, bucket)"><div ng-class="bucket.isExpanded ? \'arrow-down\' : \'arrow-right\'"></div></td>\n                    <td><div class="bucket-item">{{bucket.Name}}</div></td>\n                </tr>\n                <tr>\n                    <td></td>\n                    <td>\n                        <table class="bucket-summary">\n                                <tr>\n                                    <td class="bucket-summary-item"><span translate="bucketselector.summary.label.region"></span><span> {{bucket.Location}}</span></td>\n                                    <td ng-if="bucket.granteeCount" class="bucket-summary-item">{{bucket.granteeCount}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                                    <td ng-if="bucket.propertyCount" class="bucket-summary-item">{{bucket.propertyCount}} <span translate="bucketselector.summary.label.properties"></span></td>\n                                </tr>\n                        </table>\n                    </td>\n                </tr>\n            </table>\n            <div class="bucket-content" ng-if="bucket.isExpanded">\n                <p class="bucket-content-title" translate="createbucketmodal.label.permissions"></p>\n                <p class="bucket-content-column-header" translate="createbucketmodal.label.object"></p>\n                <table class="bucket-summary">\n                    <tr>\n                        <td class="bucket-content-value" translate="bucketselector.content.label.read"></td>\n                        <td class="bucket-content-value">{{bucket.permissionCount.READ}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                    </tr>\n                    <tr>\n                        <td class="bucket-content-value" translate="bucketselector.content.label.write"></td>\n                        <td class="bucket-content-value">{{bucket.permissionCount.WRITE}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                    </tr>\n                </table>\n                <p class="bucket-content-column-header" translate="bucketselector.content.label.permissionaccess"></p>\n                <table class="bucket-summary">\n                    <tr>\n                        <td class="bucket-content-value" translate="bucketselector.content.label.read"></td>\n                        <td class="bucket-content-value">{{bucket.permissionCount.READ_ACP}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                    </tr>\n                    <tr>\n                        <td class="bucket-content-value" translate="bucketselector.content.label.write"></td>\n                        <td class="bucket-content-value">{{bucket.permissionCount.WRITE_ACP}} <span translate="bucketselector.summary.label.grantees"></span></td>\n                    </tr>\n                </table>\n                <div class="bucket-content-divider"></div>\n                <p class="bucket-content-title" translate="bucketselector.summary.label.properties"></p>\n                <table class="bucket-summary">\n                    <tr>\n                        <td class="bucket-content-column-header" translate="bucketselector.content.label.versioning"></td>\n                        <td class="bucket-content-column-header" translate="bucketselector.content.label.tags"></td>\n                        <td class="bucket-content-column-header" translate="bucketselector.content.label.logging"></td>\n                    </tr>\n                    <tr>\n                        <td class="bucket-content-value">{{bucket.versioningStatus}}</td>\n                        <td class="bucket-content-value">{{bucket.tagCount}} <span translate="bucketselector.content.label.tags"></span></td>\n                        <td class="bucket-content-value">{{bucket.loggingStatus}}</td>\n                    </tr>\n                </table>\n            </div>\n        </div>\n        <div class="no-matches-found" ng-if="((bucketList | filter:tableFiltering.filter).length == 0)">{{getResultsMessage()}}</div>\n    </div>\n</div>');a.put("/s3/partials/buckettagging.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-tags-water-mark\': !cardOpen, \'card-enable-tags-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.tagging.label.tags"></span>\n        <div class="card-close-icon" ng-show="cardOpen" ng-click="cancelBucketTagging($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-show="!cardOpen" translate="bucketproperties.tagging.summary"></p>\n        <table class="tagging-table" ng-if="cardOpen">\n            <tr>\n                <th>\n                    <translate>bucketproperties.tagging.label.key</translate>\n                    <awsui-tooltip text="{{\'bucketproperties.tagging.key.tooltip\' | translate}}" position="right" size="small">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </th>\n                <th>\n                    <translate>bucketproperties.tagging.label.value</translate>\n                    <awsui-tooltip text="{{\'bucketproperties.tagging.value.tooltip\' | translate}}" position="right" size="small">\n                        <i class="awsui-icon alert-info-circle"></i>\n                    </awsui-tooltip>\n                </th>\n                <th></th>\n            </tr>\n            <tr ng-repeat="tag in bucketTags.tags">\n                <td><input type="text" ng-model="tag.Key" class="tag-input"></td>\n                <td><input type="text" ng-model="tag.Value" class="tag-input"></td>\n                <td>\n                    <awsui-button class="remove-tag" icon="times-circle" variant="standalone-icon" ng-click="removeTag($index)"></awsui-button>\n                </td>\n            </tr>\n            <tr>\n                <td><awsui-button id="add-bucket-tag" ng-click="addTag()" class="bucket-properties-buttons" text="{{\'bucketproperties.tagging.label.addtag\' | translate}}" icon="plus"></awsui-button></td>\n                <td></td>\n                <td></td>\n            </tr>\n        </table>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert type="error" class="error-alert" readonly="readonly" ng-show="tagError && cardOpen">{{ tagErrorMessage }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="cancel-bucket-tagging" class="bucket-properties-buttons" ng-click="cancelBucketTagging($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-tagging" class="bucket-properties-buttons" ng-click="saveBucketTagging($event)" text="{{ \'button.save\' | translate }}" variant="primary"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/bucketversioning.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-version-water-mark\': !cardOpen, \'card-enable-version-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.versioning.label.versioning"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelBucketVersioning($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="bucketproperties.versioning.summary"></p>\n        <div class="awsui-container" ng-if="cardOpen">\n            <awsui-radio-group ng-model="versioning.selectedValue" change="updateWarningMsg()">\n            <div class="awsui-row card-content-row">\n                \n                <awsui-radio-button class="enableVersioning" value="enable" ng-model="versioning.selectedValue" label="{{ \'bucketproperties.versioning.label.enableversioning\' | translate }}"></awsui-radio-button>\n            </div>\n            <awsui-alert class="bucketversion-warning" visible="versioning.selectedValue === \'enable\' && versioningWarningMsg " type="warning">{{versioningWarningMsg}}</awsui-alert>\n            <div class="awsui-row card-content-row">\n                <awsui-radio-button class="disableVersioning" value="disable" ng-model="versioning.selectedValue" label="{{ \'bucketproperties.versioning.label.disableversioning\' | translate }}">\n                </awsui-radio-button>\n                <p class="disable-versioning-description" translate="bucketproperties.versioning.description.disableversioning"></p>\n                <awsui-alert class="bucketversion-warning" visible="versioning.selectedValue === \'disable\' && versioningWarningMsg " type="warning">{{versioningWarningMsg}}</awsui-alert>\n            </div>\n            </awsui-radio-group>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert type="error" class="error-alert" ng-if="versioningError && cardOpen"> {{ versioningErrorMessage }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="cancel-bucket-versioning" ng-click="cancelBucketVersioning($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-versioning" ng-click="saveBucketVersioning($event)" text="{{ \'button.save\' | translate }}" variant="primary"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/bucketwebsite.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-webhost-water-mark\': !cardOpen, \'card-enable-webhost-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.website.label.cardopen"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelBucketWebsite($event)"></div>\n    </card-header>\n    <card-content>\n        <div id="bucket-website-card-content">\n            <p class="bucketproperties-summary" ng-if="!cardOpen" translate="bucketproperties.website.summary"></p>\n            <div class="awsui-container" ng-if="cardOpen">\n                <div class="awsui-row card-content-row">\n                    <span class="endpoint-label" translate="bucketproperties.website.label.endpoint"></span>\n                    <span class="region-endpoint"> <a ng-click="openBucketEndpoint()"> {{ bucketEndpoint }}</a></span>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-group ng-model="website.selectedValue">\n                        <awsui-radio-button name="staticWebsite" style="display: inline" value="useBucket" class="website-radio-button" ng-model="website.selectedValue" label="{{ \'bucketproperties.website.label.usethisbuckettohost\' | translate }}"></awsui-radio-button>\n                        <awsui-tooltip text="{{\'bucketproperties.website.usethisbuckettohost.tooltip\' | translate}}" position="right" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                        <a class="learn-more-card-open-link" target="_blank" href="{{docLinks[\'configure\']}}" translate="">learn.more</a>\n                    </awsui-radio-group>\n                </div>\n                <div ng-if="website.selectedValue === \'useBucket\'">\n                    <div class="awsui-row card-content-row">\n                        <label class="target-value" translate="bucketproperties.website.label.indexdocument"></label>\n                        <awsui-tooltip text="{{\'bucketproperties.website.indexdocument.tooltip\' | translate}}" position="right" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <awsui-textfield class="website-text-field" ng-model="website.indexDocument" placeholder="{{ websitePlaceholder }}"></awsui-textfield>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <label class="target-value" translate="bucketproperties.website.label.errordocument"></label>\n                        <awsui-tooltip text="{{\'bucketproperties.website.errordocument.tooltip\' | translate}}" position="right" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <awsui-textfield class="website-text-field" ng-model="website.errorDocument" placeholder="{{ \'bucketproperties.website.placeholder.errordocument\' | translate }}"></awsui-textfield>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <label class="target-value edit-redirection-rules" translate="bucketproperties.website.label.editredirectionrules"></label>\n                        <awsui-tooltip text="{{\'bucketproperties.website.editredirectionrules.tooltip\' | translate}}" position="right" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </div>\n                    <div class="awsui-row card-content-row" ng-if="cardOpen">\n                        <div class="bucket-website-content">\n                            <awsui-textarea class="routing-xml" ng-if="cardOpen" ng-model="website.routingXML"></awsui-textarea>\n                        </div>\n                    </div>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-group ng-model="website.selectedValue">\n                        <awsui-radio-button name="staticWebsite" style="display: inline" value="redirectRequest" ng-model="website.selectedValue" label="{{ \'bucketproperties.website.label.redirectrequests\' | translate }}">\n                        </awsui-radio-button>\n                        <awsui-tooltip text="{{\'bucketproperties.website.redirectrequests.tooltip\' | translate}}" position="right" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                        <a class="learn-more-card-open-link" target="_blank" href="{{docLinks[\'redirect\']}}" translate="">learn.more</a>\n                    </awsui-radio-group>\n                </div>\n                <div ng-if="website.selectedValue === \'redirectRequest\'">\n                    <div class="awsui-row card-content-row">\n                        <label class="target-value" translate="bucketproperties.website.label.targetdomain"></label>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <awsui-textfield class="website-text-field" ng-model="website.targetDomain" placeholder="{{ \'bucketproperties.website.placeholder.targetdomain\' | translate }}"></awsui-textfield>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <label class="target-value" translate="bucketproperties.website.label.redirectrequestprotocol"></label>\n                    </div>\n                    <div class="awsui-row card-content-row">\n                        <awsui-textfield class="website-text-field" ng-model="website.redirectRequestProtocol" placeholder="{{ \'bucketproperties.website.placeholder.redirectrequestprotocol\' | translate }}"></awsui-textfield>\n                    </div>\n                </div>\n                <div class="awsui-row card-content-row">\n                    <awsui-radio-group ng-model="website.selectedValue">\n                        <awsui-radio-button name="staticWebsite" value="disable" ng-model="website.selectedValue" ng-if="cardOpen" label="{{ \'bucketproperties.website.label.disablewebsitehosting\' | translate }}">\n                        </awsui-radio-button>\n                    </awsui-radio-group>\n                </div>\n            </div>\n            <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLinks[\'hosting\']}}" translate="">learn.more</a>\n            <awsui-alert type="error" class="error-alert" readonly="readonly" ng-if="websiteError && cardOpen">{{ websiteErrorMessage }}</awsui-alert>\n        </div>\n    </card-content>\n    <card-footer>\n        <div ng-if="cardOpen" class="bucket-properties-buttons">\n            <awsui-button ng-click="cancelBucketWebsite($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n            <awsui-button id="save-bucket-website-hosting" data-disabled="shouldDisableSaveButton()" ng-click="saveBucketWebsite($event)" text="{{ \'button.save\' | translate }}" variant="primary"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/card.html",'<div class="card" ng-click="openCard()" ng-class="{ \'cardexpand\' : isOpen }">\n    <div class="card-header">\n        <div class="card-header-wrapper" ng-transclude="header"></div>\n    </div>\n    <div class="card-content">\n        <div class="card-content-wrapper" ng-transclude="content"></div>\n    </div>\n    <div class="card-footer awsui-util-t-r" ng-transclude="footer"></div>\n    <div class="bucket-status-display single-line" ng-if="!isOpen && cardSummaryObj && !cardSummaryObj.isMultiValue">\n        <div class="divide-line"></div>\n        <div ng-class="{\'icon card-disabled-icon\': !cardSummaryObj.isActive && !cardSummaryObj.isLoading, \'icon card-enabled-icon\': cardSummaryObj.isActive && !cardSummaryObj.isLoading, \'awsui-spinner awsui-spinner-disabled card-spinner\' : cardSummaryObj.isLoading }"></div>\n        <div ng-class="{\'card-status-text-gray\': !cardSummaryObj.isActive && !cardSummaryObj.isLoading, \'card-status-text\': cardSummaryObj.isActive && !cardSummaryObj.isLoading, \'card-summary-loading\': cardSummaryObj.isLoading }" translate="{{ cardSummaryObj.isLoading ? cardloadingMsg : cardSummaryObj.isActive ? cardSummaryObj.activeSummary.text : cardSummaryObj.inactiveSummary.text }}"></div>\n    </div>\n    <div class="bucket-status-display" ng-if="!isOpen && cardSummaryObj && cardSummaryObj.isMultiValue && !cardSummaryObj.isLoading">\n        <div class="divide-line"></div>\n        <table class="cardfooter-summary-table" ng-class="{\'multi-lines\' : cardSummaryObj.isActive}">\n            <tr>\n                <td class="icon-column" rowspan="2">\n                    <div class="icon" ng-class="{\'card-disabled-icon\': !cardSummaryObj.isActive, \'card-enabled-icon\': cardSummaryObj.isActive }"></div>\n                </td>\n                <td class="card-summary-valuetitle" ng-class="{\'card-status-text-gray\': !cardSummaryObj.isActive, \'card-status-text\': cardSummaryObj.isActive }" translate="{{ cardSummaryObj.isActive ? cardSummaryObj.activeSummary.text : cardSummaryObj.inactiveSummary.text }}">\n                </td>\n            </tr>\n            <tr>\n                <td><p class="truncate card-summary-value">{{ cardSummaryObj.activeSummary.value  }}</p></td>\n                <td></td>\n            </tr>\n        </table>\n    </div>\n</div>');a.put("/s3/partials/cloudwatch.html",'<table class="metrics-content-table">\n\n    <tr>\n        <td class="metrics-content-cell management-side-panel-color">\n            <div class="select-metrics-side-panel">\n                <span class="awsui-icon awsui-spinner awsui-spinner-large config-spinner" ng-if="models.configLoading"></span>\n                <table class="select-metrics-table" ng-if="!models.configLoading">\n                    <tr>\n                        <td>\n                            <span class="metrics-header">Metrics</span>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <table class="search-box prefix-search-box">\n                                <tbody>\n                                <tr>\n                                    <td class="search-icon"><i class="awsui-icon search"></i></td>\n                                    <td><input type="text" class="input-field ng-pristine ng-valid ng-empty ng-touched" ng-model="models.searchText" ng-keydown="filterKeyDown($event)" ng-click="searchClicked()" placeholder="{{ \'management.search.placeholder\' | translate }}"></td>\n                                </tr>\n                                </tbody>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <awsui-alert class="save-filter-info-alert" header="{{\'management.metric.info\'|translate}}" dismissible="true" visible="models.addInfoMessage" ng-click="models.addInfoMessage=false">{{ \'management.metrics.statistics.delay\' | translate}}</awsui-alert>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="side-panel-row" ng-class="{\'row-highlight\': models.bucketChecked}">\n                            <table border="0px">\n                                <tr>\n                                    <td>\n                                        <div class="row-checkbox">\n                                            <awsui-checkbox checked="models.bucketChecked" data-disabled="false" ng-model="models.bucketChecked" change="getCloudwatchMetrics()"></awsui-checkbox>\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <i class="awsui-icon bucket buckets-bucket-icon" ng-class="{\'awsui-icon-light\': models.bucketChecked}"></i>\n                                    </td>\n                                    <td>\n                                        <div class="buckets-name" ng-class="{\'bucket-selected\': models.bucketChecked}">\n                                            {{ bucketName }}\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <span class="awsui-icon awsui-icon-link pencil buckets-cog" ng-class="{\'awsui-icon-light\': models.bucketChecked}" ng-click="configureMetrics()"></span>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr ng-if="models.toggleMetricsConfig">\n                        <td class="bucket-dropdown-config dark">\n                            <div class="new-filter-params">\n                                <div class="select-metrics-row">\n                                    <div class="select-metrics-text" translate="management.metrics.side.select.select.info">\n                                    </div>\n                                    <div class="select-metrics-learn-more dark">\n                                        <a href="{{ getLearnMoreLink(\'configure-metrics-filter\') }}" target="_blank" class="ng-binding" translate="">learn.more</a>\n                                    </div>\n                                </div>\n\n                                <div class="list-all-metrics">\n                                    <div ng-repeat="metricType in metricTypes">\n                                        <div class="expandable-metrics-dropdown" ng-model="collapsed" ng-init="collapsed=true" data-disabled="models.applyingConfig" ng-click="collapsed=!collapsed">\n                                            <awsui-checkbox class="checkbox" checked="metricType.checked" change="checkAllPaidMetrics(metricType)" data-disabled="metricType.disable" ng-model="metricType.checked"></awsui-checkbox>\n                                            <span ng-if="collapsed" class="awsui-icon caret-right awsui-icon-light section"></span>\n                                            <span ng-if="!collapsed" class="awsui-icon caret-down awsui-icon-light section"></span>\n                                            <div class="dropdown-text section">\n                                                {{metricType.title}} ({{metricType.metrics.length}})\n                                            </div>\n                                            <div class="metric-charge-info">{{ metricType.info }}</div>\n                                            <div class="specific-metrics" ng-show="!collapsed">\n                                                <div class="specific-metric" ng-repeat="specificMetric in metricType.metrics">\n                                                    <div class="specific-metric-text">\n                                                        <awsui-checkbox checked="true" data-disabled="true">\n                                                            {{specificMetric.name}}\n                                                        </awsui-checkbox>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="select-metrics-buttons">\n                                    <table>\n                                        <tr>\n                                            <td class="metric-button-spacing">\n                                                <awsui-button variant="primary" text="{{ \'button.save\'   | translate}}" class="normal-button" ng-click="applyMetricsConfig()" loading="models.applyingConfig"></awsui-button>\n                                            </td>\n                                            <td>\n                                                <awsui-button variant="normal" text="{{ \'button.cancel\' | translate}}" class="normal-button" ng-click="cancelMetricsConfig()" data-disabled="models.applyingConfig"></awsui-button>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </div>\n\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td class="filter-header">\n                            <table border="0px" class="filters-table-header">\n                                <tr>\n                                    <td>\n                                        <div class="row-checkbox">\n                                            <awsui-checkbox checked="false" change="viewAllFilters()" data-disabled="filterList.length === 0" ng-model="models.allFilters"></awsui-checkbox>\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div class="filter-title" translate="management.metrics.side.filter.header" translate-values="{count: filterList.length}"></div>\n                                    </td>\n                                    <td>\n                                        <div class="filter-add" ng-click="addFilter()">\n                                            <div class="awsui-icon awsui-icon-link plus" translate="management.metrics.side.filter.add"></div>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    <tr ng-if="models.showAddFilter">\n                        <td class="bucket-dropdown-config dark">\n                            <table>\n                                <tr>\n                                    <td class="filter-title-cell">\n                                        <div class="filter-add-title" translate="management.metrics.side.filter.dropdown.add">\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>\n                                        <div class="new-filter-params">\n                                            <div class="new-filter-text" translate="management.metrics.side.filter.name.title">\n                                            </div>\n                                            <div class="new-filter-input">\n                                                <awsui-control-group>\n                                                    <span class="error-background-fix" dom-region="validationMessage" ng-if="models.filterNameError">\n                                                        {{models.filterNameError}}\n                                                    </span>\n\n                                                    <awsui-textfield placeholder="{{ \'management.metrics.side.filter.name.placeholder\' | translate}}" ng-keyup="validateFilter()" data-disabled="models.editFilter || models.savingFilter" ng-model="models.filterName"></awsui-textfield>\n                                                </awsui-control-group>\n                                            </div>\n\n                                            <div class="new-filter-text" translate="management.metrics.side.filter.prefix.title">\n                                            </div>\n                                            <div class="new-filter-input" ng-class="{\'new-filter-input-search\' : models.filterValue || (filters.tagFilters.length + filters.prefixFilters.length) > 0 }">\n                                                <search filters="filters" no-backend-calls="true" search-error="models.filterValueError"></search>\n                                            </div>\n\n\n                                            <div class="select-metrics-buttons">\n                                                <table>\n                                                    <tr>\n                                                        <td colspan="2">\n                                                            <div class="filter-delete">\n                                                                <awsui-button data-disabled="models.deleteFilter || models.savingFilter" loading="models.deleteFilter" icon="" variant="link" ng-click="deleteFilter()" ng-if="models.editFilter" text="{{ \'management.metrics.action.delete\' | translate }}">\n                                                                </awsui-button>\n                                                            </div>\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td class="metric-button-spacing">\n                                                            <awsui-button variant="primary" text="{{ \'button.save\'   | translate}}" data-disabled="models.savingFilter || models.deleteFilter\n                                                                          || !models.filterName || models.filterNameError" class="normal-button" loading="models.savingFilter" ng-click="saveFilter()"></awsui-button>\n                                                        </td>\n                                                        <td>\n                                                            <awsui-button variant="normal" text="{{ \'button.cancel\' | translate}}" class="normal-button" data-disabled="models.savingFilter || models.deleteFilter" click="cancelFilter()"></awsui-button>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                                <div class="filter-error">\n                                                    <awsui-alert type="error" header="{{\'error.header\'|translate}}" ng-if="models.filterError">{{models.filterError}}\n                                                    </awsui-alert>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    <tr ng-if="!models.showAddFilter && filterList.length > 0" class="filter-header">\n                        <td>\n                            <table class="filters-table">\n                                <tr ng-repeat="row in filterList | filter:models.searchText " ng-class="{\'row-selected\' : row.checked, \'row-hover\': hoverRule && !row.checked}" ng-click="filterChanged(row, $event)" ng-mouseenter="hoverRule = true" ng-mouseleave="hoverRule = false">\n                                    <td>\n                                        <div class="row-checkbox">\n                                            <awsui-checkbox data-disabled="false" checked="row.checked" change="filterChanged(row)" ng-click="$event.stopPropagation()"></awsui-checkbox>\n                                        </div>\n                                    </td>\n                                    <td class="filter-name-row">\n                                        <div>\n                                            {{row.Id}}\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <span class="awsui-icon awsui-icon-link pencil buckets-cog" ng-class="{\'awsui-icon-light\': row.checked}" ng-click="addFilter(row)"></span>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr ng-if="!models.showAddFilter && filterList.length === 0">\n                        <td>\n                            <div class="side-panel-metrics-help">\n                                <span translate="management.metrics.side.filter.help"></span> <br>\n\n                                <a href="{{ getLearnMoreLink(\'configure-metrics-filter\') }}" target="_blank" class="ng-binding" translate="">learn.more</a>\n                                <br>\n                                <br>\n                                <awsui-button data-disabled="false" loading="false" icon="plus" variant="primary" ng-click="addFilter()">\n                                    {{ \'management.metrics.side.filter.add\' | translate}}\n                                </awsui-button>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n        </td>\n        <td class="metrics-content-cell">\n\n            <div>\n                <div class="metrics-loading" ng-if="metricsLoading">\n                    <span class="awsui-icon awsui-spinner awsui-spinner-large">\n                </div>\n                <div ng-if="!metricsLoading">\n                    <div class="si-top-right-header">\n                        <div>\n                            <table class="metric-type">\n                                <tr>\n                                    <td ng-repeat="(key, metricType) in S3Constants.METRICS.TYPE" ng-class="{\'type-selected\' : selectedMetricType === metricType}" ng-click="setSelectedMetricType(metricType)">\n                                        {{ getGroupTitle(metricType) }}\n                                    </td>\n                                </tr>\n                            </table>\n                            <table class="time-range">\n                                <tr>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'H1\'}" ng-click="setTimeRange(\'H1\')" translate="">management.metrics.timeframe.1h\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'H3\'}" ng-click="setTimeRange(\'H3\')" translate="">management.metrics.timeframe.3h\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'H12\'}" ng-click="setTimeRange(\'H12\')" translate="">management.metrics.timeframe.12h\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'H24\'}" ng-click="setTimeRange(\'H24\')" translate="">management.metrics.timeframe.1d\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'W1\'}" ng-click="setTimeRange(\'W1\')" translate="">management.metrics.timeframe.1w\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <div ng-class="{\'timeframe-selected\': selectedTimeFrame === \'W2\'}" ng-click="setTimeRange(\'W2\')" translate="">management.metrics.timeframe.2w\n                                        </div>\n                                    </td>\n                                    <td>\n                                        <span class="awsui-icon refresh awsui-icon-light" ng-click="refresh()"></span>\n                                    </td>\n                                </tr>\n                            </table>\n                        </div>\n                    </div>\n                    <div class="si-metrics-list-header">\n                        <div>\n                            <table class="metrics-link-table">\n                                <tr>\n                                    <td ng-repeat="metric in metricsWithStats" ng-click="goToChart(metric.ref.chartId)">\n                                        <div class="metric-name" ng-class="{\'timeframe-selected\': selectedMetricGroup === metric.display}" ng-click="setMetricGroup(metric.display)">\n                                            {{ metric.display }}\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </div>\n\n                        <div class="metrics-update-time">{{ models.updatedOn }}</div>\n                    </div>\n                    <div class="metrics-error-main">\n                        <awsui-alert type="error" header="{{\'error.header\'|translate}}" visible="error">{{error}}\n                        </awsui-alert>\n                        <awsui-alert header="{{\'management.metric.info\'|translate}}" visible="info">{{info}}\n                        </awsui-alert>\n                    </div>\n                    <div class="inner-tab-container" ng-if="metrics[selectedMetricType]">\n                        <metrics-monitoring metric-list="metrics[selectedMetricType]" zoom="selectedTimeFrame"></metrics-monitoring>\n                    </div>\n                </div>\n            </div>\n\n        </td>\n    </tr>\n</table>');a.put("/s3/partials/confirmationdialogmodal.html",'<div class="confirmation-modal" ng-show="isOpen.flag">\n    <dialog-modal is-open="isOpen.dialogOpen" close-callback="closeConfirmationModal()" header-title="modalInfo.headTitle" has-warning-msg="modalInfo.warningInfo" count-info="countInfo" source-dst-info="sourceDstInfo">\n        <dialog-modal-content>\n            <file-list-in-modal selected="selected" close-icon-show="closeIconShow"></file-list-in-modal>\n        </dialog-modal-content>\n        <dialog-modal-footer>\n            <awsui-button id="cancel" text="{{ \'createbucketmodal.footer.cancel\' | translate }}" variant="normal" click="closeConfirmationModal()"></awsui-button>\n            <awsui-button id="create-primary" variant="primary" text="{{modalInfo.buttonName}}" class="awsui-util-f-r primary-button" loading="isCounting.flag" click="operationFunc()"></awsui-button>\n        </dialog-modal-footer>\n    </dialog-modal>\n</div>');a.put("/s3/partials/createbucketmodal.html",'<modal id="create-bucket-modal" class="create-bucket-modal" ng-class="{\'overflow-y-visible\': state===STEP.NAME_AND_REGION}" id="create-S3-bucket-modal" is-open="isOpen" steps="STEP" state="state" close-callback="closeCreateBucketModal" header-title="headerTitle" next-state="nextState" previous-state="previousState" set-state="setState">\n    \n    <modal-content>\n        <div id="content" class="create-bucket-modal-content">\n            <div class="createbucketbodycontent" ng-if="state === STEP.NAME_AND_REGION">\n                <p class="subheader" translate="createbucketmodal.label.nameandregion"></p>\n                <p class="label" translate="createbucketmodal.label.name"></p>\n                <awsui-tooltip text="{{\'createbucketmodal.bucketname.tooltip\' | translate}}" position="bottom" size="small">\n                    <i class="awsui-icon info-circle"></i>\n                </awsui-tooltip>\n                <div class="bucketname-and-region">\n                    <awsui-control-group>\n                        <span dom-region="validationMessage" ng-if="bucketNameValidationErrors.length > 0">\n                            <label ng-repeat="message in bucketNameValidationErrors">{{message}}</label><br>\n                        </span>\n                        <span dom-region="control">\n                            <awsui-textfield id="bucket-name" class="create-bucket-modal-input" autocomplete="true" ng-keyup="validateBucketName()" placeholder="{{\'createbucketmodal.placeholder.name\' | translate}}" ng-model="createBucketValues.name">\n                            </awsui-textfield>\n                        </span>\n                    </awsui-control-group>\n                </div>\n                <p class="label" translate="createbucketmodal.label.region"></p>\n                <dropdown items="regions" id="bucket-region" selected-item="createBucketValues.region" placeholder="{{ \'createbucketmodal.placeholder.region\' | translate }}" filter="true"></dropdown>\n                <div class="modal-content-divider"></div>\n                <p class="subheader" translate="createbucketmodal.label.copysettings"></p>\n                <bucket-selector class="bucket-selector" enable-deselect="true" get-source-bucket-properties="createBucketProperties.getResponse" get-source-bucket-permissions="sourceBucketPermissions" curr-bucket-permissions="currPermissions" copy-settings-source-bucket="createBucketValues.copySettingsSourceBucket" bucket-list="bucketList" operation="operation" default-acls="defaultAcls"></bucket-selector>\n            </div>\n            \n            <div class="createbucketproperites" ng-if="state === STEP.PROPERTIES">\n                <div class="wrapper create-bucket-card-style">\n                    <bucket-versioning id="create-bucket-versioning-card" card-open="toggleVersioning" versioning="createBucketProperties.getResponse.versioning" for-create-bucket-modal="forCreateBucketModal" replication="createBucketProperties.getResponse.replication"></bucket-versioning>\n                    <bucket-logging id="create-bucket-logging-card" card-open="toggleLogging" logging="createBucketProperties.getResponse.logging" create-bucket-values="createBucketValues" bucket-list="bucketList" for-create-bucket-modal="forCreateBucketModal"></bucket-logging>\n                    <bucket-tagging id="create-bucket-tagging-card" card-open="toggleTagging" bucket-tags="createBucketProperties.getResponse.tagging" for-create-bucket-modal="forCreateBucketModal"></bucket-tagging>\n                </div>\n            </div>\n            \n            <div ng-if="state === STEP.PERMISSIONS" class="createbucketpermissionsstep">\n                <modal-permissions public-permissions="currPermissions.publicPermissions" user-permissions="currPermissions.userPermissions" system-permissions="currPermissions.systemPermissions" show-system-permissions="true" modal-type="MODAL_TYPE.CREATE_BUCKET"></modal-permissions>\n            </div>\n            \n            <div ng-if="state === STEP.REVIEW" class="createbucketbodycontent">\n                <table id="review-table" class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="createbucketmodal.label.nameandregion"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" ng-click="setState(STEP.NAME_AND_REGION)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <table class="details-table">\n                    <tr>\n                        <td class="review-nameregion"><span class="review-detail-title" translate="createbucketmodal.label.name"></span><span class="review-detail-content"> {{createBucketValues.name}}</span></td>\n                        <td><span class="review-detail-title" translate="createbucketmodal.label.region"></span><span class="review-detail-content"> {{createBucketValues.region.text}}</span></td>\n                    </tr>\n                </table>\n                <table class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="createbucketmodal.label.properties"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" click="setState(STEP.PROPERTIES)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <table class="details-table">\n                    <tr ng-repeat="property in propertyStatuses">\n                        <td class="review-detail-title">{{property.name}}</td>\n                        <td class="review-detail-content">{{property.status}}</td>\n                    </tr>\n                </table>\n\n                <table class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="createbucketmodal.label.permissions"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" text="{{ \'createbucketmodal.button.edit\' | translate }}" variant="link" click="setState(STEP.PERMISSIONS)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <table class="details-table">\n                    <tr ng-repeat="acl in aclsSummaries">\n                        <td class="review-detail-title">{{acl.summaryTitle}}</td>\n                        <td class="review-detail-content">{{acl.value}}</td>\n                    </tr>\n                </table>\n\n                <awsui-alert visible="createS3BucketWarning" class="block small-top-margin" type="warning" dismissible="false" header="{{ \'warning.header\' | translate }}"> {{ createS3BucketWarning }}\n                </awsui-alert>\n\n                <awsui-alert visible="createS3BucketError" class="block small-top-margin" type="error" dismissible="false" header="{{ \'createbucketmodal.error.header\' | translate }}"> {{ createS3BucketError }}\n                </awsui-alert>\n            </div>\n        </div>\n    </modal-content>\n    <modal-footer>\n        <div class="create-bucket-modal-footer">\n            <awsui-button id="next" ng-if="state !== STEP.REVIEW" variant="primary" text="{{ \'createbucketmodal.footer.next\' | translate }}" class="awsui-util-f-r primary-button" click="generateSummary()" data-disabled="!createBucketValues.name || bucketNameValidationErrors.length > 0 || !createBucketValues.region">\n            </awsui-button>\n            <awsui-button id="create-primary" ng-if="state === STEP.REVIEW" variant="primary" text="{{ \'createbucketmodal.footer.confirm\' | translate }}" class="awsui-util-f-r primary-button" click="createBucket(createBucketValues.name, createBucketValues.region)" loading="isCreatingBucket" data-disabled="!createBucketValues.name || !createBucketValues.region || createS3BucketWarning">\n            </awsui-button>\n            <awsui-button id="cancel" text="{{ \'createbucketmodal.footer.cancel\' | translate }}" variant="normal" ng-if="state === STEP.NAME_AND_REGION" class="awsui-util-f-r" click="closeCreateBucketModal()">\n            </awsui-button>\n            <awsui-button id="previous" text="{{ \'createbucketmodal.footer.previous\' | translate }}" variant="normal" ng-if="state !== STEP.NAME_AND_REGION" class="awsui-util-f-r" click="goToPreviousState()" data-disabled="createS3BucketWarning">\n            </awsui-button>\n            <awsui-button id="create-secondary" ng-if="state === STEP.NAME_AND_REGION" variant="normal" text="{{ \'createbucketmodal.footer.createnow\' | translate }}" class="awsui-util-f-l" click="createBucket(createBucketValues.name, createBucketValues.region)" loading="isCreatingBucket" data-disabled="!createBucketValues.name || !createBucketValues.region">\n            </awsui-button>\n        </div>\n    </modal-footer>\n</modal>');a.put("/s3/partials/detailprogress.html",'<modal class="detail-progress" is-open="isOpen" header-title="targetOperation.displayName" close-callback="closeCallback">\n    <modal-header>\n        <div class="detail-progress-header">\n            <span class="operation-water-mark operation-water-mark-image"></span>\n            <div class="operation-modal-title" ng-if="isActiveUploadOperation()">{{ targetOperation.displayName }} ({{ targetOperation.currentUploadSpeed }}/s)</div>\n            <div class="operation-modal-title" ng-if="!isActiveUploadOperation()">{{ targetOperation.displayName }}</div>\n            <div class="operation-modal-percentage">{{ targetOperation.successPercentage }}% {{ "operation.progress.complete" | translate }}</div>\n            <div class="detail-progress-overall-progress">\n                <div class="detail-progress-bar"></div>\n                <div class="detail-progress-bar-fill"></div>\n            </div>\n        </div>\n    </modal-header>\n    <modal-content>\n        <div class="operation-info">\n            <div class="source-info truncate">\n                <span class="info-text" translate="operation.detail.sourcepath"></span>\n                <a href="{{targetOperation.operationInitialLocationUrl}}">{{ targetOperation.operationPath }}</a>\n            </div>\n            <div class="target-info truncate" ng-if="targetOperation.dstBucket">\n                <span class="info-text" translate="operation.detail.targetpath"></span>\n                <a href="{{targetOperation.operationDestinationUrl}}">{{ targetOperation.operationDestinationPath }}</a>\n            </div>\n        </div>\n        <div class="detail-progress-content">\n            <table class="detail-progress-overall-table">\n                <tr>\n                    <td>\n                        <span class="object-progress-icon awsui-icon" ng-class="{\'alert-check-circle\': targetOperation.parameters.operationSuccessful, \'alert-exclamation-circle\': targetOperation.parameters.operationUnsuccessful, \'alert-exclamation-triangle\': targetOperation.parameters.operationPartiallySuccessful}"></span>\n                        <div ng-if="targetOperation.name === UPLOAD_OPERATION" class="detail-progress-text total-count" translate="">operation.detail.totalfiles</div>\n                        <div ng-if="targetOperation.name !== UPLOAD_OPERATION" class="detail-progress-text total-count" translate="">operation.detail.totalObjects</div>\n                    </td>\n                    <td><div class="detail-progress-text total-objects-count">{{ targetOperation.totalObjectCount }}</div></td>\n                </tr>\n                <tr>\n                    <td class="success-count-line">\n                        <div class="detail-progress-text total-successful" translate="">operation.detail.successful</div>\n                    </td>\n                    <td class="total-success-count-percentage">\n                        <div ng-if="targetOperation.parameters.isDeleteBucketSuccessful" class="detail-progress-text total-successful-count">{{ targetOperation.succeedKeyCount }} ({{ targetOperation.successPercentage-50 }}%)</div>\n                        <div ng-if="shouldShowByteText()" class="detail-progress-text total-successful-count" translate="" translate-values="{ succeedKeyCount : {{targetOperation.succeedKeyCount}}, successPercentage: {{targetOperation.successPercentage}} }">operation.detail.successInfo</div>\n                        <div ng-if="!shouldShowByteText()" class="detail-progress-text total-successful-count">{{ targetOperation.succeedKeyCount }} ({{ targetOperation.successPercentage }}%)</div>\n                    </td>\n                </tr>\n                <tr ng-repeat="errorType in targetOperation.errorTypes">\n                    <td class="error-files-list-expander">\n                        <i class="awsui-icon alert-exclamation-circle hidden"></i>\n                        <awsui-expandable-section class="expander dark" header="{{errorType.errorMessage}}" expanded="false">\n                            <table class="files-list-table">\n                                <tr class="file-role" ng-repeat="errorKey in targetOperation.errorDetails[errorType.errorMessage]">\n                                    <td class="file-icon">\n                                        <span class="awsui-icon awsui-icon-light" ng-class="getFileIconClass(errorKey)"></span>\n                                    </td>\n                                    <td class="object-detail">\n                                        <div class="object-name">{{ errorKey }}</div>\n                                        <div class="object-info">/{{ targetOperation.initialBucket }}/{{ targetOperation.initialPath }}</div>\n                                    </td>\n                                    <td class="error-icon"><i class="awsui-icon alert-exclamation-circle"></i></td>\n                                </tr>\n                            </table>\n                        </awsui-expandable-section>\n                    </td>\n                    <td class="error-count-percentage">\n                        <div ng-if="targetOperation.name === deleteBucketOperationName" class="detail-progress-text total-successful-count">{{ errorType.errorCount }} ({{ targetOperation.errorPercentage-50 }}%)</div>\n                        <div ng-if="targetOperation.name !== deleteBucketOperationName" class="detail-progress-text total-successful-count">{{ errorType.errorCount }} ({{ targetOperation.errorPercentage }}%)</div>\n                    </td>\n                </tr>\n                <tr ng-if="targetOperation.name === deleteBucketOperationName">\n                    <td>\n                        <span class="object-progress-icon awsui-icon" ng-class="{\'alert-check-circle\': targetOperation.parameters.isDeleteBucketSuccessful, \'alert-exclamation-circle\': !targetOperation.parameters.isDeleteBucketSuccessful }"></span>\n                        <div class="detail-progress-text total-count" translate="">operation.detail.bucketDeletion</div>\n                    </td>\n                    <td ng-if="targetOperation.parameters.isDeleteBucketSuccessful"><div class="detail-progress-text deletion-status" translate="">operation.detail.successful</div></td>\n                    <td ng-if="!targetOperation.parameters.isDeleteBucketSuccessful"><div class="detail-progress-text deletion-status" translate="">operation.detail.failed</div></td>\n                </tr>\n            </table>\n        </div>\n    </modal-content>\n    <modal-footer>\n        <div class="detail-progress-footer">\n            <div class="cancel-operation-button" ng-click="cancelOperationFunction(targetOperation)">\n                <div class="cancel-operation-button-text">{{ cancelButtonText }}</div>\n            </div>\n        </div>\n    </modal-footer>\n</modal>');a.put("/s3/partials/dialogmodal.html",'<div class="aws-modal" id="confirmation-modal">\n    <div ng-show="isOpen.flag" class="modal-frame fade in ng-hide">\n        <div class="modal-header" ng-class="getClass()">\n            <i class="panel-close-icon modal-close" ng-click="closeModal()"></i>\n            <div class="modal-header-title">{{headerTitle}}</div>\n            <div class="modal-header-divider"></div>\n            <div ng-transclude="header"></div>\n        </div>\n        <div ng-if="countInfo.flag" class="confirmation-info-subheader">\n            <table class="dialog-info-table">\n                <tr class="dialog-info-text">\n                    <td colspan="2" class="confirmation-info-text" translate="confirmationmodal.countinfo.title.currentlevel"></td>\n                    <td colspan="2" class="confirmation-info-text">\n                        <span translate="">confirmationmodal.countinfo.title.totalimpact</span>\n                        <awsui-tooltip text="{{\'confirmationmodal.totalimpact.tooltip\' | translate}}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                        <a class="confirmation-modal-learn-more" target="_blank" href="https://docs.aws.amazon.com/console/s3/ui-folder" translate="">learn.more</a>\n                    </td>\n                </tr>\n                <tr class="dialog-info-data">\n                    <td id="confirmation-modal-folder-count" translate="confirmationmodal.countinfo.folders" translate-values="{ folderCount : {{countInfo.folders}} }"></td>\n                    <td id="confirmation-modal-object-count" translate="confirmationmodal.countinfo.objects" translate-values="{ objectCount : {{countInfo.currLevelObjs}} }"></td>\n                    <td translate="confirmationmodal.countinfo.totalobjects" translate-values="{ totalObjCount : {{countInfo.objects}} }"></td>\n                    <td>\n                        <awsui-tooltip ng-if="countInfo.sizeDataMissing" text="{{\'confirmationmodal.info.sizedatamissing\' | translate}}" position="bottom" size="small">\n                            <span>\n                                {{countInfo.size | humanReadableBytes}}\n                                <span>*</span>\n                            </span>\n                        </awsui-tooltip>\n                        <span ng-if="!countInfo.sizeDataMissing">\n                            {{countInfo.size | humanReadableBytes}}\n                        </span>\n\n                        <span translate="confirmationmodal.countinfo.totalsize"></span>\n                    </td>\n                </tr>\n            </table>\n        </div>\n        <div ng-if="sourceDstInfo.flag" class="paste-subheader-info">\n            <table>\n                <tr>\n                    <td>\n                        <translate class="confirmation-label">confirmationmodal.source</translate>\n                        <span>{{sourceDstInfo.source}}</span>\n                    </td>\n                    <td>\n                        <translate class="confirmation-label">confirmationmodal.dst</translate>\n                        <span>{{dstFolderPath}}</span>\n                    </td>\n                </tr>\n            </table>\n        </div>\n        <div class="modal-body" ng-transclude="content" ng-class="{\n                           \'modal-body-height-with-warning\': hasWarningMsg.flag && !sourceDstInfo.flag,\n                           \'modal-body-height-without-warning\': !hasWarningMsg.flag,\n                           \'modal-body-height-with-warning-and-source-dst-info\': hasWarningMsg.flag && sourceDstInfo.flag\n                       }">\n        </div>\n        <div class="modal-footer">\n            <div class="confirmation-banner">\n                <div class="footer-divider"></div>\n                <awsui-alert ng-if="hasWarningMsg.flag" type="warning" dismissible="false">\n                    <p translate="{{hasWarningMsg.text}}" translate-values="{val: \'{{hasWarningMsg.val}}\' }"></p>\n                </awsui-alert>\n            </div>\n            <div ng-transclude="footer"></div>\n        </div>\n    </div>\n    <div ng-show="isOpen.flag" class="modal-background ng-hide"></div>\n</div>');a.put("/s3/partials/dropdown.html",'<div id="dropdown" class="dropdown" clickoutside="" on-click-outside="closeDropDown">\n    <table id="current-displayed-table" class="awsui-select-target current-displayed" ng-class="{\'dropdown-disabled\' : disabled}" ng-click="toggleDropDown(disabled)">\n        <tr ng-if="!selectedItem.displayTextField && !enableInput" class="current-displayed-row" ng-class="{\'dropdown-disabled\' : disabled, \'item-selected\' : selectedItem && !disabled, \'item-not-selected\': !selectedItem && !disabled}">\n            <td class="current-displayed-item" ng-class="{ \'disabled-text\': disabled }"><div class="truncate-dropdown" ng-style="{\'width\':getDisplayWidth()}">{{ selectedItem.text || selectedItem || placeholder }}</div></td>\n        </tr>\n        <tr class="current-displayed-row" ng-class="{\'dropdown-disabled\' : disabled, \'item-selected\' : selectedItem, \'item-not-selected\': !selectedItem}" ng-if="enableInput">\n            <td>\n                <awsui-textfield class="dropdown-inputfield" name="inputValidation" ng-model="inputField.text" ng-change="updateInput(inputField)" placeholder="{{\'granteedropdown.placeholder\' | translate }}"></awsui-textfield>\n            </td>\n        </tr>\n        <tr class="current-displayed-row" ng-class="{\'dropdown-disabled\' : disabled}" ng-if="selectedItem.displayTextField">\n            <td class="dropdown-input-td">\n                <awsui-textfield class="dropdown-inputfield" data-disabled="disabled" ng-model="selectedItem.inputValue" placeholder="{{ selectedItem.value }}"></awsui-textfield>\n            </td>\n        </tr>\n    </table>\n    <div class="list-items" ng-if="isOpen">\n        <table ng-if="filter" id="search-box" class="search-box">\n            <tr>\n                <td class="dropdown-search-inputtext"><input type="text" class="input-field" ng-model="tableFiltering.filter[filterColumn]" ng-keydown="filterKeyDown($event)" placeholder="{{ \'dropdown.inputfield.placeholder\' | translate }}"></td>\n                <td><i class="awsui-icon search"></i></td>\n            </tr>\n        </table>\n        <div class="item" ng-repeat="item in items | filter:tableFiltering.filter | orderBy:[\'pinnedTop\', \'text || toString()\'] " ng-click="selectItem(item)">\n            <div class="list-item">{{item.text || item}}</div>\n        </div>\n        <span class="no-matches-found" ng-if="((items | filter:tableFiltering.filter).length == 0)" translate="dropdown.nomatchesfound"></span>\n    </div>\n</div>');a.put("/s3/partials/editor.html",'<div class="ide-container">\n    <div id="editor" class="ide" ng-class="{ \'editor-large\': large, \'readonly\': readonly }" ng-model="code" ui-ace="{theme: \'dawn\', mode: \'javascript\', fontSize: 14, onLoad: aceLoaded}">\n    </div>\n</div>');a.put("/s3/partials/emptystate.html",'<div id="initial-start-page">\n    <div id="initial-start-top-content" class="awsui-util-t-c">\n        <div class="initial-start-paragraph" translate="emptystate.{{type}}.title"></div>\n    </div>\n    <table id="initial-start-selling-points">\n        <tbody>\n        <tr class="awsui-util-t-c" ng-if="!oneIntroImage">\n            <td>\n                <div class="intro-image no-{{type}}-1"></div>\n                <div class="intro-feature" translate="emptystate.{{type}}.firstheader"></div>\n            </td>\n            <td>\n                <div class="intro-image no-{{type}}-2"></div>\n                <div class="intro-feature" translate="emptystate.{{type}}.secondheader"></div>\n            </td>\n            <td>\n                <div class="intro-image no-{{type}}-3"></div>\n                <div class="intro-feature" translate="emptystate.{{type}}.thirdheader"></div>\n            </td>\n        </tr>\n        <tr class="awsui-util-t-c" ng-if="oneIntroImage">\n            <td>\n                <div class="intro-image no-{{type}}-1"></div>\n                <div class="intro-feature" translate="emptystate.{{type}}.firstheader"></div>\n            </td>\n        </tr>\n        <tr ng-if="!oneIntroImage">\n            <td class="intro-feature-details" translate="emptystate.{{type}}.firstdetails"></td>\n            <td class="intro-feature-details" translate="emptystate.{{type}}.seconddetails"></td>\n            <td class="intro-feature-details" translate="emptystate.{{type}}.thirddetails"></td>\n        </tr>\n        <tr ng-if="oneIntroImage">\n            <td class="replication-intro-feature-details"><div class="replication-detail-msg" translate="emptystate.{{type}}.firstdetails"></div></td>\n        </tr>\n        <tr id="initial-start-feature-learn-more" class="awsui-util-t-c" ng-if="!oneIntroImage">\n            <td><a href="{{getLearnMoreLink(0)}}" target="_blank">{{\'learn.more\'|translate}}</a></td>\n            <td><a href="{{getLearnMoreLink(1)}}" target="_blank">{{\'learn.more\'|translate}}</a></td>\n            <td><a href="{{getLearnMoreLink(2)}}" target="_blank">{{\'learn.more\'|translate}}</a></td>\n        </tr>\n        <tr class="awsui-util-t-c" ng-if="oneIntroImage">\n            <td><a href="{{getLearnMoreLink(0)}}" target="_blank">{{\'learn.more\'|translate}}</a></td>\n        </tr>\n        </tbody>\n    </table>\n    <div id="initial-start-support">\n        <awsui-button class="awsui-util-mb-s" text="{{\'get.started\' | translate}}" variant="primary" click="openModal()"></awsui-button>\n    </div>\n</div>');a.put("/s3/partials/events.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-events-water-mark\': !cardOpen, \'card-enable-events-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="events.header"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="closeCard($event)"></div>\n    </card-header>\n    <card-content>\n        <awsui-button ng-if="cardOpen" data-disabled="cardState.isAdding" text="{{\'events.button.addnotification\' | translate}}" icon="plus" variant="link" click="addEvent()"></awsui-button>\n        <awsui-button ng-if="cardOpen" data-disabled="cardState.selectedEventTable === null || cardState.isAdding" text="{{ \'events.button.delete\' | translate }}" variant="link" click="deletePressed()" loading="isDeleting">\n        </awsui-button>\n        <awsui-button ng-if="cardOpen" data-disabled="cardState.selectedEventTable === null || cardState.isAdding" text="{{ \'events.button.edit\' | translate }}" variant="link" click="editPressed()">\n        </awsui-button>\n        <div class="events-table" ng-if="cardOpen">\n            <awsui-radio-group ng-model="cardState.radioValue">\n                <table class="table table-condense">\n                    <thead>\n                        <tr>\n                            <td></td>\n                            <td translate="">events.table.name</td>\n                            <td translate="">events.table.events</td>\n                            <td translate="">events.table.filter</td>\n                            <td translate="">events.table.type</td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr ng-repeat-start="event in eventsTable" class="add-events-row" ng-if="event.isEditing">\n                            <td colspan="4">{{ cardState.headerTitle }}</td>\n                            <td colspan="1">\n                                <span class="panel-close-icon close-button" ng-click="closeAddEvents()"></span>\n                            </td>\n                        </tr>\n                        <tr ng-repeat-end="">\n                            <td colspan="5" ng-if="event.isEditing">\n                                <add-events-form id="add-events-form" event-types="eventTypes" selected-event="cardState.selectedEventObj" resource-types="resourceTypes" modal-info="modalInfo" for-create-bucket-modal="forCreateBucketModal" card-state="cardState" current-events="currentEvents"></add-events-form>\n                            </td>\n                            <td ng-if="!event.isEditing">\n                                <awsui-radio-button ng-click="selectEvent(event)" value="{{event.id}}">\n                                    <td ng-if="!event.isEditing" class="event-id">{{event.id}}</td>\n                                    <td ng-if="!event.isEditing">{{event.events}}</td>\n                                    <td ng-if="!event.isEditing">{{event.filter}}</td>\n                                    <td ng-if="!event.isEditing">{{event.type}}</td>\n                                </awsui-radio-button>\n                            </td>\n                        </tr>\n                    </tbody>\n                    <tr ng-if="currEvents.length === 0 && !isAddingEvent">\n                        <td colspan="5">\n                            <div class="empty-message">\n                                {{ \'events.table.emptymessage\' | translate }}\n                                <awsui-button text="{{\'events.button.addnotification\' | translate}}" ng-click="openAddEventModal()"></awsui-button>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </awsui-radio-group>\n        </div>\n        <p ng-if="!cardOpen" class="bucketproperties-summary" translate="bucketproperties.events.summary"></p>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert ng-if="cardOpen" type="error" visible="cardState.showError">{{ cardState.errorMessage }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button text="{{ \'events.button.save\' | translate }}" variant="primary" data-disabled="cardState.selectedEventObj.name === \'\' || cardState.selectedEventObj.arn === \'\'" class="awsui-util-f-r buttons" ng-click="savePressed($event)" loading="cardState.isSaving">\n            </awsui-button>\n            <awsui-button text="{{ \'events.button.cancel\' | translate }}" variant="normal" class="awsui-util-f-r buttons" ng-click="cancelPressed($event)">\n            </awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/fileslistinmodal.html",'<div ng-show="haveSelectedItems()" class="truncate">\n    <table class="modal-selected-files">\n        <tr ng-show="forUploads">\n            <td colspan="4">\n                <span class="awsui-icon plus awsui-icon-link" for="uploadInput"></span>\n                <label class="modal-add-files-label" id="modal-selected-files-upload-add" for="uploadInput">{{\'uploadmodal.label.add.more.files\' | translate }}</label>\n            </td>\n        </tr>\n        <tr ng-repeat="folder in selectedItems.folders">\n            <td class="modal-file-icon"><span class="folder awsui-icon awsui-icon-light"></span></td>\n            <td>\n                <p class="modal-selected-files-file-name">{{ folder.Prefix }}</p>\n                <p class="modal-selected-files-file-size">\n                    <span ng-if="folder.objsCount === null || folder.objsCount === undefined" translate="confirmationmodal.filelist.calculating"></span>\n                    <span ng-if="folder.objsCount !== null && folder.objsCount !== undefined" translate="confirmationmodal.folders" translate-values="{totalFolders: {{folder.objsCount}} }"></span>\n                    <span ng-if="folder.objsCount !== null && folder.objsCount !== undefined">- {{folder.folderSize | humanReadableBytes }} </span>\n                </p>\n            </td>\n            <td>\n                <span class="awsui-icon times awsui-icon-big awsui-icon-light" ng-show="closeIconShow" ng-click="closeIconFunc(folder)"></span>\n            </td>\n        </tr>\n        <tr ng-repeat="file in selectedItems.objects">\n            <td><span class="awsui-icon awsui-icon-light" ng-class="getFileIconClass(file)"></span></td>\n            <td>\n                <p class="modal-selected-files-file-name">{{ file.Key }}</p>\n                <p class="modal-selected-files-file-size">\n                    <span ng-if="file.Size">- {{ file.Size | humanReadableBytes }}</span>\n                    <span ng-if="!file.Size"> -- </span>\n                </p>\n            </td>\n            <td>\n                <span class="awsui-icon times awsui-icon-big awsui-icon-light" ng-show="closeIconShow" ng-click="closeIconFunc(file)"></span>\n            </td>\n        </tr>\n    </table>\n</div>');a.put("/s3/partials/hint.html",'<div class="useful-links">\n    <div class="hint-button" fac-id="s3-old-console">\n        <awsui-tooltip text="{{\'tooltip.oldconsole\' | translate}}" position="bottom" size="small">\n            <span class="switch-oldconsole hint-icons"></span><awsui-button variant="link" click="goToOldConsole()" text="{{\'button.oldconsole\' | translate}}" class="switch-back-button"></awsui-button>\n        </awsui-tooltip>\n    </div>\n    <div ng-if="showVideo()" class="hint-button" fac-id="s3-intro-video">\n        <span class="introvideo hint-icons"></span><awsui-button variant="link" click="goToVideo()" text="{{\'button.introvideo\' | translate}}" class="switch-back-button"></awsui-button>\n    </div>\n    <div class="tips-button" fac-id="s3-quick-tips">\n        <awsui-tooltip text="{{hintMessage}}" position="bottom" size="small">\n            <i class="blue-lightbulb hint-icons"></i><awsui-button variant="link" text="{{\'hint.label\' | translate}}" class="hint-tips-button"></awsui-button>\n        </awsui-tooltip>\n    </div>\n</div>');a.put("/s3/partials/initiaterestore.html",'<div class="initiate-restore-modal" ng-show="isOpen.flag">\n    <dialog-modal is-open="isOpen" close-callback="closeModal()" header-title="headerTitle" count-info="countInfo">\n        <dialog-modal-content>\n            <div class="num-of-days-section">\n                <p class="label" translate="initiaterestoremodal.label.numOfDays"></p>\n                <awsui-control-group>\n                        <span dom-region="validationMessage" ng-if="numOfDaysError.length > 0">\n                            <label ng-repeat="message in numOfDaysError">{{message}}</label><br>\n                        </span>\n                    <span dom-region="control">\n                            <awsui-textfield id="num-of-days" class="num-of-days" ng-model="params.numOfDays" ng-keyup="validateNumOfDays()" placeholder="{{\'initiaterestoremodal.placeholder.numOfDays\' | translate}}">\n                            </awsui-textfield>\n                        </span>\n                </awsui-control-group>\n            </div>\n            <div class="retrieval-option-section">\n                <div class="retrieval-option-text">\n                    <p class="label" translate="initiaterestoremodal.label.retrievalOption"></p>\n                </div>\n                <dropdown items="retrievalOptions" placeholder="{{ \'initiaterestoremodal.dropboxselectwarning\' | translate }}" id="retrieval-option-dropdown" selected-item="params.retrievalOption"></dropdown>\n                <p ng-if="!showCapacityInfo" class="label learn-more-pricing" translate="initiaterestoremodal.label.glacierPricing" translate-values="{link: learnMoreUrl}"></p>\n            </div>\n            <div ng-if="showCapacityInfo" class="provisioned-capacity-info">\n                <span class="provisioned-capacity-availability">\n                    <p class="label provisioned-capacity-available-text" translate="initiaterestoremodal.label.provisionedCapacity"></p>\n                    <p class="label">{{ capacityUnitsAvailable }}</p>\n                </span>\n                <div>\n                    <awsui-button class="add-capacity" text="{{ \'initiaterestoremodal.button.addCapacity\' | translate }}" variant="normal" click="addCapacity()" loading="isPurchasingCapacity"></awsui-button>\n                    <awsui-alert ng-if="showBuyConfirmation" type="info" dismissible="false">\n                        <span dom-region="header" translate="initiaterestoremodal.label.provisionedCapacityCost" translate-values="{ val: capacityCost, link: learnMoreUrl }"></span>\n                        <span dom-region="content">\n                             <awsui-button class="buy-capacity" text="{{ \'initiaterestoremodal.button.buy\' | translate }}" variant="normal" click="buyCapacity()" loading="isPurchasingCapacity"></awsui-button>\n                         </span>\n                    </awsui-alert>\n\n                    <awsui-alert ng-if="isPurchaseSuccessful" type="success" dismissible="false" header="{{ \'initiaterestoremodal.purchasedetails.succeedText\' | translate }}">\n                        <p translate="initiaterestoremodal.purchasedetails.priceText" translate-values="{ val: capacityCost }"></p>\n                        <p translate="initiaterestoremodal.purchasedetails.learnMore" translate-values="{link: learnMoreUrl}"></p>\n                    </awsui-alert>\n                </div>\n            </div>\n            <div>\n                <div ng-if="showCapacityInfo && capacityUnitsAvailable < 1" class="provisioned-capacity-info-text" translate="initiaterestoremodal.label.provisionedCapacityInfo" translate-values="{link: learnMoreDataRetrievalUrl}"></div>\n                <div ng-if="showCapacityInfo && capacityUnitsAvailable > 0">\n                    <table class="expandsectable">\n                        <tr class="subsectitle-row">\n                            <td ng-repeat="title in titles">\n                                {{title.txt}}\n                                <awsui-tooltip text="{{title.info}}" position="{{title.pos}}" size="small">\n                                    <i class="awsui-icon alert-info-circle"></i>\n                                </awsui-tooltip>\n                            </td>\n                        </tr>\n                        <tr class="subseccontent-row" ng-repeat="unit in capacityUnits">\n                            <td>{{unit.id}}</td>\n                            <td>{{unit.purchaseDate}}</td>\n                            <td>{{unit.expirationDate}}</td>\n                        </tr>\n                    </table>\n                </div>\n            </div>\n            <awsui-alert class="retrieval-error" type="error" ng-if="retrievalError" dismissible="false"> {{ retrievalError }} </awsui-alert>\n        </dialog-modal-content>\n        <dialog-modal-footer>\n            <div class="upload-modal-footer">\n                <div class="confirmation-banner">\n                    <awsui-alert type="warning" dismissible="false">\n                        <p translate="initiaterestoremodal.alert.storageMessage"></p>\n                    </awsui-alert>\n                </div>\n                <awsui-button id="cancel" text="{{ \'button.cancel\' | translate }}" variant="normal" click="closeModal()"></awsui-button>\n                <awsui-button id="restore" class="awsui-util-f-r primary-button" text="{{ \'initiaterestoremodal.footer.restore\' | translate }}" variant="primary" click="restore()" data-disabled="!params.numOfDays || !params.retrievalOption || numOfDaysError.length > 0"></awsui-button>\n            </div>\n        </dialog-modal-footer>\n    </dialog-modal>\n</div>');a.put("/s3/partials/lifecycleconfirmationmodal.html",'<dialog-modal class="lifecycle-confirmation-modal" is-open="isOpen" close-callback="closeConfirmationModal" header-title="headerTitle">\n    <dialog-modal-content>\n        <awsui-alert class="confirmation-warning" visible="!showContinue" type="warning"> {{ warningMessage }} </awsui-alert>\n        <awsui-alert class="confirmation-warning" visible="showContinue" type="warning"> {{ stateChangeWarning }}</awsui-alert>\n        <awsui-alert visible="lifecycleError" class="block small-top-margin" type="error" dismissible="false" header="{{ \'lifecyclemodal.step3.error.header\' | translate }}"> {{ lifecycleError }}\n        </awsui-alert>\n    </dialog-modal-content>\n    <dialog-modal-footer>\n        <awsui-button id="cancel" text="{{ \'createbucketmodal.footer.cancel\' | translate }}" variant="normal" click="closeConfirmationModal()"></awsui-button>\n        <awsui-button id="continue" variant="primary" ng-if="!showContinue" text="{{ \'lifecycleconfirmationmodal.footer.confirm\' | translate }}" class="awsui-util-f-r primary-button" click="detectStateChange()">\n        </awsui-button>\n        <awsui-button id="save" ng-if="showContinue" click="saveLifecycle()" variant="primary" text="{{ \'lifecyclemodal.footer.continue\' | translate }}" class="awsui-util-f-r primary-button">\n        </awsui-button>\n    </dialog-modal-footer>\n</dialog-modal>');a.put("/s3/partials/lifecyclemodal.html",'<modal id="lifecycle-modal" class="lifecycle-modal" ng-class="{\'overflow-y-visible\': state===STEP.NAME_AND_SCOPE}" is-open="isOpen" steps="STEP" state="state" close-callback="closeLifecycleModal" header-title="headerTitle" next-state="nextState" previous-state="previousState" set-state="setState">\n    <modal-content>\n        <div class="lifecycle-modal-content">\n            <div class="body-content" ng-if="state === STEP.NAME_AND_SCOPE">\n                <p class="label" translate="lifecyclemodal.label.policyname"></p>\n                <awsui-textfield id="rule-name" class="policy-name" change="updateNextButtonDisabled()" ng-model="selectedRule.ID" placeholder="{{\'lifecyclemodal.placeholder.policyname\' | translate}}">\n                </awsui-textfield>\n                <table>\n                    <tr>\n                        <td>\n                            <p class="label" translate="lifecyclemodal.label.applypolicy"></p>\n                        </td>\n                        <td class="tool-tip-text-subheader">\n                            <awsui-tooltip text="{{ \'lifecyclemodal.prefixtag.tooltip\' | translate }}" position="right" size="small">\n                                <i class="awsui-icon alert-info-circle"></i>\n                            </awsui-tooltip>\n                        </td>\n                    </tr>\n                </table>\n                <div ng-if="showOldUI" fac="s3-ot" fac-toggle="">\n                    <awsui-radio-group class="step1-radio-buttons" ng-model="selectedRule.applied" change="updateNextButtonDisabled()">\n                        <awsui-radio-button class="step1-radio-buttons" value="whole" ng-model="selectedRule.applied" label="{{ \'lifecyclemodal.step1.wholebucket\' | translate }}"></awsui-radio-button>\n                        <awsui-radio-button class="step1-radio-buttons" value="prefix" ng-model="selectedRule.applied" label="{{ \'lifecyclemodal.step1.prefix\' | translate }}"></awsui-radio-button>\n                    </awsui-radio-group>\n                    <awsui-textfield ng-if="selectedRule.applied === \'prefix\'" change="updateNextButtonDisabled()" class="policy-name" autocomplete="true" ng-model="selectedRule.Prefix" placeholder="{{\'lifecyclemodal.placeholder.prefix\' | translate}}">\n                    </awsui-textfield>\n                </div>\n                <div ng-if="!showOldUI" class="lifecycle-tag-search">\n                    <search fac-id="s3-ot" fetch-one-page-prefix="fetchOnePagePrefix(prefix)" fetch-one-page-tag="fetchOnePageTag()" filters="selectedRule.filters" markers="markers" tag-continuation-tokens="tagContinuationTokens" no-backend-calls="true" search-error="tag.error" tag-search-selected="tagSearchSelected" show-tag="showTag">\n                    </search>\n                </div>\n                <awsui-alert visible="showV2FormatWarning" type="warning">\n                    {{ \'lifecyclemodal.warning.newformatwarning\' | translate }}\n                </awsui-alert>\n                <awsui-alert visible="clearLDMAMUWarning" type="warning">\n                    {{ \'lifecyclemodal.warning.removeldmamu\' | translate }}\n                </awsui-alert>\n            </div>\n            <div class="body-content" ng-if="state === STEP.TRANSITION">\n                <table>\n                    <tr>\n                        <td>\n                            <p class="configure-label" translate="lifecyclemodal.step2.configurerule"></p>\n                        </td>\n                        <td class="tool-tip-text-header">\n                            <awsui-tooltip text="{{ \'lifecyclemodal.standardia.tooltip\' | translate }}" position="bottom" size="small">\n                                <i class="awsui-icon alert-info-circle"></i>\n                            </awsui-tooltip>\n                        </td>\n                    </tr>\n                </table>\n                <table class="upload-modal-radio-button-properties">\n                    <tr>\n                        <td>\n                            <awsui-checkbox id="current-version-transition" class="step2-radio-label" ng-model="selectedRule.showCurrent" change="showStep2CurrentVersionChange()">\n                                <span class="show-version" translate="lifecyclemodal.step2.current"></span>\n                            </awsui-checkbox>\n                        </td>\n                        <td class="show-previous">\n                            <awsui-checkbox id="previous-version-transition" class="step2-radio-label" ng-model="selectedRule.showPrevious" change="showStep2PreviousVersionChange()">\n                                <span class="show-version" translate="lifecyclemodal.step2.noncurrent"></span>\n                            </awsui-checkbox>\n                        </td>\n                    </tr>\n                </table>\n                <div class="review-section-header"></div>\n                <div ng-if="selectedRule.showCurrent">\n                    <p class="current-version-label" translate="lifecyclemodal.step2.currentversion"></p>\n                    <div class="modal-content-divider"></div>\n                    <p ng-if="selectedRule.currentRuleActions.length === 0" class="empty-transitions" translate="lifecyclemodal.step2.emptycurrenttransitions"></p>\n                    <table class="lifecycle-table">\n                        <tr ng-if="selectedRule.currentRuleActions.length !== 0">\n                            <td id="object-creation" class="options" translate="lifecyclemodal.objectcreated"></td>\n                            <td class="object-created-days" translate="lifecyclemodal.step2.daysafterobjectcreation"></td>\n                        </tr>\n                    </table>\n                    <div class="add-transition">\n                        <a id="add-current-transition" ng-class="{ \'add-disabled\' : selectedRule.isAddCurrentTransitionDisabled }" ng-click="addCurrentRuleAction()"> {{\'lifecyclemodal.step2.addtransition\' | translate}}</a>\n                    </div>\n                    <table class="lifecycle-table">\n                        <tr ng-repeat="action in selectedRule.currentRuleActions">\n                            <td class="transition-options">\n                                <awsui-select class="lifecycle-modal-select" change="selectCurrentRuleAction(selectedRule.currentRuleActions[$index].action,$index)" items="selectedRule.currentRuleOptions[$index]" ng-model="selectedRule.currentRuleActions[$index].action" placeholder="{{\'lifecyclemodal.selectrule\' | translate}}"></awsui-select>\n                            </td>\n                            <td class="object-transition-days">\n                                <awsui-textfield ng-class="{ \'highlight-error\' : highlightTextBoxErrorCurrent[$index] }" placeholder="{{\'lifecyclemodal.days\' | translate}}" class="lifecycle-modal-input" ng-model="selectedRule.currentRuleActions[$index].value" disabled="selectedRule.currentRuleActions[$index].action === \'\'" ng-keyup="validateDays($index, \'current\')">\n                                </awsui-textfield>\n                                <span class="close-transition" ng-click="removeCurrentRuleAction($index)"> X </span>\n                            </td>\n                        </tr>\n                    </table>\n                    <awsui-alert type="error" visible="notANumberErrorCurrent.SIA" header="{{ \'lifecyclemodal.step2.numbersiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="notANumberErrorCurrent.Glacier" header="{{ \'lifecyclemodal.step2.numberglaciererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="minimumDaysCurrent.SIA" header="{{ \'lifecyclemodal.step2.minimumdayssiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdayssiaerrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="minimumDaysCurrent.Glacier" header="{{ \'lifecyclemodal.step2.minimumdaysglaciererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdaysglaciererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorCurrent.SIA" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorCurrent.Glacier" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanCurrentError.GlacierGreaterThanSIA" header="{{ \'lifecyclemodal.step2.glaciergreaterthansiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.glaciergreaterthansiaerrormessage\' | translate }} {{ currentGlacierGreaterThanSIAValue }} </awsui-alert>\n                    <awsui-alert type="error" visible="currentError" header="{{ \'lifecyclemodal.step2.noruleactionerrorheader\' | translate }}"> {{ \'lifecyclemodal.step2.selectruleactionerror\'| translate }} </awsui-alert>\n                    <div ng-if="selectedRule.currentRuleActions.length === 0" class="modal-section"></div>\n                </div>\n                <div ng-if="selectedRule.showPrevious">\n                    <table>\n                        <tr>\n                            <td>\n                                <p class="current-version-label" translate="lifecyclemodal.step2.previousversion"></p>\n                            </td>\n                            <td class="tool-tip-text">\n                                <awsui-tooltip text="{{ \'lifecyclemodal.previousversion.tooltip\' | translate }}" position="right" size="small">\n                                    <i class="awsui-icon alert-info-circle"></i>\n                                </awsui-tooltip>\n                            </td>\n                        </tr>\n                    </table>\n                    <div class="modal-content-divider"></div>\n                    <p ng-if="selectedRule.noncurrentRuleActions.length === 0" class="empty-transitions" translate="lifecyclemodal.step2.emptynoncurrenttransitions"></p>\n                    <table class="lifecycle-table">\n                        <tr ng-if="selectedRule.noncurrentRuleActions.length !== 0">\n                            <td class="options" translate="lifecyclemodal.objectbecomespreviousversion"></td>\n                            <td class="object-created-days" translate="lifecyclemodal.step2.daysafterobjectcreation"></td>\n                        </tr>\n                    </table>\n                    <span class="add-transition">\n                    <a ng-class="{ \'add-disabled\' : selectedRule.isAddPrevTransitionDisabled }" ng-click="addNoncurrentRuleAction()"> {{\'lifecyclemodal.step2.addtransition\' | translate}} </a>\n                </span>\n                    <table class="lifecycle-table">\n                        <tr ng-repeat="action in selectedRule.noncurrentRuleActions">\n                            <td class="transition-options"><awsui-select class="lifecycle-modal-select" change="selectNoncurrentRuleAction(selectedRule.noncurrentRuleActions[$index].action, $index)" items="selectedRule.noncurrentRuleOptions[$index]" ng-model="selectedRule.noncurrentRuleActions[$index].action" placeholder="{{\'lifecyclemodal.selectrule\' | translate}}"></awsui-select>\n                                <div ng-if="selectedRule.noncurrentRuleActions[$index].showRldm"><awsui-checkbox ng-model="selectedRule.noncurrentRuleActions[$index].removeExpire">{{ \'lifecyclemodal.removeexpire\' | translate }}</awsui-checkbox></div>\n                            </td>\n                            <td ng-class="{ \'object-transition-days\' : !selectedRule.noncurrentRuleActions[$index].showRldm , \'remove-expire\' : selectedRule.noncurrentRuleActions[$index].showRldm }">\n                                <awsui-textfield ng-class="{ \'highlight-error\' : highlightTextBoxErrorNonCurrent[$index] }" placeholder="{{\'lifecyclemodal.days\' | translate}}" class="text-input lifecycle-modal-input" ng-model="selectedRule.noncurrentRuleActions[$index].value" disabled="selectedRule.noncurrentRuleActions[$index].action === \'\'" ng-keyup="validateDays($index,\'nonCurrent\')">\n                                </awsui-textfield>\n                                <span class="close-transition" ng-click="removeNoncurrentRuleAction($index)"> X </span>\n                            </td>\n                        </tr>\n                    </table>\n                    <awsui-alert type="error" visible="notANumberErrorNoncurrent.SIA" header="{{ \'lifecyclemodal.step2.numbersiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="notANumberErrorNoncurrent.Glacier" header="{{ \'lifecyclemodal.step2.numberglaciererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="minimumDaysNoncurrent.SIA" header="{{ \'lifecyclemodal.step2.minimumdayssiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdayssiaerrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="minimumDaysNoncurrent.Glacier" header="{{ \'lifecyclemodal.step2.minimumdaysglaciererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdaysglaciererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorNoncurrent.SIA" header="{{ \'lifecyclemodal.step2.numbersiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorNoncurrent.Glacier" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanNonCurrentError.GlacierGreaterThanSIA" header="{{ \'lifecyclemodal.step2.glaciergreaterthansiaerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.glaciergreaterthansiaerrormessage\' | translate }} {{ noncurrentGlacierGreaterThanSIAValue }}</awsui-alert>\n                    <awsui-alert type="error" visible="hasPrevError" header="{{ \'lifecyclemodal.step2.noruleactionerrorheader\' | translate }}"> {{ \'lifecyclemodal.step2.selectruleactionerror\'| translate }}</awsui-alert>\n                    <div ng-if="selectedRule.noncurrentRuleActions.length === 0" class="modal-section"></div>\n                </div>\n            </div>\n            <div class="body-content" ng-if="state === STEP.EXPIRATION">\n                <p class="configure-expiration-label" translate="lifecyclemodal.step3.configureexpiration"></p>\n                <table class="upload-modal-radio-button-properties">\n                    <tr>\n                        <td>\n                            <awsui-checkbox id="current-version-transition" class="step2-radio-label" ng-model="selectedRule.showStep3CurrentVersion" change="showStep3CurrentVersionChange()">\n                                <span class="show-version" translate="lifecyclemodal.step2.current"></span>\n                            </awsui-checkbox>\n                        </td>\n                        <td class="show-previous">\n                            <awsui-checkbox id="previous-version-transition" class="step2-radio-label" ng-model="selectedRule.showStep3PreviousVersion" change="showStep3PreviousVersionChange()">\n                                <span class="show-version" translate="lifecyclemodal.step2.noncurrent"></span>\n                            </awsui-checkbox>\n                        </td>\n                    </tr>\n                </table>\n                <div ng-show="selectedRule.showStep3CurrentVersion">\n                    <awsui-checkbox change="selectCurrentExpiration()" class="step2-radio-label" ng-model="selectedRule.expiration.enabled">\n                        <span class="expiration-label" translate="lifecyclemodal.expirecurrentversion"></span>\n                        <span class="tool-tip-cursor">\n                        <awsui-tooltip text="{{ \'lifecyclemodal.expirecurrobjs.tooltip\' | translate }}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </span>\n                    </awsui-checkbox>\n                    <div ng-show="selectedRule.expiration.enabled">\n                        <span class="expiration-after" translate="lifecyclemodal.step3.after"></span>\n                        <span>\n                        <awsui-textfield id="expiration-days" class="expiration-days lifecycle-modal-input" ng-class="{ \'highlight-error\' : highlightTextBoxErrorCurrent[2] }" ng-keyup="validateCurrentExpiration()" ng-model="selectedRule.expiration.days">\n                        </awsui-textfield>\n                    </span>\n                        <span class="from-object-creation" translate="lifecyclemodal.fromobjectcreation"></span>\n                    </div>\n                    <awsui-alert type="error" visible="notANumberErrorCurrent.Expire" header="{{ \'lifecyclemodal.step2.numberexpireerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="minimumDaysCurrent.Expire" header="{{ \'lifecyclemodal.step2.minimumdaysexpireerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdaysexpireerrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorCurrent.Expire" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanCurrentError.DeleteGreaterThanGlacier">\n                        {{ \'lifecyclemodal.step2.expiregreaterthanglaciererrormessage\' | translate }} {{ expireGreaterThanGlacierValue }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanCurrentError.DeleteGreaterThanSIA">\n                        {{ \'lifecyclemodal.step2.expiregreaterthansiaerrormessage\' | translate }} {{ expireGreaterThanSIAValue }} </awsui-alert>\n                </div>\n                <div ng-show="selectedRule.showStep3PreviousVersion">\n                    <awsui-checkbox class="step2-radio-label" change="selectNoncurrentExpiration()" class="step2-radio-label" ng-model="selectedRule.permanentlyDelete.enabled">\n                        <span class="expiration-label"> {{ \'lifecyclemodal.step3.permanentlydelete\' | translate }} </span>\n                        <span class="tool-tip-cursor">\n                        <awsui-tooltip text="{{ \'lifecyclemodal.delprevversions.tooltip\' | translate }}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </span>\n                    </awsui-checkbox>\n                    <div ng-show="selectedRule.permanentlyDelete.enabled">\n                        <span class="expiration-after" translate="lifecyclemodal.step3.after"></span>\n                        <span>\n                        <awsui-textfield id="permanently-delete-days" class="expiration-days lifecycle-modal-input" ng-class="{ \'highlight-error\' : highlightTextBoxErrorNonCurrent[2] }" ng-keyup="validateNoncurrentExpiration()" ng-model="selectedRule.permanentlyDelete.days">\n                        </awsui-textfield>\n                    </span>\n                        <span class="from-object-creation" translate="lifecyclemodal.step3.afterbecomingpreviousversion"></span>\n                    </div>\n                    <awsui-alert type="error" visible="minimumDaysNoncurrent.PermanentlyDelete" header="{{ \'lifecyclemodal.step2.minimumdayspermanentlydeleteerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.minimumdayspermanentlydeleteerrormessage\' | translate }}</awsui-alert>\n                    <awsui-alert type="error" visible="notANumberErrorNoncurrent.PermanentlyDelete" header="{{ \'lifecyclemodal.step2.numberpermanentlydeleteerrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="higherNumberErrorNoncurrent.PermanentlyDelete" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                        {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanNonCurrentError.DeleteGreaterThanSIA">\n                        {{ \'lifecyclemodal.step2.permanentlydeletegreaterthansiaerrormessage\' | translate }} {{ permanentlyDeleteGreaterThanSIAValue }} </awsui-alert>\n                    <awsui-alert type="error" visible="greaterThanNonCurrentError.DeleteGreaterThanGlacier">\n                        {{ \'lifecyclemodal.step2.permanentlydeletegreaterthanglaciererrormessage\' | translate }} {{ permanentlyDeleteGreaterThanGlacierValue }} </awsui-alert>\n                </div>\n                <p class="for-amu" translate="lifecyclemodal.step3.ldmamucleanup"></p>\n\n                <awsui-checkbox id="cleanup-expired" data-disabled="(!selectedRule.showRldm || (selectedRule.filters.tagFilters.length > 0))" class="expiration-after-section" change="updateNextButtonDisabled()" ng-model="selectedRule.removeExpire">\n                    <span ng-class="{ \'disable-text\' : (!selectedRule.showRldm || (selectedRule.filters.tagFilters.length > 0)) }" class="expiration-label" translate="lifecyclemodal.step3.ldmcleanup"></span>\n                    <span class="tool-tip-cursor">\n                        <awsui-tooltip text="{{ \'lifecyclemodal.cleanupldm.tooltip\' | translate }}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </span>\n                </awsui-checkbox>\n                <awsui-alert class="modal-warning" visible="(!selectedRule.showRldm && !(selectedRule.filters.tagFilters.length > 0))" type="warning">\n                    {{ \'lifecyclemodal.warning.disableldmexpire\' | translate }}\n                </awsui-alert>\n                <awsui-checkbox id="cleanup-multipart" data-disabled="(selectedRule.filters.tagFilters.length > 0)" class="expiration-after-section" change="selectAmuAction()" ng-model="selectedRule.amu.enabled">\n                    <span ng-class="{ \'disable-text\' : (selectedRule.filters.tagFilters.length > 0) }" class="expiration-label" translate="lifecyclemodal.step3.imucleanup"></span>\n                    <span class="tool-tip-cursor">\n                        <awsui-tooltip text="{{ \'lifecyclemodal.cleanupuploads.tooltip\' | translate }}" position="bottom" size="small">\n                            <i class="awsui-icon alert-info-circle"></i>\n                        </awsui-tooltip>\n                    </span>\n                </awsui-checkbox>\n                <div id="cleanup-multipart-days" ng-if="selectedRule.amu.enabled">\n                    <span class="expiration-after" translate="lifecyclemodal.step3.after"></span>\n                    <span>\n                        <awsui-textfield ng-keyup="validateAmuDays()" id="incomplete-multipart-days" class="expiration-days date-styling-override lifecycle-modal-input" ng-model="selectedRule.amu.days">\n                        </awsui-textfield>\n                    </span>\n                    <span class="from-object-creation" translate="lifecyclemodal.step3.fromstartofupload"></span>\n                </div>\n                <awsui-alert type="error" visible="notANumberAmuError" header="{{ \'lifecyclemodal.step2.numberamuerrorheader\' | translate }}">\n                    {{ \'lifecyclemodal.step2.numbererrormessage\' | translate }} </awsui-alert>\n                <awsui-alert type="error" visible="minimumDaysAmuError" header="{{ \'lifecyclemodal.step2.minimumdaysamuerrorheader\' | translate }}">\n                    {{ \'lifecyclemodal.step2.minimumdaysamuerrormessage\' | translate }} </awsui-alert>\n                <awsui-alert class="modal-warning" visible="(selectedRule.filters.tagFilters.length > 0)" type="warning">\n                    {{ \'lifecyclemodal.warning.disableldmandamu\' | translate }}\n                </awsui-alert>\n                <awsui-alert type="error" visible="higherNumberErrorAmu" header="{{ \'lifecyclemodal.highernumbererrorheader\' | translate }}">\n                    {{ \'lifecyclemodal.highernumbererrormessage\' | translate }} </awsui-alert>\n            </div>\n            <div class="body-content" ng-if="state === STEP.REVIEW">\n                <table id="review-table" class="review-table">\n                    <tr>\n                        <td class="review-subheader" translate="lifecyclemodal.label.nameandscope"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" text="{{ \'lifecyclemodal.button.edit\' | translate }}" variant="link" ng-click="setState(STEP.NAME_AND_SCOPE)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <table class="details-table">\n                    <tr>\n                        <td><span class="detail-name" translate="lifecyclemodal.step3.label.name"></span><span class="details"> {{ selectedRule.summary.ruleName }} </span></td>\n                    </tr>\n                    <tr>\n                        <td class="scope-name"><span class="detail-name" translate="lifecyclemodal.step3.label.scope"></span><span class="details"> {{ selectedRule.summary.prefix }} </span></td>\n                    </tr>\n                </table>\n                <table class="review-table">\n                    <tr>\n                        <td class="review-rule" translate="lifecyclemodal.label.rule"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" text="{{ \'lifecyclemodal.button.edit\' | translate }}" variant="link" click="setState(STEP.TRANSITION)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <div class="review-content"></div>\n                <p ng-if="selectedRule.summary.currentVersionHeader" class="review-subheader version-header" translate="lifecyclemodal.currentversion"></p>\n                <div class="review-content" ng-if="selectedRule.summary.currentTransitionsList[0] !== \'\'">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.review.transition"></span>\n                        <span class="transition-details">{{ selectedRule.summary.currentTransitionsList[0] }} </span>\n                    </div>\n                </div>\n                <div class="review-content" ng-if="selectedRule.summary.currentTransitionsList[1] !== \'\'">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.review.transition"></span>\n                        <span class="transition-details">{{ selectedRule.summary.currentTransitionsList[1] }} </span>\n                    </div>\n                </div>\n                <p ng-if="selectedRule.summary.noncurrentVersionHeader" class="review-subheader version-header review-section-header" translate="lifecyclemodal.noncurrentversion"></p>\n                <div class="review-content" ng-if="selectedRule.summary.noncurrentTransitionsList[0] !== \'\'">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.review.transition"></span>\n                        <span class="transition-details">{{ selectedRule.summary.noncurrentTransitionsList[0] }} </span>\n                    </div>\n                </div>\n                <div class="review-content" ng-if="selectedRule.summary.noncurrentTransitionsList[1] !== \'\'">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.review.transition"></span>\n                        <span class="transition-details">{{ selectedRule.summary.noncurrentTransitionsList[1] }} </span>\n                    </div>\n                </div>\n                <table class="review-table">\n                    <tr>\n                        <td class="review-rule" translate="lifecyclemodal.expiration"></td>\n                        <td class="edit-button">\n                            <awsui-button class="button-in-darkbg" text="{{ \'lifecyclemodal.button.edit\' | translate }}" variant="link" click="setState(STEP.EXPIRATION)">\n                            </awsui-button>\n                        </td>\n                    </tr>\n                </table>\n                <div class="review-content"></div>\n                <div class="review-content" ng-if="(selectedRule.expiration.enabled && selectedRule.expiration.days !==\'\')">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.expire"></span>\n                        <span class="transition-details"> {{ selectedRule.expiration.days }} </span>\n                        <span translate="lifecyclemodal.days"></span>\n                    </div>\n                </div>\n                <div class="review-content" ng-if="(selectedRule.permanentlyDelete.enabled && selectedRule.permanentlyDelete.days !==\'\')">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.permanentlydelete"></span>\n                        <span class="transition-details"> {{ selectedRule.permanentlyDelete.days }} </span>\n                        <span translate="lifecyclemodal.days"></span>\n                    </div>\n                </div>\n                <p ng-if="selectedRule.summary.rldm" class="review-subheader review-content-header" translate="lifecyclemodal.step3.ldmcleanup"></p>\n                <div ng-if="selectedRule.summary.amu !== \'\'">\n                    <div class="review-subheader review-content-description">\n                        <span class="review-content-header" translate="lifecyclemodal.step3.imucleanup"></span>\n                        <span translate="lifecyclemodal.step3.afterdays"></span>\n                        <span class="transition-details"> {{ selectedRule.summary.amu }} </span>\n                        <span translate="lifecyclemodal.days"></span>\n                    </div>\n                </div>\n                <awsui-alert visible="lifecycleError" class="block small-top-margin" type="error" dismissible="false" header="{{ \'lifecyclemodal.step3.error.header\' | translate }}"> {{ lifecycleError }}\n                </awsui-alert>\n                <awsui-alert visible="stateChangeWarning" type="warning"> {{ stateChangeWarning }}</awsui-alert>\n                <awsui-alert visible="showOverlappingPrefixWarning" type="warning">\n                    <div translate="lifecyclemodal.warning.overlappingprefix" translate-values="{ overlappingRule : overlappingRule }">\n                    </div>\n                    <div ng-if="showOverlappingNewFormatWarning" translate="lifecyclemodal.warning.overlappingprefixnewformatwarning">\n                    </div>\n                </awsui-alert>\n            </div>\n        </div>\n    </modal-content>\n    <modal-footer>\n        <div class="lifecycle-modal-footer" transclude-name="footer">\n            <awsui-button id="next-step" ng-if="state !== STEP.REVIEW" data-disabled="((state === STEP.NAME_AND_SCOPE && (!selectedRule.ID || (selectedRule.applied === \'prefix\' && !selectedRule.Prefix)\n                      || tag.error !== \'\'))\n                      || (state !== STEP.NAME_AND_SCOPE && selectedRule.isNextButtonDisabled))" variant="primary" text="{{ \'lifecyclemodal.footer.next\' | translate }}" class="awsui-util-f-r primary-button" click="generateSummary()">\n            </awsui-button>\n            <awsui-button id="save-rule" ng-if="state === STEP.REVIEW && !showContinue" click="detectStateChange()" variant="primary" text="{{ \'lifecyclemodal.footer.save\' | translate }}" class="awsui-util-f-r primary-button">\n            </awsui-button>\n            <awsui-button id="continue-rule" ng-if="state === STEP.REVIEW && showContinue" click="saveLifecycle()" variant="primary" text="{{ \'lifecyclemodal.footer.continue\' | translate }}" class="awsui-util-f-r primary-button">\n            </awsui-button>\n            <awsui-button id="cancel-rule" text="{{ \'lifecyclemodal.footer.cancel\' | translate }}" variant="normal" ng-if="state === STEP.NAME_AND_SCOPE" class="awsui-util-f-r" click="closeLifecycleModal()">\n            </awsui-button>\n            <awsui-button id="previous-step" text="{{ \'lifecyclemodal.footer.previous\' | translate }}" variant="normal" ng-if="state !== STEP.NAME_AND_SCOPE" class="awsui-util-f-r" click="goToPreviousStep()">\n            </awsui-button>\n        </div>\n    </modal-footer>\n</modal>');a.put("/s3/partials/modal.html",'<div class="aws-modal">\n    <div ng-show="isOpen.flag" class="modal-frame fade in ng-hide">\n        <div class="modal-header modal-header-image">\n            <i class="panel-close-icon modal-close" ng-click="closeModal()"></i>\n            <div class="modal-header-title">{{headerTitle}}</div>\n            \n            <table id="header-steps" class="header-steps" ng-if="steps">\n                <tr>\n                    <td class="attained-step" ng-if="getState(0)">\n\n                        <div class="modal-header-value" ng-class="{ \'selected-step\': state === getState(0) }"><span class="modal-image" ng-class="state === getState(0) ? \'modal-stepone-selected-image\' : \'modal-checked-image\'"></span><span class="modal-stepname">{{getState(0).value}}</span></div>\n                    </td>\n                    <td ng-if="getState(1)" ng-class="state !== getState(0) ? \'attained-step\' : \'step\'">\n\n                        \n                        <div class="modal-header-value" ng-class="{ \'selected-step\': state === getState(1) }"><span class="modal-image" ng-class="{\'modal-steptwo-selected-image\': state==getState(1),\n                            \'modal-steptwo-unselected-image\': state === getState(0),\n                            \'modal-checked-image\': state === getState(2) || state===getState(3)}"></span><span class="modal-stepname">{{getState(1).value}}</span></div>\n                    </td>\n                    <td ng-if="getState(2)" ng-class="state === getState(2) || state===getState(3)? \'attained-step\' : \'step\'">\n                        \n                        <div class="modal-header-value" ng-class="{ \'selected-step\': state === getState(2) }"><span class="modal-image" ng-class="{\'modal-stepthree-selected-image\': state==getState(2),\n                            \'modal-stepthree-unselected-image\': state === getState(0) || state===getState(1),\n                            \'modal-checked-image\': state === getState(3)}"></span><span class="modal-stepname">{{getState(2).value}}</span></div>\n                    </td>\n                    <td ng-if="getState(3)" ng-class="state === getState(3) ? \'attained-step\' : \'step\'">\n                        \n\n                        <div class="modal-header-value" ng-class="{ \'selected-step\': state === getState(3) }"><span class="modal-image" ng-class="state === getState(3) ? \'modal-stepfour-selected-image\' : \'modal-stepfour-unselected-image\'"></span><span class="modal-stepname">{{getState(3).value}}</span></div>\n                    </td>\n                </tr>\n            </table>\n            <div ng-transclude="header"></div>\n        </div>\n        <div class="modal-body" ng-transclude="content"></div>\n        <div class="modal-footer">\n            <div class="footer-divider"></div>\n            <div ng-transclude="footer"></div>\n        </div>\n    </div>\n    <div ng-show="isOpen.flag" class="modal-background ng-hide"></div>\n</div>');a.put("/s3/partials/modalpermissions.html",'<div class="modal-permissions">\n    <div id="user-permissions-section" class="modal-permissions-section">\n        <h3 class="subheader dark" translate="{{\'modal.acl.header.manageusers\'}}"></h3>\n        \n        <permissions-sub-modal is-public="false" acl-modal-titles="manageUserTitles" permissions="userPermissions">\n        </permissions-sub-modal>\n    </div>\n    <div id="public-permissions-section" class="modal-permissions-section">\n        <h3 class="subheader dark" translate="{{\'modal.acl.header.managepublicpermissions\'}}"></h3>\n        \n        <dropdown id="make-public-dropdown" items="makePublicOptions" selected-item="selectedItems.makePublic"></dropdown>\n        <awsui-alert class="padding-top-20" ng-class="{\'padding-bottom-20\': modalType === MODAL_TYPES.UPLOAD}" ng-if="publicPermissions[1].permissions.READ" type="warning" header="{{makePublicWarningHeader}}">\n                {{makePublicWarningBody}}\n        </awsui-alert>\n    </div>\n    <div id="system-permissions-section" ng-if="showSystemPermissions" class="modal-permissions-section">\n        <h3 class="subheader dark" translate="{{\'modal.acl.header.managesystempermissions\' | translate}}"></h3>\n        <dropdown id="log-delivery-dropdown" items="logDeliveryOptions" selected-item="selectedItems.logDelivery"></dropdown>\n    </div>\n</div>');a.put("/s3/partials/object-details/objectdetails.html",'<div class="object-details">\n    <div class="watermark-wrapper header-section">\n        <div class="watermark watermark-file"></div>\n        <breadcrumbs></breadcrumbs>\n        <div class="file-name-container">\n            <span class="file-name">{{obj.Key}}</span>\n            <div class="version-label-container" ng-click="listVersions($event)">\n                <span class="version-label">{{obj.versionLabel}}</span>\n                <div class="versions-dropdown-caret"></div>\n            </div>\n            <versions-dropdown ng-if="obj" bucket="bucket" error="error" get-metadata="getMetadata(operation, versionId)" key="key" obj="obj" selected-tab="selectedTab" show-versions-dropdown="showVersionsDropdown" tabs="tabs" versions-dropdown-selected-object="versionsDropdownSelectedObject.obj">\n            </versions-dropdown>\n        </div>\n    </div>\n    <awsui-tabs class="object-tabs" tabs="tabs" ng-model="selectedTab" ng-switch="selectedTab" ng-click="setTabParam(selectedTab)">\n        <div ng-switch-default="" class="overview">\n            <awsui-alert type="success" visible="showSuccessMessage">{{ successMessageString }}</awsui-alert>\n            <awsui-button class="action-button-spacing" id="open" variant="normal" text="{{ \'objectdetails.button.open\' | translate }}" click="openSelectedObject()" data-disabled="actionButtonsDisabled()">\n            </awsui-button>\n            <awsui-button class="action-button-spacing" id="download" variant="normal" text="{{ \'objectdetails.button.download\' | translate }}" click="downloadSelectedObject()" data-disabled="actionButtonsDisabled()">\n            </awsui-button>\n            <awsui-button class="action-button-spacing" id="downloadAs" variant="normal" text="{{ \'objectdetails.button.downloadAs\' | translate }}" click="openDownloadAsPanel()" data-disabled="actionButtonsDisabled()">\n            </awsui-button>\n            <awsui-button class="action-button-spacing" id="makepublic" variant="normal" text="{{ \'objectdetails.button.makepublic\' | translate }}" click="makePublic()" loading="isMakingPublic" data-disabled="actionButtonsDisabled()">\n            </awsui-button>\n            <awsui-button class="action-button-spacing" id="copypath" variant="normal" text="{{ \'objects.button.copypath\' | translate }}" click="copyPathToClipboard()">\n            </awsui-button>\n            <span class="copy-message" ng-class="{ \'fade-in\' : copyFinished.flag, \'fade-out\' : !copyFinished.flag}" translate="copytoclipboard.path"></span>\n            <div class="awsui-util-p-l"></div>\n            <div class="header" translate="objectdetails.overview.owner"></div>\n            <div class="awsui-util-pb-m" id="objectOwner">{{obj.Owner.DisplayName || obj.Owner.ID}}</div>\n            <div class="header" translate="last.modified"></div>\n            <div class="awsui-util-pb-m" id="objectLastActivity">{{obj.LastModified | date:"medium"}}</div>\n            <div class="header" translate="objectdetails.overview.etag"></div>\n            <div class="awsui-util-pb-m" id="objectEtag">{{obj.ETag}}</div>\n            <div class="header" translate="objectdetails.overview.storageclass"></div>\n            <div class="awsui-util-pb-m" id="objectStorageClass">{{ getStorageClassTranslation() }}</div>\n            <div class="header" translate="objectdetails.overview.sse"></div>\n            <div class="awsui-util-pb-m" id="objectServerSideEncryption">{{ getEncryptionTranslation() }}</div>\n            <div ng-if="obj.KmsID !== undefined" class="header" translate="objectdetails.overview.kmsid"></div>\n            <div ng-if="obj.KmsID !== undefined" class="awsui-util-pb-m">{{obj.KmsID}}</div>\n            <div ng-if="showReplication" class="header" translate="objectdetails.overview.replicationstatus"></div>\n            <div id="crr-objectdetail-status" ng-if="showReplication" class="awsui-util-pb-m">{{obj.ReplicationStatus}}</div>\n            <div ng-if="showExpiry" class="header" translate="objectdetails.overview.expirydate"></div>\n            <div ng-if="showExpiry" class="awsui-util-pb-m">{{obj.ExpirationDate}}</div>\n            <div ng-if="showExpiry" class="header" translate="objectdetails.overview.expiryrule"></div>\n            <div ng-if="showExpiry" class="awsui-util-pb-m">{{obj.ExpirationRule}}</div>\n            <div ng-if="showRestoration" class="header" translate="objects.details.Restoration"></div>\n            <div ng-if="showRestoration" class="awsui-util-pb-m" translate="objectdetails.value.restoration"></div>\n            <div ng-if="restorationExpiry" class="header" translate="objects.details.RestorationExpiry"></div>\n            <div ng-if="restorationExpiry" class="awsui-util-pb-m">{{restorationExpiry}}</div>\n            <div class="header" translate="objectdetails.overview.size"></div>\n            <div class="awsui-util-pb-m" id="objectSize">{{obj.Size}}</div>\n            <div ng-if="showVersionId" class="header" translate="objectdetails.overview.versionid"></div>\n            <div ng-if="showVersionId" class="awsui-util-pb-m">{{obj.versionId}}</div>\n            <div class="header" translate="objectdetails.overview.link"></div>\n            <a class="link awsui-util-pb-m" id="object-link" href="{{obj.Link}}">{{obj.Link}}</a>\n            <storage-console-config-panel class="download-side-panel" ng-class="{\'side-config-panel objects-side-panel\': downloadAsPanel, \'hide-config-panel objects-side-panel\': !downloadAsPanel}" panel-open="downloadAsPanel">\n                <header>\n                    <span class="side-panel-header download-as-panel-header" translate="object.download.destination"></span>\n                    <span class="panel-close-icon" ng-click="closeDownloadAsPanel()"></span>\n                </header>\n                <content>\n                    <div class="download-as-directions">\n                        <div class="download-as-directions-text" translate="object.download.directions"></div>\n                        <a ng-show="!downloadAsPanelGenerating && !downloadPanelError" ng-href="{{downloadPanel.url}}" id="downloadAsLink">{{ obj.Key }}</a>\n                        <div class="download-as-directions-text" ng-show="!downloadAsPanelGenerating && downloadPanelError" translate="object.download.error"></div>\n                        <span ng-show="downloadAsPanelGenerating" class="awsui-spinner awsui-spinner-light"></span>\n                    </div>\n                </content>\n            </storage-console-config-panel>\n        </div>\n        <div ng-switch-when="properties">\n            <object-properties obj="obj" options="options" bucket="bucket"></object-properties>\n        </div>\n        <div ng-switch-when="permissions" class="permissions-container">\n            <acl ng-if="obj" permission-obj="permissionObj" put-acl="putAcl" error="aclError" is-bucket-permission="false" bucket="bucket" should-disable="obj && (obj.StorageClass === \'GLACIER\' && !restorationExpiry || obj.IsLatest && obj.IsLatest !== \'true\')">\n            </acl>\n        </div>\n        <awsui-alert visible="objectDetailError && selectedTab === \'overview\'" class="block small-top-margin permissions-error" type="error" dismissible="false" header="{{ \'error.header\' | translate }}"> {{ objectDetailError }}\n        </awsui-alert>\n        <awsui-alert visible="objectPropertiesError && selectedTab === \'properties\'" class="block small-top-margin permissions-error" type="error" dismissible="false" header="{{ \'error.header\' | translate }}"> {{ objectPropertiesError}}\n        </awsui-alert>\n        <awsui-alert visible="aclError && selectedTab === \'permissions\'" class="block small-top-margin permissions-error" type="error" dismissible="false" header="{{ \'error.header\' | translate }}"> {{ aclError }}\n        </awsui-alert>\n        <awsui-alert visible="warning" class="block small-top-margin permissions-error" type="warning" dismissible="false" header="{{ \'warning.header\' | translate }}"> {{ warning }}\n        </awsui-alert>\n    </awsui-tabs>\n</div>');a.put("/s3/partials/object-details/objectmetadata.html",'<card card-id="scrollCardId" card-summary-obj="cardSummaryObj" is-open="cardOpen" ng-class="{ \'card-disable-metadata-water-mark\': !cardOpen, \'card-enable-metadata-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="objectproperties.label.metadata"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancel($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="objectdetail.metadata.blurb"></p>\n        <div ng-if="cardOpen">\n            <awsui-button id="objectmetadata-addnew" data-disabled="obj && (obj.StorageClass === \'GLACIER\' || obj.IsLatest && obj.IsLatest !== \'true\')" text="{{\'objectdetail.metadata.addnew\' | translate}}" icon="plus" variant="link" click="addMetadata(selectedRow)"></awsui-button>\n            <awsui-button id="objectmetadata-delete" data-disabled="isDeleteAndEditDisabled(selectedRow)" text="{{\'events.button.delete\' | translate}}" variant="link" click="deleteMetadata(selectedRow)" loading="isDeleting">\n            </awsui-button>\n            <awsui-button id="objectmetadata-edit" data-disabled="isDeleteAndEditDisabled(selectedRow)" text="{{ \'events.button.edit\' | translate }}" variant="link" click="editMetadata(selectedRow)">\n            </awsui-button>\n            <awsui-tooltip text="{{\'objectproperties.metadata.tooltip\' | translate}}" position="right" size="small">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n            <awsui-radio-group ng-model="selectedRow.scopeIndex" ng-change="switchSelectedRow(selectedRow)">\n                <table class="table-condense metadata-table">\n                    <thead>\n                    <tr>\n                        <td></td>\n                        <td translate="">objectdetail.metadata.key</td>\n                        <td translate="">objectdetail.metadata.value</td>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    <tr class="newmetadatarow" ng-repeat-start="newMetadata in newMetadataList">\n                        <td>\n                            <awsui-radio-button value="newMetadataList:{{$index}}">\n                        <td translate="">objectdetail.metadata.newmetadata</td>\n                        <td>\n                            <span class="newmetadata-delete close-icon" ng-click="removeNewMetadata($index, $event, selectedRow)"></span>\n                        </td>\n                        </awsui-radio-button>\n                        </td>\n                    </tr>\n                    <tr ng-repeat-end="">\n                        <td></td>\n                        <td class="newMetadata-dropdown">\n                            <awsui-control-group validation-message="{{ newMetadata.metadataKey.error }}">\n                                <dropdown disabled="!newMetadata.isEditing" items="predefinedMetadata" selected-item="newMetadata.metadataKey" filter="true" placeholder="{{ \'objectdetail.metadata.key-placeholder\' | translate }}"></dropdown>\n                            </awsui-control-group>\n                        </td>\n                        <td class="metadata-value-input">\n                            <dropdown disabled="!newMetadata.isEditing" ng-if="newMetadata.metadataKey.dropDownValue" items="newMetadata.metadataKey.dropDownValue" selected-item="newMetadata.metadataValue" filter="true" placeholder="{{\'objectdetail.metadata.value-placeholder\' | translate}}">\n                            </dropdown>\n                            <awsui-control-group id="metadata-input-error" validation-message="{{  newMetadata.metadataValue.inputError }}">\n                                <awsui-textfield data-disabled="!newMetadata.isEditing" ng-model="newMetadata.metadataValue.text" ng-if="newMetadata.metadataKey && !newMetadata.metadataKey.dropDownValue"></awsui-textfield>\n                            </awsui-control-group>\n                        </td>\n                    </tr>\n                    <tr class="metadatarow" ng-repeat="metadata in userDefinedMetadata | orderBy: \'metadataKey.text\' ">\n                        <td>\n                            <awsui-radio-button value="userDefinedMetadata:{{getIndex(metadata)}}">\n                        <td>\n                            <div class="metatext" ng-if="!metadata.isEditing">{{ metadata.metadataKey.inputValue || metadata.metadataKey.text }}</div>\n                            <awsui-control-group validation-message="{{ metadata.metadataKey.error }}">\n                                <dropdown ng-if="metadata.isEditing" items="predefinedMetadata" selected-item="metadata.metadataKey" filter="true" placeholder="{{ \'objectdetail.metadata.key-placeholder\' | translate }}"></dropdown>\n                            </awsui-control-group>\n                        </td>\n                        <td class="metadata-value-input">\n                            <div class="metatext" ng-if="!metadata.isEditing">{{ metadata.metadataValue.text }}</div>\n                            <dropdown ng-if="metadata.isEditing && metadata.metadataKey.dropDownValue" items="metadata.metadataKey.dropDownValue" selected-item="metadata.metadataValue" filter="true" input-field="metadata.metadataValue" placeholder="{{ \'objectdetail.metadata.value-placeholder\' | translate }}"></dropdown>\n                            <awsui-control-group validation-message="{{ metadata.metadataValue.inputError }}">\n                                <awsui-textfield ng-model="metadata.metadataValue.text" ng-if="metadata.isEditing && metadata.metadataKey && !metadata.metadataKey.dropDownValue"></awsui-textfield>\n                            </awsui-control-group>\n                        </td>\n                    </awsui-radio-button></td></tr>\n                    </tbody>\n                </table>\n            </awsui-radio-group>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert class="input-error" type="error" header="{{ \'error.header\' | translate }}" ng-if="validationError && cardOpen">\n            <p translate="objectdetail.metadata.multisamekeywarning" translate-values="{ errorMsg : \'{{validationError}}\' }"></p>\n        </awsui-alert>\n        <awsui-alert class="input-error" type="error" header="{{ \'error.header\' | translate }}" ng-if="metadataError && cardOpen">{{ metadataError }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div ng-if="cardOpen">\n            <awsui-button id="objectmetadata-save" ng-click="save($event)" data-disabled="obj && (obj.StorageClass === \'GLACIER\' || obj.IsLatest && obj.IsLatest !== \'true\')" text="{{ \'button.save\' | translate }}" class="awsui-util-f-r object-property-button" loading="isSaving" variant="primary"></awsui-button>\n            <awsui-button id="objectmetadata-cancel" ng-click="cancel($event)" text="{{ \'button.cancel\' | translate }}" class="awsui-util-f-r object-property-button"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/object-details/objectproperties.html",'<div class="awsui-grid">\n    <div class="awsui-container properties-cards">\n        <div class="wrapper awsui-row object-properties">\n            <object-storage-class ng-if="obj" id="object-storage-card" obj="obj"></object-storage-class>\n            <object-encryption ng-if="obj && obj.Encryption" id="object-sse-card" obj="obj" options="options"></object-encryption>\n            <object-metadata ng-if="obj" id="object-metadata-card" obj="obj"></object-metadata>\n            <object-tag ng-if="obj" id="object-tags-card" obj="obj" fac-id="s3-ot"></object-tag>\n        </div>\n    </div>\n</div>');a.put("/s3/partials/object-details/objectsse.html",'<card card-id="scrollCardId" card-summary-obj="cardSummaryObj" is-open="cardOpen" disable-expand="obj && (obj.StorageClass === \'GLACIER\' || obj.IsLatest && obj.IsLatest !== \'true\')" ng-class="{ \'card-disable-sse-water-mark\': !cardOpen, \'card-enable-sse-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="objectproperties.label.sse"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancel($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="objectproperties.sse.blurb"></p>\n        <div class="awsui-container" ng-if="cardOpen">\n            <div class="awsui-row card-content-row" fac-id="s3-no-enc">\n                <awsui-radio-group ng-model="model.selectedOption" ng-change="updateKMSKey(model.selectedOption)">\n                    <awsui-radio-button id="objectsse-none" value="NONE" ng-model="model.selectedOption" label="{{ \'sse.none\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n            </div>\n            <div class="awsui-row card-content-row">\n                <awsui-radio-group ng-model="model.selectedOption" ng-change="updateKMSKey(model.selectedOption)">\n                    <awsui-radio-button id="objectsse-aes256" value="AES256" ng-model="model.selectedOption" label="{{ \'sse.aes256\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n                <p class="object-radio-description" translate="objectproperties.sse.aes256description"></p>\n            </div>\n            <div class="awsui-row card-content-row" fac-id="s3-kms">\n                <awsui-radio-group ng-model="model.selectedOption" ng-change="updateKMSKey(model.selectedOption)">\n                    <awsui-radio-button id="objectsse-kms" value="aws:kms" ng-model="model.selectedOption" label="{{ \'sse.aws.kms\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n            </div>\n            <awsui-control-group validation-message="{{ KMSServiceError }}">\n                <dropdown ng-if="model.selectedOption===aws_kms" items="kmsKeys" placeholder="{{ \'objectproperties.placeholder.kmskeys\' | translate }}" disabled="KMSServiceError" selected-item="options.kmsId" filter="true">\n                </dropdown>\n            </awsui-control-group>\n            <awsui-textfield class="custom-kms-arn" ng-if="model.selectedOption===aws_kms && options.kmsId.value===custom_arn" ng-model="options.kmsARN"></awsui-textfield>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert class="custom-kms-arn-error" type="error" ng-if="sseError && cardOpen"> {{ sseError }} </awsui-alert>\n    </card-content>\n    <card-footer>\n        <div ng-if="cardOpen">\n            <awsui-button id="objectsse-save" ng-click="save($event)" data-disabled="disableSave()" text="{{ \'button.save\' | translate }}" class="awsui-util-f-r object-property-button" loading="isSaving" variant="primary"></awsui-button>\n            <awsui-button id="objectsse-cancel" ng-click="cancel($event)" text="{{ \'button.cancel\' | translate }}" class="awsui-util-f-r object-property-button"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/object-details/objectstorageclass.html",'<card card-id="scrollCardId" card-summary-obj="cardSummaryObj" is-open="cardOpen" disable-expand="obj && (obj.StorageClass === \'GLACIER\' || obj.IsLatest && obj.IsLatest !== \'true\')" ng-class="{ \'card-disable-storage-class-water-mark\': !cardOpen, \'card-enable-storage-class-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="objectproperties.label.storageclass"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancel($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="objectproperties.storageclass.blurb"></p>\n        <div class="awsui-container" ng-if="cardOpen">\n            <div class="awsui-row card-content-row">\n                <awsui-radio-group ng-model="obj.StorageClass">\n                    <awsui-radio-button id="objectstorage-standard" value="STANDARD" ng-model="obj.StorageClass" label="{{ \'storageclasses.standard\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n                <p class="object-radio-description" translate="objectproperties.storageclass.standarddescription"></p>\n            </div>\n            <div class="awsui-row card-content-row">\n                <awsui-radio-group ng-model="obj.StorageClass">\n                    <awsui-radio-button id="objectstorage-standardia" value="STANDARD_IA" ng-model="obj.StorageClass" label="{{ \'storageclasses.standardia\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n                <p class="object-radio-description" translate="objectproperties.storageclass.siadescription"></p>\n            </div>\n            <div class="awsui-row card-content-row" fac-id="s3-rrs">\n                <awsui-radio-group ng-model="obj.StorageClass">\n                    <awsui-radio-button id="objectstorage-reduced" value="REDUCED_REDUNDANCY" ng-model="obj.StorageClass" label="{{ \'storageclasses.rrs\' | translate }}"></awsui-radio-button>\n                </awsui-radio-group>\n                <p class="object-radio-description" translate="objectproperties.storageclass.rrsdescription"></p>\n            </div>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <div class="error-alert" ng-if="storageClassError && cardOpen">{{ storageClassError }}</div>\n    </card-content>\n    <card-footer>\n        <div class="object-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="objectstorage-save" ng-click="save($event)" data-disabled="obj.StorageClass == cachedValue.StorageClass" text="{{ \'button.save\' | translate }}" class="awsui-util-f-r object-property-button" loading="isSaving" variant="primary"></awsui-button>\n            <awsui-button id="objectstorage-cancel" ng-click="cancel($event)" text="{{ \'button.cancel\' | translate }}" class="awsui-util-f-r object-property-button"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/object-details/objecttag.html",'<card card-id="scrollCardId" card-summary-obj="cardSummaryObj" is-open="cardOpen" ng-class="{ \'card-disable-tags-water-mark\': !cardOpen, \'card-enable-tags-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="objectproperties.tags.label"></span>\n        <div class="card-close-icon" ng-show="cardOpen" ng-click="cancelObjectTagging($event)"></div>\n    </card-header>\n    <card-content>\n        <p class="bucketproperties-summary" ng-if="!cardOpen" translate="objectproperties.tags.summary"></p>\n        <table class="tagging-table" ng-if="cardOpen">\n            <thead>\n            <tr>\n                <td></td>\n                <td translate="objectproperties.tags.key"></td>\n                <td translate="objectproperties.tags.value"></td>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="tag in obj.Tagging">\n                <td>\n                    <awsui-control-group validation-message="{{tag.errorMessage}}">\n                        <awsui-textfield class="tag-input" ng-model="tag.Key"></awsui-textfield>\n                    </awsui-control-group>\n                </td>\n                <td>\n                    <awsui-control-group>\n                        <awsui-textfield class="tag-input" ng-model="tag.Value"></awsui-textfield>\n                    </awsui-control-group>\n                </td>\n                <td><a href="" class="remove-tag" ng-click="removeTag($index)">X</a></td>\n            </tr>\n            </tbody>\n        </table>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-button id="add-object-tag" ng-click="addTag()" ng-show="cardOpen" data-disabled="obj.Tagging.length >= maxAllowedTags || isAnyKeyEmpty()" icon="plus" class="object-properties-button" text="{{\'objectproperties.tags.addnew\' | translate}}"></awsui-button>\n        <awsui-alert class="tag-error" type="error" ng-show="tagError && tagErrorMessage !== \'\' && cardOpen">{{tagErrorMessage}}</awsui-alert>\n        <awsui-alert class="objecttag-replication-warning" ng-if="cardOpen" dismissible="false" type="warning" fac-id="s3-crr"><p translate="replicationcard.warningmsg"></p></awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="object-properties-buttons" ng-if="cardOpen">\n            <awsui-button id="objecttag-save" class="object-property-button awsui-util-f-r" ng-click="saveObjectTagging($event)" text="{{ \'button.save\' | translate }}" variant="primary"></awsui-button>\n            <awsui-button id="objecttag-cancel" class="object-property-button awsui-util-f-r" ng-click="cancelObjectTagging($event)" text="{{ \'button.cancel\' | translate }}"></awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/objectfrequencyanalytics.html",'<div class="object-freq">\n    <table ng-if="storage && dataRetrieved && frequencyTypes" class="info-table">\n        <tbody>\n            <tr>\n                <td>\n                    <span class="enabled-lightbulb-blue-image lightbulb-icon"></span>\n                </td>\n                <td>\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td>\n                                    <span class="header-text header" translate="storageanalysis.label.accession"></span>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>\n                                    <span class="secondary-text header" translate="storageanalysis.label.analyzed" translate-values="{ days : daysAnalyzed}"></span>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </td>\n                <td>\n                    <awsui-select items="objectTypes" class="select-object-types" ng-model="storageClass.value" change="processData()" placeholder="{{\'storageanalysis.label.standard\' | translate}}"></awsui-select>\n                </td>\n                <td>\n                    <div class="info-legend-group">\n                        <div class="info-legend">\n                            <div class="info-color-box storage-back"></div>\n                            <span class="storage-color" translate="storageanalysis.label.storage"></span>\n                        </div>\n                        <div class="info-legend">\n                            <div class="info-color-box data-back"></div>\n                            <span class="data-color" translate="storageanalysis.label.dataRetrieved"></span>\n                        </div>\n                    </div>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <table ng-if="storage && dataRetrieved && frequencyTypes" class="object-freq-table">\n        <tbody>\n            <tr>\n                <td class="cards" data-ng-repeat="i in [0, 1, 2]">\n                    <bar-chart-card chart-title="titles[i]" data="[storage[i], dataRetrieved[i]]" labels="labels" colors="{row: frequencyTypes[i].color, bars: barColors}" max-value="maxValue" width="width" height="height" footer="frequencyTypes[i]">\n                    </bar-chart-card>\n                </td>\n            </tr>\n            <tr>\n                <td class="cards" data-ng-repeat="i in [3, 4, 5]">\n                    <bar-chart-card chart-title="titles[i]" data="[storage[i], dataRetrieved[i]]" labels="labels" colors="{row: frequencyTypes[i].color, bars: barColors}" max-value="maxValue" width="width" height="height" footer="frequencyTypes[i]">\n                    </bar-chart-card>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>');a.put("/s3/partials/objects.html",'<awsui-alert type="error" header="{{\'error.header\'|translate}}" visible="currLocation.objects.error">{{currLocation.objects.error}}</awsui-alert>\n<div ng-hide="objectListError" class="object-list" filedrop="">\n    <div ng-class="{ \'object-nav-wrapper\': !showEmptyScreen, \'object-nav-wrapper-empty\': showEmptyScreen }">\n        <div class="action-strip" sticky-nav="fix-to-top" sticky-nav-padding-top="160">\n            <search ng-if="!showEmptyScreen" fetch-one-page-prefix="fetchOnePagePrefix(prefix)" fetch-one-page-tag="fetchOnePageTag()" filters="filters" markers="markers" tag-continuation-tokens="tagContinuationTokens"></search>\n            <awsui-button class="bucket-action-strip-button action-button-spacing" text="{{ \'objectactionstrip.upload\' | translate }}" ng-click="openUploadModal()" variant="primary" icon="upload" data-disabled="!isFeatureEnabled(\'s3-up\')"></awsui-button>\n            <awsui-button class="bucket-action-strip-button action-button-spacing" text="{{ \'objectactionstrip.createfolder\' | translate }}" ng-click="showCreateFolder()" variant="primary" icon="plus" data-disabled="!isFeatureEnabled(\'s3-cf\')"></awsui-button>\n            <action-dropdown class="moredropdown" get-selected-objects="getSelectedObjects" get-selected-folders="getSelectedFolders" is-single-object-only-selected="isSingleObjectOnlySelected" tag-filter-length="filters.tagFilters.length" text="{{ \'objectactionstrip.more\' | translate }}" items="more_dropdown" bucketname="bucketName" show-deleted="showDeleted"></action-dropdown>\n            <awsui-button-group ng-if="isVersionedBucket" class="bucket-action-show-deleted-objs" fac-id="s3-sdo">\n                <awsui-button ng-class="{selected: !showDeleted}" ng-click="showAllObjects()" text="{{ \'objectactionstrip.showall\' | translate }}"></awsui-button>\n                <awsui-button ng-class="{selected: showDeleted}" ng-click="showDeletedObjects()" text="{{ \'objectactionstrip.showdeleted\' | translate }}"></awsui-button>\n            </awsui-button-group>\n            <div class="refresh-button">\n                <span class="object-bucket-region" ng-bind="bucketRegion.text"></span>\n                <awsui-button id="refreshButton" icon="refresh" variant="standalone-icon" loading="isRefreshing" click="fetchObjects(false, false)"></awsui-button>\n            </div>\n        </div>\n    </div>\n    <empty-state ng-if="showEmptyScreen" right-click="rightClick($event)" open-modal="openUploadModal" type="\'object\'"></empty-state>\n    <div ng-if="noResultsMessage" class="no-results" right-click="rightClick($event)">{{noResultsMessage}}</div>\n    <div class="columbia-table object-table" ng-if="!showEmptyScreen && !noResultsMessage" right-click="rightClick($event)">\n        <div class="pages-row pages-row-top">\n            <div class="pages">\n                <awsui-button id="fetchPreviousPageBtn" icon="angle-left" variant="standalone-icon" click="fetchPreviousPageOfObjects()" data-disabled="isFetchPreviousPageDisabled()"></awsui-button>\n                <span ng-if="!fetchPageInProgress" id="paginationNumbering">{{\'objects.pagination.viewing\' | translate}} {{ startKeyNum }} {{\'objects.pagination.to\' | translate}} {{ endKeyNum }} </span>\n                <awsui-button id="fetchNextPageBtn" icon="angle-right" variant="standalone-icon" click="fetchNextPageOfObjects()" data-disabled="isFetchNextPageDisabled()"></awsui-button>\n            </div>\n        </div>\n        <table class="table table-condensed fix-width-table">\n            <thead>\n            <tr class="black-header">\n                <th><awsui-checkbox ng-model="allKeys.selected" change="selectAllKeys()"></awsui-checkbox></th>\n\n                    <th ng-click="setSortOrder(\'Key\')">\n                        <awsui-tooltip text="{{\'tooltip.pagesortonly\' | translate}}" position="bottom">\n                            <a translate="objects.column.key"></a>\n                            <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'Key\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'Key\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'Key\'}"></span>\n                        </awsui-tooltip>\n                    </th>\n                    <th ng-click="setSortOrder(\'LastModified\')">\n                        <awsui-tooltip text="{{\'tooltip.pagesortonly\' | translate}}" position="bottom">\n                        <a translate="last.modified"></a>\n                        <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'LastModified\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'LastModified\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'LastModified\'}"></span>\n                        </awsui-tooltip>\n                    </th>\n                    <th ng-click="setSortOrder(\'Size\')">\n                        <awsui-tooltip text="{{\'tooltip.pagesortonly\' | translate}}" position="bottom">\n                        <a translate="objects.column.size"></a>\n                        <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'Size\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'Size\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'Size\'}"></span>\n                        </awsui-tooltip>\n                    </th>\n                    <th ng-click="setSortOrder(\'StorageClass\')">\n                        <awsui-tooltip text="{{\'tooltip.pagesortonly\' | translate}}" position="bottom">\n                        <a translate="objects.column.storageclass"></a>\n                        <span class="sorting-icon" ng-class="{\'sorting-ascending\': sortColumnName===\'StorageClass\' && !reverseSortOrder, \'sorting-descending\': sortColumnName===\'StorageClass\' && reverseSortOrder, \'sorting-disabled\': sortColumnName!==\'StorageClass\'}"></span>\n                        </awsui-tooltip>\n                    </th>\n            </tr>\n            </thead>\n            <tbody ng-hide="currLocation.loading">\n                <tr ng-if="createFolder.displayed">\n                    <td>\n                        <awsui-checkbox ng-click="$event.stopPropagation()"></awsui-checkbox>\n                    </td>\n                    <td class="awsui-icon folder-open">\n                        <update-object show-operation="createFolder.displayed" fetch-objects="fetchObjects" current-marker="currentMarker" default-placeholder="{{\'createfolder.input.defaultvalue\' | translate}}" operation="operation" reset-selection="resetSelection">\n                    </td>\n                    <td></td>\n                    <td></td>\n                    <td></td>\n                </tr>\n                <tr class="unselectable" unselectable="on" onselectstart="return false" ng-repeat="folder in currLocation.folders.relativePaths | orderBy:sortColumnName:reverseSortOrder" ng-class="{\'row-selected\': folder.selected, \'row-hover\' : hoverFolder && !folder.selected }" ng-mouseenter="hoverFolder = true" ng-mouseleave="hoverFolder = false" ng-show="currLocation.folders.relativePaths.length" ng-click="clickObjectRow($event, folder)" ng-dblclick="navigateIntoFolder(folder.Prefix)" right-click="rightClick($event, folder)">\n                    <td>\n                        <awsui-checkbox checked="folder.selected" change="selectOneMoreKey(folder, \'folderKey\')" ng-click="$event.stopPropagation()"></awsui-checkbox>\n                    </td>\n                    <td class="awsui-icon folder-open truncate" ng-class="{\'awsui-icon-light\': folder.selected && !panelHide}">\n                        <a class="list-view-item-name object-name" ng-click="navigateIntoFolder(folder.Prefix); $event.stopPropagation()" ng-if="!folder.beingRenamed && folder.Prefix !== \'\'"> {{ folder.Prefix }} </a>\n                        <a class="list-view-item-name object-name empty-folder-name" ng-click="navigateIntoFolder(folder.Prefix); $event.stopPropagation()" ng-if="!folder.beingRenamed && folder.Prefix === \'\'"></a>\n                        <span ng-if="folder.beingRenamed">\n                            <update-object show-operation="folder.beingRenamed" fetch-objects="fetchObjects" current-marker="currentMarker" default-value="{{folder.Prefix}}" operation="operation" reset-selection="resetSelection">\n                        </span>\n                    </td>\n                    <td> -- </td>\n                    <td> -- </td>\n                    <td> -- </td>\n                </tr>\n                <tr class="unselectable" unselectable="on" onselectstart="return false" ng-repeat="obj in currLocation.objects.relativePaths | orderBy:sortColumnName:reverseSortOrder" ng-class="{\'row-selected\': obj.selected , \'row-hover\' : hoverObj && !obj.selected}" ng-mouseenter="hoverObj = true" ng-mouseleave="hoverObj = false" ng-click="clickObjectRow($event, obj)" ng-dblclick="openObjectInBrowser(obj)" right-click="rightClick($event, obj)">\n                    <td><awsui-checkbox checked="obj.selected" change="selectOneMoreKey(obj, \'objectKey\')" ng-click="$event.stopPropagation();"></awsui-checkbox></td>\n                    <td class="truncate">\n                        <span class="awsui-icon" ng-class="getIconClass(obj)" ng-click="openObjectInBrowser(obj)"></span>\n                        <a class="list-view-item-name object-name" ng-click="goToObjectDetails(obj)" ng-show="!obj.beingRenamed"> {{ obj.Key }} </a>\n                        <span ng-if="obj.beingRenamed">\n                            <update-object show-operation="obj.beingRenamed" fetch-objects="fetchObjects" current-marker="currentMarker" default-value="{{obj.Key}}" operation="operation" reset-selection="resetSelection">\n                        </span>\n                    </td>\n                    <td ng-if="obj.LastModified !== \'\'">{{ obj.LastModified | date:"medium" }}</td>\n                    <td ng-if="obj.LastModified === \'\'"> -- </td>\n                    <td ng-if="obj.Size !== \'\'">{{ obj.Size | humanReadableBytes }}</td>\n                    <td ng-if="obj.Size === \'\'"> -- </td>\n                    <td ng-if="obj.StorageClass !== \'\'">{{ getStorageClassTranslation(obj.StorageClass)}}</td>\n                    <td ng-if="obj.StorageClass === \'\'"> -- </td>\n                </tr>\n            </tbody>\n        </table>\n        <div class="pages-row">\n            <div class="pages">\n                <awsui-button icon="angle-left" variant="standalone-icon" click="fetchPreviousPageOfObjects()" data-disabled="isFetchPreviousPageDisabled()"></awsui-button>\n                <span>{{\'objects.pagination.viewing\' | translate}} {{ startKeyNum }} {{\'objects.pagination.to\' | translate}} {{ endKeyNum }} </span>\n                <awsui-button icon="angle-right" variant="standalone-icon" click="fetchNextPageOfObjects()" data-disabled="isFetchNextPageDisabled()"></awsui-button>\n\n            </div>\n        </div>\n    </div>\n    <storage-console-config-panel class="objects-side-panel download-side-panel" ng-mouseenter="hoverDownloadPanel(true)" ng-mouseleave="hoverDownloadPanel(false)" ng-class="{\'side-config-panel\': downloadAsPanel, \'hide-config-panel\': !downloadAsPanel}" panel-open="downloadAsPanel">\n        <header>\n            <span class="side-panel-header download-as-panel-header" translate="object.download.destination"></span>\n            <span class="panel-close-icon" ng-click="closeDownloadAsPanel()"></span>\n        </header>\n        <content>\n            <div class="download-as-directions">\n                <div class="download-as-directions-text" translate="object.download.directions"></div>\n                <a ng-show="!downloadAsPanelGenerating && !downloadPanelError" ng-href="{{downloadPanel.url}}" id="downloadAsLink">{{ getSelectedObjects()[0].Key }}</a>\n                <div class="download-as-directions-text" ng-show="!downloadAsPanelGenerating && downloadPanelError" translate="object.download.error"></div>\n                <span ng-show="downloadAsPanelGenerating" class="awsui-spinner awsui-spinner-light"></span>\n            </div>\n        </content>\n    </storage-console-config-panel>\n    <storage-console-config-panel class="objects-side-panel" ng-mouseenter="hoverObjectPropertiesPanel(true)" ng-mouseleave="hoverObjectPropertiesPanel(false)" ng-class="{\'side-config-panel\': objectPropertiesPanel.show, \'hide-config-panel\': !objectPropertiesPanel.show}" panel-open="objectPropertiesPanel.show">\n        <header>\n            <div class="truncate side-panel-header"> {{ objectPropertiesConfig.overview.Key }}\n            </div>\n            <span class="panel-close-icon" ng-click="closeObjectPropertiesPanel()"></span>\n            <awsui-button class="sidepanel-header-button" ng-click="downloadSelectedObject(objectSelectedForSidePanel.obj.disableDownload)" text="{{ \'objects.button.download\' | translate }}"></awsui-button>\n            <awsui-button class="sidepanel-header-button" ng-click="$event.stopPropagation(); copySelectedObjectPath(getSelectedObjects()[0].Key)" text="{{ \'objects.button.copypath\' | translate }}"></awsui-button>\n            <span class="copy-message" ng-class="{ \'fade-in\' : copyFinished.flag, \'fade-out\' : !copyFinished.flag}" translate="copytoclipboard.path"></span>\n        </header>\n        <content>\n            <div class="sidepanel-version-section">\n                <div class="version-label-container" ng-click="listVersions($event)">\n                    <span class="version-label"> {{ objectSelectedForSidePanel.obj.versionLabel }}</span>\n                    <div class="versions-dropdown-caret"></div>\n                </div>\n                <versions-dropdown bucket="bucketForVersionsDropdown.name" error="objectSelectedForSidePanel.error" get-metadata="getMetadata(operation, versionId)" set-up-metadata="setUpObjectMetadataForPropertiesPanel(obj)" update-obj-metadata="updateObjMetadata(obj)" update-obj-acl="updateObjAcl(obj)" key="versionDropdownKey.name" obj="objectSelectedForSidePanel.obj" versions="objectSelectedForSidePanel.versions" show-versions-dropdown="showVersionsDropdown" objects-page="objectsPage.show" refresh="refreshAndClearObjectsCacheForCurrentBucket()" object-properties-panel="objectPropertiesPanel" versions-dropdown-selected-object="versionsDropdownSelectedObject.obj">\n                </versions-dropdown>\n                <div ng-if="!$last" class="sidepanel-version-section-divider"></div>\n            </div>\n            <div class="version-placeholder"></div>\n            <div class="object-panel-configcontent">\n                <div class="objects-panel-config-lists" ng-repeat="(configTitle, configContent) in objectPropertiesConfig" ng-click="moveToObjectTab(configTitle)">\n                    <table ng-if="configTitle !== \'permissions\'">\n                        <tr class="objects-config-panel-content" ng-repeat="(configKey, configValue) in configContent">\n                            <td class="subtitle">{{ getPropertyTitleConditionally($first, \'objects.details.\', configTitle) }}</td>\n                            <td class="config-panel-content-left" translate="objects.details.{{configKey}}" ng-click="takeActionFromSidePanel(configTitle, configKey, $event)"></td>\n                            <td ng-if="configKey !== \'Link\'" class="config-panel-content-right">{{configValue}}</td>\n                            <td ng-if="configKey === \'Link\'" class="config-panel-content-right link"><a href="{{configValue}}">{{configValue}}</a></td>\n                        </tr>\n                    </table>\n                    <table ng-if="configTitle === \'permissions\'">\n                        <tr class="objects-config-panel-content">\n                            <td class="subtitle"><span translate="objects.details.permissions"></span></td>\n                            <td class="config-panel-content-left" translate="objects.details.owner"></td>\n                            <td class="config-panel-content-right">{{ configContent.owner }}</td>\n                        </tr>\n                    </table>\n                    <table class="object-side-panel-permissions-table" ng-repeat="(permissionHeader, properties) in configContent.grantees">\n                        <tr class="objects-config-panel-content">\n                            <td></td>\n                            <td class="config-panel-content-left config-panel-content-subheading"><span translate="objects.details.{{permissionHeader}}"></span></td>\n                            <td class="config-panel-content-right"></td>\n                        </tr>\n                        <tr class="objects-config-panel-content" ng-repeat="(permissionKey, permissionValue) in properties">\n                            <td class="subtitle"></td>\n                            <td class="config-panel-content-left"><span translate="objects.details.{{permissionKey}}"></span></td>\n                            <td class="config-panel-content-right">{{ permissionValue }} {{ \'objects.details.grantees\' | translate }}</td>\n                        </tr>\n                    </table>\n                    <div ng-if="!$last" class="bucket-config-panel-divider"></div>\n                </div>\n            </div>\n            <awsui-alert class="version-dropdown-error" ng-if="objectSelectedForSidePanel.error !== \'\'" type="error"> {{ objectSelectedForSidePanel.error }} </awsui-alert>\n        </content>\n    </storage-console-config-panel>\n</div>\n<upload-modal modal-open="isUploadModalDisplayed" current-path="currentPath" fetch-objects="fetchObjects" operation="operations.dragAndDropOperation" selected="selected" flags="flags" filedrop=""></upload-modal>\n<initiate-restore-modal ng-if="operation && isInitiateRestoreDisplayed.flag" is-open="isInitiateRestoreDisplayed" count-info="countInfo" operation="operation">\n</initiate-restore-modal>\n<confirmation-dialog-modal ng-if="operation && isConfirmationModalOpen.dialogOpen.flag" is-open="isConfirmationModalOpen" count-info="countInfo" operation="operation">\n</confirmation-dialog-modal>\n<storage-console-config-panel class="multiselect-config-panel" ng-class="{\'side-config-panel objects-side-panel\': isConfirmationModalOpen.sidePanelOpen,\n                                  \'hide-config-panel objects-side-panel\': !isConfirmationModalOpen.sidePanelOpen}" panel-open="isConfirmationModalOpen.sidePanelOpen" is-side-panel="true" ng-mouseenter="hoverConfirmationPanel(true)" ng-mouseleave="hoverConfirmationPanel(false)">\n    <header>\n        <span class="side-panel-header multi-selected-configpanel-header">{{modalInfo.headTitle}}</span>\n        <span class="panel-close-icon" ng-click="cancelConfirmationPanel($event)"></span>\n        <p translate="mutiselectpanel.files" translate-values="{totalObjs: {{countInfo.objects}} }"></p>\n    </header>\n    <content>\n        \n        <div class="initialrestore-panel" ng-if="opName === more_dropdown[3].items[1].opName">\n            <table>\n                <tr>\n                    <td class="initialrestore-toptext" translate="confirmationsidepanel.initiaterestore.toptext"></td>\n                </tr>\n                <tr>\n                    <td>\n                        <form class="initial-restore-panel-value" name="initialRestorePanel" autocomplete="off">\n                            <awsui-control-group validation-message="{{  (initialRestorePanel.initialRestoreValue.$error.required ? \'initialrestorevalue.emptywarning \' : panelSettingValues.inputErrorMsg) | translate }}">\n                                <awsui-textfield name="initialRestoreValue" ng-model="panelSettingValues.setting" ng-change="validateInitialRestoreValue(panelSettingValues)" required=""></awsui-textfield>\n                            </awsui-control-group>\n                        </form>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="initialrestore-bottomtext" translate="confirmationsidepanel.initiaterestore.bottomtext"></td>\n                </tr>\n            </table>\n        </div>\n\n        \n        <div class="add-object-tags" ng-if="opName === more_dropdown[3].items[4].opName">\n            <table class="tagging-table">\n                <thead>\n                    <tr>\n                        <td translate="objectproperties.tags.key" class="key-header"></td>\n                        <td translate="objectproperties.tags.value" class="value-header"></td>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr ng-repeat="tag in panelSettingValues.values">\n                        <td>\n                            <awsui-textfield class="tag-input" ng-model="tag.Key"></awsui-textfield>\n                        </td>\n                        <td>\n                            <awsui-textfield class="tag-input" ng-model="tag.Value"></awsui-textfield>\n                        </td>\n                        <td><a href="" class="remove-tag" ng-click="removeTag($index)">X</a></td>\n                    </tr>\n                </tbody>\n            </table>\n            <awsui-button ng-click="addTag()" data-disabled="panelSettingValues.values.length >= panelSettingValues.setting.maxKeys || isAnyKeyEmpty()" icon="plus" class="object-properties-button" text="{{\'objectproperties.tags.addnew\' | translate}}"></awsui-button>\n            <awsui-alert class="error-alert" type="error" ng-show="tagError">{{tagErrorMessage}}</awsui-alert>\n            <awsui-alert class="objecttag-replication-warning" dismissible="false" type="warning" fac-id="s3-crr">\n                <p translate="replicationcard.warningmsg"></p>\n            </awsui-alert>\n        </div>\n\n        \n        <div ng-repeat="value in panelSettingValues.values" ng-if="opName !== more_dropdown[1].items[2].opName && opName !== more_dropdown[3].items[4].opName">\n            <div class="awsui-row">\n                <awsui-radio-group class="sidepanel-radio-settings" ng-model="panelSettingValues.setting" ng-change="updateConfigPanel()">\n                    <awsui-radio-button value="{{value[0]}}" ng-model="panelSettingValues.setting" label="{{ value[1] }}"></awsui-radio-button>\n                </awsui-radio-group>\n                <div class="sidepanel-radio-description" translate="{{value[2]}}"></div>\n            </div>\n        </div>\n\n        \n        <div ng-if="opName === more_dropdown[3].items[2].opName" fac-id="s3-kms" class="configure-kms-key">\n            <awsui-control-group validation-message="{{ KMSServiceError }}">\n                <dropdown ng-if="panelSettingValues.setting === awsKMS" items="kmsKeys" placeholder="{{ \'objectproperties.placeholder.kmskeys\' | translate }}" disabled="KMSServiceError" selected-item="panelSettingValues.kmsOption.kmsId" filter="true">\n                </dropdown>\n            </awsui-control-group>\n            \n            <awsui-textfield ng-if="panelSettingValues.setting === awsKMS && panelSettingValues.kmsOption.kmsId.value === customARN" ng-model="panelSettingValues.kmsOption.kmsARN">\n            </awsui-textfield>\n        </div>\n    </content>\n\n    <footer>\n        <awsui-button id="save-confirmation-panel-btn" ng-click="saveConfirmationPanel($event)" text="{{ \'button.save\' | translate }}" class="awsui-util-f-r object-property-button" loading="isCounting.flag" variant="primary"></awsui-button>\n        \n        <awsui-button ng-click="cancelConfirmationPanel($event)" text="{{ \'button.cancel\' | translate }}" class="awsui-util-f-r object-property-button"></awsui-button>\n    </footer>\n</storage-console-config-panel>\n<action-dropdown class="context-menu" id="context-menu" get-selected-objects="getSelectedObjects" get-selected-folders="getSelectedFolders" is-single-object-only-selected="isSingleObjectOnlySelected" tag-filter-length="filters.tagFilters.length" text="{{ \'objectactionstrip.more\' | translate }}" items="more_dropdown" bucketname="bucketName" show-deleted="showDeleted">\n</action-dropdown>');a.put("/s3/partials/permissionsSubModal.html",'<table class="expandsectable">\n    <tr class="subsectitle-row">\n        <td ng-repeat="aclTitle in aclModalTitles">\n            {{aclTitle.txt}}\n            <awsui-tooltip text="{{aclTitle.info}}" position="{{aclTitle.pos}}" size="small">\n                <i class="awsui-icon alert-info-circle"></i>\n            </awsui-tooltip>\n        </td>\n        <td></td>\n    </tr>\n    <tr ng-repeat="permission in permissions" ng-if="!permissions[$index].revokeAll && permissions[$index].detail.value !== \'AuthenticatedUsers\'">\n        <td ng-if="isPublic">{{permission.detail.text}}</td>\n        <td ng-if="!isPublic">{{permission.detail.DisplayName}}<span ng-if="$index===0" translate="userpermission.owner"></span></td>\n        <td>\n            <awsui-checkbox class="createbucketcheckbox" ng-model="permission.permissions.READ">{{ \'permissions.value.read\' | translate }}</awsui-checkbox>\n            <awsui-checkbox class="createbucketcheckbox" ng-model="permission.permissions.WRITE">{{ \'permissions.value.write\' | translate }}</awsui-checkbox>\n        </td>\n        <td>\n            <awsui-checkbox class="createbucketcheckbox" ng-model="permission.permissions.READ_ACP">{{ \'permissions.value.read\' | translate }}</awsui-checkbox>\n            <awsui-checkbox class="createbucketcheckbox" ng-model="permission.permissions.WRITE_ACP">{{ \'permissions.value.write\' | translate }}</awsui-checkbox>\n            <span class="permissions-sub-modal-close close-icon" ng-if="!isPublic" ng-click="deleteUserAcl($index)"></span>\n        </td>\n    </tr>\n</table>');a.put("/s3/partials/progressbar.html",'<div scroll="" selected-tab="{{selectedTab}}" total-operation="{{totalOperationCount}}" ng-show=" totalOperationCount > 0 " class="progress-bar-footer" ng-class="{ open: isExpanded }">\n    <div ng-show="isExpanded" class="progress-bar-session">\n        <table>\n            <tr class="progress-bar-operation" ng-repeat="operation in showingOperations">\n                <th class="progress-bar-icon-and-name">\n                    <span class="operation-icon awsui-icon awsui-icon-link" ng-click="openModal(operation)" ng-class="getIconForOperation(operation.name)"></span>\n                    <div class="operation-name" ng-click="openModal(operation)"> {{operation.displayName}} <div class="upload-speed-report" ng-if="isActiveUploadOperation(operation)"> ({{operation.currentUploadSpeed}}/s)</div></div>\n                </th>\n                <th class="progress-bar-real-progress-bar">\n                    <div class="operation-progress-bar {{ operation.state }}-fill">\n                        <div ng-if="operation.successPercentage !== 0" class="current-progress-fill" ng-style="{width: operation.successPercentage + \'%\'}">\n                            <span ng-if="operation.successPercentage >= thresholdPercentage" class="operation-percentage-text">{{operation.successPercentage}}% </span>\n                            <span ng-if="operation.successPercentage >= thresholdPercentage" class="operation-percentage-text" translate="">operation.detail.successful</span>\n                        </div>\n                        <div ng-if="operation.errorPercentage !== 0" class="current-error-fill" ng-style="{width: operation.errorPercentage + \'%\'}">\n                            <span ng-if="operation.errorPercentage >= thresholdPercentage" class="operation-percentage-text">{{operation.errorPercentage}}%</span>\n                            <span ng-if="operation.errorPercentage >= thresholdPercentage" class="operation-percentage-text" translate="">operation.detail.failed</span>\n                        </div>\n                    </div>\n                </th>\n\n                <th class="progress-bar-cancel-icon">\n                    <span class="operation-cancel-button blue-cancel-icon" ng-click="cancelOperation(operation)"></span>\n                </th>\n                <div class="awsui-util-clearfix"></div>\n            </tr>\n        </table>\n    </div>\n\n    <div class="operation-summary">\n        <div class="total-operations">\n            {{ \'operation.tab.totalOperations\' | translate }}\n        </div>\n        <div class="in-progress-expander" ng-class="{ \'cursorpointer\' : hoverOnInprogress &&  totalOngoingOperations.length > 0 || operationState.ongoingOperations,\n        \'cursornomal\' : hoverOnInprogress &&  totalOngoingOperations.length === 0,\n        \'deselectprogresstab\': !operationState.ongoingOperations && totalOngoingOperations.length > 0}" ng-mouseenter="hoverOnInprogress = true" ng-mouseleave="hoverOnInprogress = false" ng-click="expandOrCollapseOperations(allOperations.ongoingOperations, totalOngoingOperations.length !== 0, \'ongoingOperations\')">\n            {{ totalOngoingOperations.length }} {{ \'operation.tab.inProgress\' | translate }}\n        </div>\n        <div class="completed-expander" ng-class="{ \'cursorpointer\' : hoverOnComplete &&  completedOperations.length > 0 || operationState.completedOperations,\n        \'cursornomal\' : hoverOnComplete &&  completedOperations.length === 0,\n        \'deselectprogresstab\': !operationState.completedOperations && completedOperations.length > 0 }" ng-mouseenter="hoverOnComplete = true" ng-mouseleave="hoverOnComplete = false" ng-click="expandOrCollapseOperations(allOperations.completedOperations, completedOperations.length !== 0, \'completedOperations\')">\n            {{ completedOperations.length}} {{ \'operation.tab.success\' | translate }}\n        </div>\n        <div class="error-expander" ng-class="{ \'cursorpointer\' : hoverOnError &&  incompleteOperations.length > 0 || operationState.incompleteOperations,\n        \'cursornomal\' : hoverOnError &&  incompleteOperations.length === 0,\n        \'deselectprogresstab\': !operationState.incompleteOperations && incompleteOperations.length > 0}" ng-mouseenter="hoverOnError = true" ng-mouseleave="hoverOnError = false" ng-click="expandOrCollapseOperations(allOperations.incompleteOperations, incompleteOperations.length !== 0, \'incompleteOperations\')">\n            {{ incompleteOperations.length }} {{ \'operation.tab.error\' | translate }}\n        </div>\n    </div>\n</div>\n<detail-progress is-open="modalOpen" cancel-button-text="detailCancelButtonText" target-operation="detailOperation" cancel-operation-function="cancelFromDetailView" close-callback="closeDetailView"></detail-progress>');a.put("/s3/partials/replicationv1.html",'<card card-summary-obj="cardSummaryObj" card-id="scrollCardId" is-open="cardOpen" ng-class="{ \'card-disable-CRR-water-mark\': !cardOpen, \'card-enable-CRR-water-mark\': cardOpen }">\n    <card-header>\n        <span translate="bucketproperties.crossregionreplication.label.crossregionreplication"></span>\n        <div class="card-close-icon" ng-if="cardOpen" ng-click="cancelPressed($event)"></div>\n    </card-header>\n    <card-content>\n        <p ng-if="!cardOpen" class="bucketproperties-summary" translate="bucketproperties.crossregionreplication.summary"></p>\n        <div class="awsui-row card-content-row">\n            <awsui-radio-group ng-if="cardOpen" ng-model="replicationObj.isEnabled">\n                <awsui-radio-button style="display: inline" value="Enabled" label="{{ \'replication.label.enable\' | translate }}" disabled="versioningStatus === S3Constants.BUCKET_PROPERTIES.DISABLE"></awsui-radio-button>\n                <awsui-tooltip text="{{\'replication.enable.tooltip\' | translate}}" position="right" size="small">\n                    <i class="awsui-icon alert-info-circle"></i>\n                </awsui-tooltip>\n                <awsui-alert ng-if="replicationObj.isEnabled == S3Constants.REPLICATION.DISABLED" class="warning-box" type="warning" dismissable="false">{{ \'replication.enablewarning\' | translate }}</awsui-alert>\n                <div class="enabled-replication-content" ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED" ng-click="$event.stopPropagation(); completeEdit()">\n                    <div class="source-section">\n                        <div class="section-header">\n                            <span translate="">replication.sectionheader.source</span>\n                            <div></div>\n                        </div>\n                        <div class="region-text">\n                            <span id="region-title" translate="">replication.label.region</span>\n                            <span>{{sourceRegion}}</span>\n                        </div>\n                        <awsui-control-group ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED">\n                            <awsui-select ng-change="resetError()" placeholder="{{ \'replication.placeholder.source\' | translate }}" ng-model="replicationObj.replicationType" items="sources">\n                            </awsui-select>\n                        </awsui-control-group>\n                    </div>\n                    <div class="destination-section">\n                        <div class="section-header">\n                            <span>{{ \'replication.sectionheader.destination\' | translate }}</span>\n                            <div></div>\n                        </div>\n                        <awsui-control-group ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED">\n                            <dropdown items="regionMapping" selected-item="replicationObj.destinationRegion" placeholder="{{ \'replication.placeholder.region\' | translate }}" filter="true"></dropdown>\n                        </awsui-control-group>\n                        <awsui-control-group ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED">\n                            <dropdown disabled="bucketList.length === 0" items="bucketList" selected-item="replicationObj.destinationBucket" placeholder="{{ \'replication.placeholder.destinationbucket\' | translate }}" filter="true"></dropdown>\n                        </awsui-control-group>\n                    </div>\n                    <div class="bottom-section">\n                        <awsui-control-group ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED && replicationObj.replicationType === \'bucket\'" label="{{ \'replication.label.storageclass\' | translate }}">\n                            <awsui-select ng-change="resetError()" placeholder="{{ \'replication.placeholder.storageclass\' | translate }}" ng-model="replicationObj.storageClass" items="storageClasses"></awsui-select>\n                        </awsui-control-group>\n                        <awsui-expandable-section class="collapsable-section" header="{{ \'replication.label.currentprefixes\' | translate }}" ng-if="cardOpen && replicationObj.replicationType === \'prefix\' && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED">\n                            <div class="replication-table-v1">\n                                <table class="table table-condensed">\n                                    <thead>\n                                    <tr>\n                                        <td></td>\n                                        <td translate="">replication.table.prefix</td>\n                                        <td translate="">replication.table.storageclass</td>\n                                        <td></td>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    <tr class="add-rule">\n                                        <td colspan="2" ng-click="addRule($event)">{{ \'replication.table.add\' | translate }}</td>\n                                        <td></td>\n                                        <td></td>\n                                    </tr>\n                                    <tr ng-repeat="rule in replicationObj.rulesArray" ng-click="editRule(rule, $event)">\n                                        <td>\n                                            <div ng-if="rule.status === S3Constants.REPLICATION.ENABLED && !rule.markedForDelete" class="card-enabled-icon rule-status" ng-click="toggleRuleStatus(rule, $event)"></div>\n                                            <div ng-if="rule.status === S3Constants.REPLICATION.DISABLED && !rule.markedForDelete" class="card-disabled-icon rule-status" ng-click="toggleRuleStatus(rule, $event)"></div>\n                                            <span ng-if="rule.markedForDelete" class="awsui-icon awsui-icon-bigger times-circle" ng-click="toggleRuleStatus(rule, $event)"></span>\n                                        </td>\n                                        <td ng-if="rule.isEditing && !rule.prefixError">\n                                            <awsui-textfield placeholder="{{ \'replication.placeholder.prefix\' | translate }}" ng-model="rule.prefix" ng-change="resetError()" ng-click="$event.stopPropagation()"></awsui-textfield>\n                                        </td>\n                                        <td ng-if="rule.isEditing && rule.prefixError">\n                                            <awsui-textfield class="verification-error-v1" placeholder="{{ \'replication.placeholder.prefix\' | translate }}" ng-change="resetError()" ng-model="rule.prefix" ng-click="$event.stopPropagation()"></awsui-textfield>\n                                        </td>\n                                        <td ng-if="rule.isEditing && !rule.storageError">\n                                            <awsui-select ng-change="resetError()" placeholder="{{ \'replication.placeholder.storageclass\' | translate }}" ng-click="$event.stopPropagation()" ng-model="rule.storageClass" items="storageClasses"></awsui-select>\n                                        </td>\n                                        <td ng-if="rule.isEditing && rule.storageError">\n                                            <awsui-select ng-change="resetError()" class="verification-error-v1" placeholder="{{ \'replication.placeholder.storageclass\' | translate }}" ng-click="$event.stopPropagation()" ng-model="rule.storageClass" items="storageClasses"></awsui-select>\n                                        </td>\n                                        <td ng-if="!rule.isEditing">\n                                            {{ rule.prefix }}\n                                        </td>\n                                        <td ng-if="!rule.isEditing">\n                                            {{ storageClassesMap[rule.storageClass] }}\n                                        </td>\n                                        <td>\n                                            <awsui-button icon="times-circle" variant="standalone-icon" ng-click="removeRule(rule, $event, true)"></awsui-button>\n                                        </td>\n                                    </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </awsui-expandable-section>\n                        <div class="section-header">\n                            <div></div>\n                        </div>\n                        <awsui-control-group ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED" label="{{ \'replication.label.selectrole\' | translate }}" class="crr-listrole">\n                            <awsui-select placeholder="{{ \'replication.placeholder.selectrole\' | translate }}" ng-model="replicationObj.role" items="iamRoles"></awsui-select>\n                        </awsui-control-group>\n                        <awsui-alert class="crr-listrole-error" header="Error" dismissible="false" type="error" ng-if="displayListRoleError()">{{listRoleError}}</awsui-alert>\n                    </div>\n                </div>\n            </awsui-radio-group>\n        </div>\n        <div class="awsui-row card-content-row">\n            <awsui-radio-group ng-if="cardOpen" ng-model="replicationObj.isEnabled">\n                <awsui-radio-button value="Disabled" label="{{ \'replication.label.disable\' | translate }}"></awsui-radio-button>\n                <div class="disabled-replication-content">\n                    <div>\n                        <awsui-button ng-if="cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.DISABLED && !forCreateBucketModal" text="{{ \'replication.label.delete\' | translate }}" click="deletePressed()" variant="danger" disabled="!replicationObj.configExists" loading="deleting">\n                        </awsui-button>\n                    </div>\n                </div>\n            </awsui-radio-group>\n        </div>\n        <a class="learn-more-card-closed-link" ng-if="!cardOpen" target="_blank" href="{{docLink}}" translate="">learn.more</a>\n        <awsui-alert class="warning-box" ng-if="errorMessage &&  cardOpen && replicationObj.isEnabled === S3Constants.REPLICATION.ENABLED" type="error">{{ errorMessage }}</awsui-alert>\n    </card-content>\n    <card-footer>\n        <div class="bucket-properties-buttons" ng-if="cardOpen">\n            <awsui-button ng-if="cardOpen" text="{{ \'replication.label.cancel\' | translate }}" ng-click="cancelPressed($event)">\n            </awsui-button>\n            <awsui-button ng-if="cardOpen" text="{{ \'replication.label.save\' | translate }}" ng-click="savePressed($event)" variant="primary" loading="cardState.isSaving" data-disabled="isDisable()">\n            </awsui-button>\n        </div>\n    </card-footer>\n</card>');a.put("/s3/partials/search.html",'<div class="object-search">\n    <div>\n        <div ng-repeat="prefixFilter in filters.prefixFilters track by $index" class="search-filter">\n            <span class="filter-identifier" translate="prefixsearch.identifier"></span>\n            <span class="filter-value">{{prefixFilter}}</span>\n            <span class="search-filter-cancel-button blue-cancel-icon" ng-click="removePrefixFilter(prefixFilter)"></span>\n        </div>\n        <div ng-repeat="tagFilter in filters.tagFilters track by $index" class="search-filter" ng-if="objectTaggingEnabled">\n            <span class="filter-identifier" translate="tagsearch.identifier"></span>\n            <span class="filter-value">{{tagFilter.tagKey}} | {{tagFilter.tagVal}}</span>\n            <span class="search-filter-cancel-button blue-cancel-icon" ng-click="removeTagFilter(tagFilter)"></span>\n        </div>\n    </div>\n        <div clickoutside="" on-click-outside="closeDropdown">\n        <div id="search-box" class="search-box">\n            <span class="search-icon" ng-if="!noBackendCalls"><i class="awsui-icon search"></i></span>\n            <span>\n                <span ng-show="shouldShowTag()" class="show-tag" translate="tagsearch.tag"></span>\n                <input type="text" class="input-field" ng-trim="false" ng-model="filters.input" ng-keydown="filterKeyDown($event)" ng-focus="openDropdown()" placeholder="{{getInputPlaceholder()}}" focus-when="prefixSearchInput">\n                \n            </span>\n        </div>\n        <div ng-show="dropdownOpen" id="search-dropdown">\n            <div ng-show="isSearchEmpty()" class="search-instruction" ng-class="{\'filter-instruction\':noBackendCalls}">\n                {{inputDropdownText}}\n            </div>\n            <div ng-show="!isSearchEmpty() && shouldShowTag()" ng-click="tagSearch(true)" class="search-instruction" translate="tagsearch.entervalue" ng-if="objectTaggingEnabled">\n            </div>\n            <div ng-show="!isSearchEmpty() && !shouldShowTag()">\n                <div class="search-option" ng-class="{\'search-option-selected\' : !tagSearchSelected}" ng-click="prefixSearch()" ng-mouseenter="highlightRow(false)" translate="{{tagSearchSelected ? \'prefixsearch.not.enter\' : \'prefixsearch.enter\'}}" translate-values="{ filterInput : filters.input }">\n                </div>\n                <div class="search-option" ng-class="{\'search-option-selected\' : tagSearchSelected}" ng-click="selectTag()" ng-mouseenter="highlightRow(true)" translate="{{tagSearchSelected ? \'tagsearch.enter\' : \'tagsearch.not.enter\'}}" translate-values="{ filterInput : filters.input }" ng-if="objectTaggingEnabled">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="search-prefix-info" ng-if="prefixInfo" translate="" translate-values="{ bucket1 : bucketName + \'/\' + prefixInfo, bucket2: bucketName + prefixInfo }">prefixsearch.validation.slash.start.warning\n    </div>\n    <awsui-control-group validation-message="{{searchError}}" id="search-validation"></awsui-control-group>\n</div>');a.put("/s3/partials/storageConsoleLineChartAnalytics.html",'<div class="line-chart-container">\n  <div class="analytics-line-chart-heading">{{ heading }}</div>\n  <div id="{{ chartid }}" class="chartgraph"></div>\n</div>');a.put("/s3/partials/storageConsoleLineChartS3.html",'<div class="line-chart-container">\n  <div class="metrics-line-chart-heading">{{ heading }}</div>\n  <div id="{{ chartid }}" class="chartgraph"></div>\n</div>');a.put("/s3/partials/storagemanagement.html",'<div>\n    <awsui-button-group class="si-category-buttons">\n        <awsui-tooltip text="{{\'management.view.tooltip.lifecycle\'|translate}}" position="top">\n            <awsui-button id="lifecycle-tab" class="si-action-button" text="{{ \'management.view.lifecycle\' | translate }}" ng-click="showView(S3Constants.MANAGEMENT.VIEWS.LIFECYCLE)" variant="{{ viewId === S3Constants.MANAGEMENT.VIEWS.LIFECYCLE ? \'primary\' : \'\' }}">\n            </awsui-button>\n        </awsui-tooltip>\n        <awsui-tooltip ng-if="displayCRRV2" text="{{\'management.view.tooltip.replication\'|translate}}" position="top">\n            <awsui-button id="replication-tab" class="si-action-button" text="{{ \'management.view.replication\' | translate }}" ng-click="showView(S3Constants.MANAGEMENT.VIEWS.REPLICATION)" variant="{{ viewId === S3Constants.MANAGEMENT.VIEWS.REPLICATION ? \'primary\' : \'\' }}">\n            </awsui-button>\n        </awsui-tooltip>\n        <awsui-tooltip text="{{\'management.view.tooltip.analytics\'|translate}}" position="top">\n            <awsui-button id="analytics-tab" class="si-action-button" text="{{ \'management.view.analytics\' | translate }}" ng-click="showView(S3Constants.MANAGEMENT.VIEWS.ANALYTICS)" variant="{{ viewId === S3Constants.MANAGEMENT.VIEWS.ANALYTICS ? \'primary\' : \'\' }}" fac-id="s3-an"></awsui-button>\n        </awsui-tooltip>\n        <awsui-tooltip text="{{\'management.view.tooltip.metrics\'|translate}}" position="top">\n            <awsui-button id="cloudwatch-tab" class="si-action-button" text="{{ \'management.view.metrics\' | translate }}" variant="{{ viewId === S3Constants.MANAGEMENT.VIEWS.CLOUDWATCH ? \'primary\' : \'\' }}" ng-click="showView(S3Constants.MANAGEMENT.VIEWS.CLOUDWATCH)" fac-id="s3-me"></awsui-button>\n        </awsui-tooltip>\n        <awsui-tooltip text="{{\'management.view.tooltip.inventory\'|translate}}" position="top">\n            <awsui-button id="inventory-tab" class="si-action-button" text="{{ \'management.view.inventory\' | translate }}" variant="{{ viewId === S3Constants.MANAGEMENT.VIEWS.INVENTORY ? \'primary\' : \'\' }}" ng-click="showView(S3Constants.MANAGEMENT.VIEWS.INVENTORY)" fac-id="s3-oi"></awsui-button>\n        </awsui-tooltip>\n    </awsui-button-group>\n\n    <bucket-lifecycle ng-if="viewEnabled(S3Constants.MANAGEMENT.VIEWS.LIFECYCLE)"></bucket-lifecycle>\n    <bucket-replication ng-if="viewEnabled(S3Constants.MANAGEMENT.VIEWS.REPLICATION) && displayCRRV2"></bucket-replication>\n    <analytics ng-if="viewEnabled(S3Constants.MANAGEMENT.VIEWS.ANALYTICS)"></analytics>\n    <cloudwatch-metrics ng-if="viewEnabled(S3Constants.MANAGEMENT.VIEWS.CLOUDWATCH)"></cloudwatch-metrics>\n    <bucket-reports ng-if="viewEnabled(S3Constants.MANAGEMENT.VIEWS.INVENTORY)"></bucket-reports>\n\n</div>');a.put("/s3/partials/storagemetrics.html",'<div>\n    <div class="clearfix"></div>\n    <div class="metrics-table">\n        <table>\n            <tr ng-repeat="metric in metricList">\n                <td>\n                    <div class="storage-management-error-box">\n                        <awsui-alert type="error" header="{{\'error.header\'|translate}}" visible="metric.error">\n                            {{metric.error}}\n                        </awsui-alert>\n                    </div>\n                    <div ng-if="metric.statistics.Datapoints">\n                        <div class="cloudwatch-link">\n                            <awsui-button target="_blank" href="{{deepLinks[$index]}}" variant="link" icon="external-link" ng-click="cloudwatchLinkClicked()">\n                                <span translate="">management.metrics.cloudwatch</span>\n                            </awsui-button>\n                        </div>\n                        <div class="svg-chart-container">\n                            <storage-console-line-chart chartid="metric.chartId" data="metric.statistics.Datapoints" heading="metric.heading" isxdate="true" xid="timestamp" xscaleby="1000" yid="metric.statistic" xmin="metric.startTime" xmax="metric.endTime" totalwidth="940" totalheight="400" template-url="partials/storageConsoleLineChartS3.html">\n                            </storage-console-line-chart>\n                        </div>\n                        <div class="dimensions">\n                            <div class="square"></div>\n                            <span class="dimension-labels" ng-repeat="label in getChartLabels(metric)">{{ label }}</span>\n                            <div class="dimension-labels-stat">\n                                <span>\n                                    (<span translate="management.metric.statistic.{{metric.statistic.toLowerCase()}}"></span>)\n                                </span>\n                            </div>\n                        </div>\n                        <hr class="hr-props">\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>');a.put("/s3/partials/targetmbox.html",'\n<div ng-if="mBoxContent.length === 0">\n  <div class="js-mbox" data-mbox="en_s3_ed_1">\n    <div>{{ \'notification.text\' | translate }}</div>\n  </div>\n</div>\n\n<div ng-if="mBoxContent.length > 0">\n  <div class="js-mbox" data-mbox="en_s3_ed_1" ng-bind-html="mBoxContent | trusted" ng-style="{\'visibility\': \'visible\'}"></div>\n</div>\n \n<div ng-if="showDefault" class="mbox-default">\n  <div>{{ \'notification.text\' | translate }}</div>\n</div>');a.put("/s3/partials/updateobject.html",'<awsui-textfield class="input-text new-folder-input" ng-model="updateObject.name" ng-keypress="triggerKeyboardEvt($event)" value="{{defaultValue}}" placeholder="{{defaultPlaceholder}}" ng-click="$event.stopPropagation();" ng-dblclick="$event.stopPropagation();" auto-focus="true">\n</awsui-textfield>\n<awsui-alert class="input-error" type="error" header="{{ \'error.header\' | translate}}" ng-show="updateObject.errorMessage">{{updateObject.errorMessage}}</awsui-alert>\n<div class="create-folder-btn">\n    <awsui-button text="{{ \'updateobject.button.save\' | translate}}" ng-click="triggerAction($event)" ng-dblclick="$event.stopPropagation();" data-disabled="updateObject.name.length === 0"></awsui-button>\n    <awsui-button text="{{ \'updateobject.button.cancel\' | translate}}" ng-dblclick="$event.stopPropagation();" ng-click="resetOperationState($event, true)"></awsui-button>\n</div>');a.put("/s3/partials/upload.html",'<modal is-open="modalOpen" close-callback="closeModal" id="uploadModal" current-path="currentPath" steps="STEP" state="state" header-title="headerTitle" next-state="nextState" previous-state="previousState" set-state="setState" class="upload-modal">\n    <modal-content>\n        <div class="upload-modal-selected-files-properties" ng-show="haveSelectedItems() && state !== STEP.REVIEW">\n            <div class="upload-modal-selected-files-properties-inner-div truncate">\n                <span class="upload-modal-selected-files-properties-span">\n                    {{ getSelectedFilesData().files }} <span translate="uploadmodal.label.files"></span>\n                </span>\n                <span class="upload-modal-selected-files-properties-span">\n                    <span class="upload-modal-selected-files-properties-span-header" translate="uploadmodal.label.size"></span> {{ getSelectedFilesData().size | humanReadableBytes }}\n                </span>\n                <span class="upload-modal-selected-files-properties-span">\n                    <span class="upload-modal-selected-files-properties-span-header" translate="uploadmodal.label.path"></span> {{ currentPath }}\n                </span>\n            </div>\n        </div>\n        <div class="upload-modal-content">\n            <div ng-if="state === STEP.SELECT_FILES">\n                <div id="upload-modal-initial-select" ng-show="!haveSelectedItems()">\n                    <div class="file-and-folder drag-and-drop-image"></div>\n                    <div ng-if="isDragAndDropAvailable()" class="drag-and-drop-text" translate="uploadmodal.label.draganddrop"></div>\n                    <div ng-if="!isDragAndDropAvailable()" class="drag-and-drop-no-text"></div>\n                    <input type="file" id="uploadInput" name="uploadInput" fileread="" multiple="multiple">\n                    <label id="uploadInputNoFilesSelected" for="uploadInput">{{ \'uploadmodal.label.add.files\' | translate }}</label>\n                </div>\n\n                <label ng-if="!haveSelectedItems() && !isDragAndDropAvailable()" class="drag-and-drop-info" translate="uploadmodal.label.draganddropinfo"></label>\n                <awsui-alert type="error" header="Error" ng-show="errorMessage">\n                    {{ errorMessage }}\n                </awsui-alert>\n\n                <file-list-in-modal remove-item-from-upload="removeItemFromUpload(item)" close-icon-show="true" for-uploads="true" selected="selected"></file-list-in-modal>\n            </div>\n\n            \n            <div ng-if="state === STEP.PERMISSIONS" class="upload-modal-permissions-content">\n                <modal-permissions public-permissions="options.permissions.publicPermissions" user-permissions="options.permissions.userPermissions" modal-type="MODAL_TYPE.UPLOAD"></modal-permissions>\n            </div>\n            \n            <div ng-if="state === STEP.PROPERTIES" class="upload-modal-property-content">\n                <div class="upload-modal-properties-group">\n                    <div>\n                        <h2 class="upload-modal-properties-group-header" translate="uploadmodal.label.storage-class"></h2>\n                    </div>\n                    <h2 class="upload-modal-properties-group-desc" translate="uploadmodal.properties.storage.description"></h2>\n                    <awsui-radio-group ng-model="options.storageClass" ng-init="setStorageClassOption()">\n                        <table class="upload-modal-radio-button-properties">\n                            <tr>\n                                <td>\n                                    <awsui-radio-button class="radio-button" value="STANDARD">{{ \'uploadmodal.label.standard\' | translate }}</awsui-radio-button>\n                                </td>\n                                <td>\n                                    <awsui-radio-button class="radio-button" value="STANDARD_IA">{{ \'uploadmodal.label.standard_ia\' | translate }}</awsui-radio-button>\n                                </td>\n                                <td fac-id="s3-rrs">\n                                    <awsui-radio-button class="radio-button" value="REDUCED_REDUNDANCY">{{ \'uploadmodal.label.reduced_redundancy\' | translate }}</awsui-radio-button>\n                                </td>\n                            </tr>\n                        </table>\n                    </awsui-radio-group>\n\n                </div>\n\n                <div class="upload-modal-properties-group">\n                    <div>\n                        <h2 class="upload-modal-properties-group-header" translate="uploadmodal.label.encryption"></h2>\n                    </div>\n                    <h2 class="upload-modal-properties-group-desc" translate="uploadmodal.properties.encryption.description"></h2>\n                        <awsui-radio-group ng-model="options.serverSideEncryption" ng-init="setEncryptionOption()" ng-change="updateKMSKey(options.serverSideEncryption)">\n                        <table class="upload-modal-radio-button-properties">\n                            <tr>\n                                <td fac-id="s3-no-enc">\n                                    <awsui-radio-button class="radio-button" value="{{S3Constants.OBJECT_SSE.NONE}}">{{ \'uploadmodal.label.none\' | translate }}</awsui-radio-button>\n                                </td>\n                                <td>\n                                    <awsui-radio-button class="radio-button" value="{{S3Constants.OBJECT_SSE.AES256}}">{{ \'uploadmodal.label.AES256\' | translate }}</awsui-radio-button>\n                                </td>\n                                <td fac-id="s3-kms">\n                                    <awsui-radio-button class="radio-button" value="{{S3Constants.OBJECT_SSE.KMS_ENCRYPTION}}">{{ \'uploadmodal.label.kms\' | translate }}</awsui-radio-button>\n                                </td>\n                            </tr>\n                        </table>\n                    </awsui-radio-group>\n                    <awsui-control-group validation-message="{{ KMSServiceError }}">\n                        <awsui-select ng-if="options.serverSideEncryption===S3Constants.OBJECT_SSE.KMS_ENCRYPTION" items="kmsKeys" placeholder="{{ \'uploadmodal.placeholder.kmskeys\' | translate }}" data-disabled="KMSServiceError" ng-model="options.kmsId" class="upload-modal-properties-kms-dropdown">\n                        </awsui-select>\n                    </awsui-control-group>\n                    <awsui-textfield class="upload-modal-kms-textfield" ng-if="options.kmsId===\'CUSTOM_ARN\'" ng-model="options.kmsARN"></awsui-textfield>\n                </div>\n\n                <div class="upload-modal-properties-group">\n                    <div>\n                        <h2 class="upload-modal-properties-group-header" translate="uploadmodal.label.metadata"></h2>\n                    </div>\n                    <h2 class="upload-modal-properties-group-desc" translate="uploadmodal.properties.metadata.description"></h2>\n                    <table class="upload-modal-metadata-properties">\n                        <thead>\n                        <th translate="uploadmodal.metadata.label.header"></th>\n                        <th translate="uploadmodal.metadata.label.value"></th>\n                        <th></th>\n                        </thead>\n\n                        <tbody>\n\n                        <tr ng-repeat="(key, value) in options.metadata">\n                            <td> {{ key }}</td>\n                            <td> {{ value }}</td>\n                            <td>\n                                <awsui-button variant="standalone-icon" icon="times" ng-click="deleteMetadataHeader(key)"></awsui-button>\n                            </td>\n                        </tr>\n                        <tr class="upload-modal-metadata-properties-textfield">\n                            <td>\n                                <awsui-select items="metadataHeaders.headers" placeholder="{{ \'uploadmodal.metadata.placehoder.selectheader\' | translate }}" ng-model="metadataHeaders.selectedHeader" ng-change="metaErrorReset()"></awsui-select>\n                            </td>\n                            <td>\n                                <awsui-textfield ng-model="metadataHeaders.selectedValue" ng-change="metaErrorReset()" placeholder="{{ \'uploadmodal.metadata.placehoder.headervalue\' | translate }}"></awsui-textfield>\n                            </td>\n                            <td>\n                                <awsui-button text="{{ \'uploadmodal.metadata.savebutton\' | translate }}" variant="normal" ng-click="addMetadataOptionsHeader(metadataHeaders.selectedHeader, metadataHeaders.selectedValue)" data-disabled="!metadataHeaders.selectedHeader || !metadataHeaders.selectedValue">\n                                </awsui-button>\n                            </td>\n                        </tr>\n\n                        <tr class="upload-modal-metadata-properties-textfield">\n                            <td>\n                                <awsui-textfield ng-model="metadataHeaders.customHeader" ng-init="metadataHeaders.customHeader =\'x-amz-meta-\'" ng-change="metaErrorReset()" placeholder="{{ \'uploadmodal.metadata.customheader\' | translate }}"></awsui-textfield>\n                            </td>\n                            <td>\n                                <awsui-textfield ng-model="metadataHeaders.customValue" ng-change="metaErrorReset()" placeholder="{{ \'uploadmodal.metadata.placehoder.headervalue\' | translate }}"></awsui-textfield>\n                            </td>\n                            <td>\n                                <awsui-button text="{{ \'uploadmodal.metadata.savebutton\' | translate }}" variant="normal" ng-click="addMetadataOptionsHeader(metadataHeaders.customHeader, metadataHeaders.customValue, true)" data-disabled="!metadataHeaders.customHeader || !metadataHeaders.customValue">\n                                </awsui-button>\n                            </td>\n                        </tr>\n                        <tr>\n                            <awsui-alert class="input-error" type="error" header="{{ \'error.header\' | translate }}" ng-if="metadataErrorMsg"> {{metadataErrorMsg}}\n                            </awsui-alert>\n                        </tr>\n\n\n                        </tbody>\n                    </table>\n                </div>\n                <div class="upload-modal-properties-group" fac-id="s3-ot-up">\n                    <h2 class="upload-modal-properties-group-header" translate="uploadmodal.label.tags"></h2>\n                    <h2 class="upload-modal-properties-group-desc" translate="uploadmodal.tags.description"></h2>\n                    <table class="upload-modal-metadata-properties">\n                        <thead>\n                        <th translate="uploadmodal.tags.label.header"></th>\n                        <th translate="uploadmodal.tags.label.value"></th>\n                        <th></th>\n                        </thead>\n\n                        <tbody>\n                        <tr ng-repeat="(key, value) in options.tags">\n                            <td> {{ key }}</td>\n                            <td> {{ value }}</td>\n                            <td>\n                                <awsui-button variant="standalone-icon" icon="times" ng-click="deleteTag(key)"></awsui-button>\n                            </td>\n                        </tr>\n                        <tr class="upload-modal-metadata-properties-textfield">\n                            <td>\n                                <awsui-control-group class="uploadmodal-tagerror" validation-message="{{ taggingError }}">\n                                    <awsui-textfield ng-model="currentTagging.key" placeholder="{{ \'uploadmodal.tags.placehoder.key\' | translate }}" ng-change="updateTaggingError(currentTagging.key)">\n                                    </awsui-textfield>\n                                </awsui-control-group>\n                            </td>\n                            <td class="tagvalue">\n                                <awsui-textfield ng-model="currentTagging.value" placeholder="{{ \'uploadmodal.tags.placehoder.value\' | translate }}">\n                                </awsui-textfield>\n                            </td>\n                            <td class="tagvalue">\n                                <awsui-button text="{{ \'uploadmodal.metadata.savebutton\' | translate }}" variant="normal" ng-click="addTag(currentTagging.key, currentTagging.value)" data-disabled="!currentTagging.key">\n                                </awsui-button>\n                            </td>\n\n                        </tr>\n                        </tbody>\n                    </table>\n\n                </div>\n            </div>\n            \n            <div ng-if="state === STEP.REVIEW">\n                <div class="review-section">\n                    <table id="review-table" class="review-table">\n                        <tr>\n                            <td class="review-subheader" translate="uploadmodal.label.files"></td>\n                            <td class="edit-button">\n                                <awsui-button class="button-in-darkbg" text="{{ \'uploadmodal.label.edit\' | translate }}" variant="link" ng-click="setState(STEP.SELECT_FILES)">\n                                </awsui-button>\n                            </td>\n                        </tr>\n                    </table>\n                    <table class="review-table-details">\n                        <tr class="details">\n                            <td>{{ getSelectedFilesData().files }} <span translate="uploadmodal.label.files"></span>\n                            </td>\n                            <td><span translate="uploadmodal.label.size"></span> {{ getSelectedFilesData().size |\n                                humanReadableBytes }}\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                <div class="review-section">\n                    <table class="review-table">\n                        <tr>\n                            <td class="review-subheader" translate="uploadmodal.label.permissions"></td>\n                            <td class="edit-button">\n                                <awsui-button class="button-in-darkbg" text="{{ \'uploadmodal.label.edit\' | translate }}" variant="link" ng-click="setState(STEP.PERMISSIONS)">\n                                </awsui-button>\n                            </td>\n                        </tr>\n                    </table>\n                    <table class="review-table-details">\n                        <tr class="details">\n                            <td>{{ getGranteeCount() }} <span translate="uploadmodal.label.grantees"></span></td>\n                        </tr>\n                    </table>\n                </div>\n                <div class="review-section">\n                    <table class="review-table">\n                        <tr>\n                            <td class="review-subheader" translate="uploadmodal.label.properties"></td>\n                            <td class="edit-button">\n                                <awsui-button class="button-in-darkbg" text="{{ \'uploadmodal.label.edit\' | translate }}" variant="link" ng-click="setState(STEP.PROPERTIES)">\n                                </awsui-button>\n                            </td>\n                        </tr>\n                    </table>\n                    <table class="review-table-details">\n                        <tr class="detail-name">\n                            <th translate="uploadmodal.label.encryption"></th>\n                            <th translate="uploadmodal.label.storage-class"></th>\n                        </tr>\n                        <tr class="details">\n                            <td>{{ getEncryptionTranslation() }}</td>\n                            <td>{{ getStorageClassTranslation() }}</td>\n                        </tr>\n                        <tr class="detail-name">\n                            <th class="awsui-util-pt-m" translate="uploadmodal.label.metadata"></th>\n                            <th></th>\n                        </tr>\n                        <tr class="details" ng-repeat="(key, value) in options.metadata">\n                            <td>{{ key }}</td>\n                            <td>{{ value }}</td>\n                        </tr>\n                        <tr class="detail-name" fac-id="s3-ot-up">\n                            <th class="awsui-util-pt-m" translate="uploadmodal.label.tags"></th>\n                            <th></th>\n                        </tr>\n                        <tr class="details" ng-repeat="(key, value) in options.tags" fac-id="s3-ot-up">\n                            <td>{{ key }}</td>\n                            <td>{{ value }}</td>\n                        </tr>\n                    </table>\n                </div>\n                <div ng-show="completedFiles.length > 0">\n                    <h3>Uploaded File(s):</h3>\n                    <table class="table table-striped">\n                        <thead>\n                        <tr>\n                            <th>Name</th>\n                            <th>Etag</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        <tr ng-repeat="uploadResult in completedFiles">\n                            <td>{{ uploadResult.name }}</td>\n                            <td>{{ uploadResult.etag }}</td>\n                        </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <div ng-show="errorFiles.length > 0">\n                    <h3>File(s) That Had Errors:</h3>\n                    <table class="table table-striped">\n                        <thead>\n                        <tr>\n                            <th>Name</th>\n                            <th>Error</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        <tr ng-repeat="uploadResult in errorFiles">\n                            <td>{{ uploadResult.name }}</td>\n                            <td>{{ uploadResult.errorMessage }}</td>\n                        </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <awsui-alert type="error" header="Error" ng-show="errorMessage">\n                    {{ errorMessage }}\n                </awsui-alert>\n            </div>\n        </div>\n    </modal-content>\n    <modal-footer>\n        <div class="upload-modal-footer">\n            <awsui-button text="{{ \'uploadmodal.footer.upload\' | translate }}" variant="primary" ng-class="{\'awsui-util-f-l\': state !== STEP.REVIEW, \'awsui-util-f-r primary-button\': state === STEP.REVIEW}" click="uploadNow()" data-disabled="uploadDisabled">\n            </awsui-button>\n            <awsui-button id="next" ng-if="state !== STEP.REVIEW" variant="primary" text="{{ \'uploadmodal.footer.next\' | translate }}" class="awsui-util-f-r primary-button" click="goToNextState()" data-disabled="!haveSelectedItems()">\n            </awsui-button>\n            <awsui-button id="previous" text="{{ \'uploadmodal.footer.previous\' | translate }}" ng-if="state !== STEP.SELECT_FILES" class="awsui-util-f-r" click="previousState()">\n            </awsui-button>\n        </div>\n    </modal-footer>\n</modal>');a.put("/s3/partials/versionsdropdown.html",'<div class="versions-dropdown" ng-class="{\'objects-side-panel-versions\': objectsPage}" ng-if="showVersionsDropdown.show == true" clickoutside="" on-click-outside="closeDropdown">\n    <table>\n        <tr class="version-row" ng-repeat="version in versions track by version.VersionId" ng-click="switchVersion($event, version)">\n            <td class="version-file-icon"><span class="awsui-icon awsui-icon-big" ng-class="version.fileIconClass"></span></td>\n            <td class="version-date">\n                {{version.LastModified | date:\'medium\'}}\n                <span class="date-subtext" ng-if="version.IsLatest === \'true\' && version.ETag">\n                    (<span translate="versionsdropdown.label.latestVersion"></span>)\n                </span>\n                <span class="date-subtext" ng-if="!version.ETag">\n                    (<span translate="versionsdropdown.label.deleteMarker"></span>)\n                </span>\n            </td>\n            <td class="version-storage-class">{{version.StorageClass}}</td>\n            <td class="version-download-icon">\n                <span class="awsui-icon awsui-icon-big download" ng-class="{\'awsui-icon-link\':!version.downloadDisabled, \'awsui-icon-disabled\':version.downloadDisabled}" ng-click="downloadVersion($event, version)"></span>\n            </td>\n            <td class="version-delete-icon"><span class="awsui-icon awsui-icon-big trash-o" ng-class="{\'awsui-icon-link\':!version.deleteDisabled, \'awsui-icon-disabled\':version.deleteDisabled}" ng-click="deleteVersion($event, version)"></span></td>\n        </tr>\n    </table>\n</div>')}]);"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};(function(){angular.module("s3").service("BucketPolicyService",["$filter","$q","$translate","APIProxyService","BucketPropertiesService","ConsoleOperation","S3Constants","SCLogService","UtilService",a]);function a(l,t,o,p,f,k,n,b,u){var m=new k(n.OPERATION_NAME.GET_BUCKET_POLICY);var s=new k(n.OPERATION_NAME.PUT_BUCKET_POLICY);var c=new k(n.OPERATION_NAME.LAMB);var v={createBucketPolicy:d,generateBucketPolicy:i};return v;function r(w){return p.listAllMyBuckets(c,true).then(function(y){b.log(n.OPERATION_NAME.LAMB,1,c);var x=y.response.ListAllMyBucketsResult.Buckets.Bucket;return x.some(function(z){return z.Name===w})})}function i(w,x){var y=JSON.stringify(x,null,"    ");y=y.replace(/ACCOUNT_ID/g,u.getUserAccountId());y=y.replace(/DESTINATION_BUCKET/g,w);return y}function d(z,x,w){var B=u.getUserAccountId();var y=n.MANAGEMENT.POLICY.STATUS.FAILED;var A="";return r(z).then(function(C){if(C){return f.getBucketPolicy(x,m,false).then(function(E){b.log(n.OPERATION_NAME.GET_BUCKET_POLICY,1,m);var G=j(B,E,z,x);var F=e(B,z,x);if(G.deny){y=n.MANAGEMENT.POLICY.STATUS.DENY;A=l("json")(F.Statement[0],n.MANAGEMENT.POLICY.SPACING);q(y,w,A);return y}else{if(G.needsPolicy){var D=function(){if(G.warn){y=n.MANAGEMENT.POLICY.STATUS.WARN;A=l("json")(F.Statement[0],n.MANAGEMENT.POLICY.SPACING);q(y,w,A);return{v:y}}var I=false;if(E&&E.Statement){if(G.existingStatement){h(B,z,G.existingStatement);A=l("json")(G.existingStatement,n.MANAGEMENT.POLICY.SPACING)}else{E.Statement.push(F.Statement[0]);A=l("json")(F.Statement[0],n.MANAGEMENT.POLICY.SPACING)}F=E;I=true}var H=l("json")(F,n.MANAGEMENT.POLICY.SPACING);return{v:f.putBucketPolicy(x,H,s).then(function(J){b.log(n.OPERATION_NAME.PUT_BUCKET_POLICY,1,s);if(I){y=n.MANAGEMENT.POLICY.STATUS.MODIFIED;q(y,w,A)}else{y=n.MANAGEMENT.POLICY.STATUS.CREATED;q(y,w,H)}return y})["catch"](function(J){b.log(n.OPERATION_NAME.PUT_BUCKET_POLICY,0,s);q(y,w,A);return t.reject(y)})}}();if((typeof D==="undefined"?"undefined":_typeof(D))==="object"){return D.v}}else{y=n.MANAGEMENT.POLICY.STATUS.FOUND}}q(y,w);return y})["catch"](function(D){b.log(n.OPERATION_NAME.GET_BUCKET_POLICY,0,m);g(B,z,x,y,w);return y})}else{g(null,z,x,y,w);return y}})["catch"](function(){b.log(n.OPERATION_NAME.LAMB,0,c);g(null,z,x,y,w);return y})}function g(C,z,w,y,x){var B=e(C,z,w);var A=l("json")(B,n.MANAGEMENT.POLICY.SPACING);q(y,x,A)}function h(B,z,y){var x=u.getBucketARN(z);var w=u.transformObjectToArray(y.Condition.StringEquals[n.MANAGEMENT.POLICY.ACCOUNT_KEY]);if(w.indexOf(B)===-1){w.push(B);y.Condition.StringEquals[n.MANAGEMENT.POLICY.ACCOUNT_KEY]=w}var A=u.transformObjectToArray(y.Condition.ArnLike[n.MANAGEMENT.POLICY.SOURCE_ARN]);if(A.indexOf(x)===-1){A.push(x);y.Condition.ArnLike[n.MANAGEMENT.POLICY.SOURCE_ARN]=A}}function e(B,A,w){var z=u.getBucketARN(A);var y=u.getBucketARN(w);var x={Id:n.MANAGEMENT.POLICY.ID+"-"+new Date().getTime(),Version:"2012-10-17",Statement:[{Sid:n.MANAGEMENT.POLICY.SID+"-"+new Date().getTime(),Effect:"Allow",Principal:{Service:"s3.amazonaws.com"},Action:["s3:PutObject"],Resource:[],Condition:{ArnLike:{"aws:SourceArn":[]},StringEquals:{"aws:SourceAccount":[],"s3:x-amz-acl":"bucket-owner-full-control"}}}]};x.Statement[0].Resource.push(y+"/*");x.Statement[0].Condition.ArnLike["aws:SourceArn"].push(z);if(B){x.Statement[0].Condition.StringEquals["aws:SourceAccount"].push(B)}else{x.Statement[0].Condition.StringEquals["aws:SourceAccount"].push(o.instant("bucketproperties.policy.auto.create.account.replace"))}return x}function j(C,B,A,x){var w={deny:false,existingStatement:null,needsPolicy:true,warn:false};var z=u.getBucketARN(A);var y=u.getBucketARN(x);if(!C){w.needsPolicy=false;return w}if(B){_.forEach(B.Statement,function(D){if(D.Principal&&u.checkValue(D.Principal.Service,n.MANAGEMENT.POLICY.SERVICE_VAL)&&u.checkValue(D.Action,n.MANAGEMENT.POLICY.ACTION)&&u.checkValue(D.Resource,y+"/*")){if(!D.Condition){if(D.Effect==="Deny"){w.deny=true}else{w.warn=true}}else{if(D.Condition.ArnLike&&D.Condition.StringEquals&&D.Condition.ArnLike[n.MANAGEMENT.POLICY.SOURCE_ARN]&&D.Condition.StringEquals[n.MANAGEMENT.POLICY.ACCOUNT_KEY]&&u.checkValue(D.Condition.StringEquals[n.MANAGEMENT.POLICY.X_AMZ_ACL_KEY],n.MANAGEMENT.POLICY.X_AMZ_ACL_VAL)){if(!(u.checkValue(D.Condition.ArnLike[n.MANAGEMENT.POLICY.SOURCE_ARN],z)&&u.checkValue(D.Condition.StringEquals[n.MANAGEMENT.POLICY.ACCOUNT_KEY],C))){if(D.Effect==="Deny"){w.deny=true}else{if(!w.existingStatement&&D.Sid.indexOf(n.MANAGEMENT.POLICY.SID)!==-1){w.existingStatement=D}}}else{if(D.Effect==="Deny"){w.deny=true}else{if(D.Sid.indexOf(n.MANAGEMENT.POLICY.SID)!==-1){w.needsPolicy=false}else{w.warn=true}}}}}}})}return w}function q(x,w){var y=arguments.length<=2||arguments[2]===undefined?"":arguments[2];w.policyType="info";w.policyHeader=o.instant("bucketproperties.policy.auto.create.success.header");w.policyDefinition=y;switch(x){case n.MANAGEMENT.POLICY.STATUS.CREATED:w.policyMessage=o.instant("bucketproperties.policy.auto.create.success.info");break;case n.MANAGEMENT.POLICY.STATUS.MODIFIED:w.policyHeader=o.instant("bucketproperties.policy.auto.modify.success.header");w.policyMessage=o.instant("bucketproperties.policy.auto.modify.success.info");break;case n.MANAGEMENT.POLICY.STATUS.FOUND:w.policyMessage="";w.policyHeader="";break;case n.MANAGEMENT.POLICY.STATUS.FAILED:w.policyHeader=o.instant("bucketproperties.policy.auto.create.error.header");w.policyMessage=o.instant("bucketproperties.policy.account.error.message");w.policyType="warning";break;case n.MANAGEMENT.POLICY.STATUS.WARN:w.policyHeader=o.instant("bucketproperties.policy.auto.create.warn.header");w.policyMessage=o.instant("bucketproperties.policy.auto.create.warn.message");w.policyType="warning";break;case n.MANAGEMENT.POLICY.STATUS.DENY:w.policyHeader=o.instant("bucketproperties.policy.auto.create.deny.header");w.policyMessage=o.instant("bucketproperties.policy.auto.create.deny.message");w.policyType="warning"}}}})();"use strict";(function(){angular.module("s3").directive("initiateRestoreModal",function(){return{scope:{isOpen:"=",countInfo:"=?",operation:"=?"},templateUrl:"/s3/partials/initiaterestore.html",controller:"InitiateRestoreController"}});angular.module("s3").controller("InitiateRestoreController",["$scope","$rootScope","$translate","$filter","APIProxyService","PathService","OperationDispatcherService","CountService","S3Constants","SCLogService","UtilService",function(n,h,o,l,p,c,f,g,m,b,r){var d="ttlObj";var j="ttlSize";var k=1;var i=2147483647;n.headerTitle=o.instant("initiaterestoremodal.header.title");n.params={};n.numOfDaysError=[];n.showBuyConfirmation=false;n.capacityUnitsAvailable=0;n.showCapacityInfo=false;n.capacityUnits=null;n.isPurchaseSuccessful=false;n.errorMessage=null;n.expeditedRetrieval=m.INITIATE_RESTORE.EXPEDITED_RETRIEVAL;n.capacityCost=null;n.learnMoreUrl=r.getPricingUrl();n.learnMoreDataRetrievalUrl=r.getDataRetrievalUrl();n.retrievalOptions=[{value:m.INITIATE_RESTORE.BULK_RETRIEVAL,text:o.instant("initiaterestoremodal.dropdown.bulkRetrieval")},{value:m.INITIATE_RESTORE.STANDARD_RETRIEVAL,text:o.instant("initiaterestoremodal.dropdown.standardRetrieval")},{value:m.INITIATE_RESTORE.EXPEDITED_RETRIEVAL,text:o.instant("initiaterestoremodal.dropdown.ExpeditedRetrieval")}];n.titles=[{txt:o.instant("initiaterestoremodal.titles.capacityId"),info:o.instant("initiaterestoremodal.capacityid.tooltip"),pos:"right"},{txt:o.instant("initiaterestoremodal.titles.purchaseDate"),info:o.instant("initiaterestoremodal.purchaseDate.tooltip"),pos:"right"},{txt:o.instant("initiaterestoremodal.titles.expirationDate"),info:o.instant("initiaterestoremodal.expirationDate.tooltip"),pos:"left"}];var a={flag:true,folders:0,objects:0,size:0,currLevelObjs:0,countResultEachFolder:{}};n.selected={selectedItems:{currFolderPathPrefix:n.operation.initialPath,folders:n.operation.selectedFolders,objects:n.operation.selectedKeys}};if(!n.countInfo||!n.countInfo.countFinish){n.countInfo=_.cloneDeep(a);n.isCounting={flag:false};n.$watch(function(){return n.countInfo},function(u,t){if(u!==t){angular.forEach(n.selected.selectedItems.folders,function(v){var w=n.countInfo.countResultEachFolder&&n.countInfo.countResultEachFolder[v.Prefix];if(w){v.objsCount=n.countInfo.countResultEachFolder[v.Prefix].count;v.folderSize=n.countInfo.countResultEachFolder[v.Prefix].totalSize}})}},true);g.countAllFiles(n.selected.selectedItems,n.countInfo,n.operation,n.isCounting)}else{angular.forEach(n.selected.selectedItems.folders,function(t){var u=n.countInfo.countResultEachFolder&&n.countInfo.countResultEachFolder[t.Prefix];if(u){t.objsCount=n.countInfo.countResultEachFolder[t.Prefix].count;t.folderSize=n.countInfo.countResultEachFolder[t.Prefix].totalSize}})}var q=function q(){var t={};p.getBucketLocation(n.operation,c.getCurrentBucket(),t).then(function(u){n.params.region=u.region;b.log("GetBucketLocation",1,n.operation);n.capacityCost=m.INITIATE_RESTORE.EXPEDITED_RETRIEVAL_COST[u.region]})["catch"](function(u){b.log("GetBucketLocation",0,n.operation,u)})};var s=function s(){p.listProvisionedCapacity(n.operation,c.getCurrentBucket(),n.params.region).then(function(t){b.log("ListProvisionedCapacity",1,n.operation);n.capacityUnits=_.map(t,function(u){return{id:u.CapacityId,purchaseDate:l("date")(u.StartDate,"medium"),expirationDate:l("date")(u.ExpirationDate,"medium")}});n.capacityUnitsAvailable=n.capacityUnits.length})["catch"](function(t){n.retrievalError=r.handleErrors(t);b.log("ListProvisionedCapacity",0,n.operation,t)})};var e=function e(){n.isPurchasingCapacity=true;n.isPurchaseSuccessful=false;p.purchaseProvisionedCapacity(n.operation,c.getCurrentBucket(),n.params.region).then(function(t){b.log("PurchaseProvisionedCapacity",1,n.operation);n.isPurchaseSuccessful=true;n.showBuyConfirmation=false;s()})["catch"](function(t){n.retrievalError=r.handleErrors(t);b.log("PurchaseProvisionedCapacity",0,n.operation,t)})["finally"](function(){n.isPurchasingCapacity=false})};n.$watch("params.retrievalOption",function(t){n.retrievalError=null;if(t&&t.value===m.INITIATE_RESTORE.EXPEDITED_RETRIEVAL){n.showCapacityInfo=true;s()}else{n.showCapacityInfo=false}});n.validateNumOfDays=function(){if(isNaN(n.params.numOfDays)||parseInt(n.params.numOfDays)<k){n.numOfDaysError=[o.instant("initiaterestoremodal.invalidwarning")]}else{if(n.params.numOfDays>i){n.numOfDaysError=[o.instant("initiaterestoremodal.highernumbererror")]}else{n.numOfDaysError=[]}}};n.addCapacity=function(){n.showBuyConfirmation=true;n.isPurchaseSuccessful=false};n.buyCapacity=function(){e()};n.closeModal=function(){n.isOpen.flag=false;n.selected={selectedItems:{currFolderPathPrefix:"",folders:[],objects:[]}};n.countInfo=_.cloneDeep(a);n.countInfo.flag=false;n.operation=null;n.retrievalError=null};n.restore=function(){if(!n.params.numOfDays){n.numOfDaysError=[o.instant("initiaterestoremodal.emptywarning")]}else{if(!n.params.retrievalOption){n.retrievalError=o.instant("initiaterestoremodal.dropboxselectwarning")}else{n.operation.additionalInfo={expirationDays:n.params.numOfDays,numberOfKeysPerBulkOperation:m.BULK_OPERATION_KEYS_PER_REQUEST.CWS_API,tier:n.params.retrievalOption.value};n.operation.totalObjectCount=n.countInfo.objects;b.log(n.operation.name.replace(/\s/g,"")+d,n.operation.totalObjectCount,n.operation);b.log(n.operation.name.replace(/\s/g,"")+j,n.countInfo.size,n.operation);f.addOperation(n.operation);n.closeModal()}}};q()}])})();"use strict";(function(){angular.module("s3").directive("bucketRequesterPays",[function(){return{restrict:"E",scope:{cardOpen:"=",id:"@?"},templateUrl:"/s3/partials/bucketrequesterpays.html",controller:"BucketRequesterPaysController"}}]);angular.module("s3").controller("BucketRequesterPaysController",["$scope","$translate","AwsUrlsService","BucketPropertiesService","ConsoleOperation","PathService","S3Constants","UtilService",a]);function a(k,b,c,d,g,i,e,j){k.docLink=c.getDocUrl(e.LEARN_MORE_LINKS.REQUESTER_PAYS);k.requesterPaysStates={enabled:"Requester",disabled:"BucketOwner"};k.error=null;k.requesterPays={};k.requesterPays.selectedValue=k.requesterPaysStates.disabled;k.scrollCardId="#"+k.id;k.cardSummaryObj=_.cloneDeep(e.CARD_SUMMARY_INIT);k.cardSummaryObj.activeSummary.text=b.instant("bucketproperties.requesterpays.cardsummary.enabled");k.cardSummaryObj.inactiveSummary.text=b.instant("bucketproperties.requesterpays.cardsummary.disabled");function l(){k.cardSummaryObj.isActive=k.requesterPays.selectedValue===k.requesterPaysStates.enabled}l();function h(){var m=i.getCurrentBucket();k.cardSummaryObj.isLoading=true;k.error=null;d.isRequesterPaysEnabled(m).then(function(n){k.requesterPays.selectedValue=n===true?k.requesterPaysStates.enabled:k.requesterPaysStates.disabled})["catch"](function(n){k.requesterPays.selectedValue=null;k.error=j.handleErrors(n)})["finally"](function(){k.cachedRequesterPays=angular.copy(k.requesterPays);l();k.cardSummaryObj.isLoading=false})}k.cancelBucketRequesterPays=function(m){j.analyticsTrackClick(e.ANALYTICS.CANCEL_REQUESTER_PAYS,e.ANALYTICS.DETAILS);m.stopPropagation();k.requesterPays=angular.copy(k.cachedRequesterPays);l();k.error=null;k.cardOpen=false};k.saveBucketRequesterPays=function(o){j.analyticsTrackClick(e.ANALYTICS.SAVE_REQUESTER_PAYS,e.ANALYTICS.DETAILS);o.stopPropagation();k.error=null;k.saving=true;var n=undefined;var m=null;var p=i.getCurrentBucket();if(k.requesterPays.selectedValue===k.requesterPaysStates.enabled){n=d.enableBucketRequestPayment;m=new g("enableBucketVersioning")}else{n=d.disableBucketRequestPayment;m=new g("disableBucketVersioning")}n(p,m).then(function(){k.cachedRequesterPays.selectedValue=angular.copy(k.requesterPays.selectedValue);k.cardOpen=false;k.error=null;l()})["catch"](function(q){k.error=q})["finally"](function(){k.saving=false;l()})};function f(){h()}f()}})();"use strict";(function(){angular.module("s3").constant("QuicksightConstants",{PARAM:{PARTNER_TYPE:"partner_type=",ACCOUNT_ID:"account_id=",USER_ID:"user_id=",BUCKET_NAME:"bucket_name=",CONFIG_TYPE:"config_type=",FILTER_ID:"filter_id=",FILE_PATH:"file_path=",PREFIX:"prefix=",TAG:"tag="},PARTNER_TYPE_VALUES:{S3_ANALYTICS:"s3_analytics"},CONFIG_TYPES:{STORAGE_CLASS_ANALYSIS:"Storage class analysis"},SN_INTEGRATION:"sn/partner-analytics",S3_PREFIX:"s3://"})})();"use strict";(function(){angular.module("s3").service("QuicksightService",["AnalyticsDataProcessor","AwsUrlsService","QuicksightConstants","UtilService",a]);function a(g,b,h,i){var d="Prefix",e="Tag";var f={generateQuicksightLink:c};return f;function c(o,k,t){var v=null;var n=h.SN_INTEGRATION;var u=h.PARTNER_TYPE_VALUES.S3_ANALYTICS;var s=i.getUserAccountId();var p=i.getUserNameARN();var r=h.CONFIG_TYPES.STORAGE_CLASS_ANALYSIS;var l=g.getSharedDataFilePath(o,k.Id,t);var q=j(k.Filter);if(l){var m=[];m.push(n+"?"+h.PARAM.PARTNER_TYPE+encodeURIComponent(u),""+h.PARAM.ACCOUNT_ID+encodeURIComponent(s),""+h.PARAM.USER_ID+encodeURIComponent(p),""+h.PARAM.BUCKET_NAME+encodeURIComponent(o),""+h.PARAM.CONFIG_TYPE+encodeURIComponent(r),""+h.PARAM.FILTER_ID+encodeURIComponent(k.Id),""+h.PARAM.FILE_PATH+encodeURIComponent(h.S3_PREFIX+l.full));if(q.prefixes){m.push("prefix="+q.prefixes)}if(q.tagKeys){m.push("tagKeys="+q.tagKeys)}if(q.tagVals){m.push("tagVals="+q.tagVals)}v=b.getQuicksightUrl(m.join("&"))}return v}function j(l){var k={};var n=[];var m=[];var o=[];if(l){if(!l.And){if(l.Prefix){n.push(l.Prefix)}else{if(l.Tag){m.push(l.Tag.Key);o.push(l.Tag.Value)}}}else{angular.forEach(l.And,function(q,p){if(p===d){n.push(q)}if(p===e){q=[].concat(q);angular.forEach(q,function(s,r){m.push(s.Key);o.push(s.Value)})}})}if(n.length>0){k.prefixes=encodeURIComponent(n.join())}if(m.length>0){k.tagKeys=encodeURIComponent(m.join());k.tagVals=encodeURIComponent(o.join())}}return k}}})();"use strict";function _defineProperty(c,a,b){if(a in c){Object.defineProperty(c,a,{value:b,enumerable:true,configurable:true,writable:true})}else{c[a]=b}return c}(function(){angular.module("s3").directive("bucketReplication",[function(){return{restrict:"E",scope:{},templateUrl:"/s3/partials/bucket-replication/bucketreplication.html",controller:"BucketReplicationController"}}]);angular.module("s3").controller("BucketReplicationController",["$scope","$translate","BucketPropertiesService","ConsoleOperation","FAC","PathService","ReplicationUtilService","Region","ReplicationConstants","S3Constants","SCLogService","UtilService","XMLParser",a]);function a(q,s,h,l,j,d,o,e,w,p,c,x,y){var i;q.showEmptyScreen=true;q.oneIntroImage=true;q.replicationObj={globalSettings:{sourceBucket:{name:null,region:null},destinationBucket:{name:null,region:null},Role:null},ruleSettings:{}};q.isConfirmationModalOpen={flag:false};var k=new l("getBucketReplication","getBucketReplication");var n=undefined;var v=(i={},_defineProperty(i,p.STORAGE_CLASSES.STANDARD,s.instant("replication.storageclasses.standard")),_defineProperty(i,p.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS,s.instant("replication.storageclasses.standardia")),_defineProperty(i,p.STORAGE_CLASSES.REDUCED_REDUNDANCY,s.instant("replication.storageclasses.reducedredundancy")),_defineProperty(i,p.STORAGE_CLASSES.DEFAULT,s.instant("replication.storageclass.sameassource")),i);q.state={isDeleting:false,isAdding:false,isEditing:false};q.REPLICATION=w.REPLICATION;q.isLoadingReplication=true;q.selectedRule={flag:false,ruleObj:{}};q.wholeBucketOrPrefix=[{text:s.instant("crr.globalconfig.source.prefix"),value:w.REPLICATION.PREFIX},{text:s.instant("crr.globalconfig.source.entirebucket"),value:w.REPLICATION.ENTIRE_BUCKET}];q.confirmationModalObj={title:null,saveValue:null,contentText:null,isOpen:{flag:false}};q.replicationModalInfo={isOpen:{flag:false},isAdd:false,selectedRule:null,storageTextMapping:v,showChangeDestinationBtn:false,showChangeRoleBtn:false,modalError:{}};q.globalConfigInfo={flag:false,isEditing:false,prefixOrWholeBucket:{text:null,value:null},storageTextMapping:v,modalError:{},showChangeDestinationBtn:false,showChangeRoleBtn:false,ENTIRE_BUCKET:w.REPLICATION.ENTIRE_BUCKET,PREFIX:w.REPLICATION.PREFIX};q.moreOptions=[{items:[{id:w.REPLICATION.ENABLED,text:s.instant("crr.dropdown.enablerule"),action:function u(){q.updateRuleStatus(w.REPLICATION.ENABLED)},disabled:true},{id:w.REPLICATION.DISABLED,text:s.instant("crr.dropdown.disablerule"),action:function u(){q.updateRuleStatus(w.REPLICATION.DISABLED)},disabled:true}]},{items:[{id:w.REPLICATION.ENABLED_ALL,text:s.instant("crr.dropdown.enableallrules"),action:function u(){q.updateRuleStatus(w.REPLICATION.ENABLED_ALL)},disabled:false},{id:w.REPLICATION.DISABLED_ALL,text:s.instant("crr.dropdown.disableallrules"),action:function u(){q.updateRuleStatus(w.REPLICATION.DISABLED_ALL)},disabled:false}]},{items:[{id:w.REPLICATION.DELETE_ALL,text:s.instant("crr.dropdown.deleteallrules"),action:function u(){q.updateRuleStatus(w.REPLICATION.DELETE_ALL)},disabled:false}]}];b();function b(){if(!j.isFeatureEnabled(p.FAC.CRR)){return}n=d.getCurrentBucket();q.replicationObj.globalSettings.sourceBucket.name=n;h.getBucketLocation(n).then(function(z){q.replicationObj.globalSettings.sourceBucket.region=e.twoWayMapping[z]})["catch"](function(){q.replicationObj.globalSettings.sourceBucket.region=null});r(n)}function t(A){var z=_.findIndex(q.replicationObj.ruleSettings.Rule,{ID:A.ID});return o.getUpdateReplicationObj(false,q.replicationObj.globalSettings.Role,q.replicationObj.ruleSettings.Rule,q.replicationObj.ruleSettings.Rule[z],z)}function m(B,A){var C=_.findIndex(q.replicationObj.ruleSettings.Rule,{ID:B});var z=_.cloneDeep(q.replicationObj.ruleSettings.Rule[C]);z.Status=A;return o.getUpdateReplicationObj(false,q.replicationObj.globalSettings.Role,q.replicationObj.ruleSettings.Rule,z)}function f(z){var A={};A.destinationBucket=q.replicationObj.globalSettings.destinationBucket.name;A.role=q.replicationObj.globalSettings.Role.value;A.rules=_.cloneDeep(q.replicationObj.ruleSettings.Rule);_.forEach(A.rules,function(B){B.Status=z});return A}q.closeConfirmationModal=function(){g();x.bodyFreezeScroll(false)};function g(){q.confirmationModalObj.isOpen.flag=false;q.confirmationModalObj.contentText=null;q.confirmationModalObj.saveValue=null;q.confirmationModalObj.title=null;q.selectedRule.flag=false;q.selectedRule.ruleObj={}}q.updateRuleStatus=function(z){x.bodyFreezeScroll(true);switch(z){case w.REPLICATION.ENABLED:if(q.selectedRule.ruleObj){q.confirmationModalObj.title=s.instant("crr.confirmationmodal.enablerule");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.saveValue=m(q.selectedRule.ruleObj.ID,w.REPLICATION.ENABLED);q.confirmationModalObj.contentText=s.instant("crr.enablesingleruletext")}break;case w.REPLICATION.DISABLED:if(q.selectedRule.ruleObj){q.confirmationModalObj.title=s.instant("crr.confirmationmodal.disablerule");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.saveValue=m(q.selectedRule.ruleObj.ID,w.REPLICATION.DISABLED);q.confirmationModalObj.contentText=s.instant("crr.disablesingleruletext")}break;case w.REPLICATION.ENABLED_ALL:q.confirmationModalObj.title=s.instant("crr.confirmationmodal.enableallrules");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.saveValue=f(w.REPLICATION.ENABLED);q.confirmationModalObj.contentText=s.instant("crr.enableallrulestext");break;case w.REPLICATION.DISABLED_ALL:q.confirmationModalObj.title=s.instant("crr.confirmationmodal.disableallrules");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.saveValue=f(w.REPLICATION.DISABLED);q.confirmationModalObj.contentText=s.instant("crr.disableallrulestext");break;case w.REPLICATION.DELETE_ALL:q.confirmationModalObj.title=s.instant("crr.confirmationmodal.deleteallrules");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.contentText=s.instant("crr.deleteallrulestext");break;default:g()}};q.deleteRule=function(){if(q.selectedRule.ruleObj){q.confirmationModalObj.title=s.instant("crr.confirmationmodal.deleteruletitle");q.confirmationModalObj.isOpen.flag=true;q.confirmationModalObj.contentText=s.instant("crr.confirmationmodal.deleterulecontent")}};q.saveConfirmation=function(){var z=new l("putBucketReplication","putBucketReplication");var A=new l("deleteBucketReplication","deleteBucketReplication");q.isConfirming=true;if(q.confirmationModalObj.title===s.instant("crr.confirmationmodal.deleteallrules")){h.deleteBucketReplication(q.replicationObj.globalSettings.sourceBucket.name,A).then(function(){c.log("deleteBucketReplication",1,A);q.replicationObj.globalSettings.destinationBucket={name:null,region:null};q.replicationObj.ruleSettings={};q.replicationObj.globalSettings.Role=null;q.replicationObj.errorMessage=null;q.closeConfirmationModal()})["catch"](function(B){c.log("deleteBucketReplication",0,A);q.confirmationModalError=x.handleErrors(B)})["finally"](function(){q.isConfirming=false})}else{if(q.confirmationModalObj.title===s.instant("crr.confirmationmodal.deleteruletitle")){(function(){var B=t(q.selectedRule.ruleObj);if(B.rules.length<=0){h.deleteBucketReplication(q.replicationObj.globalSettings.sourceBucket.name,A).then(function(){c.log("deleteBucketReplication",1,A);q.replicationObj.globalSettings.destinationBucket={name:null,region:null};q.replicationObj.ruleSettings={};q.replicationObj.globalSettings.Role=null;q.replicationObj.errorMessage=null;q.closeConfirmationModal()})["catch"](function(C){c.log("deleteBucketReplication",0,A);q.confirmationModalError=x.handleErrors(C)})["finally"](function(){q.isConfirming=false})}else{h.putBucketReplication(q.replicationObj.globalSettings.sourceBucket.name,z,B).then(function(){c.log("putBucketReplication",1,z);o.updateReplicationTable(q.replicationObj,B,q.replicationModalInfo.storageTextMapping);q.closeConfirmationModal()})["catch"](function(C){c.log("putBucketReplication",0,z);q.confirmationModalError=x.handleErrors(C)})["finally"](function(){q.isConfirming=false})}})()}else{h.putBucketReplication(q.replicationObj.globalSettings.sourceBucket.name,z,q.confirmationModalObj.saveValue).then(function(){c.log("putBucketReplication",1,z);o.updateReplicationTable(q.replicationObj,q.confirmationModalObj.saveValue,q.replicationModalInfo.storageTextMapping);q.closeConfirmationModal()})["catch"](function(B){c.log("putBucketReplication",0,z);q.confirmationModalError=x.handleErrors(B)})["finally"](function(){q.isConfirming=false})}}};q.$watch("replicationObj.ruleSettings.Rule",function(z){if(z&&z.length>0){q.moreOptions[1].items[0].disabled=false;q.moreOptions[1].items[1].disabled=false;q.moreOptions[2].items[0].disabled=false;q.globalConfigInfo.flag=true;q.globalConfigInfo.prefixOrWholeBucket=q.replicationObj.globalSettings.isEntireBucket?{text:s.instant("crr.globalconfig.source.entirebucket"),value:q.globalConfigInfo.ENTIRE_BUCKET}:{text:s.instant("crr.globalconfig.source.prefix"),value:q.globalConfigInfo.PREFIX}}else{q.moreOptions[1].items[0].disabled=true;q.moreOptions[1].items[1].disabled=true;q.moreOptions[2].items[0].disabled=true;q.globalConfigInfo.flag=false;q.globalConfigInfo.prefixOrWholeBucket={text:null,value:null}}});q.$watch("replicationModalInfo.isEntireBucket",function(z){q.globalConfigInfo.isEntireBucket=z});q.triggerMoreDropdown=function(){if(!q.selectedRule||!q.selectedRule.flag){q.moreOptions[0].items[0].disabled=true;q.moreOptions[0].items[1].disabled=true}if(q.replicationObj&&q.replicationObj.ruleSettings&&q.replicationObj.ruleSettings.Rule){q.moreOptions[1].items[1].disabled=_.findIndex(q.replicationObj.ruleSettings.Rule,{Status:w.REPLICATION.ENABLED})===-1;q.moreOptions[1].items[0].disabled=_.findIndex(q.replicationObj.ruleSettings.Rule,{Status:w.REPLICATION.DISABLED})===-1}else{q.moreOptions[1].items[1].disabled=true;q.moreOptions[1].items[0].disabled=true}};q.selectRule=function(A){q.selectedRule.flag=true;q.selectedRule.ruleObj=A;var z=A&&A.Status===w.REPLICATION.ENABLED;q.moreOptions[0].items[0].disabled=z;q.moreOptions[0].items[1].disabled=!z;q.globalConfigInfo.isEditing=false};function r(z){h.getBucketReplication(z,k).then(function(C){var A=C.response;c.log("getBucketReplication",1,k);var B=y.convertXmlStringToJson(A).ReplicationConfiguration;q.replicationObj.globalSettings.Role=_.isEmpty(B.Role)?"":{text:_.last(B.Role.split("/")),value:B.Role};q.replicationObj.ruleSettings.Rule=[].concat(B.Rule);_.forEach(q.replicationObj.ruleSettings.Rule,function(E){var D=o.extractDestinationBucket(E.Destination.Bucket);E.Destination.Bucket={name:D,region:null};q.replicationObj.globalSettings.destinationBucket.name=D;h.getBucketRegion(D).then(function(F){E.Destination.Bucket.region=F.text;q.replicationObj.globalSettings.destinationBucket.region=F.text})["catch"](function(F){if(F.status===p.HTTP_STATUS_CODES.NOT_FOUND){q.replicationObj.errorMessage=s.instant("crr.error.destinationbucketdoesnotexist")}else{q.replicationObj.errorMessage=x.handleErrors(F)}});E.Destination.changeDefaultStorageClass=!_.isEmpty(E.Destination.StorageClass);E.Destination.StorageClass={value:E.Destination.StorageClass,text:!_.isEmpty(E.Destination.StorageClass)?v[E.Destination.StorageClass]:v[p.STORAGE_CLASSES.DEFAULT]};E.Prefix=_.isEmpty(E.Prefix)?"":E.Prefix;E.isEntireBucket=_.isEmpty(E.Prefix).toString();q.globalConfigInfo.prefixOrWholeBucket=E.isEntireBucket==="true"?{text:s.instant("crr.globalconfig.source.entirebucket"),value:q.globalConfigInfo.ENTIRE_BUCKET}:{text:s.instant("crr.globalconfig.source.prefix"),value:q.globalConfigInfo.PREFIX}});q.globalConfigInfo.flag=q.replicationObj.ruleSettings.Rule&&q.replicationObj.ruleSettings.Rule.length>0;q.globalConfigInfo.isEntireBucket=_.findIndex(q.replicationObj.ruleSettings.Rule,function(D){return _.isEmpty(D.Prefix)})>-1;q.replicationObj.globalSettings.isEntireBucket=q.globalConfigInfo.isEntireBucket})["catch"](function(A){if(A!==w.REPLICATION.CONFIGNOTFOUND){c.log("getBucketReplication",0,k);q.replicationObj.errorMessage=x.handleErrors(A)}else{c.log("getBucketReplication",1,k)}})["finally"](function(){q.isLoadingReplication=false})}q.checkPrefix=function(){return _.findIndex(q.replicationObj.ruleSettings.Rule,{isEntireBucket:"true"})>-1};q.showReplicationModal=function(){var B=arguments.length<=0||arguments[0]===undefined?true:arguments[0];var z=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var A=arguments.length<=2||arguments[2]===undefined?true:arguments[2];if(!z){q.globalConfigInfo.isEditing=false;x.bodyFreezeScroll(true);if(B||A){q.replicationModalInfo.isOpen={flag:true};q.replicationModalInfo.isAdd=true}else{q.replicationModalInfo.isOpen={flag:true};q.replicationModalInfo.isAdd=false}}}}})();"use strict";(function(){angular.module("s3").directive("replicationModal",[function(){return{restrict:"E",scope:{modalInfo:"=",replicationObj:"=",selectedRule:"="},templateUrl:"/s3/partials/bucket-replication/replicationmodal.html",controller:"ReplicationModalController"}}]);angular.module("s3").controller("ReplicationModalController",["$scope","$translate","$timeout","APIProxyService","BucketPropertiesService","BucketPolicyService","ConsoleOperation","IAMService","ReplicationUtilService","Region","ReplicationConstants","S3Constants","SCLogService","UtilService",a]);function a(o,p,t,q,j,g,k,m,l,f,u,n,e,v){o.STEP={SOURCE:{name:"SOURCE",value:p.instant("replicationmodal.label.source")},DESTINATION:{name:"DESTINATION",value:p.instant("replicationmodal.label.destination")},PERMISSIONS:{name:"PERMISSIONS",value:p.instant("replicationmodal.label.permissions")},REVIEW:{name:"REVIEW",value:p.instant("replicationmodal.label.review")}};o.REPLICATION=u.REPLICATION;o.showBucketPolicyTemplate=false;o.modalState={showNext:true,showSourceVersioningWarning:false,destinationVersioningWarning:null};o.headerTitle=p.instant("replicationmodal.modaltitle");o.state=o.STEP.SOURCE;o.modalInfo.prefixList=_.pluck(o.replicationObj.ruleSettings.Rule,"Prefix").filter(function(w){return w!==""});o.modalInfo.prefixOrWholeBucketOptions=[{text:p.instant("crr.globalconfig.source.prefix"),value:u.REPLICATION.PREFIX},{text:p.instant("crr.globalconfig.source.entirebucket"),value:u.REPLICATION.ENTIRE_BUCKET}];o.bucketSelectorObj={};o.modalInfo.regions=[];o.showOverrideDestWarning=false;o.storageClasses=[{value:n.STORAGE_CLASSES.STANDARD,text:p.instant("replication.storageclasses.standard")},{value:n.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS,text:p.instant("replication.storageclasses.standardia")},{value:n.STORAGE_CLASSES.REDUCED_REDUNDANCY,text:p.instant("replication.storageclasses.reducedredundancy")}];o.copyFinished={flag:null};o.modalInfo.iamRoles=[];o.modalInfo.iamRoles.push({text:p.instant("replication.roles.createnew"),value:u.REPLICATION.NEWROLE,pinnedTop:true});v.getFACRegions(f.regionMapping,o.modalInfo.regions);o.modalInfo.regions=_.filter(o.modalInfo.regions,function(w){return w.text!==o.replicationObj.globalSettings.sourceBucket.region});o.isEnablingDestinationVersioning={flag:false};b();function b(){l.initBucketSelector(o.bucketSelectorObj,o.replicationObj);o.modalInfo.showChangeDestinationBtn=h(o.modalInfo.isAdd);o.modalInfo.showChangeRoleBtn=d(o.modalInfo.isAdd);o.showOverrideDestWarning=o.modalInfo.showChangeDestinationBtn;o.showChangeRoleWarning=o.modalInfo.showChangeRoleBtn;if(o.modalInfo.isOpen&&o.modalInfo.isOpen.flag){if(o.modalInfo.isAdd){o.tmpReplicationObj={Destination:{Bucket:{name:null,region:null},StorageClass:{value:null,text:o.modalInfo.storageTextMapping[n.STORAGE_CLASSES.DEFAULT]},changeDefaultStorageClass:false},ID:null,Prefix:null,Status:u.REPLICATION.ENABLED,isEntireBucket:(!o.replicationObj.ruleSettings.Rule||o.replicationObj.ruleSettings.Rule.length<1).toString(),Role:null};o.selectedRule.flag=false;o.selectedRule.ruleObj={}}else{o.tmpReplicationObj=_.cloneDeep(o.selectedRule.ruleObj);o.bucketSelectorObj.destinationBucket.name=_.get(o.tmpReplicationObj,"Destination.Bucket.name","")}o.tmpReplicationObj.Destination.Bucket=_.clone(o.replicationObj.globalSettings.destinationBucket);o.tmpReplicationObj.Role=_.clone(o.replicationObj.globalSettings.Role);r()}if(o.modalInfo.flag){i()}s()}o.validateBucketName=function(){v.validateBucketName(o.bucketSelectorObj.destinationBucket.name,o.bucketSelectorObj.destinationBucket.bucketNameValidationErrors,o.bucketSelectorObj.bucketListCurrAccount)};o.hideChangeDestinationBtn=function(){o.modalInfo.showChangeDestinationBtn=false};o.hideChangeRoleBtn=function(){o.modalInfo.showChangeRoleBtn=false};function c(){o.tmpReplicationObj.Destination.Bucket.name=o.bucketSelectorObj.destinationBucket.name;if(_.isEmpty(o.bucketSelectorObj.destinationBucket.region)){j.getBucketRegion(o.tmpReplicationObj.Destination.Bucket.name).then(function(w){o.tmpReplicationObj.Destination.Bucket.region=w.text})}else{if(_.isObject(o.bucketSelectorObj.destinationBucket.region)){o.tmpReplicationObj.Destination.Bucket.region=o.bucketSelectorObj.destinationBucket.region.text}else{o.tmpReplicationObj.Destination.Bucket.region=o.bucketSelectorObj.destinationBucket.region}}}o.nextCRRStep=function(){o.copyFinished={flag:null};if(o.state===o.STEP.SOURCE){if(o.tmpReplicationObj.isEntireBucket==="true"){o.tmpReplicationObj.Prefix=null}o.nextState()}else{if(o.state===o.STEP.DESTINATION){c();if(o.bucketSelectorObj.destinationBucket.createNewDestBucket){q.headBucket(new k("checkBucketAvailability"),o.tmpReplicationObj.Destination.Bucket.name).then(function(){o.bucketSelectorObj.destinationBucket.bucketNameValidationErrors=[p.instant("createbucketmodal.bucketname.exists.error")]})["catch"](function(w){if(w.status===n.HTTP_STATUS_CODES.NOT_FOUND){o.nextState()}else{o.bucketSelectorObj.destinationBucket.bucketNameValidationErrors=[p.instant("createbucketmodal.bucketname.exists.error")]}});o.showBucketPolicyTemplate=false}else{o.showBucketPolicyTemplate=o.bucketSelectorObj.isCrossAccount;o.nextState()}}else{if(o.state===o.STEP.PERMISSIONS){o.modalInfo.modalError.saveError=null;o.nextState()}else{o.nextState()}}}};o.checkInputPrefix=function(w){if(w!==o.selectedRule.ruleObj.Prefix){if(o.modalInfo.prefixList.indexOf(w)>-1){o.modalInfo.modalError.inputPrefixError=p.instant("replicationmodal.existprefixwarning")}else{o.modalInfo.modalError.inputPrefixError=null}}};o.resetInputPrefixError=function(){o.modalInfo.modalError.inputPrefixError=null};o.closeReplicationModal=function(){o.selectedRule.flag=false;o.selectedRule.ruleObj={};o.modalInfo.isOpen={flag:false};o.modalInfo.isEntireBucket=o.replicationObj.globalSettings.isEntireBucket;o.modalInfo.modalError.saveError=null;o.modalInfo.modalError.inputPrefixError=null;o.modalInfo.modalError.sourceVersioning=null;o.modalInfo.modalError.listRoleError=null;v.bodyFreezeScroll(false);o.modalInfo.prefixOrWholeBucket=o.replicationObj.globalSettings.isEntireBucket?_.find(o.modalInfo.prefixOrWholeBucketOptions,{value:u.REPLICATION.ENTIRE_BUCKET}):_.find(o.modalInfo.prefixOrWholeBucketOptions,{value:u.REPLICATION.PREFIX});if(o.modalInfo.isOverride){i();l.initBucketSelector(o.bucketSelectorObj,o.replicationObj);o.modalInfo.isEditing=false;o.modalInfo.isOverride=false;o.modalInfo.isAdd=false}o.state=o.STEP.SOURCE};o.enableSourceVersioning=function(){o.modalInfo.modalError.sourceVersioning=null;o.isEnablingSourceVersioning=true;var w=new k("enableBucketVersioning");j.enableBucketVersioning(o.replicationObj.globalSettings.sourceBucket.name,w).then(function(){e.log("CRR_enableBucketVersioning",1,w);o.modalState.showSourceVersioningWarning=false;o.modalState.showNext=true})["catch"](function(x){e.log("CRR_enableBucketVersioning",0,w);o.modalState.showSourceVersioningWarning=true;o.modalInfo.modalError.sourceVersioning=x})["finally"](function(){o.isEnablingSourceVersioning=false})};o.enableDestinationVersioning=function(){l.enableDestinationVersioning(o.isEnablingDestinationVersioning,o.bucketSelectorObj,o.modalState)};o.$watch("bucketSelectorObj.destinationBucket.name",function(x,w){if(o.modalInfo.isEditing&&x!==w){o.bucketSelectorObj.destinationBucket.Errors={};o.modalInfo.modalError.saveError=null;o.showBucketPolicyTemplate=o.bucketSelectorObj.isCrossAccount}});o.$watch("selectedRule.flag",function(w){if(w===true){l.initBucketSelector(o.bucketSelectorObj,o.replicationObj);o.modalInfo.modalError.saveError=null}});o.resetStorageClassValue=function(){o.tmpReplicationObj.Destination.StorageClass={value:null,text:o.modalInfo.storageTextMapping[n.STORAGE_CLASSES.DEFAULT]}};o.updateStorageClassText=function(w){if(o.modalInfo.storageTextMapping&&w){o.tmpReplicationObj.Destination.StorageClass.text=o.modalInfo.storageTextMapping[w]}};o.copyPolicyToClipboard=function(w,x){v.copyPathToClipboard(o.crrBucketPolicy,x)};o.scrollIntoView=function(w){v.scrollCardToView(w)};o.savePressed=function(){o.isSaving={flag:true};l.saveReplication(o.isSaving,o.tmpReplicationObj,o.bucketSelectorObj,o.modalInfo,o.replicationObj,function(){o.modalInfo.isEditing=false;o.bucketSelectorObj.destinationBucket.Errors={};o.replicationObj.errorMessage="";o.closeReplicationModal()},function(x){o.modalInfo.modalError.saveError=x;var w=$(".replication-modal .modal-body");t(function(){w.animate({scrollTop:$(".crr-save-error").offset().top-w.offset().top+w.scrollTop()})},50)})};function s(){var w=new k("listRoles","getListRoles");e.log("ListRolesRequestReceived",1,w);q.makeProxyRequest(m.listRoles,{region:v.getDefaultRegion(),params:{MaxItems:n.API_MAX_ITEMS.IAM_LIST_ROLES}},n.PROXY_API_NAMES.IAM.LIST_ROLES,w).then(function(y){var x=y.response.ListRolesResponse.ListRolesResult.Roles;e.log("CRR_ListRoles",1,w);o.modalInfo.modalError.listRoleError=null;x.forEach(function(z){if(_.findIndex(o.modalInfo.iamRoles,{value:z.Arn})===-1){o.modalInfo.iamRoles.push({text:z.RoleName,value:z.Arn})}})})["catch"](function(x){e.log("CRR_ListRoles",0,w);o.modalInfo.modalError.listRoleError=v.handleErrors(x)})}function r(){var w=new k("BucketReplication","getVersioning");j.getBucketVersioning(o.replicationObj.globalSettings.sourceBucket.name,w).then(function(x){e.log("CRR_BucketReplication",1,w);o.modalInfo.modalError.sourceVersioning=null;o.modalState.showSourceVersioningWarning=x!==u.REPLICATION.ENABLED;o.modalState.showNext=x===u.REPLICATION.ENABLED})["catch"](function(x){e.log("CRR_BucketReplication",0,w);o.modalState.showSourceVersioningWarning=true;o.modalInfo.modalError.sourceVersioning=x;o.modalState.showNext=false})}function h(w){if(_.isEmpty(o.replicationObj.globalSettings.destinationBucket.name)){return false}else{if(w||o.replicationObj.ruleSettings.Rule&&o.replicationObj.ruleSettings.Rule.length>1){return true}}}function d(w){if(_.isEmpty(o.replicationObj.globalSettings.Role)||_.isEmpty(o.replicationObj.globalSettings.Role.text)){return false}else{if(w||o.replicationObj.ruleSettings.Rule&&o.replicationObj.ruleSettings.Rule.length>1){return true}}}o.policyEditorLoaded=function(w){o.crrBucketPolicy=g.generateBucketPolicy(o.tmpReplicationObj.Destination.Bucket.name,u.CRR_BUCKET_POLICY_TEMPLATE);w.getSession().getDocument().setValue(o.crrBucketPolicy)};function i(){if(_.isEmpty(o.tmpReplicationObj)){o.tmpReplicationObj={}}l.initializeTmpReplicationObj(o.replicationObj,o.tmpReplicationObj,o.modalInfo.storageTextMapping)}}})();"use strict";(function(){angular.module("s3").directive("crrErrorModal",[function(){return{restrict:"E",scope:{modalOpen:"=",errorType:"=",bucketSelectorObj:"=",bucket:"=",copyPolicyToClipboard:"="},templateUrl:"/s3/partials/bucket-replication/crr-errormodal.html",controller:"CrrErrorModalController"}}]);angular.module("s3").controller("CrrErrorModalController",["$scope","$translate","BucketPolicyService","ReplicationUtilService","ReplicationConstants","UtilService",a]);function a(e,f,d,h,g,c){e.copyFinished={flag:null};e.errorModal={};e.isEnablingVersioning={flag:false};b();function b(){c.bodyFreezeScroll(true);switch(e.errorType){case"disabled":e.errorModal.title=f.instant("crr.warningmsg.title.notenabled");e.errorModal.header=f.instant("crr.warningmsg.content.notenabled");e.errorModal.contentText=f.instant("crr.warningmsg.detail.notenabled");e.bucket.name=e.bucketSelectorObj.destinationBucket.name;break;case"getFailure":e.errorModal.title=f.instant("crr.warningmsg.title.accessdenied");e.errorModal.contentText=f.instant("crr.warningmsg.detail.cannotdetectversioning");e.errorModal.header=f.instant("crr.warningmsg.content.cannotdetectversioning");e.bucket.name=e.bucketSelectorObj.destinationBucket.name;break;case"saveFailure":e.errorModal.title=f.instant("crr.warningmsg.title.accessdenied");e.errorModal.contentText=f.instant("crr.warningmsg.detail.cannotenableversioning");e.errorModal.header=f.instant("crr.warningmsg.content.cannotenableversioning");e.bucket.name=e.bucketSelectorObj.destinationBucket.name;break}}e.policyEditorLoaded=function(i){e.crrBucketPolicy=d.generateBucketPolicy(e.bucket.name,g.CRR_BUCKET_POLICY_TEMPLATE);i.getSession().getDocument().setValue(e.crrBucketPolicy)};e.closeErrorModal=function(){e.errorModal.title=null;e.errorModal.header=null;e.modalOpen={flag:false};e.errorModal.contentText=null;c.bodyFreezeScroll(false)};e.enableDestinationVersioning=function(){h.enableDestinationVersioning(e.isEnablingVersioning,e.bucketSelectorObj,null,true,e.closeErrorModal)}}})();"use strict";(function(){angular.module("s3").directive("crrGlobalSettings",[function(){return{restrict:"E",scope:{modalInfo:"=",bucketSelectorObj:"=",replicationObj:"=",tmpReplicationObj:"=",selectedRule:"="},templateUrl:"/s3/partials/bucket-replication/crr-globalsettings.html",controller:"CrrGlobalSettingsController"}}]);angular.module("s3").controller("CrrGlobalSettingsController",["$scope","BucketPolicyService","ReplicationUtilService","ReplicationConstants","UtilService",a]);function a(d,c,g,f,b){d.copyFinished={flag:false};d.errorModal={isOpen:null};function e(h){d.modalInfo.isOpen={flag:true};d.modalInfo.isOverride=true;d.modalInfo.isAdd=true;d.modalInfo.isEditing=false;d.modalInfo.showChangeDestinationBtn=false;d.modalInfo.showChangeRoleBtn=false;d.tmpReplicationObj.Destination.Bucket=_.clone(d.bucketSelectorObj.destinationBucket);d.tmpReplicationObj.isEntireBucket=h.toString();b.bodyFreezeScroll(true)}d.$watch("modalInfo.prefixOrWholeBucket.value",function(i,h){if(d.modalInfo.isEditing&&h!==i){if(i===f.REPLICATION.PREFIX&&d.modalInfo.isEntireBucket){e(false)}else{if(i===f.REPLICATION.ENTIRE_BUCKET&&!d.modalInfo.isEntireBucket){e(true)}else{d.modalInfo.isOverride=false;d.modalInfo.isAdd=false;d.modalInfo.showChangeDestinationBtn=false;d.modalInfo.showChangeRoleBtn=false}}}});d.validateBucketName=function(){b.validateBucketName(d.bucketSelectorObj.destinationBucket.name,d.bucketSelectorObj.destinationBucket.bucketNameValidationErrors,d.bucketSelectorObj.bucketListCurrAccount)};d.enableEditGlobalConfig=function(){d.selectedRule.flag=false;d.selectedRule.ruleObj={};g.initializeTmpReplicationObj(d.replicationObj,d.tmpReplicationObj,d.modalInfo.storageTextMapping);g.initBucketSelector(d.bucketSelectorObj,d.replicationObj);d.modalInfo.isEditing=true};d.copyPolicyToClipboard=function(h,i){h=!_.isEmpty(d.bucketSelectorObj.destinationBucket.name)?d.bucketSelectorObj.destinationBucket.name:h;b.copyPathToClipboard(c.generateBucketPolicy(h,f.CRR_BUCKET_POLICY_TEMPLATE),i)};d.cancelModifyGlobalConfig=function(){d.modalInfo.isEditing=false;g.initializeTmpReplicationObj(d.replicationObj,d.tmpReplicationObj,d.modalInfo.storageTextMapping);g.initBucketSelector(d.bucketSelectorObj,d.replicationObj);d.modalInfo.modalError.saveError=null};d.showGlobalConfigErrorModal=function(h){d.errorType=h;d.errorModal.isOpen={flag:true}};d.savePressed=function(){d.isSaving={flag:true};d.tmpReplicationObj.Destination.Bucket.name=d.bucketSelectorObj.destinationBucket.name;d.tmpReplicationObj.Destination.Bucket.region=d.bucketSelectorObj.destinationBucket.region;g.saveReplication(d.isSaving,d.tmpReplicationObj,d.bucketSelectorObj,d.modalInfo,d.replicationObj,function(){d.modalInfo.isEditing=false;d.bucketSelectorObj.destinationBucket.Errors={};d.replicationObj.errorMessage="";d.selectedRule.flag=false;d.selectedRule.ruleObj={};d.cancelModifyGlobalConfig()},function(h){d.modalInfo.modalError.saveError=h})}}})();"use strict";(function(){angular.module("s3").constant("ReplicationConstants",{CRR_BUCKET_POLICY_TEMPLATE:{Version:"2008-10-17",Id:"S3-Console-Replication-Policy",Statement:[{Sid:"S3ReplicationPolicyStmt1",Effect:"Allow",Principal:{AWS:"arn:aws:iam::ACCOUNT_ID:root"},Action:["s3:GetBucketVersioning","s3:PutBucketVersioning","s3:ReplicateObject","s3:ReplicateDelete"],Resource:["arn:aws:s3:::DESTINATION_BUCKET","arn:aws:s3:::DESTINATION_BUCKET/*"]}]},REPLICATION:{ENABLED:"Enabled",DISABLED:"Disabled",ENABLED_ALL:"enabledAll",DISABLED_ALL:"disabledAll",DELETE_ALL:"deleteAll",CONFIGNOTFOUND:"The replication configuration was not found",NEWROLE:"newrole",ENTIRE_BUCKET:"entireBucket",PREFIX:"prefix"},ERROR_CODE:{ENTITY_EXIST:"EntityAlreadyExists",ACCESS_DENIED:"AccessDenied",LIMIT_EXCEED:"LimitExceeded"}})})();"use strict";(function(){angular.module("s3").service("ReplicationUtilService",["$q","$translate","$timeout","APIProxyService","BucketPropertiesService","BucketPolicyService","CachingService","ConsoleOperation","Region","ReplicationConstants","S3Constants","SCLogService","UtilService",function(v,q,x,r,j,f,h,n,e,z,p,d,A){function a(B,D){var C={Status:B.Status,Prefix:B.Prefix,Destination:{Bucket:{name:D.destinationBucket}}};if(_.isEmpty(_.get(B,"Destination.StorageClass.value"))){C.Destination.changeDefaultStorageClass=false}else{C.Destination.changeDefaultStorageClass=true;C.Destination.StorageClass={value:B.Destination.StorageClass.value}}return C}function c(E,G,D,B){var H=arguments.length<=4||arguments[4]===undefined?-1:arguments[4];var C={};C.destinationBucket=B.Destination.Bucket.name;C.role=G.value;C.rules=_.cloneDeep(D);if(E){C.rules.push(a(B,C))}else{if(H<=-1){var F=_.findIndex(C.rules,{ID:B.ID});if(F>-1){C.rules[F].Status=B.Status;C.rules[F].Prefix=B.Prefix;if(_.isEmpty(_.get(B,"Destination.StorageClass.value"))){delete C.rules[F].Destination.StorageClass;C.rules[F].Destination.changeDefaultStorageClass=false}else{C.rules[F].Destination.StorageClass={value:B.Destination.StorageClass.value};C.rules[F].Destination.changeDefaultStorageClass=true}}if(D.length>1&&B.isEntireBucket==="true"){C.rules.length=0;C.rules.push(a(B,C))}}else{if(H>-1){C.rules.splice(H,1)}}}return C}function u(C,B,D){C.globalSettings.Role={text:_.last(B.role.split("/")),value:B.role};C.ruleSettings.Rule=[].concat(B.rules);C.globalSettings.destinationBucket={name:B.destinationBucket,region:null};_.forEach(C.ruleSettings.Rule,function(E){E.Destination.Bucket={name:C.globalSettings.destinationBucket.name,region:null};j.getBucketRegion(C.globalSettings.destinationBucket.name).then(function(F){C.globalSettings.destinationBucket.region=F.text;E.Destination.Bucket.region=F.text});if(E.Destination.changeDefaultStorageClass){E.Destination.StorageClass={value:E.Destination.StorageClass.value,text:D[E.Destination.StorageClass.value]}}else{E.Destination.StorageClass={value:null,text:D[p.STORAGE_CLASSES.DEFAULT]}}E.Prefix=_.isEmpty(E.Prefix)?"":E.Prefix;E.isEntireBucket=_.isEmpty(E.Prefix).toString();E.ID=_.isEmpty(E.ID)?E.isEntireBucket==="true"?"tmp-entirebucket":"tmp-"+E.Prefix:E.ID})}function y(C,B){C.isCrossAccount=false;C.bucketListCurrAccount=[];C.sourceBucket=B.globalSettings.sourceBucket.name;C.sourceRegion=B.globalSettings.sourceBucket.region;C.destinationBucket={name:null,region:null,versioningEnabled:null,createNewDestBucket:false,bucketNameValidationErrors:[]};C.destinationBucket.Errors={};if(!_.isEmpty(B.globalSettings.destinationBucket.name)){C.destinationBucket.name=B.globalSettings.destinationBucket.name;C.destinationBucket.region=B.globalSettings.destinationBucket.region}}function t(C,B,D){B.Destination={Bucket:_.cloneDeep(C.globalSettings.destinationBucket),StorageClass:{value:null,text:D[p.STORAGE_CLASSES.DEFAULT]},changeDefaultStorageClass:false};B.ID=null;B.Prefix=null;B.Status=z.REPLICATION.ENABLED;B.isEntireBucket=C.globalSettings.isEntireBucket.toString();B.Role={text:C.globalSettings.Role.text,value:C.globalSettings.Role.value}}function b(F,E){var C=arguments.length<=2||arguments[2]===undefined?null:arguments[2];var D=arguments.length<=3||arguments[3]===undefined?false:arguments[3];var G=arguments.length<=4||arguments[4]===undefined?null:arguments[4];F.flag=true;var B=new n("enableBucketVersioning");if(E&&E.destinationBucket){j.enableBucketVersioning(E.destinationBucket.name,B).then(function(){d.log("CRR_enableBucketVersioning",1,B);E.destinationBucket.versioningEnabled=true;E.destinationBucket.Errors.getVersioningError=null;E.destinationBucket.Errors.enabledVersioningError=null;if(D){G()}else{if(C){C.showNext=true}}})["catch"](function(H){d.log("CRR_enableBucketVersioning",0,B);E.destinationBucket.versioningEnabled=null;E.destinationBucket.Errors.getVersioningError=null;E.destinationBucket.Errors.enabledVersioningError=H})["finally"](function(){F.flag=false})}}function w(G,D,E){var C={};C.sourceBucket=G;C.destinationBucket=D;C.isExistingRole=E.value!==z.REPLICATION.NEWROLE;if(!C.isExistingRole){var B="s3crr_role_for_"+C.sourceBucket+"_to_"+C.destinationBucket;C.roleName=B.length>p.ENTITY_MAX_LENGTH.ROLE?B.substr(0,p.ENTITY_MAX_LENGTH.ROLE):B}else{C.roleName=E.text}var F="s3crr_policy_for_"+C.sourceBucket+"_to_"+C.destinationBucket;C.rolePolicy=F.length>p.ENTITY_MAX_LENGTH.POLICY?F.substr(0,p.ENTITY_MAX_LENGTH.POLICY):F;return C}function l(B){return B.substring(B.lastIndexOf(":")+1)}function o(C,D,B){C.currTimes=C.currTimes+1;return j.enableBucketVersioning(D,B).then(function(){return v.when()})["catch"](function(F){var E=A.handleErrors(F);if(C.currTimes<=C.maxTimes&&E===p.STATUS_CODE_MAP[p.HTTP_STATUS_CODES.NOT_FOUND]){return x(function(){return o(C,D,B)},C.timeInterval)}else{return v.reject(E)}})}function k(C,F,E,D){var B=new n("createBucketEnablingVersioning");return r.createBucket(B,C,F).then(function(){d.log("CRR_createBucket",1,B,{bucketName:C,region:F});h.evictLamb();D.destinationBucket.createNewDestBucket=false;return o({currTimes:0,maxTimes:3,timeInterval:6000},C,new n("enableBucketVersioning"))}).then(function(){d.log("CRR_enableBucketVersioning",1,B,{bucketName:C,region:F});if(E){return E(C)}return v.when()})["catch"](function(G){d.log("CRR_createBucketAndEnableVersioningVersioning",0,B,{bucketName:C,region:F});return v.reject(G)})}function m(G,F,H,C,B,E){var D=new n("createIAMRole");return A.createOrUpdateRoleForReplication(G.roleName,G.rolePolicy,G.sourceBucket,G.destinationBucket,G.isExistingRole).then(function(J){var I=E(J,true);d.log("CRR_createOrUpdateRole",1,D);if(F){return F(I,H,C,B)}return v.when(I)})["catch"](function(J){var I=E(false);if(_.get(J,"response.Error.Code")==="EntityAlreadyExists"||_.get(J,"response.Error.Code")==="AccessDenied"||_.get(J,"response.Error.Code")==="LimitExceeded"){d.log("CRR_createOrUpdateRole",1,D);if(F){return F(I,H,C,B)}return v.when(I)}else{d.log("CRR_createOrUpdateRole",0,D);return v.reject(A.handleErrors(J))}})}function s(G,B,H,F,C){var E=w(C.globalSettings.sourceBucket.name,F,B.Role);var D=function D(J,K){if(K){var I=undefined;if(!E.isExistingRole&&J){I={text:_.last(J.split("/")),value:J};B.Role.text=I.text;B.Role.value=I.value;if(_.findIndex(H.iamRoles,{value:I.value})===-1){H.iamRoles.push(I)}}else{I=B.Role}return I}else{return _.clone(B.Role)}};return m(E,G,H,C,B,D)}function g(H,I,D,C){var F=new n("putBucketReplication");var E=undefined,G=undefined;if(I.isOverride){E=[];G=true}else{E=_.isEmpty(D.ruleSettings.Rule)?[]:_.cloneDeep(D.ruleSettings.Rule);G=I.isAdd}var B=c(G,H,E,C);return j.putBucketReplication(D.globalSettings.sourceBucket.name,F,B).then(function(){d.log("putBucketReplication",1,F);u(D,B,I.storageTextMapping);I.isEntireBucket=_.findIndex(D.ruleSettings.Rule,function(J){return _.isEmpty(J.Prefix)})>-1;D.globalSettings.isEntireBucket=I.isEntireBucket;I.prefixList=_.pluck(D.ruleSettings.Rule,"Prefix").filter(function(J){return J!==""});return v.when()})["catch"](function(J){d.log("putBucketReplication",0,F);return v.reject(A.handleErrors(J))})}function i(K,C,I,F,G,D,H){K.flag=true;var E=C.Destination.Bucket.name,J=_.isObject(C.Destination.Bucket.region)?e.twoWayMapping[C.Destination.Bucket.region.text]:e.twoWayMapping[C.Destination.Bucket.region];if(I.destinationBucket.createNewDestBucket){var B=function B(){return s(g,C,F,E,G)};k(E,J,B,I).then(function(){D()})["catch"](function(L){H(L)})["finally"](function(){K.flag=false})}else{if(E===G.globalSettings.destinationBucket.name&&C.Role.value===G.globalSettings.Role.value){g(C.Role,F,G,C).then(function(){D()})["catch"](function(L){H(L)})["finally"](function(){K.flag=false})}else{s(g,C,F,E,G).then(function(){D()})["catch"](function(L){H(L)})["finally"](function(){K.flag=false})}}}return{extractDestinationBucket:l,getUpdateReplicationObj:c,updateReplicationTable:u,handleIAMRole:w,initBucketSelector:y,initializeTmpReplicationObj:t,enableDestinationVersioning:b,createNewDestBucketRequest:k,IAMRoleRequest:m,CRRIAMRoleRequest:s,putCRRRequest:g,saveReplication:i}}])})();"use strict";(function(){angular.module("s3").directive("bucketReplicationV1",function(){return{restrict:"E",scope:{cardOpen:"=",forCreateBucketModal:"=?",replicationObj:"=?",modalInfo:"=?",versioningStatus:"=",id:"@?"},templateUrl:"/s3/partials/replicationv1.html",controller:"BucketReplicationV1Controller"}});angular.module("s3").controller("BucketReplicationV1Controller",["$filter","$scope","$timeout","$translate","APIProxyService","AwsUrlsService","BucketPropertiesService","BucketPropertiesUtilService","ConsoleOperation","FAC","IAMService","PathService","Region","S3Constants","SCLogService","UtilService",a]);function a(o,r,w,s,t,c,j,h,m,k,p,e,f,q,d,y){var n,i,l;function b(){if(!k.isFeatureEnabled(q.FAC.CRR)){return}r.cardState={ruleBeingEdited:null,isExpanded:false,isSaving:false};if(!r.forCreateBucketModal){r.replicationObj={role:"",destinationBucket:null,storageClass:"",rulesArray:[],replicationType:"",isEnabled:q.REPLICATION.DISABLED}}r.errorMessage="";r.bucketList=[];r.allMyBuckets=[];r.S3Constants=q;l=new m("getBucketReplication","getBucketReplication");r.iamRoles=[];r.iamRoles.push({text:s.instant("replication.roles.createnew"),value:q.REPLICATION.NEWROLE});r.scrollCardId="#"+r.id;r.cardSummaryObj=_.cloneDeep(q.CARD_SUMMARY_INIT);if(r.forCreateBucketModal){r.$watch("cardOpen",function(A,z){w(function(){y.scrollCardToView(q.BUCKET_PROPERTIES.REPLICATION.CREATE_BUCKET_CARD)},1)})}if(r.forCreateBucketModal){n=r.modalInfo.name;i=r.modalInfo.region;r.regionMapping=[];f.regionMapping.forEach(function(z){if(z.value!==i){r.regionMapping.push(z)}});r.sourceRegion=f.twoWayMapping[i]+" ("+i+")"}else{n=e.getCurrentBucket();j.getBucketLocation(n).then(function(z){i=z;r.regionMapping=[];var A=[];y.getFACRegions(f.regionMapping,A);A.forEach(function(B){if(B.value!==i){r.regionMapping.push(B)}});r.sourceRegion=f.twoWayMapping[z]+" ("+z+")"})["catch"](function(z){r.errorMessage=y.handleErrors(z)})}r.sources=[{value:"bucket",text:s.instant("replication.label.bucket")},{value:"prefix",text:s.instant("replication.label.prefix")}];r.storageClasses=[{value:q.STORAGE_CLASSES.DEFAULT,text:s.instant("replication.storageclasses.default")},{value:q.STORAGE_CLASSES.STANDARD,text:s.instant("replication.storageclasses.standard")},{value:q.STORAGE_CLASSES.STANDARD_INFREQUENT_ACCESS,text:s.instant("replication.storageclasses.standardia")},{value:q.STORAGE_CLASSES.REDUCED_REDUNDANCY,text:s.instant("replication.storageclasses.reducedredundancy")}];if(!k.isFeatureEnabled(q.FAC.S3_RRS)){r.storageClasses=_.reject(r.storageClasses,function(z){return z.value===q.STORAGE_CLASSES.REDUCED_REDUNDANCY})}r.storageClassesMap={};r.storageClasses.forEach(function(z){r.storageClassesMap[z.value]=z.text;r.storageClassesMap[z.text]=z.value});d.log("ListAllMyBucketsRequestReceived",1,l);t.listAllMyBuckets(l).then(function(z){var A=z.response.ListAllMyBucketsResult.Buckets.Bucket;d.log("ListAllMyBucketsSuccess",1,l);r.allMyBuckets=A;r.updateBucketList(false)})["catch"](function(z){d.log("ListAllMyBucketsSuccess",0,l);r.errorMessage=y.handleErrors(z)});v();r.cardSummaryObj.isLoading=true;u(n,false)}r.resetError=function(){r.errorMessage=null};r.$watchCollection("replicationObj.destinationRegion",function(A,z){if(!_.isEmpty(A)&&!_.isEqual(A,z)){if(r.replicationObj.resetDestinationBucket){r.replicationObj.destinationBucket=null}r.updateBucketList();r.resetError();r.replicationObj.resetDestinationBucket=true}});r.displayListRoleError=function(){return !_.isEmpty(r.listRoleError)&&$(".crr-listrole span.awsui-select-target.awsui-select-open.awsui-select-target-focused").length>0};function v(){var z=y.getDefaultRegion();d.log("ListRolesRequestReceived",1,l);t.makeProxyRequest(p.listRoles,{region:z,params:{MaxItems:q.API_MAX_ITEMS.IAM_LIST_ROLES}},q.PROXY_API_NAMES.IAM.LIST_ROLES,l).then(function(B){var A=B.response.ListRolesResponse.ListRolesResult.Roles;d.log("ListRolesSuccess",1,l);A.forEach(function(C){if(_.findIndex(r.iamRoles,{value:C.Arn})===-1){r.iamRoles.push({text:C.RoleName,value:C.Arn})}});r.listRoleError=null})["catch"](function(B){d.log("ListRolesSuccess",0,l);var A=y.handleErrors(B);r.listRoleError=A})}function u(z,A,B){if(!r.forCreateBucketModal){j.getBucketReplication(z,l).then(function(D){var C=D.response;r.replicationObj.resetDestinationBucket=A;h.populateReplicationObj(C,z,r.replicationObj,r.regionMapping,!A).then(function(){r.updateBucketList(A);g()});r.replicationObj.configExists=true})["catch"](function(C){if(C===q.REPLICATION.CONFIGNOTFOUND){r.replicationObj.configExists=false}else{r.errorMessage=y.handleErrors(C)}g()})["finally"](function(){if(r.replicationObj&&r.replicationObj.role&&!B){var C=_.clone(r.replicationObj.role);if(_.findIndex(r.iamRoles,{value:C})===-1){r.iamRoles.push({text:_.last(C.split("/")),value:C})}}})}else{if(r.replicationObj&&r.replicationObj.response!==undefined){h.populateReplicationObj(r.replicationObj.response,z,r.replicationObj).then(function(){r.updateBucketList(A)})}}}r.removeRule=function(B,A,z){if(z){A.stopPropagation()}r.replicationObj.rulesArray.splice(_.findIndex(r.replicationObj.rulesArray,function(C){return B===C}),1);B.storageClass="";B.prefix="";B.markedForDelete=true};r.updateBucketList=function(A){var z=[];r.allMyBuckets.forEach(function(B){j.getBucketLocation(B.Name).then(function(C){if(r.replicationObj&&r.replicationObj.destinationRegion&&(C===r.replicationObj.destinationRegion||C===r.replicationObj.destinationRegion.value)){z.push(B.Name)}if(A){r.errorMessage=""}r.bucketList=y.transformListOfOptionsToDropdown(z)})})};r.allRulesEmpty=function(){return _.every(r.replicationObj.rulesArray,function(z){return z.prefix===""&&z.storageClass===""})};r.addRule=function(z){z.stopPropagation();if(r.completeEdit()){r.cardState.isExpanded=true;var A={prefix:"",status:q.REPLICATION.ENABLED,storageClass:"",isEditing:true};r.replicationObj.rulesArray.push(A);r.cardState.ruleBeingEdited=A}};r.completeEdit=function(){var z=r.cardState.ruleBeingEdited;if(!z){return true}else{if(z.prefix!==""&&z.storageClass!==""||z.markedForDelete){z.prefixError=false;z.storageError=false;z.isEditing=false;r.cardState.ruleBeingEdited=null;return true}else{if(z.prefix===""&&z.storageClass===""){z.storageError=false;z.prefixError=false;r.removeRule(z,"",false);return true}else{if(z.prefix===""){z.prefixError=true;z.storageError=false}else{z.storageError=true;z.prefixError=false}return false}}}};r.editRule=function(A,z){z.stopPropagation();if(r.completeEdit()){A.isEditing=true;r.cardState.ruleBeingEdited=A}};r.isDisable=function(){return r.replicationObj.isEnabled===q.REPLICATION.ENABLED&&(r.replicationObj.destinationBucket===null||r.replicationObj.role===""||r.replicationObj.replicationType==="bucket"&&r.replicationObj.storageClass===""||r.replicationObj.replicationType==="prefix"&&(r.replicationObj.rulesArray.length===0||r.allRulesEmpty()))};r.savePressed=function(C){if(r.isDisable(r.replicationObj)){return}y.analyticsTrackClick(q.ANALYTICS.SAVE_REPLICATION,q.ANALYTICS.DETAILS);if(!r.completeEdit()){return}r.replicationObj.rules=[];h.handleRules(n,r.replicationObj);var A=r.replicationObj.destinationBucket.value||r.replicationObj.destinationBucket;var z="",D=false;if(r.replicationObj.role===q.REPLICATION.NEWROLE){z="replication_role_for_"+n+"_to_"+A}else{D=true;var B=r.replicationObj.role.split("/");z=B[B.length-1]}var E="replication_policy_for_"+n+"_to_"+A;if(z.length>q.ENTITY_MAX_LENGTH.ROLE){z=z.substr(0,q.ENTITY_MAX_LENGTH.ROLE)}if(E.length>q.ENTITY_MAX_LENGTH.POLICY){E=E.substr(0,q.ENTITY_MAX_LENGTH.POLICY)}y.createOrUpdateRoleForReplication_v1(z,E,n,A,D).then(function(F){if(!D){r.replicationObj.role=F}d.log("createOrUpdateRoleSuccess",1,l);x(C,D)})["catch"](function(F){r.errorMessage=y.handleErrors(F);d.log("createOrUpdateRoleSuccess",0,l)})};function x(A,B){var z=new m("putBucketReplication","putBucketReplication");if(r.forCreateBucketModal){r.replicationObj.response=j.parseBucketReplicationObject_v1(r.replicationObj);r.closeCard(A)}else{r.cardState.isSaving=true;j.putBucketReplication(n,z,r.replicationObj,true).then(function(){u(n,true,B);r.closeCard(A)})["catch"](function(C){r.errorMessage=y.handleErrors(C)})["finally"](function(){r.cardState.isSaving=false;r.replicationObj.role=""})}}r.toggleRuleStatus=function(A,z){z.stopPropagation();if(A.markedForDelete){A.markedForDelete=false}else{if(A.status===q.REPLICATION.DISABLED){A.status=q.REPLICATION.ENABLED}else{if(A.status===q.REPLICATION.ENABLED){A.status=q.REPLICATION.DISABLED}}}};r.cancelPressed=function(z){y.analyticsTrackClick(q.ANALYTICS.CANCEL_REPLICATION,q.ANALYTICS.DETAILS);r.closeCard(z);b()};r.deletePressed=function(){var z=new m("deleteReplicationConfiguration","deleteReplicationConfiguration");r.deleting=true;j.deleteBucketReplication(n,z).then(function(A){r.replicationObj.isEnabled=q.REPLICATION.DISABLED;r.replicationObj.configExists=false;r.closeCard();return A})["catch"](function(A){r.errorMessage=y.handleErrors(A)})["finally"](function(){r.deleting=false})};r.closeCard=function(z){if(z){z.stopPropagation()}r.cardOpen=false};function g(){if(r.replicationObj.isEnabled===q.REPLICATION.ENABLED){r.cardSummaryObj.isActive=true;r.cardSummaryObj.activeSummary.text=s.instant("bucketproperties.crossregionreplication.destinationbucket");r.cardSummaryObj.isMultiValue=true;r.cardSummaryObj.activeSummary.value=r.replicationObj.destinationBucket.value||r.replicationObj.destinationBucket}else{r.cardSummaryObj.isActive=false;r.cardSummaryObj.isMultiValue=false;r.cardSummaryObj.inactiveSummary.text=s.instant("bucketproperty.disabled")}r.cardSummaryObj.isLoading=false}r.docLink=c.getDocUrl(q.LEARN_MORE_LINKS.REPLICATION);b()}})();